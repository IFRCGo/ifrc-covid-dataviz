{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nexport function drawRegionchart(data, options) {\n  const regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n  groupedData = {};\n  regions.forEach(function (d, i) {\n    groupedData[d] = {\n      cumulative_case: 0,\n      cumulative_deaths: 0,\n      cumulative_vaccines: 0\n    };\n  });\n  data.who_data.forEach(function (d, i) {\n    groupedData[d.ifrc_region].new_cases += d.new_cases;\n    groupedData[d.ifrc_region].new_deaths += d.new_deaths;\n    groupedData[d.ifrc_region].cumulative_cases = 0;\n    groupedData[d.ifrc_region].cumulative_deaths = 0;\n  });\n  console.log(groupedData); // // totals by date\n  // groupedData.forEach(function(d,i){\n  //     regions.forEach(function(dd,ii){\n  //         // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n  //         if(i>0){\n  //             d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n  //             d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n  //         } else {\n  //             d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n  //             d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n  //         }\n  //     })\n  //     d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n  //     d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n  //     d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n  //     d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n  //     d.region = [];\n  //     regions.forEach(function(dd,ii){\n  //         d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n  //     })\n  // })\n  // const numIntervals = d3.max(data.who_data, function(d,i){\n  //     return d[options.timeline_frequency+'Total'];\n  // });\n  // const maxCases = d3.max(groupedData, function(d,i){\n  //     if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n  //     if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n  //     if(options.timeline_type==='stacked') return 100;\n  // })\n  // const maxDeaths = d3.max(groupedData, function(d,i){\n  //     if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n  //     if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n  //     if(options.timeline_type==='stacked') return 100;\n  // })\n  // // define date range\n  // const minDate = groupedData[0].date;\n  // const maxDate = groupedData[numIntervals].date;\n  // const svg = d3.select('#timechart_svg');\n  // svg.selectAll('g').remove();\n  // const width = 2000;\n  // const barWidth = width/numIntervals;\n  // let barSpacing = 0.04; \n  // if(options.timeline_frequency==='month') barSpacing = 0.03;\n  // if(options.timeline_frequency==='day') barSpacing = 0;\n  // const xScale = d3.scaleLinear()\n  // .range([0,width])\n  // .domain([0,numIntervals]);\n  // const yScaleCases = d3.scaleLinear()\n  // .range([0,140])\n  // .domain([0,maxCases]);\n  // const yScaleDeaths = d3.scaleLinear()\n  // .range([0,140])\n  // .domain([0,maxDeaths]);\n  // // CASES\n  // // loop through groupedData and draw bars\n  // const barGroups = svg.selectAll('.bar_group')\n  // .data(groupedData)\n  // .enter()\n  // .append('g')\n  // .attr('transform', function(d,i){ \n  //     return 'translate('+xScale(i)+')'\n  // })\n  // // CASES\n  // barGroups.selectAll('.cases_bar')\n  // .data(function(d,i){ return d.region.filter(function(dd,ii){\n  //     return dd.region!=='OTH';\n  // })})\n  // .enter()\n  // .append('rect')\n  // .attr('class', 'cases_bar')\n  // .attr('x', (barWidth*barSpacing))\n  // .attr('y', function(d,i){\n  //     const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n  //     let dp = 0;\n  //     if(i>0){\n  //         for(let ii=1;ii<=i;ii++){\n  //             if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n  //             if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n  //             if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n  //         }\n  //     }\n  //     let y = 0;\n  //     if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n  //     if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n  //     if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n  //     if(y){ return y; } else { return 0};\n  // })\n  // .attr('width', barWidth-(barWidth*barSpacing*2))\n  // .attr('height', function(d,i){\n  //     const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n  //     let y = 0;\n  //     if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n  //     if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n  //     if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n  //     if(y){ return y; } else { return 0};\n  // })\n  // .attr('fill', function(d,i){\n  //     return colors.regions[d.region];\n  // })\n  // // DEATHS\n  // barGroups.selectAll('.deaths_bar')\n  // .data(function(d,i){ return d.region.filter(function(dd,ii){\n  //     return dd.region!=='OTH';\n  // })})\n  // .enter()\n  // .append('rect')\n  // .attr('class', 'deaths_bar')\n  // .attr('x', (barWidth*barSpacing))\n  // .attr('y', function(d,i){\n  //     const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n  //     let dp = 0;\n  //     if(i>0){\n  //         for(let ii=1;ii<=i;ii++){\n  //             if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n  //             if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n  //             if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n  //         }\n  //     }\n  //     let y = 0;\n  //     if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n  //     if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n  //     if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n  //     if(y){ return y; } else { return 0};\n  // })\n  // .attr('width', barWidth-(barWidth*barSpacing*2))\n  // .attr('height', function(d,i){\n  //     const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n  //     let y = 0;\n  //     if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n  //     if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n  //     if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n  //     if(y){ return y; } else { return 0};\n  // })\n  // .attr('fill', function(d,i){\n  //     return colors.regions[d.region];\n  // })\n  // 10\n  // 0.1\n  // 1 - 8 - 1\n  // draw x-axis\n  // draw y-axis\n}\nexport function updateRegionchart(data) {\n  console.log('update regionchart');\n}\nexport default drawRegionchart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Regionchart.js"],"names":["d3","moment","colors","drawRegionchart","data","options","regions","groupedData","forEach","d","i","cumulative_case","cumulative_deaths","cumulative_vaccines","who_data","ifrc_region","new_cases","new_deaths","cumulative_cases","console","log","updateRegionchart"],"mappings":"AAAA,OAAO,KAAKA,EAAZ,MAAoB,IAApB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AAEA,OAAO,SAASC,eAAT,CAAyBC,IAAzB,EAA+BC,OAA/B,EAAwC;AAE3C,QAAMC,OAAO,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,KAA/B,CAAhB;AAEAC,EAAAA,WAAW,GAAG,EAAd;AAEAD,EAAAA,OAAO,CAACE,OAAR,CAAgB,UAASC,CAAT,EAAWC,CAAX,EAAa;AACzBH,IAAAA,WAAW,CAACE,CAAD,CAAX,GAAiB;AAAEE,MAAAA,eAAe,EAAE,CAAnB;AAAsBC,MAAAA,iBAAiB,EAAE,CAAzC;AAA4CC,MAAAA,mBAAmB,EAAE;AAAjE,KAAjB;AACH,GAFD;AAIAT,EAAAA,IAAI,CAACU,QAAL,CAAcN,OAAd,CAAsB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC/BH,IAAAA,WAAW,CAACE,CAAC,CAACM,WAAH,CAAX,CAA2BC,SAA3B,IAAwCP,CAAC,CAACO,SAA1C;AACAT,IAAAA,WAAW,CAACE,CAAC,CAACM,WAAH,CAAX,CAA2BE,UAA3B,IAAyCR,CAAC,CAACQ,UAA3C;AACAV,IAAAA,WAAW,CAACE,CAAC,CAACM,WAAH,CAAX,CAA2BG,gBAA3B,GAA8C,CAA9C;AACAX,IAAAA,WAAW,CAACE,CAAC,CAACM,WAAH,CAAX,CAA2BH,iBAA3B,GAA+C,CAA/C;AACH,GALD;AAOAO,EAAAA,OAAO,CAACC,GAAR,CAAYb,WAAZ,EAjB2C,CAmB3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAGA;AAEH;AAED,OAAO,SAASc,iBAAT,CAA2BjB,IAA3B,EAAiC;AAEpCe,EAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ;AAEH;AAED,eAAejB,eAAf","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\n\nexport function drawRegionchart(data, options) {\n\n    const regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n\n    groupedData = {};\n\n    regions.forEach(function(d,i){\n        groupedData[d] = { cumulative_case: 0, cumulative_deaths: 0, cumulative_vaccines: 0}\n    })\n\n    data.who_data.forEach(function(d,i){\n        groupedData[d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d.ifrc_region].cumulative_cases = 0;\n        groupedData[d.ifrc_region].cumulative_deaths = 0;\n    });\n\n    console.log(groupedData);\n\n    // // totals by date\n    // groupedData.forEach(function(d,i){\n    //     regions.forEach(function(dd,ii){\n    //         // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n    //         if(i>0){\n    //             d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n    //             d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n    //         } else {\n    //             d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n    //             d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n    //         }\n    //     })\n\n    //     d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n    //     d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n    //     d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n    //     d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n    //     d.region = [];\n\n    //     regions.forEach(function(dd,ii){\n    //         d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n    //     })\n\n    // })\n\n    // const numIntervals = d3.max(data.who_data, function(d,i){\n    //     return d[options.timeline_frequency+'Total'];\n    // });\n\n    // const maxCases = d3.max(groupedData, function(d,i){\n    //     if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n    //     if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n    //     if(options.timeline_type==='stacked') return 100;\n    // })\n\n    // const maxDeaths = d3.max(groupedData, function(d,i){\n    //     if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n    //     if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n    //     if(options.timeline_type==='stacked') return 100;\n    // })\n\n    // // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n\n    // const svg = d3.select('#timechart_svg');\n    // svg.selectAll('g').remove();\n\n    // const width = 2000;\n    // const barWidth = width/numIntervals;\n\n    // let barSpacing = 0.04; \n    // if(options.timeline_frequency==='month') barSpacing = 0.03;\n    // if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // const xScale = d3.scaleLinear()\n    // .range([0,width])\n    // .domain([0,numIntervals]);\n\n    // const yScaleCases = d3.scaleLinear()\n    // .range([0,140])\n    // .domain([0,maxCases]);\n\n    // const yScaleDeaths = d3.scaleLinear()\n    // .range([0,140])\n    // .domain([0,maxDeaths]);\n\n    // // CASES\n    // // loop through groupedData and draw bars\n    // const barGroups = svg.selectAll('.bar_group')\n    // .data(groupedData)\n    // .enter()\n    // .append('g')\n    // .attr('transform', function(d,i){ \n    //     return 'translate('+xScale(i)+')'\n    // })\n\n    // // CASES\n    // barGroups.selectAll('.cases_bar')\n    // .data(function(d,i){ return d.region.filter(function(dd,ii){\n    //     return dd.region!=='OTH';\n    // })})\n    // .enter()\n    // .append('rect')\n    // .attr('class', 'cases_bar')\n    // .attr('x', (barWidth*barSpacing))\n    // .attr('y', function(d,i){\n    //     const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n    //     let dp = 0;\n    //     if(i>0){\n    //         for(let ii=1;ii<=i;ii++){\n    //             if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n    //             if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n    //             if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n    //         }\n    //     }\n    //     let y = 0;\n    //     if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n    //     if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n    //     if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n    //     if(y){ return y; } else { return 0};\n    // })\n    // .attr('width', barWidth-(barWidth*barSpacing*2))\n    // .attr('height', function(d,i){\n    //     const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n    //     let y = 0;\n    //     if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n    //     if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n    //     if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n    //     if(y){ return y; } else { return 0};\n    // })\n    // .attr('fill', function(d,i){\n    //     return colors.regions[d.region];\n    // })\n\n    // // DEATHS\n    // barGroups.selectAll('.deaths_bar')\n    // .data(function(d,i){ return d.region.filter(function(dd,ii){\n    //     return dd.region!=='OTH';\n    // })})\n    // .enter()\n    // .append('rect')\n    // .attr('class', 'deaths_bar')\n    // .attr('x', (barWidth*barSpacing))\n    // .attr('y', function(d,i){\n    //     const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n    //     let dp = 0;\n    //     if(i>0){\n    //         for(let ii=1;ii<=i;ii++){\n    //             if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n    //             if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n    //             if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n    //         }\n    //     }\n    //     let y = 0;\n    //     if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n    //     if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n    //     if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n    //     if(y){ return y; } else { return 0};\n    // })\n    // .attr('width', barWidth-(barWidth*barSpacing*2))\n    // .attr('height', function(d,i){\n    //     const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n    //     let y = 0;\n    //     if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n    //     if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n    //     if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n    //     if(y){ return y; } else { return 0};\n    // })\n    // .attr('fill', function(d,i){\n    //     return colors.regions[d.region];\n    // })\n\n    // 10\n\n    // 0.1\n\n    // 1 - 8 - 1\n    \n    // draw x-axis\n\n\n    // draw y-axis\n\n}\n\nexport function updateRegionchart(data) {\n\n    console.log('update regionchart');\n\n}\n\nexport default drawRegionchart;\n"]},"metadata":{},"sourceType":"module"}