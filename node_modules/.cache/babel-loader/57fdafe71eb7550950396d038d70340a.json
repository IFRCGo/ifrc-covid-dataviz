{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{nFormatter}from'./HelperFunctions';import{textwrap}from'd3-textwrap';import clone from'just-clone';var yScaleCases;var yScaleDeaths;var yScaleVaccines;var yAxisCases;var yAxisDeaths;var yAxisVaccines;var yScaleCasesAxis;var yScaleDeathsAxis;var yScaleVaccinesAxis;var xScale;var xAxis;var xScaleAxis;var xScaleEvents;var maxDate;var minDate;var md;var regions=['AF','ME','AP','EU','AM','OTH'];export function drawTimechart(data,options){minDate=options.minDate;maxDate=options.maxDate;var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});var vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\ndata.vaccines_data=data.vaccines_data_daily;data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\ndata.vaccines_data=[];if(options.timeline_frequency==='day'){data.vaccines_data=clone(data.vaccines_data_cumulative);}if(options.timeline_frequency==='week'){data.vaccines_data_cumulative.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||date==moment(options.maxVDate).startOf('day').unix()){data.vaccines_data.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(options.maxVDate).startOf('day').unix();data.vaccines_data_cumulative.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate&&date==maxDateUnix){data.vaccines_data.push(d);}});}data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});// define date range\n// const minDate = groupedData[0].date;\n// const maxDate = groupedData[numIntervals].date;\n// const minDate = groupedData[0].date;\n// if(options.timeline_frequency==='month') md = md.add(1, 'months');\n// if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\nif(options.timeline_frequency==='month')minDate=moment(minDate).startOf('month').startOf('day').toDate();if(options.timeline_frequency==='month')maxDate=moment(maxDate).endOf('month').startOf('day').toDate();if(options.timeline_frequency==='week')maxDate=moment(maxDate).endOf('isoWeek').startOf('day').toDate();md=moment(maxDate);if(options.timeline_frequency==='day')md=moment(md).add(1,'days').toDate();var svg=d3.select('#timechart_svg');svg.selectAll('g').remove();d3.selectAll('#layout .yAxis').remove();d3.selectAll('#yAxis').remove();d3.selectAll('#layout .xAxis').remove();//bg\nsvg.append('g').append('rect').attr('width','100%').attr('height','100%').attr('x',0).attr('y',0).attr('fill','#FFF').attr('opacity',0);var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\nxScale=d3.scaleTime().range([0,width]).domain([minDate,md]);xScaleAxis=d3.scaleTime().range([0,596]).domain([minDate,md]);yScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nxAxis=d3.axisBottom().scale(xScaleAxis).tickSize(2).tickPadding(3);// if(options.timeline_frequency=='month')\n// xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n// if(options.timeline_frequency=='week')\n// xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisGroup=d3.select('#layout').append(\"g\").attr('id','yAxis').attr('clip-path','url(#mask)');var yAxisCasesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"casesAxis\").attr('transform','translate(620,363)').call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"deathsAxis\").attr('transform','translate(620,534)').call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"VaccinesAxis\").attr('transform','translate(620,707.5)').call(yAxisVaccines);// x-axis cases\nvar xAxisCases=yAxisGroup.append('g').attr(\"id\",\"casesXAxis\").attr('class','xAxis').attr('transform','translate(24,504)').call(xAxis);var xAxisDeaths=yAxisGroup.append('g').attr(\"id\",\"deathsXAxis\").attr('class','xAxis').attr('transform','translate(24,674)').call(xAxis);var xAxisVaccines=yAxisGroup.append('g').attr(\"id\",\"vaccinesXAxis\").attr('class','xAxis').attr('transform','translate(24,848)').call(xAxis);var xAxisTimeline=yAxisGroup.append('g').attr(\"id\",\"timelineXAxis\").attr('class','xAxis').attr('transform','translate(24,908)').call(xAxis);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).enter().append('g').attr('class','bar_group').attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar cases_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar deaths_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).enter().append('g').attr('class','vbar_group').attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class','timeBar vaccines_bar').attr('class',function(d,i){return'timeBar vaccines_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});if(options.timeline_frequency==='month'){vbarGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}data.vgroupedData=vgroupedData;data.groupedData=groupedData;// tooltips\n// events calendar timeline\nvar tData=data.timeline_data;xScaleEvents=d3.scaleTime().range([25,619]).domain([minDate,md]);// bring to front\ndocument.getElementById(\"svg\").appendChild(d3.select('#timeline_tooltip').node());document.getElementById(\"svg\").appendChild(d3.select('#event_tooltip').node());var timelineTooltip=d3.select('#timeline_tooltip').attr('opacity',0);var eventTooltip=d3.select('#event_tooltip').attr('opacity',0);// hover bar\nvar hoverBar=svg.append('rect').attr('id','timechart_hover').attr('width',barWidth).attr('x',0).attr('y',0).attr('opacity',0).attr('height','100%').attr('fill','rgb(221 221 221 / 40%)');d3.select('#timechart_svg').on('mouseover',function(event){var coords=d3.pointer(event);hoverBar.attr('opacity',1);var xDate=xScale.invert(coords[0]);if(options.timeline_frequency=='week'){xDate=moment(xDate).startOf('isoWeek');}if(options.timeline_frequency=='day'){xDate=moment(xDate).startOf('day');}if(options.timeline_frequency=='month'){xDate=moment(xDate).startOf('month');}if(coords[1]<470){timelineTooltip.attr('opacity',1).attr('display','inline');hoverBar.attr('height','100%');}else if(coords[1]>510){eventTooltip.attr('opacity',1);hoverBar.attr('height','90%');}else{eventTooltip.attr('opacity',0);timelineTooltip.attr('opacity',0);hoverBar.attr('height','100%');}if(xDate.toDate().getTime()<minDate.getTime()){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);}d3.select('#svg_container').style('z-index',10);}).on('mouseout',function(event){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0).attr('display','none');// timelineTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\nd3.select('#svg_container').style('z-index',1);eventTooltip.attr('opacity',0).attr('transform','translate(0,0)');d3.selectAll('.event_marker path').style('stroke','grey').attr('opacity',0.8);}).on('mousemove',function(event){var coords=d3.pointer(event);var xDate=xScale.invert(coords[0]);var tooltipStr='';if(options.timeline_frequency=='week'){xDate=moment(xDate).startOf('isoWeek');tooltipStr=xDate.format('ll');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}if(options.timeline_frequency=='day'){xDate=moment(xDate).startOf('day');tooltipStr=xDate.format('ll');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}if(options.timeline_frequency=='month'){xDate=moment(xDate).startOf('month');tooltipStr=xDate.format('MMMM YYYY');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}hoverBar.attr('x',xScale(xDate.toDate()));var groupedDataFiltered=data.groupedData.filter(function(d,i){return moment(d.date).startOf('day').unix()==xDate.startOf('day').unix();});var vgroupedDataFiltered=data.vgroupedData.filter(function(d,i){return moment(d.date).startOf('day').unix()==xDate.startOf('day').unix();});var deaths='-';var cases='-';var vaccines='-';if(options.timeline_type=='cumulative'){// cumulative\nif(groupedDataFiltered[0])cases=nFormatter(groupedDataFiltered[0].total_cumulative_cases,2);if(groupedDataFiltered[0])deaths=nFormatter(groupedDataFiltered[0].total_cumulative_deaths,2);if(vgroupedDataFiltered[0])vaccines=nFormatter(vgroupedDataFiltered[0].total_cumulative_vaccines,2);}else{// non-cumulative/stacked\nif(groupedDataFiltered[0])cases=nFormatter(groupedDataFiltered[0].total_new_cases,2);if(groupedDataFiltered[0])deaths=nFormatter(groupedDataFiltered[0].total_new_deaths,2);if(vgroupedDataFiltered[0])vaccines=nFormatter(vgroupedDataFiltered[0].total_new_vaccines,2);}d3.select('#tooltip_cases tspan').text(cases).attr(\"text-anchor\",\"end\").attr('dx',32);d3.select('#tooltip_deaths tspan').text(deaths).attr(\"text-anchor\",\"end\").attr('dx',32);d3.select('#tooltip_vaccines tspan').text(vaccines).attr(\"text-anchor\",\"end\").attr('dx',32);// if((xDate.toDate().getTime()>options.maxDate.getTime())){\n//     hoverBar.attr('opacity', 0);\n// // } else \nif(xDate.toDate().getTime()<minDate.getTime()&&options.timeline_frequency=='day'){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);}if(options.timeline_frequency=='month'){hoverBar.attr('width',function(){return xScale(moment(xDate).endOf('month'))-xScale(moment(xDate).startOf('month'));});}timelineTooltip.attr('transform',function(){if(options.timeline_frequency=='month'){return'translate('+(xScaleEvents(xDate.toDate())+barWidth/3.5)+','+(coords[1]+343)+')';}return'translate('+(xScaleEvents(xDate.toDate())+18)+','+(coords[1]+343)+')';});if(coords[1]<470){timelineTooltip.attr('opacity',1);hoverBar.attr('opacity',1);hoverBar.attr('height','100%');}else if(coords[1]>510){eventTooltip.attr('opacity',1);hoverBar.attr('height','90%');var x=moment(xScale.invert(coords[0])).startOf('day');var xx=xScale.invert(coords[0]);eventTooltip.attr('transform',function(){return'translate('+(xScaleEvents(x.toDate())+-3)+','+817+')';});var events=tData.filter(function(d,i){return moment(d.date).startOf('day').unix()==x.unix();});// select nearest neighbor for ux purposes \nif(events.length==0){events=tData.filter(function(d,i){return moment(d.date).startOf('day').unix()<=moment(x).add(1,'days').unix()&&moment(d.date).startOf('day').unix()>=moment(x).subtract(1,'days').unix();});}if(events.length>0){d3.select('#event-'+moment(events[0].date).startOf('day').unix()).select('path').style('stroke','#000').attr('opacity',1);tooltipStr=moment(events[0].date).startOf('day').format('ll');d3.select('#event_tooltip_date tspan').text(tooltipStr);var wrap=textwrap().bounds({height:200,width:230}).method('tspans');var event=d3.select('#event_tooltip_text').text(events[0].description).attr('y',18).attr('x',6);d3.select('#event_tooltip_text').call(wrap);d3.selectAll('#event_tooltip_text tspan').attr('dy','1.3em');var bbox=d3.select('#event_tooltip_text').node().getBBox();d3.select('#event_tooltip_rect').attr('width',bbox.width+17).attr('height',bbox.height+26);var h=d3.select('#event_tooltip_rect').attr('height');var ys=0;if(bbox.height<20){ys=19;}else if(bbox.height<30){ys=9;}else if(bbox.height<40){ys=0;}else if(bbox.height<50){ys=-20;}else if(bbox.height<60){ys=-20;}var y=d3.select('#event_tooltip_rect').attr('y');d3.select('#event_tooltip_rect').attr('y',ys);d3.selectAll('#event_tooltip_text').attr('y',function(d,i){return parseInt(d3.select(this).attr('y'))+ys;});d3.selectAll('#event_tooltip_date tspan').attr('dy',function(d,i){return ys;});eventTooltip.attr('opacity',1);}else{d3.selectAll('.event_marker path').style('stroke','grey').attr('opacity',0.8);eventTooltip.attr('opacity',0);}}else{eventTooltip.attr('opacity',0);timelineTooltip.attr('opacity',0);hoverBar.attr('opacity',0);hoverBar.attr('height','100%');}if(options.timeline_frequency=='day'&&xDate.toDate().getTime()<minDate.getTime()){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);return false;}});tData=tData.filter(function(d){return d.date.length>0;});yAxisGroup.append('g').selectAll('.event_marker').data(tData).enter().append('g').attr('class','event_marker').attr('id',function(d,i){return'event-'+moment(d.date).startOf('day').unix();}).attr('transform',function(d){var x=xScaleEvents(new Date(d.date));return'translate('+x+', 893)';}).append('path').attr('d',\"M0,-6L4,0 0,6 -4,0Z\").style('stroke','grey').attr('opacity',0.8).style('stroke-width',3.5).style('fill','white');}export function updateTimechart(data,options){var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});var vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\ndata.vaccines_data=data.vaccines_data_daily;data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\ndata.vaccines_data=[];if(options.timeline_frequency==='day'){data.vaccines_data=clone(data.vaccines_data_cumulative);}if(options.timeline_frequency==='week'){data.vaccines_data_cumulative.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||date==moment(options.maxVDate).startOf('day').unix()){data.vaccines_data.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(options.maxVDate).startOf('day').unix();data.vaccines_data_cumulative.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate&&date==maxDateUnix){data.vaccines_data.push(d);}});}data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});var svg=d3.select('#timechart_svg');var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\n// xScale = d3.scaleTime()\n// .range([0,width])\n// .domain([minDate,md]);\n// xScaleAxis = d3.scaleTime()\n// .range([23,596])\n// .domain([minDate,md]);\nyScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisCasesText=d3.select('#casesAxis').transition().duration(500).call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=d3.select('#deathsAxis').transition().duration(500).call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=d3.select('#VaccinesAxis').transition().duration(500).call(yAxisVaccines);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];return'blue';});// // DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(groupedData.length==0){d3.selectAll('.cases_bar').transition().duration(500).attr('y',140).attr('height',0);d3.selectAll('.deaths_bar').transition().duration(500).attr('y',140+170).attr('height',0);}// // VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(vgroupedData.length==0){d3.selectAll('.vaccines_bar').transition().duration(500).attr('y',140).attr('height',0);}// // bar size tweak for spacing\n// if(options.timeline_frequency==='month'){\n//     barGroups.selectAll(\".timeBar\")\n//     .attr(\"width\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(1-barSpacing);\n//       })\n//     .attr(\"x\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(barSpacing/2);\n//       })\n//     }\ndata.vgroupedData=vgroupedData;data.groupedData=groupedData;}export default drawTimechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Timechart.js"],"names":["d3","moment","colors","nFormatter","textwrap","clone","yScaleCases","yScaleDeaths","yScaleVaccines","yAxisCases","yAxisDeaths","yAxisVaccines","yScaleCasesAxis","yScaleDeathsAxis","yScaleVaccinesAxis","xScale","xAxis","xScaleAxis","xScaleEvents","maxDate","minDate","md","regions","drawTimechart","data","options","groupedData","who_data","forEach","d","i","timeline_frequency","date","week_start","month_start","ifrc_region","new_cases","new_deaths","cumulative_cases","cumulative_deaths","dd","ii","hasOwnProperty","total_new_cases","AF","AP","AM","EU","ME","OTH","total_cumulative_cases","total_new_deaths","total_cumulative_deaths","region","push","vgroupedData","timeline_type","vaccines_data","vaccines_data_daily","new_vaccines","daily_vaccinations","cumulative_vaccines","total_new_vaccines","vaccines_data_cumulative","endOfWeekDate","endOf","startOf","unix","maxVDate","maxDateUnix","endOfMonthDate","total_vaccinations","total_cumulative_vaccines","filter","el","numIntervals","max","maxCases","maxDeaths","maxVaccines","toDate","add","svg","select","selectAll","remove","append","attr","width","barWidth","barSpacing","scaleTime","range","domain","scaleLinear","axisBottom","scale","tickSize","tickPadding","axisRight","ticks","tickFormat","yAxisGroup","yAxisCasesText","call","yAxisDeathsText","yAxisVaccinesText","xAxisCases","xAxisDeaths","xAxisVaccines","xAxisTimeline","barGroups","enter","totalNewCases","parentNode","datum","dp","y","totalNewDeaths","next","timeMonth","offset","vbarGroups","totalNewVaccines","tData","timeline_data","document","getElementById","appendChild","node","timelineTooltip","eventTooltip","hoverBar","on","event","coords","pointer","xDate","invert","getTime","style","tooltipStr","format","text","groupedDataFiltered","vgroupedDataFiltered","deaths","cases","vaccines","x","xx","events","length","subtract","wrap","bounds","height","method","description","bbox","getBBox","h","ys","parseInt","Date","updateTimechart","transition","duration"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {nFormatter} from './HelperFunctions';\nimport { textwrap } from 'd3-textwrap';\nimport clone from 'just-clone';\n\nlet yScaleCases;\nlet yScaleDeaths;\nlet yScaleVaccines;\nlet yAxisCases;\nlet yAxisDeaths;\nlet yAxisVaccines;\nlet yScaleCasesAxis;\nlet yScaleDeathsAxis;\nlet yScaleVaccinesAxis;\nlet xScale;\nlet xAxis; \nlet xScaleAxis;\nlet xScaleEvents;\nlet maxDate; \nlet minDate;\nlet md; \n\nconst regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n\nexport function drawTimechart(data, options) {\n\n    minDate = options.minDate;\n    maxDate = options.maxDate;\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    let vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        data.vaccines_data = [];\n        if(options.timeline_frequency==='day') {\n            data.vaccines_data = clone(data.vaccines_data_cumulative);\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(date==moment(options.maxVDate).startOf('day').unix())){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(options.maxVDate).startOf('day').unix();\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate)&&(date==maxDateUnix))){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n    // const minDate = groupedData[0].date;\n\n\n    // if(options.timeline_frequency==='month') md = md.add(1, 'months');\n    // if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\n    if(options.timeline_frequency==='month') minDate = moment(minDate).startOf('month').startOf('day').toDate();\n    if(options.timeline_frequency==='month') maxDate = moment(maxDate).endOf('month').startOf('day').toDate();\n    if(options.timeline_frequency==='week') maxDate = moment(maxDate).endOf('isoWeek').startOf('day').toDate();\n\n    md = moment(maxDate);\n    if(options.timeline_frequency==='day') md = moment(md).add(1, 'days').toDate();\n\n    const svg = d3.select('#timechart_svg');\n    svg.selectAll('g').remove();\n    d3.selectAll('#layout .yAxis').remove();\n    d3.selectAll('#yAxis').remove();\n    d3.selectAll('#layout .xAxis').remove();\n\n    //bg\n    svg.append('g').append('rect')\n    .attr('width', '100%')\n    .attr('height', '100%')\n    .attr('x', 0)\n    .attr('y', 0)\n    .attr('fill', '#FFF')\n    .attr('opacity', 0);\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    xScale = d3.scaleTime()\n    .range([0,width])\n    .domain([minDate,md]);\n\n    xScaleAxis = d3.scaleTime()\n    .range([0,596])\n    .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    \n    xAxis = d3.axisBottom()\n    .scale(xScaleAxis)\n    .tickSize(2)\n    .tickPadding(3);\n\n    // if(options.timeline_frequency=='month')\n    // xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n\n    // if(options.timeline_frequency=='week')\n    // xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\n\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisGroup = d3.select('#layout').append(\"g\").attr('id', 'yAxis').attr('clip-path', 'url(#mask)');\n\n    var yAxisCasesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"casesAxis\")\n    .attr('transform', 'translate(620,363)')\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"deathsAxis\")\n    .attr('transform', 'translate(620,534)')\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"VaccinesAxis\")\n    .attr('transform', 'translate(620,707.5)')\n    .call(yAxisVaccines);\n\n    // x-axis cases\n    var xAxisCases = yAxisGroup.append('g')\n    .attr(\"id\", \"casesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,504)')\n    .call(xAxis);\n\n    var xAxisDeaths = yAxisGroup.append('g')\n    .attr(\"id\", \"deathsXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,674)')\n    .call(xAxis);\n\n    var xAxisVaccines = yAxisGroup.append('g')\n    .attr(\"id\", \"vaccinesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,848)')\n    .call(xAxis);\n\n    var xAxisTimeline = yAxisGroup.append('g')\n    .attr(\"id\", \"timelineXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,908)')\n    .call(xAxis);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'bar_group')\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar cases_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    })\n\n    // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar deaths_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n            })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n            })\n        }\n\n    // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'vbar_group')\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n   \n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', 'timeBar vaccines_bar')\n    .attr('class', function(d,i) { return 'timeBar vaccines_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    if(options.timeline_frequency==='month'){\n    vbarGroups.selectAll(\".timeBar\")\n    .attr(\"width\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(1-barSpacing);\n        })\n    .attr(\"x\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(barSpacing/2);\n        })\n    }\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n          })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n          })\n        }\n\n    data.vgroupedData = vgroupedData;\n    data.groupedData = groupedData;\n\n        // tooltips\n\n        // events calendar timeline\n        var tData = data.timeline_data;\n\n        xScaleEvents = d3.scaleTime()\n        .range([25,619])\n        .domain([minDate,md]);\n        \n        // bring to front\n       document.getElementById(\"svg\").appendChild(d3.select('#timeline_tooltip').node());\n       document.getElementById(\"svg\").appendChild(d3.select('#event_tooltip').node());\n       var timelineTooltip = d3.select('#timeline_tooltip').attr('opacity', 0);\n       var eventTooltip = d3.select('#event_tooltip').attr('opacity', 0);\n\n        // hover bar\n        var hoverBar = svg.append('rect')\n        .attr('id','timechart_hover')\n        .attr('width', barWidth)\n        .attr('x', 0)\n        .attr('y', 0)\n        .attr('opacity', 0)\n        .attr('height', '100%')\n        .attr('fill', 'rgb(221 221 221 / 40%)')\n\n        d3.select('#timechart_svg').on('mouseover',  (event) => {\n\n            var coords = d3.pointer( event );\n            hoverBar.attr('opacity', 1)\n\n            var xDate = xScale.invert(coords[0]);\n\n            if(options.timeline_frequency=='week') {\n                xDate = moment(xDate).startOf('isoWeek');\n            }\n            if(options.timeline_frequency=='day') {\n                xDate = moment(xDate).startOf('day');\n            }\n            if(options.timeline_frequency=='month') {\n                xDate = moment(xDate).startOf('month');\n            }\n\n            if(coords[1]<470){\n                timelineTooltip.attr('opacity', 1).attr('display', 'inline');\n                hoverBar.attr('height', '100%');\n            } else if(coords[1]>510){\n                eventTooltip.attr('opacity', 1);\n                hoverBar.attr('height', '90%');\n            } else {\n                eventTooltip.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                hoverBar.attr('height', '100%');\n            }\n\n            if((xDate.toDate().getTime()<minDate.getTime())){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n            }\n\n            d3.select('#svg_container').style('z-index', 10);\n\n        }).on('mouseout',  (event) => {\n            hoverBar.attr('opacity', 0)\n            timelineTooltip.attr('opacity', 0).attr('display', 'none');\n            // timelineTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\n            d3.select('#svg_container').style('z-index', 1);\n            eventTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\n            d3.selectAll('.event_marker path').style('stroke', 'grey').attr('opacity', 0.8);\n        })\n        .on('mousemove', (event) => {\n            var coords = d3.pointer( event );\n            var xDate = xScale.invert(coords[0]);\n            var tooltipStr = '';\n            if(options.timeline_frequency=='week') {\n                xDate = moment(xDate).startOf('isoWeek');\n                tooltipStr = xDate.format('ll');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            if(options.timeline_frequency=='day') {\n                xDate = moment(xDate).startOf('day');\n                tooltipStr = xDate.format('ll');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            if(options.timeline_frequency=='month') {\n                xDate = moment(xDate).startOf('month');\n                tooltipStr = xDate.format('MMMM YYYY');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            hoverBar.attr('x', xScale(xDate.toDate()));\n\n            var groupedDataFiltered = data.groupedData.filter(function(d,i){\n                return moment(d.date).startOf('day').unix() == xDate.startOf('day').unix();\n            });\n            var vgroupedDataFiltered = data.vgroupedData.filter(function(d,i){\n                return moment(d.date).startOf('day').unix() == xDate.startOf('day').unix();\n            });\n\n            var deaths = '-';\n            var cases = '-';\n            var vaccines = '-';\n            if(options.timeline_type=='cumulative'){ \n                // cumulative\n                if(groupedDataFiltered[0]) cases = nFormatter(groupedDataFiltered[0].total_cumulative_cases, 2);\n                if(groupedDataFiltered[0]) deaths = nFormatter(groupedDataFiltered[0].total_cumulative_deaths, 2);\n                if(vgroupedDataFiltered[0]) vaccines = nFormatter(vgroupedDataFiltered[0].total_cumulative_vaccines, 2);\n            } else {\n                // non-cumulative/stacked\n                if(groupedDataFiltered[0]) cases = nFormatter(groupedDataFiltered[0].total_new_cases, 2);\n                if(groupedDataFiltered[0]) deaths = nFormatter(groupedDataFiltered[0].total_new_deaths, 2);\n                if(vgroupedDataFiltered[0]) vaccines = nFormatter(vgroupedDataFiltered[0].total_new_vaccines, 2);\n            }\n\n            d3.select('#tooltip_cases tspan').text((cases)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n            d3.select('#tooltip_deaths tspan').text((deaths)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n            d3.select('#tooltip_vaccines tspan').text((vaccines)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n\n            // if((xDate.toDate().getTime()>options.maxDate.getTime())){\n            //     hoverBar.attr('opacity', 0);\n            // // } else \n            if(((xDate.toDate().getTime()<minDate.getTime()))&&(options.timeline_frequency=='day')){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n            }\n\n            if(options.timeline_frequency=='month'){\n                hoverBar.attr('width', function(){\n                   return xScale(moment(xDate).endOf('month')) - xScale(moment(xDate).startOf('month'));\n                })\n            }\n            timelineTooltip.attr('transform', function(){\n                if(options.timeline_frequency=='month') { \n                    return 'translate('+((xScaleEvents(xDate.toDate()))+(barWidth/3.5))+','+(coords[1]+343)+')';\n                }\n                return 'translate('+(xScaleEvents(xDate.toDate())+(18))+','+(coords[1]+343)+')';\n            })\n\n            if(coords[1]<470){\n                timelineTooltip.attr('opacity', 1);\n                hoverBar.attr('opacity', 1);\n                hoverBar.attr('height', '100%');\n            } else if(coords[1]>510){\n                eventTooltip.attr('opacity', 1);\n                hoverBar.attr('height', '90%');\n                var x = moment(xScale.invert(coords[0])).startOf('day');\n                var xx = (xScale.invert(coords[0]))\n                eventTooltip.attr('transform', function(){\n                    return 'translate('+(xScaleEvents(x.toDate())+(-3))+','+(817)+')';\n                });\n\n                var events = tData.filter(function(d,i){\n                    return moment(d.date).startOf('day').unix() == x.unix()\n                });\n\n                // select nearest neighbor for ux purposes \n                if(events.length==0){\n                    events = tData.filter(function(d,i){\n                        return ((moment(d.date).startOf('day').unix() <= moment(x).add(1, 'days').unix())&&(moment(d.date).startOf('day').unix() >= moment(x).subtract(1, 'days').unix()))\n                    });\n                }\n                \n                if(events.length>0){\n\n                    d3.select('#event-'+moment(events[0].date).startOf('day').unix()).select('path').style('stroke', '#000').attr('opacity', 1);\n                    tooltipStr = moment(events[0].date).startOf('day').format('ll');\n                    d3.select('#event_tooltip_date tspan').text(tooltipStr);\n\n                    var wrap = textwrap().bounds({height: 200, width: 230}).method('tspans');\n                    var event = d3.select('#event_tooltip_text').text(events[0].description)\n                    .attr('y', 18)\n                    .attr('x', 6)\n                    d3.select('#event_tooltip_text').call(wrap);\n\n                    d3.selectAll('#event_tooltip_text tspan').attr('dy', '1.3em');\n                    var bbox = d3.select('#event_tooltip_text').node().getBBox();\n                    d3.select('#event_tooltip_rect').attr('width', bbox.width+17)\n                    .attr('height', bbox.height +26 );\n\n                    var h = d3.select('#event_tooltip_rect').attr('height');\n                    var ys = 0;\n\n                    if(bbox.height<20){\n                        ys = 19;\n                    } else if(bbox.height<30){\n                        ys = 9;\n                    } else if(bbox.height<40){\n                        ys = 0;\n                    } else if(bbox.height<50){\n                        ys = -20;\n                    } else if(bbox.height<60){\n                        ys = -20;\n                    }\n\n                    var y = d3.select('#event_tooltip_rect').attr('y');\n\n                    d3.select('#event_tooltip_rect').attr('y', ys);\n                    \n                    d3.selectAll('#event_tooltip_text').attr('y', function(d,i){\n                        return parseInt(d3.select(this).attr('y')) + ys;\n                    });\n\n                    d3.selectAll('#event_tooltip_date tspan').attr('dy', function(d,i){\n                        return ys;\n                    });\n\n                    eventTooltip.attr('opacity', 1);\n\n                } else {\n                    d3.selectAll('.event_marker path').style('stroke', 'grey')\n                    .attr('opacity', 0.8);\n                    eventTooltip.attr('opacity', 0);\n                }\n            } else {\n                eventTooltip.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                hoverBar.attr('opacity', 0);\n                hoverBar.attr('height', '100%');\n            }\n\n            if((options.timeline_frequency=='day')&&((xDate.toDate().getTime()<minDate.getTime()))){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                return false;\n            }\n        });\n\n        tData = tData.filter(d => d.date.length > 0);\n\n        yAxisGroup.append('g').selectAll('.event_marker')\n        .data(tData)\n        .enter()\n        .append('g')\n        .attr('class', 'event_marker')\n        .attr('id', function(d,i){\n            return 'event-'+moment(d.date).startOf('day').unix();\n        })\n        .attr('transform', function(d){\n            var x = xScaleEvents(new Date(d.date));\n            return 'translate('+(x)+', 893)';\n        })\n        .append('path')\n        .attr('d', \"M0,-6L4,0 0,6 -4,0Z\")\n        .style('stroke', 'grey')\n        .attr('opacity', 0.8)\n        .style('stroke-width',3.5)\n        .style('fill', 'white');\n\n}\n\nexport function updateTimechart(data, options) {\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    let vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        data.vaccines_data = [];\n        if(options.timeline_frequency==='day') {\n            data.vaccines_data = clone(data.vaccines_data_cumulative);\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(date==moment(options.maxVDate).startOf('day').unix())){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(options.maxVDate).startOf('day').unix();\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate)&&(date==maxDateUnix))){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    const svg = d3.select('#timechart_svg');\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    // xScale = d3.scaleTime()\n    // .range([0,width])\n    // .domain([minDate,md]);\n\n    // xScaleAxis = d3.scaleTime()\n    // .range([23,596])\n    // .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisCasesText = d3.select('#casesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = d3.select('#deathsAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = d3.select('#VaccinesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisVaccines);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n        return 'blue'\n    })\n\n    // // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n\n    if(groupedData.length==0){\n        d3.selectAll('.cases_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n\n        d3.selectAll('.deaths_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140+170)\n        .attr('height', 0)\n        \n    }\n    // // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n\n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    });\n\n    if(vgroupedData.length==0){\n        d3.selectAll('.vaccines_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n    }\n   \n    // // bar size tweak for spacing\n    // if(options.timeline_frequency==='month'){\n    //     barGroups.selectAll(\".timeBar\")\n    //     .attr(\"width\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(1-barSpacing);\n    //       })\n    //     .attr(\"x\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(barSpacing/2);\n    //       })\n    //     }\n    data.vgroupedData = vgroupedData;\n    data.groupedData = groupedData;\n\n}\n\nexport default drawTimechart;\n"]},"metadata":{},"sourceType":"module"}