{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { addCommas } from './HelperFunctions';\nimport { filter } from './App';\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases;\nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth;\nconst regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\nconst margin = {\n  left: 20,\n  top: 0,\n  right: 58\n};\nlet rcSize;\nlet groupedData = [];\nexport function drawRegionchart(data, options, filter) {\n  groupedData = [];\n  const barSpacing = 0.1;\n  data.regions.forEach(function (d, i) {\n    groupedData.push({\n      region: d.code,\n      cumulative_cases: 0,\n      cumulative_deaths: 0,\n      cumulative_vaccines: 0,\n      population: d.population\n    });\n  });\n  data.who_data.forEach(function (d, i) {\n    data.regions.forEach(function (dd, ii) {\n      if (dd.code == d.ifrc_region) {\n        // remove OTH\n        groupedData[ii].cumulative_cases += d.new_cases;\n        groupedData[ii].cumulative_deaths += d.new_deaths;\n      }\n    });\n  });\n  groupedData.forEach(function (d, i) {\n    d.cumulative_cases = d.cumulative_cases / (d.population / 100000);\n    d.cumulative_deaths = d.cumulative_deaths / (d.population / 100000);\n    d.cumulative_vaccines = d.cumulative_vaccines / (d.population / 100000);\n    if (!d.cumulative_cases) d.cumulative_cases = 0;\n  });\n  console.log(data.regions);\n  console.log(groupedData);\n  maxCases = d3.max(groupedData, function (d, i) {\n    return d.cumulative_cases;\n  });\n  maxDeaths = d3.max(groupedData, function (d, i) {\n    return d.cumulative_deaths;\n  }); // vaccinations max date records\n\n  var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n  var vacGrouped = vGroup[vGroup.length - 1];\n  var vData = [];\n  vacGrouped[1].forEach(function (d, i) {\n    regions.forEach(function (dd, ii) {\n      if (dd == d.ifrc_region && dd != 'OTH') {\n        // remove OTH\n        groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n      }\n    });\n  });\n  groupedData.sort(function (a, b) {\n    if (options.region_chart_toggle == 'cases') return b.cumulative_cases - a.cumulative_cases;\n    if (options.region_chart_toggle == 'deaths') return b.cumulative_deaths - a.cumulative_deaths;\n    if (options.region_chart_toggle == 'vaccines') return b.cumulative_vaccines - a.cumulative_vaccines;\n  });\n  maxVaccinations = d3.max(groupedData, function (d, i) {\n    return d.cumulative_vaccines;\n  }); // append region chart containerg\n\n  const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n  rcSize = {\n    x: regionChartContainer.attr('x'),\n    y: regionChartContainer.attr('y'),\n    width: regionChartContainer.attr('width'),\n    height: regionChartContainer.attr('height')\n  };\n  const svg = d3.select('#layout').append('g').attr('transform', 'translate(' + rcSize.x + ', ' + rcSize.y + ')').attr('id', 'region_chart');\n  var rowHeight = rcSize.height / (groupedData.length - 1); // remove OTH\n\n  var rows = svg.selectAll('.bar-row').data(groupedData.filter(d => d.region !== 'OTH')).enter().append('g').attr('class', 'bar-row').attr('transform', function (d, i) {\n    return 'translate(0,' + (i * rowHeight + margin.top) + ')';\n  });\n  data.cumulative_totals = groupedData;\n  var label = rows.append('text').attr('y', rowHeight / 2).attr('x', margin.left - 5).attr('class', function (d, i) {\n    return 'bar-labels bar-label-' + d.region;\n  }).style('alignment-baseline', 'middle').style('font-size', '11px').attr('opacity', 1).attr('fill', '#000').text(function (d, i) {\n    if (d.region === 'AM') return 'Americas';\n    if (d.region === 'EU') return 'Europe';\n    if (d.region === 'AF') return 'Africa';\n    if (d.region === 'ME') return 'Middle East and North Africa';\n    if (d.region === 'AP') return 'Asia-Pacific';\n  }).style('text-anchor', 'end');\n  labelWidth = rows.node().getBBox().width + margin.left;\n  label.attr('x', labelWidth + 89);\n  labelWidth = labelWidth + 94;\n  d3.selectAll('.timeBar').attr('opacity', 1);\n  var rowBg = rows.append('rect').attr('y', 0).attr('x', 0).attr('width', labelWidth).attr('height', rowHeight - 2).style('opacity', 0).attr('fill', 'grey').style('cursor', 'pointer').attr('class', function (d, i) {\n    return 'bar-bg-' + d.region;\n  }).attr('data-id', function (d, i) {\n    return d.region;\n  }).on('mouseover', function (d) {\n    d3.select(this).style('opacity', 0.1); // var dat = d3.select(this.parentNode).datum();\n    // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n    // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n  }).on('mouseout', function () {\n    d3.select(this).style('opacity', 0); // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n  }).on('click', function (d, i) {\n    var t = d3.select(this).attr('data-id');\n    filter([t], 'regionchart');\n  });\n  xScaleCases = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxCases]); // severity/reliability x xcale\n\n  xScaleDeaths = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxDeaths]); // severity/reliability x xcale\n\n  xScaleVaccines = d3.scaleLinear().range([labelWidth, rcSize.width - margin.right - labelWidth]).domain([0, maxVaccinations]); // severity/reliability x xcale\n\n  var bars = rows.append('rect').attr('id', function (d, i) {\n    return 'bar-' + d.region;\n  }).attr('data-id', function (d, i) {\n    return d.region;\n  }).attr('class', 'region-bar').attr('width', function (d, i) {\n    if (options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases);\n    if (options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths);\n    if (options.region_chart_toggle == 'vaccines') return xScaleDeaths(d.cumulative_vaccines);\n  }).attr('x', labelWidth).style('outline', 'none').style('cursor', 'pointer').attr('y', rowHeight * barSpacing - 1).attr('height', rowHeight - rowHeight * barSpacing * 2).style('fill', function (d) {\n    return colors.regions[d.region];\n  }).attr('opacity', 1).on('click', function (d, i) {\n    var t = d3.select(this).attr('data-id');\n    filter([t], 'regionchart');\n  }).on('mouseover', function (d) {\n    var dat = d3.select(this.parentNode).datum(); // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n    // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n  }).on('mouseout', function () {// d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n  });\n  var dataLabel = rows.append('text').text(function (d) {\n    if (options.region_chart_toggle == 'cases') return addCommas(d.cumulative_cases);\n    if (options.region_chart_toggle == 'deaths') return addCommas(d.cumulative_deaths);\n    if (options.region_chart_toggle == 'vaccines') return addCommas(d.cumulative_vaccines);\n  }).attr('id', function (d, i) {\n    return 'data-label' + d.region;\n  }).attr('data-id', function (d, i) {\n    return d.region;\n  }).attr('class', 'data-label').attr('y', rowHeight / 2).style('alignment-baseline', 'middle').style('text-anchor', 'start').attr('x', function (d, i) {\n    if (options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases) + labelWidth + 5;\n    if (options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths) + labelWidth + 5;\n    if (options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines) + labelWidth + 5;\n  }).attr('opacity', function (d, i) {\n    var val = 0;\n    if (options.region_chart_toggle == 'cases') val = d.cumulative_cases;\n    if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths;\n    if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines;\n\n    if (val > 0) {\n      return 1;\n    } else {\n      return 0;\n    }\n  }).style('fill', '#696969').style('font-weight', 'normal').style('font-size', '10px');\n}\nexport function updateRegionchart(options, data) {\n  groupedData = [];\n  regions.forEach(function (d, i) {\n    groupedData.push({\n      region: d,\n      cumulative_cases: 0,\n      cumulative_deaths: 0,\n      cumulative_vaccines: 0\n    });\n  });\n  data.who_data.forEach(function (d, i) {\n    regions.forEach(function (dd, ii) {\n      if (dd == d.ifrc_region) {\n        // remove OTH\n        groupedData[ii].cumulative_cases += d.new_cases;\n        groupedData[ii].cumulative_deaths += d.new_deaths;\n        groupedData[ii].cumulative_vaccines = 0;\n      }\n    });\n  });\n  maxCases = d3.max(groupedData, function (d, i) {\n    return d.cumulative_cases;\n  });\n  maxDeaths = d3.max(groupedData, function (d, i) {\n    return d.cumulative_deaths;\n  }); // vaccinations max date records\n\n  var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n  var vacGrouped = vGroup[vGroup.length - 1];\n  var vData = [];\n\n  if (vacGrouped) {\n    vacGrouped[1].forEach(function (d, i) {\n      regions.forEach(function (dd, ii) {\n        if (dd == d.ifrc_region) {\n          // remove OTH\n          groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n        }\n      });\n    });\n  }\n\n  groupedData.sort(function (a, b) {\n    if (options.region_chart_toggle == 'cases') return b.cumulative_cases - a.cumulative_cases;\n    if (options.region_chart_toggle == 'deaths') return b.cumulative_deaths - a.cumulative_deaths;\n    if (options.region_chart_toggle == 'vaccines') return b.cumulative_vaccines - a.cumulative_vaccines;\n  });\n  data.cumulative_totals = groupedData;\n  maxVaccinations = d3.max(groupedData, function (d, i) {\n    return d.cumulative_vaccines;\n  });\n  xScaleCases = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxCases]); // severity/reliability x xcale\n\n  xScaleDeaths = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxDeaths]); // severity/reliability x xcale\n\n  xScaleVaccines = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxVaccinations]); // severity/reliability x xcale\n\n  if (maxVaccinations == 0 && maxCases == 0 && maxDeaths == 0) {\n    d3.selectAll('.region-bar').transition().duration(500).attr('width', 0);\n    d3.selectAll('.data-label').transition().duration(500).attr('x', labelWidth).attr('opacity', 0);\n  } else {\n    d3.selectAll('.region-bar').transition().duration(500).attr('width', function (d, i) {\n      var id = d3.select(this).attr('data-id');\n      var d;\n      groupedData.forEach(function (dd, ii) {\n        if (dd.region == id) {\n          d = dd;\n        }\n      });\n      var val = 0;\n      if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n      if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n      if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);\n\n      if (!isNaN(val)) {\n        return parseFloat(val);\n      } else {\n        return 0;\n      }\n    });\n    d3.selectAll('.data-label').transition().duration(500).tween(\"text\", function (d, i) {\n      var end = 0;\n      var id = d3.select(this).attr('data-id');\n      var d;\n      groupedData.forEach(function (dd, ii) {\n        if (dd.region == id) {\n          d = dd;\n        }\n      });\n      if (options.region_chart_toggle == 'cases') end = d.cumulative_cases;\n      if (options.region_chart_toggle == 'deaths') end = d.cumulative_deaths;\n      if (options.region_chart_toggle == 'vaccines') end = d.cumulative_vaccines;\n      var i = d3.interpolate(Math.floor(Math.random() * 112346 + 92345), end);\n      return function (t) {\n        d3.select(this).text(addCommas(Math.round(i(t))));\n      };\n    }).attr('x', function (d, i) {\n      var id = d3.select(this).attr('data-id');\n      var d;\n      groupedData.forEach(function (dd, ii) {\n        if (dd.region == id) {\n          d = dd;\n        }\n      });\n      if (options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases) + labelWidth + 5;\n      if (options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths) + labelWidth + 5;\n      if (options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines) + labelWidth + 5;\n    }).attr('opacity', function (d, i) {\n      var d;\n      var id = d3.select(this).attr('data-id');\n      groupedData.forEach(function (dd, ii) {\n        if (dd.region == id) {\n          d = dd;\n        }\n      });\n      var val = 0;\n      if (options.region_chart_toggle == 'cases') val = d.cumulative_cases;\n      if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths;\n      if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines;\n\n      if (val > 0) {\n        return 1;\n      } else {\n        return 0;\n      }\n    });\n  }\n}\nexport default drawRegionchart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Regionchart.js"],"names":["d3","moment","colors","addCommas","filter","maxCases","maxDeaths","maxVaccinations","xScaleCases","xScaleDeaths","xScaleVaccines","labelWidth","regions","margin","left","top","right","rcSize","groupedData","drawRegionchart","data","options","barSpacing","forEach","d","i","push","region","code","cumulative_cases","cumulative_deaths","cumulative_vaccines","population","who_data","dd","ii","ifrc_region","new_cases","new_deaths","console","log","max","vGroup","flatGroup","vaccines_data_cumulative","date","vacGrouped","length","vData","total_vaccinations","sort","a","b","region_chart_toggle","regionChartContainer","select","attr","x","y","width","height","svg","append","rowHeight","rows","selectAll","enter","cumulative_totals","label","style","text","node","getBBox","rowBg","on","t","scaleLinear","range","domain","bars","dat","parentNode","datum","dataLabel","val","updateRegionchart","transition","duration","id","isNaN","parseFloat","tween","end","interpolate","Math","floor","random","round"],"mappings":"AAAA,OAAO,KAAKA,EAAZ,MAAoB,IAApB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SAAQC,SAAR,QAAwB,mBAAxB;AACA,SAAQC,MAAR,QAAqB,OAArB;AAEA,IAAIC,QAAJ;AACA,IAAIC,SAAJ;AACA,IAAIC,eAAJ;AACA,IAAIC,WAAJ;AACA,IAAIC,YAAJ;AACA,IAAIC,cAAJ;AACA,IAAIC,UAAJ;AACA,MAAMC,OAAO,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,KAA/B,CAAhB;AACA,MAAMC,MAAM,GAAG;AAAEC,EAAAA,IAAI,EAAE,EAAR;AAAYC,EAAAA,GAAG,EAAE,CAAjB;AAAoBC,EAAAA,KAAK,EAAE;AAA3B,CAAf;AACA,IAAIC,MAAJ;AACA,IAAIC,WAAW,GAAG,EAAlB;AAEA,OAAO,SAASC,eAAT,CAAyBC,IAAzB,EAA+BC,OAA/B,EAAwCjB,MAAxC,EAAgD;AAEnDc,EAAAA,WAAW,GAAG,EAAd;AAEA,QAAMI,UAAU,GAAG,GAAnB;AAEAF,EAAAA,IAAI,CAACR,OAAL,CAAaW,OAAb,CAAqB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC9BP,IAAAA,WAAW,CAACQ,IAAZ,CAAiB;AAAEC,MAAAA,MAAM,EAAEH,CAAC,CAACI,IAAZ;AAAkBC,MAAAA,gBAAgB,EAAE,CAApC;AAAuCC,MAAAA,iBAAiB,EAAE,CAA1D;AAA6DC,MAAAA,mBAAmB,EAAE,CAAlF;AAAqFC,MAAAA,UAAU,EAAER,CAAC,CAACQ;AAAnG,KAAjB;AACH,GAFD;AAIAZ,EAAAA,IAAI,CAACa,QAAL,CAAcV,OAAd,CAAsB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC/BL,IAAAA,IAAI,CAACR,OAAL,CAAaW,OAAb,CAAqB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAChC,UAAID,EAAE,CAACN,IAAH,IAASJ,CAAC,CAACY,WAAf,EAA4B;AAAE;AAC1BlB,QAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBN,gBAAhB,IAAoCL,CAAC,CAACa,SAAtC;AACAnB,QAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBL,iBAAhB,IAAqCN,CAAC,CAACc,UAAvC;AACH;AACJ,KALD;AAMH,GAPD;AASApB,EAAAA,WAAW,CAACK,OAAZ,CAAoB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC7BD,IAAAA,CAAC,CAACK,gBAAF,GAAqBL,CAAC,CAACK,gBAAF,IAAoBL,CAAC,CAACQ,UAAF,GAAa,MAAjC,CAArB;AACAR,IAAAA,CAAC,CAACM,iBAAF,GAAsBN,CAAC,CAACM,iBAAF,IAAqBN,CAAC,CAACQ,UAAF,GAAa,MAAlC,CAAtB;AACAR,IAAAA,CAAC,CAACO,mBAAF,GAAwBP,CAAC,CAACO,mBAAF,IAAuBP,CAAC,CAACQ,UAAF,GAAa,MAApC,CAAxB;AACA,QAAG,CAACR,CAAC,CAACK,gBAAN,EAAwBL,CAAC,CAACK,gBAAF,GAAqB,CAArB;AAC3B,GALD;AAOAU,EAAAA,OAAO,CAACC,GAAR,CAAYpB,IAAI,CAACR,OAAjB;AACA2B,EAAAA,OAAO,CAACC,GAAR,CAAYtB,WAAZ;AAEAb,EAAAA,QAAQ,GAAGL,EAAE,CAACyC,GAAH,CAAOvB,WAAP,EAAoB,UAASM,CAAT,EAAWC,CAAX,EAAa;AACxC,WAAOD,CAAC,CAACK,gBAAT;AACH,GAFU,CAAX;AAIAvB,EAAAA,SAAS,GAAGN,EAAE,CAACyC,GAAH,CAAOvB,WAAP,EAAoB,UAASM,CAAT,EAAWC,CAAX,EAAa;AACzC,WAAOD,CAAC,CAACM,iBAAT;AACH,GAFW,CAAZ,CAjCmD,CAqCnD;;AACA,MAAIY,MAAM,GAAG1C,EAAE,CAAC2C,SAAH,CAAavB,IAAI,CAACwB,wBAAlB,EAA4CpB,CAAC,IAAIA,CAAC,CAACqB,IAAnD,CAAb;AAEA,MAAIC,UAAU,GAAGJ,MAAM,CAACA,MAAM,CAACK,MAAP,GAAc,CAAf,CAAvB;AAEA,MAAIC,KAAK,GAAG,EAAZ;AACAF,EAAAA,UAAU,CAAC,CAAD,CAAV,CAAcvB,OAAd,CAAsB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC/Bb,IAAAA,OAAO,CAACW,OAAR,CAAgB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC3B,UAAID,EAAE,IAAEV,CAAC,CAACY,WAAP,IAAsBF,EAAE,IAAE,KAA7B,EAAoC;AAAE;AAClChB,QAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBJ,mBAAhB,IAAuCP,CAAC,CAACyB,kBAAzC;AACH;AACJ,KAJD;AAKH,GAND;AAQA/B,EAAAA,WAAW,CAACgC,IAAZ,CAAiB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC1B,QAAG/B,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C,OAAQD,CAAC,CAACvB,gBAAH,GAAwBsB,CAAC,CAACtB,gBAAjC;AAC3C,QAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C,OAAQD,CAAC,CAACtB,iBAAH,GAAyBqB,CAAC,CAACrB,iBAAlC;AAC5C,QAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C,OAAQD,CAAC,CAACrB,mBAAH,GAA2BoB,CAAC,CAACpB,mBAApC;AACjD,GAJD;AAMAxB,EAAAA,eAAe,GAAGP,EAAE,CAACyC,GAAH,CAAOvB,WAAP,EAAoB,UAASM,CAAT,EAAWC,CAAX,EAAa;AAC/C,WAAOD,CAAC,CAACO,mBAAT;AACH,GAFiB,CAAlB,CAzDmD,CA6DnD;;AACA,QAAMuB,oBAAoB,GAAGtD,EAAE,CAACuD,MAAH,CAAU,iCAAV,EAA6CC,IAA7C,CAAkD,SAAlD,EAA6D,CAA7D,CAA7B;AACAvC,EAAAA,MAAM,GAAG;AACLwC,IAAAA,CAAC,EAAEH,oBAAoB,CAACE,IAArB,CAA0B,GAA1B,CADE;AAC8BE,IAAAA,CAAC,EAAEJ,oBAAoB,CAACE,IAArB,CAA0B,GAA1B,CADjC;AACiEG,IAAAA,KAAK,EAAEL,oBAAoB,CAACE,IAArB,CAA0B,OAA1B,CADxE;AAC4GI,IAAAA,MAAM,EAAEN,oBAAoB,CAACE,IAArB,CAA0B,QAA1B;AADpH,GAAT;AAIA,QAAMK,GAAG,GAAG7D,EAAE,CAACuD,MAAH,CAAU,SAAV,EAAqBO,MAArB,CAA4B,GAA5B,EAAiCN,IAAjC,CAAsC,WAAtC,EAAmD,eAAavC,MAAM,CAACwC,CAApB,GAAsB,IAAtB,GAA2BxC,MAAM,CAACyC,CAAlC,GAAoC,GAAvF,EACXF,IADW,CACN,IADM,EACA,cADA,CAAZ;AAGH,MAAIO,SAAS,GAAG9C,MAAM,CAAC2C,MAAP,IAAe1C,WAAW,CAAC6B,MAAZ,GAAmB,CAAlC,CAAhB,CAtEsD,CAsEA;;AAEnD,MAAIiB,IAAI,GAAGH,GAAG,CAACI,SAAJ,CAAc,UAAd,EACb7C,IADa,CACRF,WAAW,CAACd,MAAZ,CAAmBoB,CAAC,IAAEA,CAAC,CAACG,MAAF,KAAW,KAAjC,CADQ,EAEbuC,KAFa,GAGbJ,MAHa,CAGN,GAHM,EAIbN,IAJa,CAIR,OAJQ,EAIC,SAJD,EAKbA,IALa,CAKR,WALQ,EAKK,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAC/B,WAAO,kBAAmBA,CAAC,GAACsC,SAAH,GAAgBlD,MAAM,CAACE,GAAzC,IAAgD,GAAvD;AACA,GAPa,CAAX;AASAK,EAAAA,IAAI,CAAC+C,iBAAL,GAAyBjD,WAAzB;AAEA,MAAIkD,KAAK,GAAGJ,IAAI,CAACF,MAAL,CAAY,MAAZ,EACdN,IADc,CACT,GADS,EACJO,SAAS,GAAC,CADN,EAEXP,IAFW,CAEN,GAFM,EAED3C,MAAM,CAACC,IAAP,GAAY,CAFX,EAGd0C,IAHc,CAGT,OAHS,EAGA,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAAE,WAAO,0BAAwBD,CAAC,CAACG,MAAjC;AAAyC,GAHxD,EAId0C,KAJc,CAIR,oBAJQ,EAIc,QAJd,EAKdA,KALc,CAKR,WALQ,EAKK,MALL,EAMXb,IANW,CAMN,SANM,EAMK,CANL,EAOdA,IAPc,CAOT,MAPS,EAOD,MAPC,EAQdc,IARc,CAQT,UAAS9C,CAAT,EAAWC,CAAX,EAAa;AAClB,QAAGD,CAAC,CAACG,MAAF,KAAW,IAAd,EAAoB,OAAO,UAAP;AACpB,QAAGH,CAAC,CAACG,MAAF,KAAW,IAAd,EAAoB,OAAO,QAAP;AACpB,QAAGH,CAAC,CAACG,MAAF,KAAW,IAAd,EAAoB,OAAO,QAAP;AACpB,QAAGH,CAAC,CAACG,MAAF,KAAW,IAAd,EAAoB,OAAO,8BAAP;AACpB,QAAGH,CAAC,CAACG,MAAF,KAAW,IAAd,EAAoB,OAAO,cAAP;AACpB,GAdc,EAcZ0C,KAdY,CAcN,aAdM,EAcS,KAdT,CAAZ;AAgBA1D,EAAAA,UAAU,GAAGqD,IAAI,CAACO,IAAL,GAAYC,OAAZ,GAAsBb,KAAtB,GAA8B9C,MAAM,CAACC,IAAlD;AACHsD,EAAAA,KAAK,CAACZ,IAAN,CAAW,GAAX,EAAgB7C,UAAU,GAAC,EAA3B;AACAA,EAAAA,UAAU,GAAGA,UAAU,GAAG,EAA1B;AACGX,EAAAA,EAAE,CAACiE,SAAH,CAAa,UAAb,EAAyBT,IAAzB,CAA8B,SAA9B,EAAwC,CAAxC;AAEA,MAAIiB,KAAK,GAAGT,IAAI,CAACF,MAAL,CAAY,MAAZ,EACdN,IADc,CACT,GADS,EACJ,CADI,EAEdA,IAFc,CAET,GAFS,EAEJ,CAFI,EAGdA,IAHc,CAGT,OAHS,EAGA7C,UAHA,EAId6C,IAJc,CAIT,QAJS,EAICO,SAAS,GAAC,CAJX,EAKdM,KALc,CAKR,SALQ,EAKG,CALH,EAMXb,IANW,CAMN,MANM,EAME,MANF,EAOda,KAPc,CAOR,QAPQ,EAOE,SAPF,EAQdb,IARc,CAQT,OARS,EAQA,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAAE,WAAO,YAAUD,CAAC,CAACG,MAAnB;AAA2B,GAR1C,EASd6B,IATc,CAST,SATS,EASE,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAAE,WAAOD,CAAC,CAACG,MAAT;AAAiB,GATlC,EAUd+C,EAVc,CAUX,WAVW,EAUE,UAASlD,CAAT,EAAW;AAC3BxB,IAAAA,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBc,KAAhB,CAAsB,SAAtB,EAAiC,GAAjC,EAD2B,CAErB;AACA;AACA;AACN,GAfc,EAgBdK,EAhBc,CAgBX,UAhBW,EAgBC,YAAU;AACzB1E,IAAAA,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBc,KAAhB,CAAsB,SAAtB,EAAiC,CAAjC,EADyB,CAEnB;AACN,GAnBc,EAoBdK,EApBc,CAoBX,OApBW,EAoBF,UAASlD,CAAT,EAAWC,CAAX,EAAa;AACnB,QAAIkD,CAAC,GAAG3E,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,SAArB,CAAR;AACApD,IAAAA,MAAM,CAAC,CAACuE,CAAD,CAAD,EAAK,aAAL,CAAN;AACH,GAvBW,CAAZ;AAyBAnE,EAAAA,WAAW,GAAGR,EAAE,CAAC4E,WAAH,GAChBC,KADgB,CACV,CAAC,CAAD,EAAI5D,MAAM,CAAC0C,KAAP,GAAe9C,MAAM,CAACG,KAAtB,GAA8BL,UAAlC,CADU,EAEhBmE,MAFgB,CAET,CAAC,CAAD,EAAIzE,QAAJ,CAFS,CAAd,CAjImD,CAmI/B;;AAEpBI,EAAAA,YAAY,GAAGT,EAAE,CAAC4E,WAAH,GACjBC,KADiB,CACX,CAAC,CAAD,EAAI5D,MAAM,CAAC0C,KAAP,GAAe9C,MAAM,CAACG,KAAtB,GAA8BL,UAAlC,CADW,EAEjBmE,MAFiB,CAEV,CAAC,CAAD,EAAIxE,SAAJ,CAFU,CAAf,CArImD,CAuI9B;;AAErBI,EAAAA,cAAc,GAAGV,EAAE,CAAC4E,WAAH,GACnBC,KADmB,CACb,CAAClE,UAAD,EAAaM,MAAM,CAAC0C,KAAP,GAAe9C,MAAM,CAACG,KAAtB,GAA8BL,UAA3C,CADa,EAEnBmE,MAFmB,CAEZ,CAAC,CAAD,EAAIvE,eAAJ,CAFY,CAAjB,CAzImD,CA2IxB;;AAE3B,MAAIwE,IAAI,GAAGf,IAAI,CAACF,MAAL,CAAY,MAAZ,EACVN,IADU,CACL,IADK,EACC,UAAShC,CAAT,EAAWC,CAAX,EAAa;AACrB,WAAO,SAAOD,CAAC,CAACG,MAAhB;AACH,GAHU,EAIb6B,IAJa,CAIR,SAJQ,EAIG,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAAE,WAAOD,CAAC,CAACG,MAAT;AAAiB,GAJnC,EAKV6B,IALU,CAKL,OALK,EAKI,YALJ,EAMVA,IANU,CAML,OANK,EAMI,UAAShC,CAAT,EAAWC,CAAX,EAAa;AACxB,QAAGJ,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C,OAAO7C,WAAW,CAACgB,CAAC,CAACK,gBAAH,CAAlB;AAC3C,QAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C,OAAO5C,YAAY,CAACe,CAAC,CAACM,iBAAH,CAAnB;AAC5C,QAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C,OAAO5C,YAAY,CAACe,CAAC,CAACO,mBAAH,CAAnB;AACjD,GAVU,EAWVyB,IAXU,CAWL,GAXK,EAWA7C,UAXA,EAYV0D,KAZU,CAYJ,SAZI,EAYO,MAZP,EAaVA,KAbU,CAaJ,QAbI,EAaM,SAbN,EAcVb,IAdU,CAcL,GAdK,EAcAO,SAAS,GAACzC,UAAV,GAAuB,CAdvB,EAeVkC,IAfU,CAeL,QAfK,EAeKO,SAAS,GAAGA,SAAS,GAACzC,UAAX,GAAuB,CAfvC,EAgBV+C,KAhBU,CAgBJ,MAhBI,EAgBI,UAAS7C,CAAT,EAAW;AACtB,WAAOtB,MAAM,CAACU,OAAP,CAAeY,CAAC,CAACG,MAAjB,CAAP;AACH,GAlBU,EAmBV6B,IAnBU,CAmBL,SAnBK,EAmBK,CAnBL,EAoBVkB,EApBU,CAoBP,OApBO,EAoBE,UAASlD,CAAT,EAAWC,CAAX,EAAa;AACtB,QAAIkD,CAAC,GAAG3E,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,SAArB,CAAR;AACApD,IAAAA,MAAM,CAAC,CAACuE,CAAD,CAAD,EAAK,aAAL,CAAN;AACH,GAvBU,EAwBVD,EAxBU,CAwBP,WAxBO,EAwBM,UAASlD,CAAT,EAAW;AACxB,QAAIwD,GAAG,GAAGhF,EAAE,CAACuD,MAAH,CAAU,KAAK0B,UAAf,EAA2BC,KAA3B,EAAV,CADwB,CAExB;AACA;AACN,GA5Ba,EA6BbR,EA7Ba,CA6BV,UA7BU,EA6BE,YAAU,CACnB;AACN,GA/Ba,CAAX;AAiCA,MAAIS,SAAS,GAAGnB,IAAI,CAACF,MAAL,CAAY,MAAZ,EAClBQ,IADkB,CACb,UAAS9C,CAAT,EAAW;AACV,QAAGH,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C,OAAOlD,SAAS,CAACqB,CAAC,CAACK,gBAAH,CAAhB;AAC3C,QAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C,OAAOlD,SAAS,CAACqB,CAAC,CAACM,iBAAH,CAAhB;AAC5C,QAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C,OAAOlD,SAAS,CAACqB,CAAC,CAACO,mBAAH,CAAhB;AACjD,GALe,EAMlByB,IANkB,CAMb,IANa,EAMP,UAAShC,CAAT,EAAWC,CAAX,EAAa;AACxB,WAAO,eAAaD,CAAC,CAACG,MAAtB;AACA,GARkB,EASf6B,IATe,CASV,SATU,EASC,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAAE,WAAOD,CAAC,CAACG,MAAT;AAAiB,GATjC,EAUlB6B,IAVkB,CAUb,OAVa,EAUJ,YAVI,EAWlBA,IAXkB,CAWb,GAXa,EAWRO,SAAS,GAAC,CAXF,EAYlBM,KAZkB,CAYZ,oBAZY,EAYU,QAZV,EAalBA,KAbkB,CAaZ,aAbY,EAaG,OAbH,EAclBb,IAdkB,CAcb,GAda,EAcR,UAAShC,CAAT,EAAWC,CAAX,EAAa;AACjB,QAAGJ,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C,OAAO7C,WAAW,CAACgB,CAAC,CAACK,gBAAH,CAAX,GAAgClB,UAAhC,GAA2C,CAAlD;AAC3C,QAAGU,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C,OAAO5C,YAAY,CAACe,CAAC,CAACM,iBAAH,CAAZ,GAAkCnB,UAAlC,GAA6C,CAApD;AAC5C,QAAGU,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C,OAAO3C,cAAc,CAACc,CAAC,CAACO,mBAAH,CAAd,GAAsCpB,UAAtC,GAAiD,CAAxD;AACjD,GAlBe,EAmBf6C,IAnBe,CAmBV,SAnBU,EAmBC,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAC1B,QAAI2D,GAAG,GAAG,CAAV;AACA,QAAG/D,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C+B,GAAG,GAAI5D,CAAC,CAACK,gBAAT;AAC3C,QAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C+B,GAAG,GAAI5D,CAAC,CAACM,iBAAT;AAC5C,QAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C+B,GAAG,GAAI5D,CAAC,CAACO,mBAAT;;AAC9C,QAAGqD,GAAG,GAAC,CAAP,EAAS;AAAE,aAAO,CAAP;AAAU,KAArB,MAA2B;AAAE,aAAO,CAAP;AAAS;AACzC,GAzBe,EA0BlBf,KA1BkB,CA0BZ,MA1BY,EA0BJ,SA1BI,EA2BlBA,KA3BkB,CA2BZ,aA3BY,EA2BG,QA3BH,EA4BlBA,KA5BkB,CA4BZ,WA5BY,EA4BC,MA5BD,CAAhB;AA8BH;AAED,OAAO,SAASgB,iBAAT,CAA2BhE,OAA3B,EAAmCD,IAAnC,EAAyC;AAE5CF,EAAAA,WAAW,GAAG,EAAd;AAEAN,EAAAA,OAAO,CAACW,OAAR,CAAgB,UAASC,CAAT,EAAWC,CAAX,EAAa;AACzBP,IAAAA,WAAW,CAACQ,IAAZ,CAAiB;AAAEC,MAAAA,MAAM,EAAEH,CAAV;AAAaK,MAAAA,gBAAgB,EAAE,CAA/B;AAAkCC,MAAAA,iBAAiB,EAAE,CAArD;AAAwDC,MAAAA,mBAAmB,EAAE;AAA7E,KAAjB;AACH,GAFD;AAIAX,EAAAA,IAAI,CAACa,QAAL,CAAcV,OAAd,CAAsB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC/Bb,IAAAA,OAAO,CAACW,OAAR,CAAgB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC3B,UAAID,EAAE,IAAEV,CAAC,CAACY,WAAV,EAAuB;AAAE;AACrBlB,QAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBN,gBAAhB,IAAoCL,CAAC,CAACa,SAAtC;AACAnB,QAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBL,iBAAhB,IAAqCN,CAAC,CAACc,UAAvC;AACApB,QAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBJ,mBAAhB,GAAsC,CAAtC;AACH;AACJ,KAND;AAOH,GARD;AAUA1B,EAAAA,QAAQ,GAAGL,EAAE,CAACyC,GAAH,CAAOvB,WAAP,EAAoB,UAASM,CAAT,EAAWC,CAAX,EAAa;AACxC,WAAOD,CAAC,CAACK,gBAAT;AACH,GAFU,CAAX;AAIAvB,EAAAA,SAAS,GAAGN,EAAE,CAACyC,GAAH,CAAOvB,WAAP,EAAoB,UAASM,CAAT,EAAWC,CAAX,EAAa;AACzC,WAAOD,CAAC,CAACM,iBAAT;AACH,GAFW,CAAZ,CAtB4C,CA0B5C;;AACA,MAAIY,MAAM,GAAG1C,EAAE,CAAC2C,SAAH,CAAavB,IAAI,CAACwB,wBAAlB,EAA4CpB,CAAC,IAAIA,CAAC,CAACqB,IAAnD,CAAb;AAEA,MAAIC,UAAU,GAAGJ,MAAM,CAACA,MAAM,CAACK,MAAP,GAAc,CAAf,CAAvB;AAEA,MAAIC,KAAK,GAAG,EAAZ;;AACA,MAAGF,UAAH,EAAc;AACVA,IAAAA,UAAU,CAAC,CAAD,CAAV,CAAcvB,OAAd,CAAsB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC/Bb,MAAAA,OAAO,CAACW,OAAR,CAAgB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC3B,YAAID,EAAE,IAAEV,CAAC,CAACY,WAAV,EAAuB;AAAE;AACrBlB,UAAAA,WAAW,CAACiB,EAAD,CAAX,CAAgBJ,mBAAhB,IAAuCP,CAAC,CAACyB,kBAAzC;AACH;AACJ,OAJD;AAKH,KAND;AAOH;;AAED/B,EAAAA,WAAW,CAACgC,IAAZ,CAAiB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC1B,QAAG/B,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C,OAAQD,CAAC,CAACvB,gBAAH,GAAwBsB,CAAC,CAACtB,gBAAjC;AAC3C,QAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C,OAAQD,CAAC,CAACtB,iBAAH,GAAyBqB,CAAC,CAACrB,iBAAlC;AAC5C,QAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C,OAAQD,CAAC,CAACrB,mBAAH,GAA2BoB,CAAC,CAACpB,mBAApC;AACjD,GAJD;AAMAX,EAAAA,IAAI,CAAC+C,iBAAL,GAAyBjD,WAAzB;AAEAX,EAAAA,eAAe,GAAGP,EAAE,CAACyC,GAAH,CAAOvB,WAAP,EAAoB,UAASM,CAAT,EAAWC,CAAX,EAAa;AAC/C,WAAOD,CAAC,CAACO,mBAAT;AACH,GAFiB,CAAlB;AAIAvB,EAAAA,WAAW,GAAGR,EAAE,CAAC4E,WAAH,GAChBC,KADgB,CACV,CAAC,CAAD,EAAI5D,MAAM,CAAC0C,KAAP,GAAe9C,MAAM,CAACG,KAAtB,GAA8BL,UAAlC,CADU,EAEhBmE,MAFgB,CAET,CAAC,CAAD,EAAIzE,QAAJ,CAFS,CAAd,CAtD4C,CAwDxB;;AAEpBI,EAAAA,YAAY,GAAGT,EAAE,CAAC4E,WAAH,GACjBC,KADiB,CACX,CAAC,CAAD,EAAI5D,MAAM,CAAC0C,KAAP,GAAe9C,MAAM,CAACG,KAAtB,GAA8BL,UAAlC,CADW,EAEjBmE,MAFiB,CAEV,CAAC,CAAD,EAAIxE,SAAJ,CAFU,CAAf,CA1D4C,CA4DvB;;AAErBI,EAAAA,cAAc,GAAGV,EAAE,CAAC4E,WAAH,GACnBC,KADmB,CACb,CAAC,CAAD,EAAI5D,MAAM,CAAC0C,KAAP,GAAe9C,MAAM,CAACG,KAAtB,GAA8BL,UAAlC,CADa,EAEnBmE,MAFmB,CAEZ,CAAC,CAAD,EAAIvE,eAAJ,CAFY,CAAjB,CA9D4C,CAgEjB;;AAE3B,MAAIA,eAAe,IAAE,CAAlB,IAAuBF,QAAQ,IAAE,CAAjC,IAAsCC,SAAS,IAAE,CAApD,EAAuD;AACnDN,IAAAA,EAAE,CAACiE,SAAH,CAAa,aAAb,EACCqB,UADD,GACcC,QADd,CACuB,GADvB,EAEC/B,IAFD,CAEM,OAFN,EAEe,CAFf;AAIAxD,IAAAA,EAAE,CAACiE,SAAH,CAAa,aAAb,EACCqB,UADD,GAEGC,QAFH,CAEY,GAFZ,EAGG/B,IAHH,CAGQ,GAHR,EAGa7C,UAHb,EAIG6C,IAJH,CAIQ,SAJR,EAImB,CAJnB;AAKH,GAVD,MAUO;AACHxD,IAAAA,EAAE,CAACiE,SAAH,CAAa,aAAb,EACCqB,UADD,GACcC,QADd,CACuB,GADvB,EAEC/B,IAFD,CAEM,OAFN,EAEe,UAAShC,CAAT,EAAWC,CAAX,EAAa;AACxB,UAAI+D,EAAE,GAAGxF,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,SAArB,CAAT;AACA,UAAIhC,CAAJ;AACAN,MAAAA,WAAW,CAACK,OAAZ,CAAoB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC/B,YAAGD,EAAE,CAACP,MAAH,IAAa6D,EAAhB,EAAmB;AACfhE,UAAAA,CAAC,GAAGU,EAAJ;AACH;AACJ,OAJD;AAKA,UAAIkD,GAAG,GAAG,CAAV;AACA,UAAG/D,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C+B,GAAG,GAAG5E,WAAW,CAACgB,CAAC,CAACK,gBAAH,CAAjB;AAC3C,UAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C+B,GAAG,GAAG3E,YAAY,CAACe,CAAC,CAACM,iBAAH,CAAlB;AAC5C,UAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C+B,GAAG,GAAG1E,cAAc,CAACc,CAAC,CAACO,mBAAH,CAApB;;AAC9C,UAAG,CAAC0D,KAAK,CAACL,GAAD,CAAT,EAAgB;AAAE,eAAOM,UAAU,CAACN,GAAD,CAAjB;AAAwB,OAA1C,MAAgD;AAAE,eAAO,CAAP;AAAS;AAC9D,KAfD;AAgBApF,IAAAA,EAAE,CAACiE,SAAH,CAAa,aAAb,EACCqB,UADD,GAEGC,QAFH,CAEY,GAFZ,EAGGI,KAHH,CAGS,MAHT,EAGiB,UAASnE,CAAT,EAAWC,CAAX,EAAc;AAC3B,UAAImE,GAAG,GAAG,CAAV;AACA,UAAIJ,EAAE,GAAGxF,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,SAArB,CAAT;AACA,UAAIhC,CAAJ;AACAN,MAAAA,WAAW,CAACK,OAAZ,CAAoB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC/B,YAAGD,EAAE,CAACP,MAAH,IAAa6D,EAAhB,EAAmB;AACfhE,UAAAA,CAAC,GAAGU,EAAJ;AACH;AACJ,OAJD;AAKA,UAAGb,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2CuC,GAAG,GAAIpE,CAAC,CAACK,gBAAT;AAC3C,UAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4CuC,GAAG,GAAIpE,CAAC,CAACM,iBAAT;AAC5C,UAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8CuC,GAAG,GAAIpE,CAAC,CAACO,mBAAT;AAC9C,UAAIN,CAAC,GAAGzB,EAAE,CAAC6F,WAAH,CAAeC,IAAI,CAACC,KAAL,CAAYD,IAAI,CAACE,MAAL,KAAgB,MAAjB,GAA2B,KAAtC,CAAf,EAA6DJ,GAA7D,CAAR;AACA,aAAO,UAASjB,CAAT,EAAY;AACjB3E,QAAAA,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBe,IAAhB,CAAqBnE,SAAS,CAAC2F,IAAI,CAACG,KAAL,CAAWxE,CAAC,CAACkD,CAAD,CAAZ,CAAD,CAA9B;AACD,OAFD;AAGD,KAnBH,EAoBCnB,IApBD,CAoBM,GApBN,EAoBW,UAAShC,CAAT,EAAWC,CAAX,EAAa;AACpB,UAAI+D,EAAE,GAAGxF,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,SAArB,CAAT;AACA,UAAIhC,CAAJ;AACAN,MAAAA,WAAW,CAACK,OAAZ,CAAoB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC/B,YAAGD,EAAE,CAACP,MAAH,IAAa6D,EAAhB,EAAmB;AACfhE,UAAAA,CAAC,GAAGU,EAAJ;AACH;AACJ,OAJD;AAKA,UAAGb,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C,OAAO7C,WAAW,CAACgB,CAAC,CAACK,gBAAH,CAAX,GAAgClB,UAAhC,GAA2C,CAAlD;AAC3C,UAAGU,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C,OAAO5C,YAAY,CAACe,CAAC,CAACM,iBAAH,CAAZ,GAAkCnB,UAAlC,GAA6C,CAApD;AAC5C,UAAGU,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C,OAAO3C,cAAc,CAACc,CAAC,CAACO,mBAAH,CAAd,GAAsCpB,UAAtC,GAAiD,CAAxD;AACjD,KA/BD,EAgCC6C,IAhCD,CAgCM,SAhCN,EAgCiB,UAAShC,CAAT,EAAWC,CAAX,EAAa;AAC1B,UAAID,CAAJ;AACA,UAAIgE,EAAE,GAAGxF,EAAE,CAACuD,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,SAArB,CAAT;AACAtC,MAAAA,WAAW,CAACK,OAAZ,CAAoB,UAASW,EAAT,EAAYC,EAAZ,EAAe;AAC/B,YAAGD,EAAE,CAACP,MAAH,IAAa6D,EAAhB,EAAmB;AACfhE,UAAAA,CAAC,GAAGU,EAAJ;AACH;AACJ,OAJD;AAKA,UAAIkD,GAAG,GAAG,CAAV;AACA,UAAG/D,OAAO,CAACgC,mBAAR,IAA+B,OAAlC,EAA2C+B,GAAG,GAAI5D,CAAC,CAACK,gBAAT;AAC3C,UAAGR,OAAO,CAACgC,mBAAR,IAA+B,QAAlC,EAA4C+B,GAAG,GAAI5D,CAAC,CAACM,iBAAT;AAC5C,UAAGT,OAAO,CAACgC,mBAAR,IAA+B,UAAlC,EAA8C+B,GAAG,GAAI5D,CAAC,CAACO,mBAAT;;AAC9C,UAAGqD,GAAG,GAAC,CAAP,EAAS;AAAE,eAAO,CAAP;AAAU,OAArB,MAA2B;AAAE,eAAO,CAAP;AAAS;AACzC,KA7CD;AA+CH;AAIJ;AAED,eAAejE,eAAf","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {addCommas} from './HelperFunctions';\nimport {filter} from './App';\n\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases; \nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth; \nconst regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\nconst margin = { left: 20, top: 0, right: 58 };\nlet rcSize; \nlet groupedData = [];\n\nexport function drawRegionchart(data, options, filter) {\n\n    groupedData = [];\n\n    const barSpacing = 0.1;\n\n    data.regions.forEach(function(d,i){\n        groupedData.push({ region: d.code, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0, population: d.population});\n    })\n\n    data.who_data.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ // remove OTH\n                groupedData[ii].cumulative_cases += d.new_cases;\n                groupedData[ii].cumulative_deaths += d.new_deaths;\n            }\n        });\n    });\n\n    groupedData.forEach(function(d,i){\n        d.cumulative_cases = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines = d.cumulative_vaccines/(d.population/100000);\n        if(!d.cumulative_cases) d.cumulative_cases = 0;\n    })\n\n    console.log(data.regions);\n    console.log(groupedData);\n\n    maxCases = d3.max(groupedData, function(d,i){\n        return d.cumulative_cases;\n    })\n\n    maxDeaths = d3.max(groupedData, function(d,i){\n        return d.cumulative_deaths;\n    })\n\n    // vaccinations max date records\n    var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n\n    var vacGrouped = vGroup[vGroup.length-1];\n\n    var vData = [];\n    vacGrouped[1].forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if((dd==d.ifrc_region)&&(dd!='OTH')){ // remove OTH\n                groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n            }\n        })\n    });\n\n    groupedData.sort(function(a,b){\n        if(options.region_chart_toggle == 'cases') return (b.cumulative_cases) - (a.cumulative_cases);\n        if(options.region_chart_toggle == 'deaths') return (b.cumulative_deaths) - (a.cumulative_deaths);\n        if(options.region_chart_toggle == 'vaccines') return (b.cumulative_vaccines) - (a.cumulative_vaccines); \n    });\n\n    maxVaccinations = d3.max(groupedData, function(d,i){\n        return d.cumulative_vaccines;\n    })\n\n    // append region chart containerg\n    const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n    rcSize = {\n        x: regionChartContainer.attr('x'), y: regionChartContainer.attr('y'), width: regionChartContainer.attr('width'), height: regionChartContainer.attr('height')\n    }\n\n    const svg = d3.select('#layout').append('g').attr('transform', 'translate('+rcSize.x+', '+rcSize.y+')')\n    .attr('id', 'region_chart');\n\n\tvar rowHeight = rcSize.height/(groupedData.length-1); // remove OTH\n\n    var rows = svg.selectAll('.bar-row')\n\t.data(groupedData.filter(d=>d.region!=='OTH'))\n\t.enter()\n\t.append('g')\n\t.attr('class', 'bar-row')\n\t.attr('transform', function(d,i){\n\t\treturn 'translate(0,' + ((i*rowHeight) + margin.top) + ')';\n\t});\n\n    data.cumulative_totals = groupedData;\n    \n    var label = rows.append('text')\n\t.attr('y', rowHeight/2 )\n    .attr('x', margin.left-5)\n\t.attr('class', function(d,i){ return 'bar-labels bar-label-'+d.region })\n\t.style('alignment-baseline', 'middle')\n\t.style('font-size', '11px')\n    .attr('opacity', 1)\n\t.attr('fill', '#000')\n\t.text(function(d,i){\n\t\tif(d.region==='AM') return 'Americas';\n\t\tif(d.region==='EU') return 'Europe';\n\t\tif(d.region==='AF') return 'Africa';\n\t\tif(d.region==='ME') return 'Middle East and North Africa';\n\t\tif(d.region==='AP') return 'Asia-Pacific';\n\t}).style('text-anchor', 'end');\n\n    labelWidth = rows.node().getBBox().width + margin.left;\n\tlabel.attr('x', labelWidth+89);\n\tlabelWidth = labelWidth + 94;\n    d3.selectAll('.timeBar').attr('opacity',1);\n    \n    var rowBg = rows.append('rect')\n\t.attr('y', 0)\n\t.attr('x', 0)\n\t.attr('width', labelWidth)\n\t.attr('height', rowHeight-2)\n\t.style('opacity', 0)\n    .attr('fill', 'grey')\n\t.style('cursor', 'pointer')\n\t.attr('class', function(d,i){ return 'bar-bg-'+d.region })\n\t.attr('data-id', function(d,i){ return d.region })\n\t.on('mouseover', function(d){\n\t\td3.select(this).style('opacity', 0.1);\n        // var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n\t\td3.select(this).style('opacity', 0);\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\t.on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    });\n\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);// severity/reliability x xcale\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);// severity/reliability x xcale\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([labelWidth, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);// severity/reliability x xcale\n\n    var bars = rows.append('rect')\n    .attr('id', function(d,i){\n        return 'bar-'+d.region;\n    })\n\t.attr('data-id', function(d,i){ return d.region })\n    .attr('class', 'region-bar')\n    .attr('width', function(d,i){\n        if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases);\n        if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths);\n        if(options.region_chart_toggle == 'vaccines') return xScaleDeaths(d.cumulative_vaccines);\n    })\n    .attr('x', labelWidth)\n    .style('outline', 'none')\n    .style('cursor', 'pointer')\n    .attr('y', rowHeight*barSpacing - 1)\n    .attr('height', rowHeight-((rowHeight*barSpacing)*2))\n    .style('fill', function(d){\n        return colors.regions[d.region]\n    })\n    .attr('opacity',1)\n    .on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    })\n    .on('mouseover', function(d){\n        var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\n    var dataLabel = rows.append('text')\n\t.text(function(d){\n        if(options.region_chart_toggle == 'cases') return addCommas(d.cumulative_cases);\n        if(options.region_chart_toggle == 'deaths') return addCommas(d.cumulative_deaths);\n        if(options.region_chart_toggle == 'vaccines') return addCommas(d.cumulative_vaccines);\n    })\n\t.attr('id', function(d,i){\n\t\treturn 'data-label'+d.region;\n\t})\n    .attr('data-id', function(d,i){ return d.region })\n\t.attr('class', 'data-label')\n\t.attr('y', rowHeight/2)\n\t.style('alignment-baseline', 'middle')\n\t.style('text-anchor', 'start')\n\t.attr('x', function(d,i){\n        if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases)+labelWidth+5;\n        if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths)+labelWidth+5;\n        if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;\n    })\n    .attr('opacity', function(d,i){\n        var val = 0;\n        if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases);\n        if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths);\n        if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines);\n        if(val>0){ return 1 } else { return 0}\n    })\n\t.style('fill', '#696969')\n\t.style('font-weight', 'normal')\n\t.style('font-size', '10px');\n\n}\n\nexport function updateRegionchart(options,data) {\n    \n    groupedData = [];\n\n    regions.forEach(function(d,i){\n        groupedData.push({ region: d, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0});\n    })\n    \n    data.who_data.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if((dd==d.ifrc_region)){ // remove OTH\n                groupedData[ii].cumulative_cases += d.new_cases;\n                groupedData[ii].cumulative_deaths += d.new_deaths;\n                groupedData[ii].cumulative_vaccines = 0;\n            }\n        })\n    });\n\n    maxCases = d3.max(groupedData, function(d,i){\n        return d.cumulative_cases;\n    })\n\n    maxDeaths = d3.max(groupedData, function(d,i){\n        return d.cumulative_deaths;\n    })\n\n    // vaccinations max date records\n    var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n\n    var vacGrouped = vGroup[vGroup.length-1];\n\n    var vData = [];\n    if(vacGrouped){\n        vacGrouped[1].forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if((dd==d.ifrc_region)){ // remove OTH\n                    groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n                }\n            })\n        });\n    }\n\n    groupedData.sort(function(a,b){\n        if(options.region_chart_toggle == 'cases') return (b.cumulative_cases) - (a.cumulative_cases);\n        if(options.region_chart_toggle == 'deaths') return (b.cumulative_deaths) - (a.cumulative_deaths);\n        if(options.region_chart_toggle == 'vaccines') return (b.cumulative_vaccines) - (a.cumulative_vaccines); \n    });\n\n    data.cumulative_totals = groupedData;\n\n    maxVaccinations = d3.max(groupedData, function(d,i){\n        return d.cumulative_vaccines;\n    })\n\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);// severity/reliability x xcale\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);// severity/reliability x xcale\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);// severity/reliability x xcale\n\n    if((maxVaccinations==0)&&(maxCases==0)&&(maxDeaths==0)){\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .attr('width', 0);\n\n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500) \n          .attr('x', labelWidth)\n          .attr('opacity', 0);\n    } else {\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .attr('width', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);\n            if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n        })   \n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500)\n          .tween(\"text\", function(d,i) {\n            var end = 0;\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            if(options.region_chart_toggle == 'cases') end = (d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') end = (d.cumulative_deaths);  \n            if(options.region_chart_toggle == 'vaccines') end = (d.cumulative_vaccines);  \n            var i = d3.interpolate(Math.floor((Math.random() * 112346) + 92345), end);\n            return function(t) {\n              d3.select(this).text(addCommas(Math.round(i(t))));\n            };\n          })\n        .attr('x', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases)+labelWidth+5;\n            if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths)+labelWidth+5;\n            if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;\n        })\n        .attr('opacity', function(d,i){\n            var d;\n            var id = d3.select(this).attr('data-id');\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths);\n            if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines);\n            if(val>0){ return 1 } else { return 0}\n        })\n\n    }\n\n   \n\n}\n\nexport default drawRegionchart;\n"]},"metadata":{},"sourceType":"module"}