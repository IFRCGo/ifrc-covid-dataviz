{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{filter}from'./App';import mapboxgl from'!mapbox-gl';// eslint-disable-line import/no-webpack-loader-syntax\nimport'mapbox-gl/dist/mapbox-gl.css';import{addCommas}from'./HelperFunctions';mapboxgl.accessToken='pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';var map;var dots;var maxSize=15;var mapTooltip;export function createMap(data,options,filter){d3.select('#map-refresh').attr('display','none').style('cursor','pointer').on('click',function(d,i){map.setCenter([8,22]);map.setZoom(0);d3.select('#map-refresh').attr('display','none');});map=new mapboxgl.Map({container:'map_div',// container ID\n// style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww', // style URL\nstyle:'mapbox://styles/go-ifrc/ckqrsg27f1cwu17pex8w2de2e',// style URL\ncenter:[8,22],// starting position [lng, lat]\nzoom:0// starting zoom\n});map.setRenderWorldCopies(false);map.addControl(new mapboxgl.NavigationControl());map.on('zoom',function(){d3.select('#map-refresh').attr('display','inline');});map.on('touchmove',function(){d3.select('#map-refresh').attr('display','inline');});map.on('wheel',function(){d3.select('#map-refresh').attr('display','inline');});map.on('drag',function(){d3.select('#map-refresh').attr('display','inline');});var container=map.getCanvasContainer();var svg=d3.select(container).append(\"svg\").attr('id','mapoverlay').attr(\"width\",\"100%\").attr(\"height\",\"24vw\").style(\"position\",\"absolute\").style(\"z-index\",2);mapTooltip=d3.select('#map_tooltip').attr('opacity',1).attr('transform','translate(0,0)').attr('display','inline');// dots = svg\n// .selectAll(\".country-map\")\n// .data(data.world)\n// .enter()\n// .append(\"circle\")\n// .attr('class', 'country-map')\n// .attr('id', function(d,i){ return 'country-map-'+d.iso2 })\n// .attr(\"r\", 0)\n// var maxValue = d3.max(data.country, function(d,i){\n//     return d[1].cumulative_cases;\n// })\n// var rScale = d3.scalePow().exponent(0.5)\n//   .domain([0, maxValue])\n//   .range([0, 15]);\n// data.country.forEach(function(d,i){\n//     d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases))\n//     .attr('data-name', d[1].country)\n// })\nd3.select(\"#map_div\").append('svg').attr('width','18vw').attr('height','1.5vw').attr('id','maplegend').attr('viewBox','0 0 227 18');document.getElementById(\"maplegend\").appendChild(d3.select('#red_legend').node());document.getElementById(\"maplegend\").appendChild(d3.select('#blue_legend').node());document.getElementById(\"maplegend\").appendChild(d3.select('#bi_legend').node());d3.select('#red_legend').attr('transform','translate(20,0)');d3.select('#blue_legend').attr('transform','translate(20,0)');d3.select('#bi_legend').attr('transform','translate(0,0)');d3.select('#bi_legend').attr('display','none');d3.select('#blue_legend').attr('display','none');document.getElementById(\"mapoverlay\").appendChild(d3.select('#map_tooltip').node());mapTooltip.attr('display','none');map.on('load',function(e){map.setPaintProperty('countries','fill-opacity-transition',{duration:0,delay:0});updateMap(data,options);});}export function updateMap(data,options){var duration=800;var delay=10;map.setLayoutProperty('countries','visibility','none');if(options.map_toggle=='bi-weekly-change'){var maxIncrease=d3.max(data.country,function(d,i){return d[1].percent_change;});var maxDecrease=d3.min(data.country,function(d,i){return d[1].percent_change;});d3.select('#bi_legend').attr('display','inline');d3.select('#blue_legend').attr('display','none');d3.select('#red_legend').attr('display','none');maxIncrease=Math.ceil(maxIncrease/0.1)*0.1;maxDecrease=Math.floor(maxDecrease/0.1)*0.1;if(maxIncrease>1)maxIncrease=1;if(maxDecrease<-1)maxDecrease=-1;d3.select('#bi_legend_dec_val').attr('text-anchor','end');if(maxIncrease<1){d3.select('#bi_legend_inc_val tspan').text(Math.round(maxIncrease*100)+'%');}else{d3.select('#bi_legend_inc_val tspan').text(Math.round(maxIncrease*100)+'% +');}if(maxDecrease>-1){d3.select('#bi_legend_dec_val tspan').text(Math.round(Math.abs(maxDecrease)*100)+'%').attr('dx',14);}else{d3.select('#bi_legend_dec_val tspan').text(Math.round(Math.abs(maxDecrease)*100)+'% +').attr('dx',14);}// var rScale = d3.scalePow().exponent(0.5)\n// .domain([-1, 0, 1])\n// .range([maxSize, 0, maxSize])\n// .clamp(true);\n// d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n// data.country.forEach(function(d,i){\n//     d3.select('#country-map-'+d[0])\n//     .transition('c').duration(duration).delay(delay)\n//     .attr('r', rScale(d[1].percent_change))\n//     .style('stroke', function(){\n//         // if(d[1].percent_change>1){ return '#E02225'} else { return '#1F558C'}\n//         return '#FFF'\n//     }).style('fill', function(){\n//         if(d[1].percent_change>0){ return colors.red } else { return colors.blue}\n//     })\n// })\nvar colorScale=d3.scaleLinear()// .domain([-1, 0, 1])\n.domain([maxDecrease,0,maxIncrease]).range([colors.blue,colors.lightgrey,colors.red]);// .clamp(true);\nvar fillColorArray=['case'];data.country.forEach(function(d,i){fillColorArray.push(['==',['get',\"iso\"],d[0]]);fillColorArray.push(colorScale(d[1].percent_change));});if(fillColorArray.length>1){fillColorArray.push(colors.darkgrey);map.setPaintProperty('countries','fill-color',fillColorArray);}}if(options.map_toggle=='cases'){var maxValue=d3.max(data.country,function(d,i){return d[1].cumulative_cases_per_100k;});d3.select('#bi_legend').attr('display','none');d3.select('#blue_legend').attr('display','none');d3.select('#red_legend').attr('display','inline');d3.select('#red_legend_title tspan').text('Cases per 100k');if(maxValue>1000){maxValue=Math.ceil(maxValue/100)*100;}else{maxValue=Math.ceil(maxValue/10)*10;}d3.select('#red_legend_val tspan').text(addCommas(maxValue));// var rScale = d3.scalePow().exponent(0.5)\n// .domain([0, maxValue])\n// .range([0, maxSize]);\n// d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n// data.country.forEach(function(d,i){\n//     d3.select('#country-map-'+d[0])\n//     .transition('c').duration(duration).delay(delay)\n//     .attr('r', rScale(d[1].cumulative_cases))\n//     .style('fill', colors.red)\n//     .style('stroke', '#FFF');\n// })\nvar colorScale=d3.scaleLinear().domain([0,maxValue]).range([colors.lightgrey,colors.red]);var fillColorArray=['case'];data.country.forEach(function(d,i){fillColorArray.push(['==',['get',\"iso\"],d[0]]);fillColorArray.push(colorScale(d[1].cumulative_cases_per_100k));});if(fillColorArray.length>1){fillColorArray.push(colors.darkgrey);map.setPaintProperty('countries','fill-color',fillColorArray);}}if(options.map_toggle=='deaths'){var maxValue=d3.max(data.country,function(d,i){return d[1].cumulative_deaths_per_100k;});d3.select('#bi_legend').attr('display','none');d3.select('#blue_legend').attr('display','none');d3.select('#red_legend').attr('display','inline');d3.select('#red_legend_title tspan').text('Deaths per 100k');if(maxValue>1000){maxValue=Math.ceil(maxValue/100)*100;}else{maxValue=Math.ceil(maxValue/10)*10;}d3.select('#red_legend_val tspan').text(addCommas(maxValue));// var rScale = d3.scalePow().exponent(0.5)\n// .domain([0, maxValue])\n// .range([0, maxSize]);\n// d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n// data.country.forEach(function(d,i){\n//     d3.select('#country-map-'+d[0])\n//     .transition('c').duration(duration).delay(delay)\n//     .attr('r', rScale(d[1].cumulative_deaths))\n//     .style('fill', colors.red)\n//     .style('stroke', '#FFF');\n// })\nvar colorScale=d3.scaleLinear().domain([0,maxValue]).range([colors.lightgrey,colors.red]);var fillColorArray=['case'];data.country.forEach(function(d,i){fillColorArray.push(['==',['get',\"iso\"],d[0]]);fillColorArray.push(colorScale(d[1].cumulative_deaths_per_100k));});if(fillColorArray.length>1){fillColorArray.push(colors.darkgrey);map.setPaintProperty('countries','fill-color',fillColorArray);}}if(options.map_toggle=='percent-fully-vaccinated'){var maxValue=d3.max(data.vGroup,function(d,i){return parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;});d3.select('#bi_legend').attr('display','none');d3.select('#blue_legend').attr('display','inline');d3.select('#red_legend').attr('display','none');d3.select('#blue_legend_title tspan').text('Percent fully vaccinated');// if(maxValue>1000){\n//     maxValue = (Math.round(maxValue/100))*100;\n// } else {\n//     maxValue = (Math.round(maxValue/10))*10;\n// }\nd3.select('#blue_legend_val tspan').text('100%');// var rScale = d3.scalePow().exponent(0.55)\n// .domain([0, 1])\n// .range([1, maxSize])\n// .clamp(true);\n// d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n// data.vGroup.forEach(function(d,i){\n//     var peoplevaccinated = parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n//     if(isNaN(peoplevaccinated)) peoplevaccinated = 0;\n//     d3.select('#country-map-'+d[1][0].country_code)\n//     .transition('c').duration(duration).delay(delay)\n//     .attr('r', rScale(peoplevaccinated))\n//     .style('stroke', '#FFF')\n//     .style('fill', function(){\n//         return colors.blue;\n//     })\n// })\nvar colorScale=d3.scaleLinear().domain([0,1]).range([colors.lightgrey,colors.blue]).clamp(true);var fillColorArray=['case'];data.vGroup.forEach(function(d,i){var peoplevaccinated=parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;if(isNaN(peoplevaccinated))peoplevaccinated=0;if(peoplevaccinated>0){if(d[1][0].country_code)fillColorArray.push(['==',['get',\"iso\"],d[1][0].country_code]);if(d[1][0].country_code)fillColorArray.push(colorScale(peoplevaccinated));}});if(fillColorArray.length>1){fillColorArray.push(colors.darkgrey);map.setPaintProperty('countries','fill-color',fillColorArray);}else{map.setPaintProperty('countries','fill-color',colors.darkgrey);}}if(options.map_toggle=='percent-vaccine-acceptance'){var maxValue=d3.max(data.vGroup,function(d,i){return parseFloat(d[1][0].vaccine_acceptance_percent)/100;});d3.select('#bi_legend').attr('display','none');d3.select('#blue_legend').attr('display','inline');d3.select('#red_legend').attr('display','none');d3.select('#blue_legend_title tspan').text('Percent vaccine acceptance');// if(maxValue>1000){\n//     maxValue = (Math.round(maxValue/100))*100;\n// } else {\n//     maxValue = (Math.round(maxValue/10))*10;\n// }\nd3.select('#blue_legend_val tspan').text('100%');// var rScale = d3.scalePow().exponent(1)\n// .domain([0, 1])\n// .range([1, maxSize*.7])\n// // .clamp(true);\n// d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n// data.vGroup.forEach(function(d,i){\n//     var vaccine_acceptance_percent = parseFloat(d[1][0].vaccine_acceptance_percent/100);\n//     if(isNaN(vaccine_acceptance_percent)) vaccine_acceptance_percent = 0;\n//     d3.select('#country-map-'+d[1][0].country_code)\n//     .transition('c').duration(duration).delay(delay)\n//     .attr('r', rScale(vaccine_acceptance_percent))\n//     .style('stroke', '#FFF')\n//     .style('fill', function(){\n//         return colors.blue;\n//     })\n// })\nvar colorScale=d3.scaleLinear().domain([0,1]).range([colors.lightgrey,colors.blue]).clamp(true);var fillColorArray=['case'];data.vGroup.forEach(function(d,i){var vaccine_acceptance_percent=parseFloat(d[1][0].vaccine_acceptance_percent)/100;if(isNaN(vaccine_acceptance_percent))vaccine_acceptance_percent=0;if(vaccine_acceptance_percent>0){if(d[1][0].country_code)fillColorArray.push(['==',['get',\"iso\"],d[1][0].country_code]);if(d[1][0].country_code)fillColorArray.push(colorScale(vaccine_acceptance_percent));}});if(fillColorArray.length>1){fillColorArray.push(colors.darkgrey);map.setPaintProperty('countries','fill-color',fillColorArray);}else{map.setPaintProperty('countries','fill-color',colors.darkgrey);}}mapTooltip.attr('display','none');map.on('mousemove',function(e){var features=map.queryRenderedFeatures(e.point);var displayProperties=['type','properties','id','layer','source','sourceLayer','state'];if(features.length==1&&features[0].layer.id=='countries'){var id=features[0].properties.iso;var countryfiltered=data.equity_data.filter(function(d){return d.country_iso2==id;});var countryName;if(countryfiltered[0])countryName=countryfiltered[0].country_name;mapTooltip.select('#map_tooltip_name tspan').text(countryName);if(mapTooltip.select('#map_tooltip_name tspan').text().length==0){mapTooltip.attr('display','none');};if(options.map_toggle=='cases'){var country=data.country.filter(function(d){return d[1].country_code==id;})[0];if(!country||country.length==0)return false;mapTooltip.select('#map_tooltip_val tspan').text(addCommas(Math.round(country[1].cumulative_cases_per_100k))+' cases per 100k');}if(options.map_toggle=='deaths'){var country=data.country.filter(function(d){return d[1].country_code==id;})[0];if(!country||country.length==0)return false;mapTooltip.select('#map_tooltip_val tspan').text(addCommas(Math.round(country[1].cumulative_deaths_per_100k))+' deaths per 100k');}if(options.map_toggle=='bi-weekly-change'){var country=data.country.filter(function(d){return d[1].country_code==id;})[0];if(!country||country.length==0)return false;var val=(country[1].percent_change*100).toFixed(1);var str='';if(val>=0){str='% increase';}else{str='% decrease';}mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);}if(options.map_toggle=='percent-fully-vaccinated'){var country=data.vGroup.filter(function(d){return d[1][0].country_code==id;});if(!country||country.length==0)return false;if(!country[0][1])return false;country=country[0][1];var val=parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1);if(isNaN(val)){val='-';}else{val=val+'% fully vaccinated';}mapTooltip.select('#map_tooltip_val tspan').text(val);}if(options.map_toggle=='percent-vaccine-acceptance'){var country=data.vGroup.filter(function(d){return d[1][0].country_code==id;});if(!country||country.length==0)return false;if(!country[0][1])return false;country=country[0][1];var val=parseFloat(country[0].vaccine_acceptance_percent).toFixed(1);if(isNaN(val)){val='-';}else{val=val+'% vaccine acceptance';}mapTooltip.select('#map_tooltip_val tspan').text(val);}var str=mapTooltip.select('#map_tooltip_val tspan').text();if(str.includes('NaN'))mapTooltip.attr('display','none');d3.select('#map_tooltip_bg').attr('width',20);var bbox=d3.select('#map_tooltip_text').node().getBBox();d3.select('#map_tooltip_bg').attr('width',parseFloat(bbox.width)+15);var scale=window.innerWidth/1329;mapTooltip.attr('display','inline').attr('transform','translate('+(e.point.x+20)+','+e.point.y+')scale('+scale+')');var heightOffset=mapTooltip.node().getBBox();if(mapTooltip.select('#map_tooltip_name tspan').text().length==0){mapTooltip.attr('display','none');};// mapTooltip.attr('transform', 'translate('+(project(([d.lng, d.lat])).x+3)+','+(project(([d.lng, d.lat])).y+2-heightOffset.height/2)+')scale('+scale+')');\n}else{mapTooltip.attr('display','none');}});// function render() {\n//     dots\n//       .attr(\"cx\", function(d) {\n//         return project(([d.lng, d.lat])).x;\n//       })\n//       .attr(\"cy\", function(d) {\n//         return project(([d.lng, d.lat])).y;\n//       });\n//   }\n// map.on(\"viewreset\", render);\n// map.on(\"move\", render);\n// map.on(\"moveend\", render);\n// render(); // Call once to render\n// tooltips\n// var mapTooltip = d3.select('#map_tooltip').attr('opacity', 1).attr('transform', 'translate(0,0)').attr('display', 'none');\n// d3.selectAll('.country-map').on('mousemove', function(event, d){\n//     var id = d3.select(this).attr('id').substr(12,2);\n//     var countryfiltered = data.equity_data.filter(d=>d.country_iso2 == id);\n//     var countryName;\n//     if(countryfiltered[0]) countryName = countryfiltered[0].country_name;\n//     mapTooltip.select('#map_tooltip_name tspan').text(countryName);\n//     if(options.map_toggle=='cases'){\n//         var country = data.country.filter(d=>d[1].country_code == id)[0];\n//         if((!country)||(country.length==0)) return false;\n//         mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_cases)+' cases');\n//     }\n//     if(options.map_toggle=='deaths'){\n//         var country = data.country.filter(d=>d[1].country_code == id)[0];\n//         if((!country)||(country.length==0)) return false;\n//         mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_deaths)+' deaths');\n//     }\n//     if(options.map_toggle=='bi-weekly-change'){\n//         var country = data.country.filter(d=>d[1].country_code == id)[0];\n//         if((!country)||(country.length==0)) return false;\n//         var val = ((country[1].percent_change)*100).toFixed(1);\n//         var str = '';\n//         if(val>=0){\n//             str = '% increase';\n//         } else {\n//             str = '% decrease';\n//         }\n//         mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);\n//     }\n//     if(options.map_toggle=='percent-fully-vaccinated'){\n//         var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n//         if((!country)||(country.length==0)) return false;\n//         mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1)+'% fully vaccinated');\n//     }\n//     if(options.map_toggle=='percent-vaccine-acceptance'){\n//         var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n//         if((!country)||(country.length==0)) return false;\n//         mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].vaccine_acceptance_percent).toFixed(1)+'% vaccine acceptance');\n//     }\n//     d3.select('#map_tooltip_bg').attr('width', 0)\n//     var bbox = mapTooltip.node().getBBox();\n//     d3.select('#map_tooltip_bg').attr('width', (parseFloat(bbox.width)+2))\n//     var scale = window.innerWidth/1329;\n//     mapTooltip\n//     .attr('display', 'inline')\n//     .attr('transform', 'translate('+project(([d.lng, d.lat])).x+','+project(([d.lng, d.lat])).y+')scale('+scale+')');\n//     var heightOffset = mapTooltip.node().getBBox();\n//     mapTooltip.attr('transform', 'translate('+(project(([d.lng, d.lat])).x+3)+','+(project(([d.lng, d.lat])).y+2-heightOffset.height/2)+')scale('+scale+')');\n// }).on('mouseout', function(event){\n//     if(event.toElement=='tspan') return false;\n//     mapTooltip.attr('display', 'none');\n// })\nmap.setLayoutProperty('countries','visibility','visible');}// function project(d) {\n//     return map.project(new mapboxgl.LngLat(d[0], d[1]));\n// }\nexport default createMap;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Map.js"],"names":["d3","moment","colors","filter","mapboxgl","addCommas","accessToken","map","dots","maxSize","mapTooltip","createMap","data","options","select","attr","style","on","d","i","setCenter","setZoom","Map","container","center","zoom","setRenderWorldCopies","addControl","NavigationControl","getCanvasContainer","svg","append","document","getElementById","appendChild","node","e","setPaintProperty","duration","delay","updateMap","setLayoutProperty","map_toggle","maxIncrease","max","country","percent_change","maxDecrease","min","Math","ceil","floor","text","round","abs","colorScale","scaleLinear","domain","range","blue","lightgrey","red","fillColorArray","forEach","push","length","darkgrey","maxValue","cumulative_cases_per_100k","cumulative_deaths_per_100k","vGroup","parseFloat","people_fully_vaccinated_per_hundred","clamp","peoplevaccinated","isNaN","country_code","vaccine_acceptance_percent","features","queryRenderedFeatures","point","displayProperties","layer","id","properties","iso","countryfiltered","equity_data","country_iso2","countryName","country_name","val","toFixed","str","includes","bbox","getBBox","width","scale","window","innerWidth","x","y","heightOffset"],"mappings":"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AGtF,UAAU,CAACI,MAAX,CAAkB,yBAAlB,EAA6CsC,IAA7C,GAAoDa,MAApD,EAA4D,CAA/D,CAAiE,CAC7DvD,UAAU,CACTK,IADD,CACM,SADN,CACiB,MADjB,EAEH,EAED;AACH,CA7ED,IA6EO,CACHL,UAAU,CAACK,IAAX,CAAgB,SAAhB,CAA2B,MAA3B,EACH,CACJ,CA7FD,EAgGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEAR,GAAG,CAACkC,iBAAJ,CACI,WADJ,CAEI,YAFJ,CAGI,SAHJ,EAMH,CAED;AACA;AACA;AAEA,cAAe9B,CAAAA,SAAf","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {filter} from './App';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport {addCommas} from './HelperFunctions';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';\n\nlet map;\nlet dots; \nlet maxSize = 15; \nlet mapTooltip;\n\nexport function createMap(data, options, filter) {\n\n    d3.select('#map-refresh').attr('display', 'none').style('cursor', 'pointer')\n    .on('click', function(d,i){\n        map.setCenter([8, 22]);\n        map.setZoom(0);\n        d3.select('#map-refresh').attr('display', 'none');\n    })\n    \n    map = new mapboxgl.Map({\n        container: 'map_div', // container ID\n        // style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww', // style URL\n        style: 'mapbox://styles/go-ifrc/ckqrsg27f1cwu17pex8w2de2e', // style URL\n        center: [8, 22], // starting position [lng, lat]\n        zoom: 0 // starting zoom\n    });\n\n    map.setRenderWorldCopies(false);\n    map.addControl(new mapboxgl.NavigationControl());\n    \n    map.on('zoom', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('touchmove', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('wheel', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('drag', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    var container = map.getCanvasContainer();\n\n    var svg = d3\n    .select(container)\n    .append(\"svg\")\n    .attr('id', 'mapoverlay')\n    .attr(\"width\", \"100%\")\n    .attr(\"height\", \"24vw\")\n    .style(\"position\", \"absolute\")\n    .style(\"z-index\", 2);\n\n    mapTooltip = d3.select('#map_tooltip').attr('opacity', 1).attr('transform', 'translate(0,0)').attr('display', 'inline');\n\n    // dots = svg\n    // .selectAll(\".country-map\")\n    // .data(data.world)\n    // .enter()\n    // .append(\"circle\")\n    // .attr('class', 'country-map')\n    // .attr('id', function(d,i){ return 'country-map-'+d.iso2 })\n    // .attr(\"r\", 0)\n    \n\n    // var maxValue = d3.max(data.country, function(d,i){\n    //     return d[1].cumulative_cases;\n    // })\n\n    // var rScale = d3.scalePow().exponent(0.5)\n    //   .domain([0, maxValue])\n    //   .range([0, 15]);\n\n    // data.country.forEach(function(d,i){\n    //     d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases))\n    //     .attr('data-name', d[1].country)\n    // })\n    \n    d3.select(\"#map_div\").append('svg')\n    .attr('width', '18vw')\n    .attr('height', '1.5vw')\n    .attr('id', 'maplegend')\n    .attr('viewBox', '0 0 227 18')\n\n    document.getElementById(\"maplegend\").appendChild(d3.select('#red_legend').node());\n    document.getElementById(\"maplegend\").appendChild(d3.select('#blue_legend').node());\n    document.getElementById(\"maplegend\").appendChild(d3.select('#bi_legend').node());\n\n    d3.select('#red_legend').attr('transform', 'translate(20,0)');\n    d3.select('#blue_legend').attr('transform', 'translate(20,0)');\n    d3.select('#bi_legend').attr('transform', 'translate(0,0)');\n\n    d3.select('#bi_legend').attr('display', 'none');\n    d3.select('#blue_legend').attr('display', 'none');\n\n    document.getElementById(\"mapoverlay\").appendChild(d3.select('#map_tooltip').node());\n    mapTooltip.attr('display', 'none')  \n\n    map.on('load', function (e) {\n\n        map.setPaintProperty('countries', 'fill-opacity-transition', {duration: 0, delay: 0});\n\n        updateMap(data, options) ;\n\n    });\n\n}\n\nexport function updateMap(data, options) {\n   \n    var duration = 800;\n    var delay = 10;\n\n    map.setLayoutProperty(\n        'countries',\n        'visibility',\n        'none'\n    );\n\n    if(options.map_toggle == 'bi-weekly-change'){\n        \n        var maxIncrease = d3.max(data.country, function(d,i){\n            return d[1].percent_change;\n        })\n\n        var maxDecrease = d3.min(data.country, function(d,i){\n            return d[1].percent_change;\n        })\n\n        d3.select('#bi_legend').attr('display', 'inline');\n        d3.select('#blue_legend').attr('display', 'none');\n        d3.select('#red_legend').attr('display', 'none');\n\n        maxIncrease = (Math.ceil(maxIncrease/0.1))*0.1;\n        maxDecrease = (Math.floor(maxDecrease/0.1))*0.1;\n\n        if(maxIncrease>1) maxIncrease = 1;\n        if(maxDecrease<-1) maxDecrease = -1;\n\n        d3.select('#bi_legend_dec_val').attr('text-anchor', 'end');\n        if(maxIncrease<1){\n            d3.select('#bi_legend_inc_val tspan').text(Math.round(maxIncrease*100)+'%');\n        } else {\n            d3.select('#bi_legend_inc_val tspan').text(Math.round(maxIncrease*100)+'% +');\n        }\n        if(maxDecrease>-1){\n            d3.select('#bi_legend_dec_val tspan').text(Math.round(Math.abs(maxDecrease)*100)+'%').attr('dx', 14);\n        } else {\n            d3.select('#bi_legend_dec_val tspan').text(Math.round(Math.abs(maxDecrease)*100)+'% +').attr('dx', 14);\n        }\n\n        // var rScale = d3.scalePow().exponent(0.5)\n        // .domain([-1, 0, 1])\n        // .range([maxSize, 0, maxSize])\n        // .clamp(true);\n\n        // d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        // data.country.forEach(function(d,i){\n        //     d3.select('#country-map-'+d[0])\n        //     .transition('c').duration(duration).delay(delay)\n        //     .attr('r', rScale(d[1].percent_change))\n        //     .style('stroke', function(){\n        //         // if(d[1].percent_change>1){ return '#E02225'} else { return '#1F558C'}\n        //         return '#FFF'\n        //     }).style('fill', function(){\n        //         if(d[1].percent_change>0){ return colors.red } else { return colors.blue}\n        //     })\n        // })\n\n        var colorScale = d3.scaleLinear()\n        // .domain([-1, 0, 1])\n        .domain([maxDecrease, 0, maxIncrease])\n        .range([colors.blue, colors.lightgrey, colors.red])\n        // .clamp(true);\n\n        var fillColorArray = ['case']\n        data.country.forEach(function(d,i){\n            fillColorArray.push(['==', ['get', \"iso\"], d[0]]);\n            fillColorArray.push(colorScale(d[1].percent_change));\n        });\n\n        if(fillColorArray.length>1){\n            fillColorArray.push(colors.darkgrey)\n            map.setPaintProperty(\n                'countries', \n                'fill-color', fillColorArray\n            );\n        }\n        \n    }\n\n    if(options.map_toggle == 'cases'){\n\n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].cumulative_cases_per_100k;\n        });\n\n        d3.select('#bi_legend').attr('display', 'none');\n        d3.select('#blue_legend').attr('display', 'none');\n        d3.select('#red_legend').attr('display', 'inline');\n\n        d3.select('#red_legend_title tspan').text('Cases per 100k');\n\n        if(maxValue>1000){\n            maxValue = (Math.ceil(maxValue/100))*100;\n        } else {\n            maxValue = (Math.ceil(maxValue/10))*10;\n        }\n\n        d3.select('#red_legend_val tspan').text(addCommas(maxValue));\n\n        // var rScale = d3.scalePow().exponent(0.5)\n        // .domain([0, maxValue])\n        // .range([0, maxSize]);\n\n        // d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        // data.country.forEach(function(d,i){\n        //     d3.select('#country-map-'+d[0])\n        //     .transition('c').duration(duration).delay(delay)\n        //     .attr('r', rScale(d[1].cumulative_cases))\n        //     .style('fill', colors.red)\n        //     .style('stroke', '#FFF');\n        // })\n\n        var colorScale = d3.scaleLinear()\n        .domain([0, maxValue])\n        .range([colors.lightgrey, colors.red]);\n\n        var fillColorArray = ['case']\n        data.country.forEach(function(d,i){\n            fillColorArray.push(['==', ['get', \"iso\"], d[0]]);\n            fillColorArray.push(colorScale(d[1].cumulative_cases_per_100k));\n        });\n\n        if(fillColorArray.length>1){\n            fillColorArray.push(colors.darkgrey)\n            map.setPaintProperty(\n                'countries', \n                'fill-color', fillColorArray\n            );\n        }\n\n    }\n    \n    if(options.map_toggle == 'deaths'){\n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].cumulative_deaths_per_100k;\n        })\n\n        d3.select('#bi_legend').attr('display', 'none');\n        d3.select('#blue_legend').attr('display', 'none');\n        d3.select('#red_legend').attr('display', 'inline');\n\n        d3.select('#red_legend_title tspan').text('Deaths per 100k');\n\n        if(maxValue>1000){\n            maxValue = (Math.ceil(maxValue/100))*100;\n        } else {\n            maxValue = (Math.ceil(maxValue/10))*10;\n        }\n\n        d3.select('#red_legend_val tspan').text(addCommas(maxValue));\n\n        // var rScale = d3.scalePow().exponent(0.5)\n        // .domain([0, maxValue])\n        // .range([0, maxSize]);\n\n        // d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        // data.country.forEach(function(d,i){\n        //     d3.select('#country-map-'+d[0])\n        //     .transition('c').duration(duration).delay(delay)\n        //     .attr('r', rScale(d[1].cumulative_deaths))\n        //     .style('fill', colors.red)\n        //     .style('stroke', '#FFF');\n        // })\n\n        var colorScale = d3.scaleLinear()\n        .domain([0, maxValue])\n        .range([colors.lightgrey, colors.red]);\n\n        var fillColorArray = ['case']\n        data.country.forEach(function(d,i){\n            fillColorArray.push(['==', ['get', \"iso\"], d[0]]);\n            fillColorArray.push(colorScale(d[1].cumulative_deaths_per_100k));\n        });\n\n        if(fillColorArray.length>1){\n            fillColorArray.push(colors.darkgrey)\n            map.setPaintProperty(\n                'countries', \n                'fill-color', fillColorArray\n            );\n        }\n    }\n\n    if(options.map_toggle == 'percent-fully-vaccinated'){\n        var maxValue = d3.max(data.vGroup, function(d,i){\n            return parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n        })\n\n        d3.select('#bi_legend').attr('display', 'none');\n        d3.select('#blue_legend').attr('display', 'inline');\n        d3.select('#red_legend').attr('display', 'none');\n\n        d3.select('#blue_legend_title tspan').text('Percent fully vaccinated');\n\n        // if(maxValue>1000){\n        //     maxValue = (Math.round(maxValue/100))*100;\n        // } else {\n        //     maxValue = (Math.round(maxValue/10))*10;\n        // }\n\n        d3.select('#blue_legend_val tspan').text('100%');\n\n        // var rScale = d3.scalePow().exponent(0.55)\n        // .domain([0, 1])\n        // .range([1, maxSize])\n        // .clamp(true);\n\n        // d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        // data.vGroup.forEach(function(d,i){\n        //     var peoplevaccinated = parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n        //     if(isNaN(peoplevaccinated)) peoplevaccinated = 0;\n        //     d3.select('#country-map-'+d[1][0].country_code)\n        //     .transition('c').duration(duration).delay(delay)\n        //     .attr('r', rScale(peoplevaccinated))\n        //     .style('stroke', '#FFF')\n        //     .style('fill', function(){\n        //         return colors.blue;\n        //     })\n        // })\n\n        var colorScale = d3.scaleLinear()\n        .domain([0, 1])\n        .range([colors.lightgrey, colors.blue])\n        .clamp(true);\n\n        var fillColorArray = ['case']\n        data.vGroup.forEach(function(d,i){\n            var peoplevaccinated = parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n            if(isNaN(peoplevaccinated)) peoplevaccinated = 0;\n            if(peoplevaccinated>0){\n                if(d[1][0].country_code) fillColorArray.push(['==', ['get', \"iso\"], d[1][0].country_code]);\n                if(d[1][0].country_code) fillColorArray.push(colorScale(peoplevaccinated));\n            }\n        });\n\n        if(fillColorArray.length>1){\n            fillColorArray.push(colors.darkgrey)\n            map.setPaintProperty(\n                'countries', \n                'fill-color', fillColorArray\n            );\n        } else {\n            map.setPaintProperty(\n                'countries', \n                'fill-color',\n                colors.darkgrey\n            );\n        }\n        \n    }\n\n    if(options.map_toggle == 'percent-vaccine-acceptance'){\n        var maxValue = d3.max(data.vGroup, function(d,i){\n            return parseFloat(d[1][0].vaccine_acceptance_percent)/100;\n        })\n\n        d3.select('#bi_legend').attr('display', 'none');\n        d3.select('#blue_legend').attr('display', 'inline');\n        d3.select('#red_legend').attr('display', 'none');\n\n        d3.select('#blue_legend_title tspan').text('Percent vaccine acceptance');\n\n        // if(maxValue>1000){\n        //     maxValue = (Math.round(maxValue/100))*100;\n        // } else {\n        //     maxValue = (Math.round(maxValue/10))*10;\n        // }\n\n        d3.select('#blue_legend_val tspan').text('100%');\n        \n        // var rScale = d3.scalePow().exponent(1)\n        // .domain([0, 1])\n        // .range([1, maxSize*.7])\n        // // .clamp(true);\n\n        // d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        // data.vGroup.forEach(function(d,i){\n        //     var vaccine_acceptance_percent = parseFloat(d[1][0].vaccine_acceptance_percent/100);\n            \n        //     if(isNaN(vaccine_acceptance_percent)) vaccine_acceptance_percent = 0;\n\n        //     d3.select('#country-map-'+d[1][0].country_code)\n        //     .transition('c').duration(duration).delay(delay)\n        //     .attr('r', rScale(vaccine_acceptance_percent))\n        //     .style('stroke', '#FFF')\n        //     .style('fill', function(){\n        //         return colors.blue;\n        //     })\n        // })\n\n        var colorScale = d3.scaleLinear()\n        .domain([0, 1])\n        .range([colors.lightgrey, colors.blue])\n        .clamp(true);\n\n        var fillColorArray = ['case']\n        data.vGroup.forEach(function(d,i){\n            var vaccine_acceptance_percent = parseFloat(d[1][0].vaccine_acceptance_percent)/100;\n            if(isNaN(vaccine_acceptance_percent)) vaccine_acceptance_percent = 0;\n            if(vaccine_acceptance_percent>0){\n                if(d[1][0].country_code) fillColorArray.push(['==', ['get', \"iso\"], d[1][0].country_code]);\n                if(d[1][0].country_code) fillColorArray.push(colorScale(vaccine_acceptance_percent));\n            }\n        });\n\n        if(fillColorArray.length>1){\n            fillColorArray.push(colors.darkgrey)\n            map.setPaintProperty(\n                'countries', \n                'fill-color', fillColorArray\n            );\n        } else {\n            map.setPaintProperty(\n                'countries', \n                'fill-color',\n                colors.darkgrey\n            );\n        }\n\n\n    }\n\n    mapTooltip.attr('display', 'none')  \n\n    map.on('mousemove', function (e) {\n        var features = map.queryRenderedFeatures(e.point);\n         \n        var displayProperties = [\n        'type',\n        'properties',\n        'id',\n        'layer',\n        'source',\n        'sourceLayer',\n        'state'\n        ];\n         \n        if((features.length==1)&&(features[0].layer.id=='countries')){\n\n            var id = features[0].properties.iso;\n            var countryfiltered = data.equity_data.filter(d=>d.country_iso2 == id);\n            var countryName;\n            if(countryfiltered[0]) countryName = countryfiltered[0].country_name;\n    \n            mapTooltip.select('#map_tooltip_name tspan').text(countryName);\n  \n            if(mapTooltip.select('#map_tooltip_name tspan').text().length==0){\n                mapTooltip\n                .attr('display', 'none');\n            };\n            \n            if(options.map_toggle=='cases'){\n                var country = data.country.filter(d=>d[1].country_code == id)[0];\n                if((!country)||(country.length==0)) return false;\n                mapTooltip.select('#map_tooltip_val tspan').text(addCommas(Math.round(country[1].cumulative_cases_per_100k))+' cases per 100k');\n            }\n    \n            if(options.map_toggle=='deaths'){\n                var country = data.country.filter(d=>d[1].country_code == id)[0];\n                if((!country)||(country.length==0)) return false;\n                mapTooltip.select('#map_tooltip_val tspan').text(addCommas(Math.round(country[1].cumulative_deaths_per_100k))+' deaths per 100k');\n            }\n    \n            if(options.map_toggle=='bi-weekly-change'){\n                var country = data.country.filter(d=>d[1].country_code == id)[0];\n                if((!country)||(country.length==0)) return false;\n                var val = ((country[1].percent_change)*100).toFixed(1);\n                var str = '';\n                if(val>=0){\n                    str = '% increase';\n                } else {\n                    str = '% decrease';\n                }\n                mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);\n            }\n    \n            if(options.map_toggle=='percent-fully-vaccinated'){\n                var country = data.vGroup.filter(d=>d[1][0].country_code == id);\n                if((!country)||(country.length==0)) return false;\n                if((!country[0][1])) return false;\n                country = country[0][1];\n                var val = parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1)\n                if(isNaN(val)){ val = '-' } else { val = val + '% fully vaccinated'}\n                mapTooltip.select('#map_tooltip_val tspan').text(val);\n            }\n    \n            if(options.map_toggle=='percent-vaccine-acceptance'){\n                var country = data.vGroup.filter(d=>d[1][0].country_code == id);\n                if((!country)||(country.length==0)) return false;\n                if((!country[0][1])) return false;\n                country = country[0][1];\n                var val = parseFloat(country[0].vaccine_acceptance_percent).toFixed(1)\n                if(isNaN(val)){ val = '-' } else { val = val + '% vaccine acceptance'}\n                mapTooltip.select('#map_tooltip_val tspan').text(val);\n            }\n    \n            var str = mapTooltip.select('#map_tooltip_val tspan').text();\n            if(str.includes('NaN')) mapTooltip.attr('display', 'none')\n\n            d3.select('#map_tooltip_bg').attr('width', 20)\n            var bbox = d3.select('#map_tooltip_text').node().getBBox();\n            d3.select('#map_tooltip_bg').attr('width', (parseFloat(bbox.width)+15))\n            var scale = window.innerWidth/1329;\n            mapTooltip\n            .attr('display', 'inline')\n            .attr('transform', 'translate('+(e.point.x+20)+','+e.point.y+')scale('+scale+')');\n            var heightOffset = mapTooltip.node().getBBox();\n\n            if(mapTooltip.select('#map_tooltip_name tspan').text().length==0){\n                mapTooltip\n                .attr('display', 'none');\n            };\n\n            // mapTooltip.attr('transform', 'translate('+(project(([d.lng, d.lat])).x+3)+','+(project(([d.lng, d.lat])).y+2-heightOffset.height/2)+')scale('+scale+')');\n        } else {\n            mapTooltip.attr('display', 'none')\n        }\n    })\n\n\n    // function render() {\n    //     dots\n    //       .attr(\"cx\", function(d) {\n    //         return project(([d.lng, d.lat])).x;\n    //       })\n    //       .attr(\"cy\", function(d) {\n    //         return project(([d.lng, d.lat])).y;\n    //       });\n    //   }\n\n    // map.on(\"viewreset\", render);\n    // map.on(\"move\", render);\n    // map.on(\"moveend\", render);\n    // render(); // Call once to render\n\n    // tooltips\n\n    // var mapTooltip = d3.select('#map_tooltip').attr('opacity', 1).attr('transform', 'translate(0,0)').attr('display', 'none');\n\n    // d3.selectAll('.country-map').on('mousemove', function(event, d){\n\n    //     var id = d3.select(this).attr('id').substr(12,2);\n    //     var countryfiltered = data.equity_data.filter(d=>d.country_iso2 == id);\n    //     var countryName;\n    //     if(countryfiltered[0]) countryName = countryfiltered[0].country_name;\n\n    //     mapTooltip.select('#map_tooltip_name tspan').text(countryName);\n\n    //     if(options.map_toggle=='cases'){\n    //         var country = data.country.filter(d=>d[1].country_code == id)[0];\n    //         if((!country)||(country.length==0)) return false;\n    //         mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_cases)+' cases');\n    //     }\n\n    //     if(options.map_toggle=='deaths'){\n    //         var country = data.country.filter(d=>d[1].country_code == id)[0];\n    //         if((!country)||(country.length==0)) return false;\n    //         mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_deaths)+' deaths');\n    //     }\n\n    //     if(options.map_toggle=='bi-weekly-change'){\n    //         var country = data.country.filter(d=>d[1].country_code == id)[0];\n    //         if((!country)||(country.length==0)) return false;\n    //         var val = ((country[1].percent_change)*100).toFixed(1);\n    //         var str = '';\n    //         if(val>=0){\n    //             str = '% increase';\n    //         } else {\n    //             str = '% decrease';\n    //         }\n    //         mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);\n    //     }\n\n    //     if(options.map_toggle=='percent-fully-vaccinated'){\n    //         var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n    //         if((!country)||(country.length==0)) return false;\n    //         mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1)+'% fully vaccinated');\n    //     }\n\n    //     if(options.map_toggle=='percent-vaccine-acceptance'){\n    //         var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n    //         if((!country)||(country.length==0)) return false;\n    //         mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].vaccine_acceptance_percent).toFixed(1)+'% vaccine acceptance');\n    //     }\n\n\n    //     d3.select('#map_tooltip_bg').attr('width', 0)\n\n    //     var bbox = mapTooltip.node().getBBox();\n    //     d3.select('#map_tooltip_bg').attr('width', (parseFloat(bbox.width)+2))\n    //     var scale = window.innerWidth/1329;\n    //     mapTooltip\n    //     .attr('display', 'inline')\n    //     .attr('transform', 'translate('+project(([d.lng, d.lat])).x+','+project(([d.lng, d.lat])).y+')scale('+scale+')');\n\n    //     var heightOffset = mapTooltip.node().getBBox();\n    //     mapTooltip.attr('transform', 'translate('+(project(([d.lng, d.lat])).x+3)+','+(project(([d.lng, d.lat])).y+2-heightOffset.height/2)+')scale('+scale+')');\n\n    // }).on('mouseout', function(event){\n    //     if(event.toElement=='tspan') return false;\n    //     mapTooltip.attr('display', 'none');\n    // })\n\n    map.setLayoutProperty(\n        'countries',\n        'visibility',\n        'visible'\n    );\n\n}\n\n// function project(d) {\n//     return map.project(new mapboxgl.LngLat(d[0], d[1]));\n// }\n\nexport default createMap;\n"]},"metadata":{},"sourceType":"module"}