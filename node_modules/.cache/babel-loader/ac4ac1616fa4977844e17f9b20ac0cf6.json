{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{nFormatter}from'./HelperFunctions';import{selection,textwrap}from'd3-textwrap';import clone from'just-clone';var yScaleCases;var yScaleDeaths;var yScaleVaccines;var yAxisCases;var yAxisDeaths;var yAxisVaccines;var yScaleCasesAxis;var yScaleDeathsAxis;var yScaleVaccinesAxis;var xScale;var xAxis;var xScaleAxis;var xScaleEvents;var maxDate;var minDate;var md;var regions=['AF','ME','AP','EU','AM','OTH'];export function drawTimechart(data,options){minDate=options.minDate;maxDate=options.maxDate;var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});var vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\ndata.vaccines_data=data.vaccines_data_daily;data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\ndata.vaccines_data=[];if(options.timeline_frequency==='day'){data.vaccines_data=clone(data.vaccines_data_cumulative);}if(options.timeline_frequency==='week'){data.vaccines_data_cumulative.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||date==moment(options.maxVDate).startOf('day').unix()){data.vaccines_data.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(options.maxVDate).startOf('day').unix();data.vaccines_data_cumulative.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate&&date==maxDateUnix){data.vaccines_data.push(d);}});}data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});// define date range\n// const minDate = groupedData[0].date;\n// const maxDate = groupedData[numIntervals].date;\n// const minDate = groupedData[0].date;\n// if(options.timeline_frequency==='month') md = md.add(1, 'months');\n// if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\nif(options.timeline_frequency==='month')minDate=moment(minDate).startOf('month').startOf('day').toDate();if(options.timeline_frequency==='month')maxDate=moment(maxDate).endOf('month').startOf('day').toDate();if(options.timeline_frequency==='week')maxDate=moment(maxDate).endOf('isoWeek').startOf('day').toDate();md=moment(maxDate);if(options.timeline_frequency==='day')md=new Date(moment(maxDate).add(1,'days').toDate());var svg=d3.select('#timechart_svg');svg.selectAll('g').remove();d3.selectAll('#layout .yAxis').remove();d3.selectAll('#yAxis').remove();d3.selectAll('#layout .xAxis').remove();//bg\nsvg.append('g').append('rect').attr('width',2000).attr('height','100%').attr('x',0).attr('y',0).attr('fill','#FFF').attr('opacity',0);var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\nxScale=d3.scaleTime().range([0,width]).domain([minDate,md]);xScaleAxis=d3.scaleTime().range([0,596]).domain([minDate,md]);yScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nxAxis=d3.axisBottom().scale(xScaleAxis).tickSize(2).tickPadding(3);// if(options.timeline_frequency=='month')\n// xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n// if(options.timeline_frequency=='week')\n// xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisGroup=d3.select('#layout').append(\"g\").attr('id','yAxis').attr('clip-path','url(#mask)');var yAxisCasesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"casesAxis\").attr('transform','translate(620,363)').call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"deathsAxis\").attr('transform','translate(620,534)').call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"VaccinesAxis\").attr('transform','translate(620,707.5)').call(yAxisVaccines);// x-axis cases\nvar xAxisCases=yAxisGroup.append('g').attr(\"id\",\"casesXAxis\").attr('class','xAxis').attr('transform','translate(24,504)').call(xAxis);var xAxisDeaths=yAxisGroup.append('g').attr(\"id\",\"deathsXAxis\").attr('class','xAxis').attr('transform','translate(24,674)').call(xAxis);var xAxisVaccines=yAxisGroup.append('g').attr(\"id\",\"vaccinesXAxis\").attr('class','xAxis').attr('transform','translate(24,848)').call(xAxis);var xAxisTimeline=yAxisGroup.append('g').attr(\"id\",\"timelineXAxis\").attr('class','xAxis').attr('transform','translate(24,908)').call(xAxis);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).enter().append('g').attr('class','bar_group').attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar cases_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar deaths_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).enter().append('g').attr('class','vbar_group').attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class','timeBar vaccines_bar').attr('class',function(d,i){return'timeBar vaccines_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});if(options.timeline_frequency==='month'){vbarGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}data.vgroupedData=vgroupedData;data.groupedData=groupedData;// tooltips\n// events calendar timeline\nvar tData=data.timeline_data;xScaleEvents=d3.scaleTime().range([25,619]).domain([minDate,md]);// bring to front\ndocument.getElementById(\"svg\").appendChild(d3.select('#timeline_tooltip').node());document.getElementById(\"svg\").appendChild(d3.select('#event_tooltip').node());var timelineTooltip=d3.select('#timeline_tooltip').attr('opacity',0);var eventTooltip=d3.select('#event_tooltip').attr('opacity',0);// hover bar\nvar hoverBar=svg.append('rect').attr('id','timechart_hover').attr('width',barWidth).attr('x',0).attr('y',0).attr('opacity',0).attr('height','100%').attr('fill','rgb(221 221 221 / 40%)');d3.select('#timechart_svg').on('mouseover',function(event){var coords=d3.pointer(event);hoverBar.attr('opacity',1);var xDate=xScale.invert(coords[0]);if(options.timeline_frequency=='week'){xDate=moment(xDate).startOf('isoWeek');}if(options.timeline_frequency=='day'){xDate=moment(xDate).startOf('day');}if(options.timeline_frequency=='month'){xDate=moment(xDate).startOf('month');}if(coords[1]<470){timelineTooltip.attr('opacity',1).attr('display','inline');hoverBar.attr('height','100%');}else if(coords[1]>510){eventTooltip.attr('opacity',1);hoverBar.attr('height','90%');}else{eventTooltip.attr('opacity',0);timelineTooltip.attr('opacity',0);hoverBar.attr('height','100%');}if(xDate.toDate().getTime()<minDate.getTime()){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);}d3.select('#svg_container').style('z-index',10);}).on('mouseout',function(event){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0).attr('display','none');// timelineTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\nd3.select('#svg_container').style('z-index',1);eventTooltip.attr('opacity',0).attr('transform','translate(0,0)');d3.selectAll('.event_marker path').style('stroke','grey').attr('opacity',0.8);}).on('mousemove',function(event){var coords=d3.pointer(event);var xDate=xScale.invert(coords[0]);var tooltipStr='';if(options.timeline_frequency=='week'){xDate=moment(xDate).startOf('isoWeek');tooltipStr=xDate.format('ll');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}if(options.timeline_frequency=='day'){xDate=moment(xDate).startOf('day');tooltipStr=xDate.format('ll');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}if(options.timeline_frequency=='month'){xDate=moment(xDate).startOf('month');tooltipStr=xDate.format('MMMM YYYY');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}hoverBar.attr('x',xScale(xDate.toDate()));var groupedDataFiltered=data.groupedData.filter(function(d,i){return moment(d.date).startOf('day').unix()==xDate.startOf('day').unix();});var vgroupedDataFiltered=data.vgroupedData.filter(function(d,i){return moment(d.date).startOf('day').unix()==xDate.startOf('day').unix();});var deaths='-';var cases='-';var vaccines='-';if(options.timeline_type=='cumulative'){// cumulative\nif(groupedDataFiltered[0])cases=nFormatter(groupedDataFiltered[0].total_cumulative_cases,2);if(groupedDataFiltered[0])deaths=nFormatter(groupedDataFiltered[0].total_cumulative_deaths,2);if(vgroupedDataFiltered[0])vaccines=nFormatter(vgroupedDataFiltered[0].total_cumulative_vaccines,2);}else{// non-cumulative/stacked\nif(groupedDataFiltered[0])cases=nFormatter(groupedDataFiltered[0].total_new_cases,2);if(groupedDataFiltered[0])deaths=nFormatter(groupedDataFiltered[0].total_new_deaths,2);if(vgroupedDataFiltered[0])vaccines=nFormatter(vgroupedDataFiltered[0].total_new_vaccines,2);}d3.select('#tooltip_cases tspan').text(cases).attr(\"text-anchor\",\"end\").attr('dx',32);d3.select('#tooltip_deaths tspan').text(deaths).attr(\"text-anchor\",\"end\").attr('dx',32);d3.select('#tooltip_vaccines tspan').text(vaccines).attr(\"text-anchor\",\"end\").attr('dx',32);// if((xDate.toDate().getTime()>options.maxDate.getTime())){\n//     hoverBar.attr('opacity', 0);\n// // } else \nif(xDate.toDate().getTime()<minDate.getTime()&&options.timeline_frequency=='day'){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);}if(options.timeline_frequency=='month'){hoverBar.attr('width',function(){return xScale(moment(xDate).endOf('month'))-xScale(moment(xDate).startOf('month'));});}timelineTooltip.attr('transform',function(){var bw=barWidth;var ratio=(options.brushR-options.brushL)/600;var offset=0;if(ratio<0.5)offset=3;if(ratio<0.3)offset=12;if(ratio<0.2)offset=20;if(ratio<0.15)offset=21;if(options.timeline_frequency=='month'){if(ratio<0.6)offset=20;if(ratio<0.5)offset=30;if(ratio<0.3)offset=50;if(ratio<0.2)offset=60;if(ratio<0.1)offset=70;return'translate('+(xScaleEvents(xDate.toDate())+barWidth/3+offset)+','+(coords[1]+353)+')';}return'translate('+(xScaleEvents(xDate.toDate())+18+offset)+','+(coords[1]+353)+')';});if(coords[1]<470){timelineTooltip.attr('opacity',1);hoverBar.attr('opacity',1);hoverBar.attr('height','100%');}else if(coords[1]>510){eventTooltip.attr('opacity',1);hoverBar.attr('height','90%');var x=moment(xScale.invert(coords[0])).startOf('day');var xx=xScale.invert(coords[0]);eventTooltip.attr('transform',function(){return'translate('+(xScaleEvents(x.toDate())+-3)+','+817+')';});var events=tData.filter(function(d,i){return moment(d.date).startOf('day').unix()==x.unix();});// select nearest neighbor for ux purposes \nif(events.length==0){events=tData.filter(function(d,i){return moment(d.date).startOf('day').unix()<=moment(x).add(1,'days').unix()&&moment(d.date).startOf('day').unix()>=moment(x).subtract(1,'days').unix();});}if(events.length>0){d3.select('#event-'+moment(events[0].date).startOf('day').unix()).select('path').style('stroke','#000').attr('opacity',1);tooltipStr=moment(events[0].date).startOf('day').format('ll');d3.select('#event_tooltip_date tspan').text(tooltipStr);var wrap=textwrap().bounds({height:200,width:230}).method('tspans');var event=d3.select('#event_tooltip_text').text(events[0].description).attr('y',18).attr('x',6);d3.select('#event_tooltip_text').call(wrap);d3.selectAll('#event_tooltip_text tspan').attr('dy','1.3em');var bbox=d3.select('#event_tooltip_text').node().getBBox();d3.select('#event_tooltip_rect').attr('width',bbox.width+17).attr('height',bbox.height+26);var h=d3.select('#event_tooltip_rect').attr('height');var ys=0;if(bbox.height<20){ys=19;}else if(bbox.height<30){ys=9;}else if(bbox.height<40){ys=0;}else if(bbox.height<50){ys=-20;}else if(bbox.height<60){ys=-20;}var y=d3.select('#event_tooltip_rect').attr('y');d3.select('#event_tooltip_rect').attr('y',ys);d3.selectAll('#event_tooltip_text').attr('y',function(d,i){return parseInt(d3.select(this).attr('y'))+ys;});d3.selectAll('#event_tooltip_date tspan').attr('dy',function(d,i){return ys;});eventTooltip.attr('opacity',1);}else{d3.selectAll('.event_marker path').style('stroke','grey').attr('opacity',0.8);eventTooltip.attr('opacity',0);}}else{eventTooltip.attr('opacity',0);timelineTooltip.attr('opacity',0);hoverBar.attr('opacity',0);hoverBar.attr('height','100%');}if(options.timeline_frequency=='day'&&xDate.toDate().getTime()<minDate.getTime()){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);return false;}});tData=tData.filter(function(d){return d.date.length>0;});yAxisGroup.append('g').selectAll('.event_marker').data(tData).enter().append('g').attr('class','event_marker').attr('id',function(d,i){return'event-'+moment(d.date).startOf('day').unix();}).attr('transform',function(d){var x=xScaleEvents(new Date(d.date));return'translate('+x+', 893)';}).append('path').attr('d',\"M0,-6L4,0 0,6 -4,0Z\").style('stroke','grey').attr('opacity',0.8).style('stroke-width',3.5).style('fill','white');// create brush zoom\n// reset\n// options.brushL = 0;\n// options.brushR = 600;\nvar brush=d3.brushX().extent([[0,0],[600,40]]).on(\"start brush end\",brushed);d3.select('.brush').remove();;var gBrush=d3.select('#zoombar').append(\"g\").attr(\"class\",\"brush\").attr('opacity',0.1).call(brush);d3.selectAll('.handle rect').attr('fill-opacity','1').style('visibility','visible').attr('width',2).attr('fill','#000').style('stroke-opacity',0);var brushScale=d3.scaleLinear().domain([-3,597]).range([0,2000]);gBrush.call(brush.move,[options.brushL,options.brushR]);function brushed(){var x=parseFloat(d3.select('.handle--w').attr('x'));var x2=parseFloat(d3.select('.handle--e').attr('x'));if(x2-x<40)return false;var w=d3.select('.selection').attr('width');d3.select('#zoomL').attr('transform','translate('+x+',0)');d3.select('#zoomR').attr('transform','translate('+x2+',0)');d3.select('#zoomOverlay').attr('width',x2-x);d3.select('#zoomOverlay').attr('x',x);d3.select('#zoomOverlay').attr('transform','translate(3,0)');var viewBoxW=Math.round(brushScale(x2)-brushScale(x));var viewBoxX=Math.round(brushScale(x));options.brushL=x+3;options.brushR=x2+3;xScaleAxis=d3.scaleTime().range([0,596]).domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);xScaleEvents=d3.scaleTime().range([25,619])// .domain([minDate,md]);\n.domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);d3.selectAll('.event_marker').attr('transform',function(d){var x=xScaleEvents(new Date(d.date));return'translate('+x+', 893)';});xAxis=d3.axisBottom().ticks(5).scale(xScaleAxis);xAxisCases.call(xAxis);xAxisDeaths.call(xAxis);xAxisVaccines.call(xAxis);xAxisTimeline.call(xAxis);d3.select('#timechart_svg').attr('viewBox',viewBoxX+' 0 '+viewBoxW+' 553');}}export function updateTimechart(data,options){var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});var vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\ndata.vaccines_data=data.vaccines_data_daily;data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\ndata.vaccines_data=[];if(options.timeline_frequency==='day'){data.vaccines_data=clone(data.vaccines_data_cumulative);}if(options.timeline_frequency==='week'){data.vaccines_data_cumulative.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||date==moment(options.maxVDate).startOf('day').unix()){data.vaccines_data.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(options.maxVDate).startOf('day').unix();data.vaccines_data_cumulative.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate&&date==maxDateUnix){data.vaccines_data.push(d);}});}data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});var svg=d3.select('#timechart_svg');var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\n// xScale = d3.scaleTime()\n// .range([0,width])\n// .domain([minDate,md]);\n// xScaleAxis = d3.scaleTime()\n// .range([23,596])\n// .domain([minDate,md]);\nyScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisCasesText=d3.select('#casesAxis').transition().duration(500).call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=d3.select('#deathsAxis').transition().duration(500).call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=d3.select('#VaccinesAxis').transition().duration(500).call(yAxisVaccines);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];return'blue';});// // DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(groupedData.length==0){d3.selectAll('.cases_bar').transition().duration(500).attr('y',140).attr('height',0);d3.selectAll('.deaths_bar').transition().duration(500).attr('y',140+170).attr('height',0);}// // VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(vgroupedData.length==0){d3.selectAll('.vaccines_bar').transition().duration(500).attr('y',140).attr('height',0);}// // bar size tweak for spacing\n// if(options.timeline_frequency==='month'){\n//     barGroups.selectAll(\".timeBar\")\n//     .attr(\"width\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(1-barSpacing);\n//       })\n//     .attr(\"x\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(barSpacing/2);\n//       })\n//     }\ndata.vgroupedData=vgroupedData;data.groupedData=groupedData;}export default drawTimechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Timechart.js"],"names":["d3","moment","colors","nFormatter","selection","textwrap","clone","yScaleCases","yScaleDeaths","yScaleVaccines","yAxisCases","yAxisDeaths","yAxisVaccines","yScaleCasesAxis","yScaleDeathsAxis","yScaleVaccinesAxis","xScale","xAxis","xScaleAxis","xScaleEvents","maxDate","minDate","md","regions","drawTimechart","data","options","groupedData","who_data","forEach","d","i","timeline_frequency","date","week_start","month_start","ifrc_region","new_cases","new_deaths","cumulative_cases","cumulative_deaths","dd","ii","hasOwnProperty","total_new_cases","AF","AP","AM","EU","ME","OTH","total_cumulative_cases","total_new_deaths","total_cumulative_deaths","region","push","vgroupedData","timeline_type","vaccines_data","vaccines_data_daily","new_vaccines","daily_vaccinations","cumulative_vaccines","total_new_vaccines","vaccines_data_cumulative","endOfWeekDate","endOf","startOf","unix","maxVDate","maxDateUnix","endOfMonthDate","total_vaccinations","total_cumulative_vaccines","filter","el","numIntervals","max","maxCases","maxDeaths","maxVaccines","toDate","Date","add","svg","select","selectAll","remove","append","attr","width","barWidth","barSpacing","scaleTime","range","domain","scaleLinear","axisBottom","scale","tickSize","tickPadding","axisRight","ticks","tickFormat","yAxisGroup","yAxisCasesText","call","yAxisDeathsText","yAxisVaccinesText","xAxisCases","xAxisDeaths","xAxisVaccines","xAxisTimeline","barGroups","enter","totalNewCases","parentNode","datum","dp","y","totalNewDeaths","next","timeMonth","offset","vbarGroups","totalNewVaccines","tData","timeline_data","document","getElementById","appendChild","node","timelineTooltip","eventTooltip","hoverBar","on","event","coords","pointer","xDate","invert","getTime","style","tooltipStr","format","text","groupedDataFiltered","vgroupedDataFiltered","deaths","cases","vaccines","bw","ratio","brushR","brushL","x","xx","events","length","subtract","wrap","bounds","height","method","description","bbox","getBBox","h","ys","parseInt","brush","brushX","extent","brushed","gBrush","brushScale","move","parseFloat","x2","w","viewBoxW","Math","round","viewBoxX","updateTimechart","transition","duration"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {nFormatter} from './HelperFunctions';\nimport { selection, textwrap } from 'd3-textwrap';\nimport clone from 'just-clone';\n\nlet yScaleCases;\nlet yScaleDeaths;\nlet yScaleVaccines;\nlet yAxisCases;\nlet yAxisDeaths;\nlet yAxisVaccines;\nlet yScaleCasesAxis;\nlet yScaleDeathsAxis;\nlet yScaleVaccinesAxis;\nlet xScale;\nlet xAxis; \nlet xScaleAxis;\nlet xScaleEvents;\nlet maxDate; \nlet minDate;\nlet md; \n\nconst regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n\nexport function drawTimechart(data, options) {\n\n    minDate = options.minDate;\n    maxDate = options.maxDate;\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    let vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        data.vaccines_data = [];\n        if(options.timeline_frequency==='day') {\n            data.vaccines_data = clone(data.vaccines_data_cumulative);\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(date==moment(options.maxVDate).startOf('day').unix())){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(options.maxVDate).startOf('day').unix();\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate)&&(date==maxDateUnix))){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n    // const minDate = groupedData[0].date;\n\n\n    // if(options.timeline_frequency==='month') md = md.add(1, 'months');\n    // if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\n    if(options.timeline_frequency==='month') minDate = moment(minDate).startOf('month').startOf('day').toDate();\n    if(options.timeline_frequency==='month') maxDate = moment(maxDate).endOf('month').startOf('day').toDate();\n    if(options.timeline_frequency==='week') maxDate = moment(maxDate).endOf('isoWeek').startOf('day').toDate();\n\n    md = moment(maxDate);\n    if(options.timeline_frequency==='day') md = new Date(moment(maxDate).add(1, 'days').toDate());\n\n    const svg = d3.select('#timechart_svg');\n    svg.selectAll('g').remove();\n    d3.selectAll('#layout .yAxis').remove();\n    d3.selectAll('#yAxis').remove();\n    d3.selectAll('#layout .xAxis').remove();\n\n    //bg\n    svg.append('g').append('rect')\n    .attr('width', 2000)\n    .attr('height', '100%')\n    .attr('x', 0)\n    .attr('y', 0)\n    .attr('fill', '#FFF')\n    .attr('opacity', 0);\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    xScale = d3.scaleTime()\n    .range([0,width])\n    .domain([minDate,md]);\n\n    xScaleAxis = d3.scaleTime()\n    .range([0,596])\n    .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    \n    xAxis = d3.axisBottom()\n    .scale(xScaleAxis)\n    .tickSize(2)\n    .tickPadding(3);\n\n    // if(options.timeline_frequency=='month')\n    // xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n\n    // if(options.timeline_frequency=='week')\n    // xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\n\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisGroup = d3.select('#layout').append(\"g\").attr('id', 'yAxis').attr('clip-path', 'url(#mask)');\n\n    var yAxisCasesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"casesAxis\")\n    .attr('transform', 'translate(620,363)')\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"deathsAxis\")\n    .attr('transform', 'translate(620,534)')\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"VaccinesAxis\")\n    .attr('transform', 'translate(620,707.5)')\n    .call(yAxisVaccines);\n\n    // x-axis cases\n    var xAxisCases = yAxisGroup.append('g')\n    .attr(\"id\", \"casesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,504)')\n    .call(xAxis);\n\n    var xAxisDeaths = yAxisGroup.append('g')\n    .attr(\"id\", \"deathsXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,674)')\n    .call(xAxis);\n\n    var xAxisVaccines = yAxisGroup.append('g')\n    .attr(\"id\", \"vaccinesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,848)')\n    .call(xAxis);\n\n    var xAxisTimeline = yAxisGroup.append('g')\n    .attr(\"id\", \"timelineXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,908)')\n    .call(xAxis);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'bar_group')\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar cases_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    })\n\n    // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar deaths_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n            })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n            })\n        }\n\n    // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'vbar_group')\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n   \n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', 'timeBar vaccines_bar')\n    .attr('class', function(d,i) { return 'timeBar vaccines_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    if(options.timeline_frequency==='month'){\n    vbarGroups.selectAll(\".timeBar\")\n    .attr(\"width\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(1-barSpacing);\n        })\n    .attr(\"x\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(barSpacing/2);\n        })\n    }\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n          })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n          })\n        }\n\n    data.vgroupedData = vgroupedData;\n    data.groupedData = groupedData;\n\n        // tooltips\n\n        // events calendar timeline\n        var tData = data.timeline_data;\n\n        xScaleEvents = d3.scaleTime()\n        .range([25,619])\n        .domain([minDate,md]);\n        \n        // bring to front\n       document.getElementById(\"svg\").appendChild(d3.select('#timeline_tooltip').node());\n       document.getElementById(\"svg\").appendChild(d3.select('#event_tooltip').node());\n       var timelineTooltip = d3.select('#timeline_tooltip').attr('opacity', 0);\n       var eventTooltip = d3.select('#event_tooltip').attr('opacity', 0);\n\n        // hover bar\n        var hoverBar = svg.append('rect')\n        .attr('id','timechart_hover')\n        .attr('width', barWidth)\n        .attr('x', 0)\n        .attr('y', 0)\n        .attr('opacity', 0)\n        .attr('height', '100%')\n        .attr('fill', 'rgb(221 221 221 / 40%)')\n\n        d3.select('#timechart_svg').on('mouseover',  (event) => {\n\n            var coords = d3.pointer( event );\n            hoverBar.attr('opacity', 1)\n\n            var xDate = xScale.invert(coords[0]);\n\n            if(options.timeline_frequency=='week') {\n                xDate = moment(xDate).startOf('isoWeek');\n            }\n            if(options.timeline_frequency=='day') {\n                xDate = moment(xDate).startOf('day');\n            }\n            if(options.timeline_frequency=='month') {\n                xDate = moment(xDate).startOf('month');\n            }\n\n            if(coords[1]<470){\n                timelineTooltip.attr('opacity', 1).attr('display', 'inline');\n                hoverBar.attr('height', '100%');\n            } else if(coords[1]>510){\n                eventTooltip.attr('opacity', 1);\n                hoverBar.attr('height', '90%');\n            } else {\n                eventTooltip.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                hoverBar.attr('height', '100%');\n            }\n\n            if((xDate.toDate().getTime()<minDate.getTime())){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n            }\n\n            d3.select('#svg_container').style('z-index', 10);\n\n        }).on('mouseout',  (event) => {\n            hoverBar.attr('opacity', 0)\n            timelineTooltip.attr('opacity', 0).attr('display', 'none');\n            // timelineTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\n            d3.select('#svg_container').style('z-index', 1);\n            eventTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\n            d3.selectAll('.event_marker path').style('stroke', 'grey').attr('opacity', 0.8);\n        })\n        .on('mousemove', (event) => {\n            var coords = d3.pointer( event );\n\n            var xDate = xScale.invert(coords[0]);\n\n            var tooltipStr = '';\n            if(options.timeline_frequency=='week') {\n                xDate = moment(xDate).startOf('isoWeek');\n                tooltipStr = xDate.format('ll');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            if(options.timeline_frequency=='day') {\n                xDate = moment(xDate).startOf('day');\n                tooltipStr = xDate.format('ll');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            if(options.timeline_frequency=='month') {\n                xDate = moment(xDate).startOf('month');\n                tooltipStr = xDate.format('MMMM YYYY');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            hoverBar.attr('x', xScale(xDate.toDate()));\n\n            var groupedDataFiltered = data.groupedData.filter(function(d,i){\n                return moment(d.date).startOf('day').unix() == xDate.startOf('day').unix();\n            });\n            var vgroupedDataFiltered = data.vgroupedData.filter(function(d,i){\n                return moment(d.date).startOf('day').unix() == xDate.startOf('day').unix();\n            });\n\n            var deaths = '-';\n            var cases = '-';\n            var vaccines = '-';\n            if(options.timeline_type=='cumulative'){ \n                // cumulative\n                if(groupedDataFiltered[0]) cases = nFormatter(groupedDataFiltered[0].total_cumulative_cases, 2);\n                if(groupedDataFiltered[0]) deaths = nFormatter(groupedDataFiltered[0].total_cumulative_deaths, 2);\n                if(vgroupedDataFiltered[0]) vaccines = nFormatter(vgroupedDataFiltered[0].total_cumulative_vaccines, 2);\n            } else {\n                // non-cumulative/stacked\n                if(groupedDataFiltered[0]) cases = nFormatter(groupedDataFiltered[0].total_new_cases, 2);\n                if(groupedDataFiltered[0]) deaths = nFormatter(groupedDataFiltered[0].total_new_deaths, 2);\n                if(vgroupedDataFiltered[0]) vaccines = nFormatter(vgroupedDataFiltered[0].total_new_vaccines, 2);\n            }\n\n            d3.select('#tooltip_cases tspan').text((cases)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n            d3.select('#tooltip_deaths tspan').text((deaths)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n            d3.select('#tooltip_vaccines tspan').text((vaccines)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n\n            // if((xDate.toDate().getTime()>options.maxDate.getTime())){\n            //     hoverBar.attr('opacity', 0);\n            // // } else \n            if(((xDate.toDate().getTime()<minDate.getTime()))&&(options.timeline_frequency=='day')){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n            }\n\n            if(options.timeline_frequency=='month'){\n                hoverBar.attr('width', function(){\n                   return xScale(moment(xDate).endOf('month')) - xScale(moment(xDate).startOf('month'));\n                })\n            }\n            timelineTooltip.attr('transform', function(){\n                var bw = barWidth;\n                var ratio = (options.brushR - options.brushL)/600;\n                var offset = 0;\n                if(ratio<0.5) offset = 3;\n                if(ratio<0.3) offset = 12;\n                if(ratio<0.2) offset = 20;\n                if(ratio<0.15) offset = 21;\n                if(options.timeline_frequency=='month') { \n                    if(ratio<0.6) offset = 20;\n                    if(ratio<0.5) offset = 30;\n                    if(ratio<0.3) offset = 50;\n                    if(ratio<0.2) offset = 60;\n                    if(ratio<0.1) offset = 70;\n                    return 'translate('+(((xScaleEvents(xDate.toDate()))+(barWidth/3))+offset)+','+(coords[1]+353)+')';\n                }\n                return 'translate('+((xScaleEvents(xDate.toDate())+(18))+offset)+','+(coords[1]+353)+')';\n            })\n\n            if(coords[1]<470){\n                timelineTooltip.attr('opacity', 1);\n                hoverBar.attr('opacity', 1);\n                hoverBar.attr('height', '100%');\n            } else if(coords[1]>510){\n                eventTooltip.attr('opacity', 1);\n                hoverBar.attr('height', '90%');\n                var x = moment(xScale.invert(coords[0])).startOf('day');\n                var xx = (xScale.invert(coords[0]))\n                eventTooltip.attr('transform', function(){\n                    return 'translate('+(xScaleEvents(x.toDate())+(-3))+','+(817)+')';\n                });\n\n                var events = tData.filter(function(d,i){\n                    return moment(d.date).startOf('day').unix() == x.unix()\n                });\n\n                // select nearest neighbor for ux purposes \n                if(events.length==0){\n                    events = tData.filter(function(d,i){\n                        return ((moment(d.date).startOf('day').unix() <= moment(x).add(1, 'days').unix())&&(moment(d.date).startOf('day').unix() >= moment(x).subtract(1, 'days').unix()))\n                    });\n                }\n                \n                if(events.length>0){\n\n                    d3.select('#event-'+moment(events[0].date).startOf('day').unix()).select('path').style('stroke', '#000').attr('opacity', 1);\n                    tooltipStr = moment(events[0].date).startOf('day').format('ll');\n                    d3.select('#event_tooltip_date tspan').text(tooltipStr);\n\n                    var wrap = textwrap().bounds({height: 200, width: 230}).method('tspans');\n                    var event = d3.select('#event_tooltip_text').text(events[0].description)\n                    .attr('y', 18)\n                    .attr('x', 6)\n                    d3.select('#event_tooltip_text').call(wrap);\n\n                    d3.selectAll('#event_tooltip_text tspan').attr('dy', '1.3em');\n                    var bbox = d3.select('#event_tooltip_text').node().getBBox();\n                    d3.select('#event_tooltip_rect').attr('width', bbox.width+17)\n                    .attr('height', bbox.height +26 );\n\n                    var h = d3.select('#event_tooltip_rect').attr('height');\n                    var ys = 0;\n\n                    if(bbox.height<20){\n                        ys = 19;\n                    } else if(bbox.height<30){\n                        ys = 9;\n                    } else if(bbox.height<40){\n                        ys = 0;\n                    } else if(bbox.height<50){\n                        ys = -20;\n                    } else if(bbox.height<60){\n                        ys = -20;\n                    }\n\n                    var y = d3.select('#event_tooltip_rect').attr('y');\n\n                    d3.select('#event_tooltip_rect').attr('y', ys);\n                    \n                    d3.selectAll('#event_tooltip_text').attr('y', function(d,i){\n                        return parseInt(d3.select(this).attr('y')) + ys;\n                    });\n\n                    d3.selectAll('#event_tooltip_date tspan').attr('dy', function(d,i){\n                        return ys;\n                    });\n\n                    eventTooltip.attr('opacity', 1);\n\n                } else {\n                    d3.selectAll('.event_marker path').style('stroke', 'grey')\n                    .attr('opacity', 0.8);\n                    eventTooltip.attr('opacity', 0);\n                }\n            } else {\n                eventTooltip.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                hoverBar.attr('opacity', 0);\n                hoverBar.attr('height', '100%');\n            }\n\n            if((options.timeline_frequency=='day')&&((xDate.toDate().getTime()<minDate.getTime()))){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                return false;\n            }\n        });\n\n        tData = tData.filter(d => d.date.length > 0);\n\n        yAxisGroup.append('g').selectAll('.event_marker')\n        .data(tData)\n        .enter()\n        .append('g')\n        .attr('class', 'event_marker')\n        .attr('id', function(d,i){\n            return 'event-'+moment(d.date).startOf('day').unix();\n        })\n        .attr('transform', function(d){\n            var x = xScaleEvents(new Date(d.date));\n            return 'translate('+(x)+', 893)';\n        })\n        .append('path')\n        .attr('d', \"M0,-6L4,0 0,6 -4,0Z\")\n        .style('stroke', 'grey')\n        .attr('opacity', 0.8)\n        .style('stroke-width',3.5)\n        .style('fill', 'white');\n\n        // create brush zoom\n        // reset\n        // options.brushL = 0;\n        // options.brushR = 600;\n        const brush = d3.brushX()\n        .extent([[0,0],[600,40]])\n        .on(\"start brush end\", brushed);\n\n        d3.select('.brush').remove();\n;\n        var gBrush = d3.select('#zoombar').append(\"g\")\n        .attr(\"class\", \"brush\")\n        .attr('opacity', 0.1)\n        .call(brush);\n\n\t\td3.selectAll('.handle rect').attr('fill-opacity', '1').style('visibility', 'visible').attr('width', 2).attr('fill', '#000').style('stroke-opacity', 0);\n\n        var brushScale = d3.scaleLinear()\n        .domain([-3, 597])\n        .range([0,2000]);\n\n        gBrush.call(brush.move, [options.brushL,options.brushR]);\n\n        function brushed(){\n            var x = parseFloat(d3.select('.handle--w').attr('x'));\n            var x2 = parseFloat(d3.select('.handle--e').attr('x'));\n            if((x2-x)<40) return false;\n            var w = d3.select('.selection').attr('width');\n            d3.select('#zoomL').attr('transform', 'translate('+x+',0)');\n            d3.select('#zoomR').attr('transform', 'translate('+(x2)+',0)');\n            d3.select('#zoomOverlay').attr('width', (x2-x));\n            d3.select('#zoomOverlay').attr('x', (x));\n            d3.select('#zoomOverlay').attr('transform', 'translate(3,0)');\n            var viewBoxW = Math.round(brushScale(x2)-brushScale(x));\n            var viewBoxX = Math.round(brushScale(x));\n            options.brushL = x+3;\n            options.brushR = x2+3;\n\n            xScaleAxis = d3.scaleTime()\n            .range([0,596])\n            .domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);\n\n            xScaleEvents = d3.scaleTime()\n            .range([25,619])\n            // .domain([minDate,md]);\n            .domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);\n\n            d3.selectAll('.event_marker')\n            .attr('transform', function(d){\n                var x = xScaleEvents(new Date(d.date));\n                return 'translate('+(x)+', 893)';\n            });\n\n            xAxis = d3.axisBottom()\n            .ticks(5)\n            .scale(xScaleAxis);\n\n            xAxisCases.call(xAxis);\n            xAxisDeaths.call(xAxis);\n            xAxisVaccines.call(xAxis);\n            xAxisTimeline.call(xAxis);\n            \n            d3.select('#timechart_svg').attr('viewBox', viewBoxX + ' 0 '+ viewBoxW + ' 553')\n        }\n\n}\n\nexport function updateTimechart(data, options) {\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n    });\n\n    let vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        data.vaccines_data = [];\n        if(options.timeline_frequency==='day') {\n            data.vaccines_data = clone(data.vaccines_data_cumulative);\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(date==moment(options.maxVDate).startOf('day').unix())){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(options.maxVDate).startOf('day').unix();\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((moment(options.maxVDate).startOf('day').unix()!=endOfMonthDate)&&(date==maxDateUnix))){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    const svg = d3.select('#timechart_svg');\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    // xScale = d3.scaleTime()\n    // .range([0,width])\n    // .domain([minDate,md]);\n\n    // xScaleAxis = d3.scaleTime()\n    // .range([23,596])\n    // .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisCasesText = d3.select('#casesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = d3.select('#deathsAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = d3.select('#VaccinesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisVaccines);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n        return 'blue'\n    })\n\n    // // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n\n    if(groupedData.length==0){\n        d3.selectAll('.cases_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n\n        d3.selectAll('.deaths_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140+170)\n        .attr('height', 0)\n        \n    }\n    // // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n\n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    });\n\n    if(vgroupedData.length==0){\n        d3.selectAll('.vaccines_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n    }\n   \n    // // bar size tweak for spacing\n    // if(options.timeline_frequency==='month'){\n    //     barGroups.selectAll(\".timeBar\")\n    //     .attr(\"width\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(1-barSpacing);\n    //       })\n    //     .attr(\"x\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(barSpacing/2);\n    //       })\n    //     }\n    data.vgroupedData = vgroupedData;\n    data.groupedData = groupedData;\n\n}\n\nexport default drawTimechart;\n"]},"metadata":{},"sourceType":"module"}