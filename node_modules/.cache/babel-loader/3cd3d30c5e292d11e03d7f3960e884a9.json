{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{addCommas}from'./HelperFunctions';import{filter}from'./App';var maxCases;var maxDeaths;var maxVaccinations;var xScaleCases;var xScaleDeaths;var xScaleVaccines;var labelWidth;var regions=['AF','ME','AP','EU','AM','OTH'];var margin={left:20,top:0,right:58};var rcSize;var groupedData=[];export function drawRegionchart(data,options,filter){groupedData=[];var barSpacing=0.1;data.regions.forEach(function(d,i){groupedData.push({region:d.code,cumulative_cases:0,cumulative_deaths:0,cumulative_vaccines:0,population:d.population});});data.who_data.forEach(function(d,i){data.regions.forEach(function(dd,ii){if(dd.code==d.ifrc_region){// remove OTH\ngroupedData[ii].cumulative_cases+=d.new_cases;groupedData[ii].cumulative_deaths+=d.new_deaths;}});});// vaccinations max date records\nvar vGroup=d3.flatGroup(data.vaccines_data_cumulative,function(d){return d.date;});var vacGrouped=vGroup[vGroup.length-1];var vData=[];vacGrouped[1].forEach(function(d,i){regions.forEach(function(dd,ii){if(dd==d.ifrc_region&&dd!='OTH'){// remove OTH\ngroupedData[ii].cumulative_vaccines+=d.total_vaccinations;}});});groupedData.forEach(function(d,i){d.cumulative_cases_per_100k=d.cumulative_cases/(d.population/100000);d.cumulative_deaths_per_100k=d.cumulative_deaths/(d.population/100000);d.cumulative_vaccines_per_100k=d.cumulative_vaccines/(d.population/100000);if(!isFinite(d.cumulative_cases_per_100k))d.cumulative_cases_per_100k=0;if(!isFinite(d.cumulative_deaths_per_100k))d.cumulative_deaths_per_100k=0;if(!isFinite(d.cumulative_vaccines_per_100k))d.cumulative_vaccines_per_100k=0;});groupedData.sort(function(a,b){if(options.region_chart_toggle=='cases')return b.cumulative_cases_per_100k-a.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')return b.cumulative_deaths_per_100k-a.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')return b.cumulative_vaccines_per_100k-a.cumulative_vaccines_per_100k;});maxVaccinations=d3.max(groupedData,function(d,i){return d.cumulative_vaccines_per_100k;});maxCases=d3.max(groupedData,function(d,i){return d.cumulative_cases_per_100k;});maxDeaths=d3.max(groupedData,function(d,i){return d.cumulative_deaths_per_100k;});// append region chart containerg\nvar regionChartContainer=d3.select('#layout #region_chart_container').attr('opacity',0);rcSize={x:regionChartContainer.attr('x'),y:regionChartContainer.attr('y'),width:regionChartContainer.attr('width'),height:regionChartContainer.attr('height')};var svg=d3.select('#layout').append('g').attr('transform','translate('+rcSize.x+', '+rcSize.y+')').attr('id','region_chart');var rowHeight=rcSize.height/(groupedData.length-1);// remove OTH\nvar rows=svg.selectAll('.bar-row').data(groupedData.filter(function(d){return d.region!=='OTH';})).enter().append('g').attr('class','bar-row').attr('transform',function(d,i){return'translate(0,'+(i*rowHeight+margin.top)+')';});data.cumulative_totals=groupedData;var label=rows.append('text').attr('y',rowHeight/2).attr('x',margin.left-5).attr('class',function(d,i){return'bar-labels bar-label-'+d.region;}).style('alignment-baseline','middle').style('font-size','11px').attr('opacity',1).attr('fill','#000').text(function(d,i){if(d.region==='AM')return'Americas';if(d.region==='EU')return'Europe';if(d.region==='AF')return'Africa';if(d.region==='ME')return'Middle East and North Africa';if(d.region==='AP')return'Asia-Pacific';}).style('text-anchor','end');labelWidth=rows.node().getBBox().width+margin.left;label.attr('x',labelWidth+89);labelWidth=labelWidth+94;d3.selectAll('.timeBar').attr('opacity',1);var rowBg=rows.append('rect').attr('y',0).attr('x',0).attr('width',labelWidth).attr('height',rowHeight-2).style('opacity',0).attr('fill','grey').style('cursor','pointer').attr('class',function(d,i){return'bar-bg-'+d.region;}).attr('data-id',function(d,i){return d.region;}).on('mouseover',function(d){d3.select(this).style('opacity',0.1);// var dat = d3.select(this.parentNode).datum();\n// d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n// d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n}).on('mouseout',function(){d3.select(this).style('opacity',0);// d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n}).on('click',function(d,i){var t=d3.select(this).attr('data-id');filter([t],'regionchart');});xScaleCases=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxCases]);xScaleDeaths=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxDeaths]);xScaleVaccines=d3.scaleLinear().range([labelWidth,rcSize.width-margin.right-labelWidth]).domain([0,maxVaccinations]);var bars=rows.append('rect').attr('id',function(d,i){return'bar-'+d.region;}).attr('data-id',function(d,i){return d.region;}).attr('class','region-bar').attr('width',function(d,i){if(options.region_chart_toggle=='cases')return xScaleCases(d.cumulative_cases_per_100k);if(options.region_chart_toggle=='deaths')return xScaleDeaths(d.cumulative_deaths_per_100k);if(options.region_chart_toggle=='vaccines')return xScaleDeaths(d.cumulative_vaccines_per_100k);}).attr('x',labelWidth).style('outline','none').style('cursor','pointer').attr('y',rowHeight*barSpacing-1).attr('height',rowHeight-rowHeight*barSpacing*2).style('fill',function(d){return colors.regions[d.region];}).attr('opacity',1).on('click',function(d,i){var t=d3.select(this).attr('data-id');filter([t],'regionchart');}).on('mouseover',function(d){var dat=d3.select(this.parentNode).datum();// d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n// d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n}).on('mouseout',function(){// d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n});var dataLabel=rows.append('text').text(function(d){if(options.region_chart_toggle=='cases')return addCommas(Math.round(d.cumulative_cases_per_100k));if(options.region_chart_toggle=='deaths')return addCommas(Math.round(d.cumulative_deaths_per_100k));if(options.region_chart_toggle=='vaccines')return addCommas(Math.round(d.cumulative_vaccines_per_100k));}).attr('id',function(d,i){return'data-label'+d.region;}).attr('data-id',function(d,i){return d.region;}).attr('class','data-label').attr('y',rowHeight/2).style('alignment-baseline','middle').style('text-anchor','start').attr('x',function(d,i){if(options.region_chart_toggle=='cases')return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;if(options.region_chart_toggle=='deaths')return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;if(options.region_chart_toggle=='vaccines')return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;}).attr('opacity',function(d,i){var val=0;if(options.region_chart_toggle=='cases')val=d.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')val=d.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')val=d.cumulative_vaccines_per_100k;if(val>0){return 1;}else{return 0;}}).style('fill','#696969').style('font-weight','normal').style('font-size','10px');}export function updateRegionchart(options,data){groupedData=[];data.regions.forEach(function(d,i){groupedData.push({region:d.code,cumulative_cases:0,cumulative_deaths:0,cumulative_vaccines:0,population:d.population});});data.who_data.forEach(function(d,i){data.regions.forEach(function(dd,ii){if(dd.code==d.ifrc_region){// remove OTH\ngroupedData[ii].cumulative_cases+=d.new_cases;groupedData[ii].cumulative_deaths+=d.new_deaths;}});});// vaccinations max date records\nvar vGroup=d3.flatGroup(data.vaccines_data_cumulative,function(d){return d.date;});var vacGrouped=vGroup[vGroup.length-1];var vData=[];vacGrouped[1].forEach(function(d,i){regions.forEach(function(dd,ii){if(dd==d.ifrc_region&&dd!='OTH'){// remove OTH\ngroupedData[ii].cumulative_vaccines+=d.total_vaccinations;}});});groupedData.forEach(function(d,i){d.cumulative_cases_per_100k=d.cumulative_cases/(d.population/100000);d.cumulative_deaths_per_100k=d.cumulative_deaths/(d.population/100000);d.cumulative_vaccines_per_100k=d.cumulative_vaccines/(d.population/100000);if(!isFinite(d.cumulative_cases_per_100k))d.cumulative_cases_per_100k=0;if(!isFinite(d.cumulative_deaths_per_100k))d.cumulative_deaths_per_100k=0;if(!isFinite(d.cumulative_vaccines_per_100k))d.cumulative_vaccines_per_100k=0;});groupedData.sort(function(a,b){if(options.region_chart_toggle=='cases')return b.cumulative_cases_per_100k-a.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')return b.cumulative_deaths_per_100k-a.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')return b.cumulative_vaccines_per_100k-a.cumulative_vaccines_per_100k;});maxVaccinations=d3.max(groupedData,function(d,i){return d.cumulative_vaccines_per_100k;});maxCases=d3.max(groupedData,function(d,i){return d.cumulative_cases_per_100k;});maxDeaths=d3.max(groupedData,function(d,i){return d.cumulative_deaths_per_100k;});xScaleCases=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxCases]);xScaleDeaths=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxDeaths]);xScaleVaccines=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxVaccinations]);if(maxVaccinations==0&&maxCases==0&&maxDeaths==0){d3.selectAll('.region-bar').transition().duration(500).attr('width',0);d3.selectAll('.data-label').transition().duration(500).attr('x',labelWidth).attr('opacity',0);}else{d3.selectAll('.region-bar').transition().duration(500).attr('width',function(d,i){var id=d3.select(this).attr('data-id');var d;groupedData.forEach(function(dd,ii){if(dd.region==id){d=dd;}});var val=0;if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases_per_100k);if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths_per_100k);if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines_per_100k);if(!isNaN(val)){return parseFloat(val);}else{return 0;}});d3.selectAll('.data-label').transition().duration(500).tween(\"text\",function(d,i){var end=0;var id=d3.select(this).attr('data-id');var d;groupedData.forEach(function(dd,ii){if(dd.region==id){d=dd;}});if(options.region_chart_toggle=='cases')end=d.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')end=d.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')end=d.cumulative_vaccines_per_100k;var i=d3.interpolate(Math.floor(Math.random()*2346+9345),end);return function(t){d3.select(this).text(addCommas(Math.round(i(t))));};}).attr('x',function(d,i){var id=d3.select(this).attr('data-id');var d;groupedData.forEach(function(dd,ii){if(dd.region==id){d=dd;}});if(options.region_chart_toggle=='cases')return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;if(options.region_chart_toggle=='deaths')return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;if(options.region_chart_toggle=='vaccines')return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;}).attr('opacity',function(d,i){var d;var id=d3.select(this).attr('data-id');groupedData.forEach(function(dd,ii){if(dd.region==id){d=dd;}});var val=0;if(options.region_chart_toggle=='cases')val=d.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')val=d.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')val=d.cumulative_vaccines_per_100k;if(val>0){return 1;}else{return 0;}});}}export default drawRegionchart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Regionchart.js"],"names":["d3","moment","colors","addCommas","filter","maxCases","maxDeaths","maxVaccinations","xScaleCases","xScaleDeaths","xScaleVaccines","labelWidth","regions","margin","left","top","right","rcSize","groupedData","drawRegionchart","data","options","barSpacing","forEach","d","i","push","region","code","cumulative_cases","cumulative_deaths","cumulative_vaccines","population","who_data","dd","ii","ifrc_region","new_cases","new_deaths","vGroup","flatGroup","vaccines_data_cumulative","date","vacGrouped","length","vData","total_vaccinations","cumulative_cases_per_100k","cumulative_deaths_per_100k","cumulative_vaccines_per_100k","isFinite","sort","a","b","region_chart_toggle","max","regionChartContainer","select","attr","x","y","width","height","svg","append","rowHeight","rows","selectAll","enter","cumulative_totals","label","style","text","node","getBBox","rowBg","on","t","scaleLinear","range","domain","bars","dat","parentNode","datum","dataLabel","Math","round","val","updateRegionchart","transition","duration","id","isNaN","parseFloat","tween","end","interpolate","floor","random"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {addCommas} from './HelperFunctions';\nimport {filter} from './App';\n\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases; \nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth; \nconst regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\nconst margin = { left: 20, top: 0, right: 58 };\nlet rcSize; \nlet groupedData = [];\n\nexport function drawRegionchart(data, options, filter) {\n\n    groupedData = [];\n\n    const barSpacing = 0.1;\n\n    data.regions.forEach(function(d,i){\n        groupedData.push({ region: d.code, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0, population: d.population});\n    })\n\n    data.who_data.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ // remove OTH\n                groupedData[ii].cumulative_cases += d.new_cases;\n                groupedData[ii].cumulative_deaths += d.new_deaths;\n            }\n        });\n    });\n\n    // vaccinations max date records\n    var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n\n    var vacGrouped = vGroup[vGroup.length-1];\n\n    var vData = [];\n    vacGrouped[1].forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if((dd==d.ifrc_region)&&(dd!='OTH')){ // remove OTH\n                groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n            }\n        })\n    });\n\n    groupedData.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    groupedData.sort(function(a,b){\n        if(options.region_chart_toggle == 'cases') return (b.cumulative_cases_per_100k) - (a.cumulative_cases_per_100k);\n        if(options.region_chart_toggle == 'deaths') return (b.cumulative_deaths_per_100k) - (a.cumulative_deaths_per_100k);\n        if(options.region_chart_toggle == 'vaccines') return (b.cumulative_vaccines_per_100k) - (a.cumulative_vaccines_per_100k); \n    });\n\n    maxVaccinations = d3.max(groupedData, function(d,i){\n        return d.cumulative_vaccines_per_100k;\n    })\n\n    maxCases = d3.max(groupedData, function(d,i){\n        return d.cumulative_cases_per_100k;\n    })\n\n    maxDeaths = d3.max(groupedData, function(d,i){\n        return d.cumulative_deaths_per_100k;\n    });\n\n    // append region chart containerg\n    const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n    rcSize = {\n        x: regionChartContainer.attr('x'), y: regionChartContainer.attr('y'), width: regionChartContainer.attr('width'), height: regionChartContainer.attr('height')\n    }\n\n    const svg = d3.select('#layout').append('g').attr('transform', 'translate('+rcSize.x+', '+rcSize.y+')')\n    .attr('id', 'region_chart');\n\n\tvar rowHeight = rcSize.height/(groupedData.length-1); // remove OTH\n\n    var rows = svg.selectAll('.bar-row')\n\t.data(groupedData.filter(d=>d.region!=='OTH'))\n\t.enter()\n\t.append('g')\n\t.attr('class', 'bar-row')\n\t.attr('transform', function(d,i){\n\t\treturn 'translate(0,' + ((i*rowHeight) + margin.top) + ')';\n\t});\n\n    data.cumulative_totals = groupedData;\n    \n    var label = rows.append('text')\n\t.attr('y', rowHeight/2 )\n    .attr('x', margin.left-5)\n\t.attr('class', function(d,i){ return 'bar-labels bar-label-'+d.region })\n\t.style('alignment-baseline', 'middle')\n\t.style('font-size', '11px')\n    .attr('opacity', 1)\n\t.attr('fill', '#000')\n\t.text(function(d,i){\n\t\tif(d.region==='AM') return 'Americas';\n\t\tif(d.region==='EU') return 'Europe';\n\t\tif(d.region==='AF') return 'Africa';\n\t\tif(d.region==='ME') return 'Middle East and North Africa';\n\t\tif(d.region==='AP') return 'Asia-Pacific';\n\t}).style('text-anchor', 'end');\n\n    labelWidth = rows.node().getBBox().width + margin.left;\n\tlabel.attr('x', labelWidth+89);\n\tlabelWidth = labelWidth + 94;\n    d3.selectAll('.timeBar').attr('opacity',1);\n    \n    var rowBg = rows.append('rect')\n\t.attr('y', 0)\n\t.attr('x', 0)\n\t.attr('width', labelWidth)\n\t.attr('height', rowHeight-2)\n\t.style('opacity', 0)\n    .attr('fill', 'grey')\n\t.style('cursor', 'pointer')\n\t.attr('class', function(d,i){ return 'bar-bg-'+d.region })\n\t.attr('data-id', function(d,i){ return d.region })\n\t.on('mouseover', function(d){\n\t\td3.select(this).style('opacity', 0.1);\n        // var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n\t\td3.select(this).style('opacity', 0);\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\t.on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    });\n\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([labelWidth, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    var bars = rows.append('rect')\n    .attr('id', function(d,i){\n        return 'bar-'+d.region;\n    })\n\t.attr('data-id', function(d,i){ return d.region })\n    .attr('class', 'region-bar')\n    .attr('width', function(d,i){\n        if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k);\n        if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k);\n        if(options.region_chart_toggle == 'vaccines') return xScaleDeaths(d.cumulative_vaccines_per_100k);\n    })\n    .attr('x', labelWidth)\n    .style('outline', 'none')\n    .style('cursor', 'pointer')\n    .attr('y', rowHeight*barSpacing - 1)\n    .attr('height', rowHeight-((rowHeight*barSpacing)*2))\n    .style('fill', function(d){\n        return colors.regions[d.region]\n    })\n    .attr('opacity',1)\n    .on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    })\n    .on('mouseover', function(d){\n        var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\n    var dataLabel = rows.append('text')\n\t.text(function(d){\n        if(options.region_chart_toggle == 'cases') return addCommas(Math.round(d.cumulative_cases_per_100k));\n        if(options.region_chart_toggle == 'deaths') return addCommas(Math.round(d.cumulative_deaths_per_100k));\n        if(options.region_chart_toggle == 'vaccines') return addCommas(Math.round(d.cumulative_vaccines_per_100k));\n    })\n\t.attr('id', function(d,i){\n\t\treturn 'data-label'+d.region;\n\t})\n    .attr('data-id', function(d,i){ return d.region })\n\t.attr('class', 'data-label')\n\t.attr('y', rowHeight/2)\n\t.style('alignment-baseline', 'middle')\n\t.style('text-anchor', 'start')\n\t.attr('x', function(d,i){\n        if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n        if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n        if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n    })\n    .attr('opacity', function(d,i){\n        var val = 0;\n        if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n        if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n        if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n        if(val>0){ return 1 } else { return 0}\n    })\n\t.style('fill', '#696969')\n\t.style('font-weight', 'normal')\n\t.style('font-size', '10px');\n\n}\n\nexport function updateRegionchart(options,data) {\n    \n    groupedData = [];\n\n    data.regions.forEach(function(d,i){\n        groupedData.push({ region: d.code, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0, population: d.population});\n    })\n\n    data.who_data.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ // remove OTH\n                groupedData[ii].cumulative_cases += d.new_cases;\n                groupedData[ii].cumulative_deaths += d.new_deaths;\n            }\n        });\n    });\n\n    // vaccinations max date records\n    var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n\n    var vacGrouped = vGroup[vGroup.length-1];\n\n    var vData = [];\n    vacGrouped[1].forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if((dd==d.ifrc_region)&&(dd!='OTH')){ // remove OTH\n                groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n            }\n        })\n    });\n\n    groupedData.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    groupedData.sort(function(a,b){\n        if(options.region_chart_toggle == 'cases') return (b.cumulative_cases_per_100k) - (a.cumulative_cases_per_100k);\n        if(options.region_chart_toggle == 'deaths') return (b.cumulative_deaths_per_100k) - (a.cumulative_deaths_per_100k);\n        if(options.region_chart_toggle == 'vaccines') return (b.cumulative_vaccines_per_100k) - (a.cumulative_vaccines_per_100k); \n    });\n\n    maxVaccinations = d3.max(groupedData, function(d,i){\n        return d.cumulative_vaccines_per_100k;\n    })\n\n    maxCases = d3.max(groupedData, function(d,i){\n        return d.cumulative_cases_per_100k;\n    })\n\n    maxDeaths = d3.max(groupedData, function(d,i){\n        return d.cumulative_deaths_per_100k;\n    });\n\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    if((maxVaccinations==0)&&(maxCases==0)&&(maxDeaths==0)){\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .attr('width', 0);\n\n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500) \n          .attr('x', labelWidth)\n          .attr('opacity', 0);\n    } else {\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .attr('width', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n            if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n        })   \n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500)\n          .tween(\"text\", function(d,i) {\n            var end = 0;\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            if(options.region_chart_toggle == 'cases') end = (d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') end = (d.cumulative_deaths_per_100k);  \n            if(options.region_chart_toggle == 'vaccines') end = (d.cumulative_vaccines_per_100k);  \n            var i = d3.interpolate(Math.floor((Math.random() * 2346) + 9345), end);\n            return function(t) {\n              d3.select(this).text(addCommas(Math.round(i(t))));\n            };\n          })\n        .attr('x', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n            if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n            if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n        })\n        .attr('opacity', function(d,i){\n            var d;\n            var id = d3.select(this).attr('data-id');\n            groupedData.forEach(function(dd,ii){\n                if(dd.region == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n            if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n            if(val>0){ return 1 } else { return 0}\n        })\n\n    }\n\n   \n\n}\n\nexport default drawRegionchart;\n"]},"metadata":{},"sourceType":"module"}