{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { addCommas } from './HelperFunctions';\nimport { filter } from './App';\nlet maxX = 1000;\nlet maxY = 100;\nlet maxZ = 1000000;\nlet xScale;\nlet yScale;\nlet zScale;\nlet groupedData = [];\nlet width = 600;\nlet height = 233;\nlet x = 40;\nlet y = 58;\nexport function drawBubblechart(data, options, filter) {\n  data.vGroup.forEach(function (d, i) {\n    data.equity_data.forEach(function (dd, ii) {\n      if (d[0] == dd.country_iso3) {\n        dd.people_fully_vaccinated_per_hundred = parseFloat(d[1][0].people_fully_vaccinated_per_hundred);\n        dd.people_vaccinated_per_hundred = parseFloat(d[1][0].people_vaccinated_per_hundred);\n        dd.total_vaccinations = parseFloat(d[1][0].total_vaccinations);\n        dd.total_vaccinations_per_hundred = parseFloat(d[1][0].total_vaccinations_per_hundred);\n      }\n    });\n  });\n  console.log(data);\n  maxX = d3.max(data.equity_data, function (d, i) {\n    return parseFloat(d.gni_2017);\n  });\n  maxY = d3.max(data.equity_data, function (d, i) {\n    if (options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return parseFloat(d.people_vaccinated_per_hundred);\n    if (options.bubble_chart_y_axis == 'percent-fully-vaccinated') return parseFloat(d.people_fully_vaccinated_per_hundred);\n    if (options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return parseFloat(d.vaccince_acceptance_percent);\n  });\n  maxZ = d3.max(data.equity_data, function (d, i) {\n    return parseFloat(d.population);\n  });\n  xScale = d3.scaleLinear().range([0, width]).domain([0, maxX]);\n  yScale = d3.scaleLinear().range([height, 0]).domain([0, maxY]);\n  zScale = d3.scaleSqrt().domain([0, maxZ]).range([1, 20]);\n  const svg = d3.select('#bubblechart-tab').append('g').attr('transform', 'translate(' + x + ', ' + y + ')').attr('id', 'bubblechart'); // create y-axis\n\n  svg.append(\"g\").attr('id', 'bubbley').call(d3.axisLeft(yScale).ticks(3)); // create x-axis\n\n  svg.append(\"g\").attr('id', 'bubblex').attr(\"transform\", \"translate(0,\" + height + \")\").call(d3.axisBottom(xScale).ticks(3)); // Add dots\n\n  svg.append('g').selectAll(\".bubble\").data(data.equity_data).enter().append(\"circle\").attr(\"class\", function (d) {\n    return \"bubble\";\n  }).attr(\"cx\", function (d) {\n    return xScale(parseFloat(d.gni_2017));\n  }).attr(\"cy\", function (d) {\n    if (options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return yScale(parseFloat(d.people_vaccinated_per_hundred));\n    if (options.bubble_chart_y_axis == 'percent-fully-vaccinated') return yScale(parseFloat(d.people_fully_vaccinated_per_hundred));\n    if (options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return yScale(parseFloat(d.vaccince_acceptance_percent));\n  }).attr(\"r\", function (d) {\n    return zScale(parseFloat(d.population));\n  }).style(\"fill\", function (d) {\n    if (options.bubble_chart_color_by == 'region') {\n      if (colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n    }\n\n    if (options.bubble_chart_color_by == 'hdi') {\n      if (colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n    }\n\n    if (options.bubble_chart_color_by == 'inform-severity') {\n      if (colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n    }\n\n    return 'transparent';\n  }).style(\"stroke\", function (d) {\n    if (options.bubble_chart_color_by == 'region') {\n      if (colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n    }\n\n    if (options.bubble_chart_color_by == 'hdi') {\n      if (colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n    }\n\n    if (options.bubble_chart_color_by == 'inform-severity') {\n      if (colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n    }\n\n    return 'transparent';\n  }).style(\"stroke-width\", 2).style(\"fill-opacity\", 0.8);\n}\nexport function updateBubblechart(data, options, filter) {\n  console.log(data);\n  data.vGroup.forEach(function (d, i) {\n    data.equity_data.forEach(function (dd, ii) {\n      if (d[0] == dd.country_iso3) {\n        dd.people_fully_vaccinated_per_hundred = parseFloat(d[1][0].people_fully_vaccinated_per_hundred);\n        dd.people_vaccinated_per_hundred = parseFloat(d[1][0].people_vaccinated_per_hundred);\n        dd.total_vaccinations = parseFloat(d[1][0].total_vaccinations);\n        dd.total_vaccinations_per_hundred = parseFloat(d[1][0].total_vaccinations_per_hundred);\n      }\n    });\n  });\n  maxX = d3.max(data.equity_data, function (d, i) {\n    return parseFloat(d.gni_2017);\n  });\n  maxY = d3.max(data.equity_data, function (d, i) {\n    if (options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return parseFloat(d.people_vaccinated_per_hundred);\n    if (options.bubble_chart_y_axis == 'percent-fully-vaccinated') return parseFloat(d.people_fully_vaccinated_per_hundred);\n    if (options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return parseFloat(d.vaccince_acceptance_percent);\n  });\n  maxZ = d3.max(data.equity_data, function (d, i) {\n    return parseFloat(d.population);\n  });\n  xScale = d3.scaleLinear().range([0, width]).domain([0, maxX]);\n  yScale = d3.scaleLinear().range([height, 0]).domain([0, maxY]);\n  zScale = d3.scaleSqrt().domain([0, maxZ]).range([1, 20]);\n  const svg = d3.select('#bubblechart'); // create y-axis\n\n  svg.select('#bubbley').transition().duration(800).call(d3.axisLeft(yScale).ticks(3)); // create x-axis\n\n  svg.select('#bubblex').transition().duration(800).call(d3.axisBottom(xScale).ticks(3)); // Add dots\n\n  svg.selectAll(\".bubble\").data(data.equity_data).data(data.equity_data).enter().append(\"circle\").transition().duration(800).attr(\"cx\", function (d) {\n    return xScale(parseFloat(d.gni_2017));\n  }).attr(\"cy\", function (d) {\n    if (options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return yScale(parseFloat(d.people_vaccinated_per_hundred));\n    if (options.bubble_chart_y_axis == 'percent-fully-vaccinated') return yScale(parseFloat(d.people_fully_vaccinated_per_hundred));\n    if (options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return yScale(parseFloat(d.vaccince_acceptance_percent));\n  }).attr(\"r\", function (d) {\n    return zScale(parseFloat(d.population));\n  }).style(\"fill\", function (d) {\n    if (options.bubble_chart_color_by == 'region') {\n      if (colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n    }\n\n    if (options.bubble_chart_color_by == 'hdi') {\n      if (colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n    }\n\n    if (options.bubble_chart_color_by == 'inform-severity') {\n      if (colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n    }\n\n    return 'transparent';\n  }).style(\"stroke\", function (d) {\n    if (options.bubble_chart_color_by == 'region') {\n      if (colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n    }\n\n    if (options.bubble_chart_color_by == 'hdi') {\n      if (colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n    }\n\n    if (options.bubble_chart_color_by == 'inform-severity') {\n      if (colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n    }\n\n    return 'transparent';\n  }).exit().remove();\n}\nexport default drawBubblechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Bubblechart.js"],"names":["d3","moment","colors","addCommas","filter","maxX","maxY","maxZ","xScale","yScale","zScale","groupedData","width","height","x","y","drawBubblechart","data","options","vGroup","forEach","d","i","equity_data","dd","ii","country_iso3","people_fully_vaccinated_per_hundred","parseFloat","people_vaccinated_per_hundred","total_vaccinations","total_vaccinations_per_hundred","console","log","max","gni_2017","bubble_chart_y_axis","vaccince_acceptance_percent","population","scaleLinear","range","domain","scaleSqrt","svg","select","append","attr","call","axisLeft","ticks","axisBottom","selectAll","enter","style","bubble_chart_color_by","regions","ifrc_region","hdi_category","inform_severity","updateBubblechart","transition","duration","exit","remove"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {addCommas} from './HelperFunctions';\nimport {filter} from './App';\n\nlet maxX =1000;\nlet maxY = 100;\nlet maxZ = 1000000;\nlet xScale; \nlet yScale; \nlet zScale; \nlet groupedData = [];\nlet width = 600;\nlet height = 233;\nlet x = 40;\nlet y = 58;\n\nexport function drawBubblechart(data, options, filter) {\n\n    data.vGroup.forEach(function(d,i){\n        data.equity_data.forEach(function(dd,ii){\n            if(d[0] == dd.country_iso3){\n                dd.people_fully_vaccinated_per_hundred = parseFloat(d[1][0].people_fully_vaccinated_per_hundred);\n                dd.people_vaccinated_per_hundred = parseFloat(d[1][0].people_vaccinated_per_hundred);\n                dd.total_vaccinations = parseFloat(d[1][0].total_vaccinations);\n                dd.total_vaccinations_per_hundred = parseFloat(d[1][0].total_vaccinations_per_hundred);\n\n            }\n        })\n    })\n    console.log(data);\n\n    maxX = d3.max(data.equity_data, function(d,i){\n        return parseFloat(d.gni_2017);\n    })\n\n    maxY = d3.max(data.equity_data, function(d,i){\n        if(options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return parseFloat(d.people_vaccinated_per_hundred);\n        if(options.bubble_chart_y_axis == 'percent-fully-vaccinated') return parseFloat(d.people_fully_vaccinated_per_hundred);\n        if(options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return parseFloat(d.vaccince_acceptance_percent);\n    });\n\n    maxZ = d3.max(data.equity_data, function(d,i){\n        return parseFloat(d.population);\n    });\n\n    xScale = d3.scaleLinear()\n\t.range([0, width])\n\t.domain([0, maxX]);\n\n    yScale = d3.scaleLinear()\n\t.range([height, 0])\n\t.domain([0, maxY]);\n\n    zScale = d3.scaleSqrt()\n    .domain([0, maxZ])\n    .range([1, 20]);\n\n    const svg = d3.select('#bubblechart-tab').append('g').attr('transform', 'translate('+x+', '+y+')')\n    .attr('id', 'bubblechart');\n\n    // create y-axis\n    svg.append(\"g\")\n    .attr('id', 'bubbley')\n    .call(d3.axisLeft(yScale).ticks(3));\n\n    // create x-axis\n    svg.append(\"g\")\n    .attr('id', 'bubblex')\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(d3.axisBottom(xScale).ticks(3));\n\n    // Add dots\n    svg.append('g')\n    .selectAll(\".bubble\")\n    .data(data.equity_data)\n    .enter()\n    .append(\"circle\")\n    .attr(\"class\", function(d) { return \"bubble\" })\n    .attr(\"cx\", function (d) { return xScale(parseFloat(d.gni_2017)); } )\n    .attr(\"cy\", function (d) { \n        if(options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return yScale(parseFloat(d.people_vaccinated_per_hundred));\n        if(options.bubble_chart_y_axis == 'percent-fully-vaccinated') return yScale(parseFloat(d.people_fully_vaccinated_per_hundred));\n        if(options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return yScale(parseFloat(d.vaccince_acceptance_percent));\n    })\n    .attr(\"r\", function (d) { return zScale(parseFloat(d.population)); } )\n    .style(\"fill\", function (d) { \n        if(options.bubble_chart_color_by == 'region') {\n           if(colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n        } \n        if(options.bubble_chart_color_by == 'hdi') {\n            if(colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n         }\n         if(options.bubble_chart_color_by == 'inform-severity') {\n            if(colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n         }\n        return  'transparent';\n    })\n    .style(\"stroke\", function (d) { \n        if(options.bubble_chart_color_by == 'region') {\n           if(colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n        } \n        if(options.bubble_chart_color_by == 'hdi') {\n            if(colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n         }\n         if(options.bubble_chart_color_by == 'inform-severity') {\n            if(colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n         }\n        return  'transparent';\n    })\n    .style(\"stroke-width\", 2)\n    .style(\"fill-opacity\", 0.8);\n\n\n}\n\nexport function updateBubblechart(data,options,filter) {\n    \n    console.log(data);\n\n\n    data.vGroup.forEach(function(d,i){\n        data.equity_data.forEach(function(dd,ii){\n            if(d[0] == dd.country_iso3){\n                dd.people_fully_vaccinated_per_hundred = parseFloat(d[1][0].people_fully_vaccinated_per_hundred);\n                dd.people_vaccinated_per_hundred = parseFloat(d[1][0].people_vaccinated_per_hundred);\n                dd.total_vaccinations = parseFloat(d[1][0].total_vaccinations);\n                dd.total_vaccinations_per_hundred = parseFloat(d[1][0].total_vaccinations_per_hundred);\n\n            }\n        })\n    })\n\n    maxX = d3.max(data.equity_data, function(d,i){\n        return parseFloat(d.gni_2017);\n    })\n\n    maxY = d3.max(data.equity_data, function(d,i){\n        if(options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return parseFloat(d.people_vaccinated_per_hundred);\n        if(options.bubble_chart_y_axis == 'percent-fully-vaccinated') return parseFloat(d.people_fully_vaccinated_per_hundred);\n        if(options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return parseFloat(d.vaccince_acceptance_percent);\n    });\n\n    maxZ = d3.max(data.equity_data, function(d,i){\n        return parseFloat(d.population);\n    });\n\n    xScale = d3.scaleLinear()\n\t.range([0, width])\n\t.domain([0, maxX]);\n\n    yScale = d3.scaleLinear()\n\t.range([height, 0])\n\t.domain([0, maxY]);\n\n    zScale = d3.scaleSqrt()\n    .domain([0, maxZ])\n    .range([1, 20]);\n\n    const svg = d3.select('#bubblechart');\n\n    // create y-axis\n    svg.select('#bubbley')\n    .transition().duration(800)\n    .call(d3.axisLeft(yScale).ticks(3));\n\n    // create x-axis\n    svg.select('#bubblex')\n    .transition().duration(800)\n    .call(d3.axisBottom(xScale).ticks(3));\n\n    // Add dots\n    svg\n    .selectAll(\".bubble\")\n    .data(data.equity_data)\n    .data(data.equity_data)\n    .enter()\n    .append(\"circle\")\n    .transition().duration(800)\n    .attr(\"cx\", function (d) { return xScale(parseFloat(d.gni_2017)); } )\n    .attr(\"cy\", function (d) { \n        if(options.bubble_chart_y_axis == 'percent-vaccinated-at-least-1-dose') return yScale(parseFloat(d.people_vaccinated_per_hundred));\n        if(options.bubble_chart_y_axis == 'percent-fully-vaccinated') return yScale(parseFloat(d.people_fully_vaccinated_per_hundred));\n        if(options.bubble_chart_y_axis == 'percent-vaccine-acceptance') return yScale(parseFloat(d.vaccince_acceptance_percent));\n    })\n    .attr(\"r\", function (d) { return zScale(parseFloat(d.population)); } )\n    .style(\"fill\", function (d) { \n        if(options.bubble_chart_color_by == 'region') {\n           if(colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n        } \n        if(options.bubble_chart_color_by == 'hdi') {\n            if(colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n         }\n         if(options.bubble_chart_color_by == 'inform-severity') {\n            if(colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n         }\n        return  'transparent';\n    })\n    .style(\"stroke\", function (d) { \n        if(options.bubble_chart_color_by == 'region') {\n           if(colors.regions[d.ifrc_region]) return colors.regions[d.ifrc_region];\n        } \n        if(options.bubble_chart_color_by == 'hdi') {\n            if(colors.hdi_category[d.hdi_category]) return colors.hdi_category[d.hdi_category];\n         }\n         if(options.bubble_chart_color_by == 'inform-severity') {\n            if(colors.inform_severity[d.inform_severity]) return colors.inform_severity[d.inform_severity];\n         }\n        return  'transparent';\n    }).exit().remove();\n   \n\n}\n\nexport default drawBubblechart;\n"]},"metadata":{},"sourceType":"module"}