{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { filter } from './App';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\n\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { addCommas } from './HelperFunctions';\nmapboxgl.accessToken = 'pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';\nlet map;\nlet dots;\nlet maxSize = 15;\nexport function createMap(data, options, filter) {\n  d3.select('#map-refresh').attr('display', 'none').style('cursor', 'pointer').on('click', function (d, i) {\n    map.setCenter([8, 22]);\n    map.setZoom(1);\n    d3.select('#map-refresh').attr('display', 'none');\n  });\n  map = new mapboxgl.Map({\n    container: 'map_div',\n    // container ID\n    style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww',\n    // style URL\n    center: [8, 22],\n    // starting position [lng, lat]\n    zoom: 1 // starting zoom\n\n  });\n  map.setRenderWorldCopies(false);\n  map.addControl(new mapboxgl.NavigationControl());\n  map.on('zoom', function () {\n    d3.select('#map-refresh').attr('display', 'inline');\n  });\n  map.on('touchmove', function () {\n    d3.select('#map-refresh').attr('display', 'inline');\n  });\n  map.on('wheel', function () {\n    d3.select('#map-refresh').attr('display', 'inline');\n  });\n  map.on('drag', function () {\n    d3.select('#map-refresh').attr('display', 'inline');\n  });\n  var container = map.getCanvasContainer();\n  var svg = d3.select(container).append(\"svg\").attr('id', 'mapoverlay').attr(\"width\", \"100%\").attr(\"height\", \"24vw\").style(\"position\", \"absolute\").style(\"z-index\", 2); // dots = svg\n  // .selectAll(\".country-map\")\n  // .data(data.world)\n  // .enter()\n  // .append(\"circle\")\n  // .attr('class', 'country-map')\n  // .attr('id', function(d,i){ return 'country-map-'+d.iso2 })\n  // .attr(\"r\", 0)\n  // var maxValue = d3.max(data.country, function(d,i){\n  //     return d[1].cumulative_cases;\n  // })\n  // var rScale = d3.scalePow().exponent(0.5)\n  //   .domain([0, maxValue])\n  //   .range([0, 15]);\n  // data.country.forEach(function(d,i){\n  //     d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases))\n  //     .attr('data-name', d[1].country)\n  // })\n\n  document.getElementById(\"mapoverlay\").appendChild(d3.select('#map_tooltip').node());\n\n  function render() {// dots\n    //   .attr(\"cx\", function(d) {\n    //     return project(([d.lng, d.lat])).x;\n    //   })\n    //   .attr(\"cy\", function(d) {\n    //     return project(([d.lng, d.lat])).y;\n    //   });\n  }\n\n  map.on(\"viewreset\", render);\n  map.on(\"move\", render);\n  map.on(\"moveend\", render);\n  render(); // Call once to render\n\n  map.on('mousemove', function (e) {\n    var features = map.queryRenderedFeatures(e.point);\n    var displayProperties = ['type', 'properties', 'id', 'layer', 'source', 'sourceLayer', 'state'];\n    if (features.length == 1 && features[0].layer.id == 'countries') console.log(features[0].properties);\n    var displayFeatures = features.map(function (feat) {\n      var displayFeat = {};\n      displayProperties.forEach(function (prop) {\n        displayFeat[prop] = feat[prop];\n      });\n      return displayFeat;\n    });\n  });\n  map.on('load', function (e) {\n    map.setPaintProperty('countries', 'fill-color', ['match', ['get', 'ISO2'], 'IN', colors.red, colors.lightgrey]);\n  }); // updateMap(data, options) ;\n}\nexport function updateMap(data, options) {\n  var duration = 800;\n  var delay = 10;\n\n  if (options.map_toggle == 'bi-weekly-change') {\n    var maxValue = d3.max(data.country, function (d, i) {\n      return d[1].percent_change;\n    });\n    var rScale = d3.scalePow().exponent(0.5).domain([-1, 0, 1]).range([maxSize, 0, maxSize]).clamp(true);\n    d3.selectAll('.country-map').transition('c').duration(duration / 1.7).attr('r', 0);\n    data.country.forEach(function (d, i) {\n      d3.select('#country-map-' + d[0]).transition('c').duration(duration).delay(delay).attr('r', rScale(d[1].percent_change)).style('stroke', function () {\n        // if(d[1].percent_change>1){ return '#E02225'} else { return '#1F558C'}\n        return '#FFF';\n      }).style('fill', function () {\n        if (d[1].percent_change > 0) {\n          return colors.red;\n        } else {\n          return colors.blue;\n        }\n      });\n    });\n  }\n\n  if (options.map_toggle == 'cases') {\n    var maxValue = d3.max(data.country, function (d, i) {\n      return d[1].cumulative_cases;\n    });\n    var rScale = d3.scalePow().exponent(0.5).domain([0, maxValue]).range([0, maxSize]);\n    d3.selectAll('.country-map').transition('c').duration(duration / 1.7).attr('r', 0);\n    data.country.forEach(function (d, i) {\n      d3.select('#country-map-' + d[0]).transition('c').duration(duration).delay(delay).attr('r', rScale(d[1].cumulative_cases)).style('fill', colors.red).style('stroke', '#FFF');\n    });\n  }\n\n  if (options.map_toggle == 'deaths') {\n    var maxValue = d3.max(data.country, function (d, i) {\n      return d[1].cumulative_deaths;\n    });\n    var rScale = d3.scalePow().exponent(0.5).domain([0, maxValue]).range([0, maxSize]);\n    d3.selectAll('.country-map').transition('c').duration(duration / 1.7).attr('r', 0);\n    data.country.forEach(function (d, i) {\n      d3.select('#country-map-' + d[0]).transition('c').duration(duration).delay(delay).attr('r', rScale(d[1].cumulative_deaths)).style('fill', colors.red).style('stroke', '#FFF');\n    });\n  }\n\n  if (options.map_toggle == 'percent-fully-vaccinated') {\n    var maxValue = d3.max(data.vGroup, function (d, i) {\n      return parseFloat(d[1][0].people_fully_vaccinated_per_hundred) / 100;\n    });\n    var rScale = d3.scalePow().exponent(0.55).domain([0, 1]).range([1, maxSize]).clamp(true);\n    d3.selectAll('.country-map').transition('c').duration(duration / 1.7).attr('r', 0);\n    data.vGroup.forEach(function (d, i) {\n      var peoplevaccinated = parseFloat(d[1][0].people_fully_vaccinated_per_hundred) / 100;\n      if (isNaN(peoplevaccinated)) peoplevaccinated = 0;\n      d3.select('#country-map-' + d[1][0].country_code).transition('c').duration(duration).delay(delay).attr('r', rScale(peoplevaccinated)).style('stroke', '#FFF').style('fill', function () {\n        return colors.blue;\n      });\n    });\n  }\n\n  if (options.map_toggle == 'percent-vaccine-acceptance') {\n    var maxValue = d3.max(data.vGroup, function (d, i) {\n      return parseFloat(d[1][0].vaccince_acceptance_percent) / 100;\n    });\n    var rScale = d3.scalePow().exponent(1).domain([0, 1]).range([1, maxSize * .7]); // .clamp(true);\n\n    d3.selectAll('.country-map').transition('c').duration(duration / 1.7).attr('r', 0);\n    data.vGroup.forEach(function (d, i) {\n      var vaccince_acceptance_percent = parseFloat(d[1][0].vaccince_acceptance_percent / 100);\n      if (isNaN(vaccince_acceptance_percent)) vaccince_acceptance_percent = 0;\n      d3.select('#country-map-' + d[1][0].country_code).transition('c').duration(duration).delay(delay).attr('r', rScale(vaccince_acceptance_percent)).style('stroke', '#FFF').style('fill', function () {\n        return colors.blue;\n      });\n    });\n  }\n\n  function render() {\n    dots.attr(\"cx\", function (d) {\n      return project([d.lng, d.lat]).x;\n    }).attr(\"cy\", function (d) {\n      return project([d.lng, d.lat]).y;\n    });\n  }\n\n  map.on(\"viewreset\", render);\n  map.on(\"move\", render);\n  map.on(\"moveend\", render);\n  render(); // Call once to render\n  // tooltips\n\n  var mapTooltip = d3.select('#map_tooltip').attr('opacity', 1).attr('transform', 'translate(0,0)').attr('display', 'none');\n  d3.selectAll('.country-map').on('mousemove', function (event, d) {\n    var id = d3.select(this).attr('id').substr(12, 2);\n    var countryfiltered = data.equity_data.filter(d => d.country_iso2 == id);\n    var countryName;\n    if (countryfiltered[0]) countryName = countryfiltered[0].country_name;\n    mapTooltip.select('#map_tooltip_name tspan').text(countryName);\n\n    if (options.map_toggle == 'cases') {\n      var country = data.country.filter(d => d[1].country_code == id)[0];\n      if (country.length == 0) return false;\n      mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_cases) + ' cases');\n    }\n\n    if (options.map_toggle == 'deaths') {\n      var country = data.country.filter(d => d[1].country_code == id)[0];\n      if (country.length == 0) return false;\n      mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_deaths) + ' deaths');\n    }\n\n    if (options.map_toggle == 'bi-weekly-change') {\n      var country = data.country.filter(d => d[1].country_code == id)[0];\n      if (country.length == 0) return false;\n      var val = (country[1].percent_change * 100).toFixed(1);\n      var str = '';\n\n      if (val >= 0) {\n        str = '% increase';\n      } else {\n        str = '% decrease';\n      }\n\n      mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val) + str);\n    }\n\n    if (options.map_toggle == 'percent-fully-vaccinated') {\n      var country = data.vGroup.filter(d => d[1][0].country_code == id)[0][1];\n      if (!country || country.length == 0) return false;\n      mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1) + '% fully vaccinated');\n    }\n\n    if (options.map_toggle == 'percent-vaccine-acceptance') {\n      var country = data.vGroup.filter(d => d[1][0].country_code == id)[0][1];\n      if (!country || country.length == 0) return false;\n      mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].vaccince_acceptance_percent).toFixed(1) + '% vaccine acceptance');\n    }\n\n    d3.select('#map_tooltip_bg').attr('width', 0);\n    var bbox = mapTooltip.node().getBBox();\n    d3.select('#map_tooltip_bg').attr('width', parseFloat(bbox.width) + 2);\n    var scale = window.innerWidth / 1329;\n    mapTooltip.attr('display', 'inline').attr('transform', 'translate(' + project([d.lng, d.lat]).x + ',' + project([d.lng, d.lat]).y + ')scale(' + scale + ')');\n    var heightOffset = mapTooltip.node().getBBox();\n    mapTooltip.attr('transform', 'translate(' + (project([d.lng, d.lat]).x + 3) + ',' + (project([d.lng, d.lat]).y + 2 - heightOffset.height / 2) + ')scale(' + scale + ')');\n  }).on('mouseout', function (event) {\n    if (event.toElement == 'tspan') return false;\n    mapTooltip.attr('display', 'none');\n  });\n}\n\nfunction project(d) {\n  return map.project(new mapboxgl.LngLat(d[0], d[1]));\n}\n\nexport default createMap;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Map.js"],"names":["d3","moment","colors","filter","mapboxgl","addCommas","accessToken","map","dots","maxSize","createMap","data","options","select","attr","style","on","d","i","setCenter","setZoom","Map","container","center","zoom","setRenderWorldCopies","addControl","NavigationControl","getCanvasContainer","svg","append","document","getElementById","appendChild","node","render","e","features","queryRenderedFeatures","point","displayProperties","length","layer","id","console","log","properties","displayFeatures","feat","displayFeat","forEach","prop","setPaintProperty","red","lightgrey","updateMap","duration","delay","map_toggle","maxValue","max","country","percent_change","rScale","scalePow","exponent","domain","range","clamp","selectAll","transition","blue","cumulative_cases","cumulative_deaths","vGroup","parseFloat","people_fully_vaccinated_per_hundred","peoplevaccinated","isNaN","country_code","vaccince_acceptance_percent","project","lng","lat","x","y","mapTooltip","event","substr","countryfiltered","equity_data","country_iso2","countryName","country_name","text","val","toFixed","str","Math","abs","bbox","getBBox","width","scale","window","innerWidth","heightOffset","height","toElement","LngLat"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {filter} from './App';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport {addCommas} from './HelperFunctions';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';\n\nlet map;\nlet dots; \nlet maxSize = 15; \n\nexport function createMap(data, options, filter) {\n\n    d3.select('#map-refresh').attr('display', 'none').style('cursor', 'pointer')\n    .on('click', function(d,i){\n        map.setCenter([8, 22]);\n        map.setZoom(1);\n        d3.select('#map-refresh').attr('display', 'none');\n    })\n    \n    map = new mapboxgl.Map({\n        container: 'map_div', // container ID\n        style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww', // style URL\n        center: [8, 22], // starting position [lng, lat]\n        zoom: 1 // starting zoom\n    });\n\n    map.setRenderWorldCopies(false);\n    map.addControl(new mapboxgl.NavigationControl());\n    \n    map.on('zoom', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('touchmove', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('wheel', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('drag', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    var container = map.getCanvasContainer();\n\n    var svg = d3\n    .select(container)\n    .append(\"svg\")\n    .attr('id', 'mapoverlay')\n    .attr(\"width\", \"100%\")\n    .attr(\"height\", \"24vw\")\n    .style(\"position\", \"absolute\")\n    .style(\"z-index\", 2);\n\n    // dots = svg\n    // .selectAll(\".country-map\")\n    // .data(data.world)\n    // .enter()\n    // .append(\"circle\")\n    // .attr('class', 'country-map')\n    // .attr('id', function(d,i){ return 'country-map-'+d.iso2 })\n    // .attr(\"r\", 0)\n    \n\n    // var maxValue = d3.max(data.country, function(d,i){\n    //     return d[1].cumulative_cases;\n    // })\n\n    // var rScale = d3.scalePow().exponent(0.5)\n    //   .domain([0, maxValue])\n    //   .range([0, 15]);\n\n    // data.country.forEach(function(d,i){\n    //     d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases))\n    //     .attr('data-name', d[1].country)\n    // })\n    \n\n\n    document.getElementById(\"mapoverlay\").appendChild(d3.select('#map_tooltip').node());\n\n    function render() {\n        // dots\n        //   .attr(\"cx\", function(d) {\n        //     return project(([d.lng, d.lat])).x;\n        //   })\n        //   .attr(\"cy\", function(d) {\n        //     return project(([d.lng, d.lat])).y;\n        //   });\n      }\n\n    map.on(\"viewreset\", render);\n    map.on(\"move\", render);\n    map.on(\"moveend\", render);\n    render(); // Call once to render\n\n    map.on('mousemove', function (e) {\n        var features = map.queryRenderedFeatures(e.point);\n         \n        var displayProperties = [\n        'type',\n        'properties',\n        'id',\n        'layer',\n        'source',\n        'sourceLayer',\n        'state'\n        ];\n         \n        if((features.length==1)&&(features[0].layer.id=='countries'))\n        console.log(features[0].properties);\n\n        var displayFeatures = features.map(function (feat) {\n            var displayFeat = {};\n            displayProperties.forEach(function (prop) {\n            displayFeat[prop] = feat[prop];\n        });\n        return displayFeat;\n        });\n        \n        })\n\n    map.on('load', function (e) {\n        \n        map.setPaintProperty(\n            'countries', \n            'fill-color', \n            ['match', ['get', 'ISO2'], 'IN', colors.red, colors.lightgrey]\n          );\n    });\n\n    // updateMap(data, options) ;\n}\n\nexport function updateMap(data, options) {\n   \n    var duration = 800;\n    var delay = 10;\n\n\n    if(options.map_toggle == 'bi-weekly-change'){\n        \n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].percent_change;\n        })\n\n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([-1, 0, 1])\n        .range([maxSize, 0, maxSize])\n        .clamp(true);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-map-'+d[0])\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(d[1].percent_change))\n            .style('stroke', function(){\n                // if(d[1].percent_change>1){ return '#E02225'} else { return '#1F558C'}\n                return '#FFF'\n            }).style('fill', function(){\n                if(d[1].percent_change>0){ return colors.red } else { return colors.blue}\n            })\n        })\n\n    }\n\n    if(options.map_toggle == 'cases'){\n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].cumulative_cases;\n        })\n\n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([0, maxValue])\n        .range([0, maxSize]);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-map-'+d[0])\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(d[1].cumulative_cases))\n            .style('fill', colors.red)\n            .style('stroke', '#FFF');\n        })\n\n    }\n    \n    if(options.map_toggle == 'deaths'){\n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].cumulative_deaths;\n        })\n\n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([0, maxValue])\n        .range([0, maxSize]);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-map-'+d[0])\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(d[1].cumulative_deaths))\n            .style('fill', colors.red)\n            .style('stroke', '#FFF');\n        })\n\n    }\n\n    if(options.map_toggle == 'percent-fully-vaccinated'){\n        var maxValue = d3.max(data.vGroup, function(d,i){\n            return parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n        })\n\n        var rScale = d3.scalePow().exponent(0.55)\n        .domain([0, 1])\n        .range([1, maxSize])\n        .clamp(true);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.vGroup.forEach(function(d,i){\n            var peoplevaccinated = parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n            if(isNaN(peoplevaccinated)) peoplevaccinated = 0;\n            d3.select('#country-map-'+d[1][0].country_code)\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(peoplevaccinated))\n            .style('stroke', '#FFF')\n            .style('fill', function(){\n                return colors.blue;\n            })\n        })\n\n        \n    }\n\n    if(options.map_toggle == 'percent-vaccine-acceptance'){\n        var maxValue = d3.max(data.vGroup, function(d,i){\n            return parseFloat(d[1][0].vaccince_acceptance_percent)/100;\n        })\n\n        \n        var rScale = d3.scalePow().exponent(1)\n        .domain([0, 1])\n        .range([1, maxSize*.7])\n        // .clamp(true);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.vGroup.forEach(function(d,i){\n            var vaccince_acceptance_percent = parseFloat(d[1][0].vaccince_acceptance_percent/100);\n            \n            if(isNaN(vaccince_acceptance_percent)) vaccince_acceptance_percent = 0;\n\n            d3.select('#country-map-'+d[1][0].country_code)\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(vaccince_acceptance_percent))\n            .style('stroke', '#FFF')\n            .style('fill', function(){\n                return colors.blue;\n            })\n        })\n\n    }\n\n    function render() {\n        dots\n          .attr(\"cx\", function(d) {\n            return project(([d.lng, d.lat])).x;\n          })\n          .attr(\"cy\", function(d) {\n            return project(([d.lng, d.lat])).y;\n          });\n      }\n\n    map.on(\"viewreset\", render);\n    map.on(\"move\", render);\n    map.on(\"moveend\", render);\n    render(); // Call once to render\n\n    // tooltips\n\n    var mapTooltip = d3.select('#map_tooltip').attr('opacity', 1).attr('transform', 'translate(0,0)').attr('display', 'none');\n\n    d3.selectAll('.country-map').on('mousemove', function(event, d){\n\n        var id = d3.select(this).attr('id').substr(12,2);\n        var countryfiltered = data.equity_data.filter(d=>d.country_iso2 == id);\n        var countryName;\n        if(countryfiltered[0]) countryName = countryfiltered[0].country_name;\n\n        mapTooltip.select('#map_tooltip_name tspan').text(countryName);\n\n        if(options.map_toggle=='cases'){\n            var country = data.country.filter(d=>d[1].country_code == id)[0];\n            if(country.length==0) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_cases)+' cases');\n        }\n\n        if(options.map_toggle=='deaths'){\n            var country = data.country.filter(d=>d[1].country_code == id)[0];\n            if(country.length==0) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_deaths)+' deaths');\n        }\n\n        if(options.map_toggle=='bi-weekly-change'){\n            var country = data.country.filter(d=>d[1].country_code == id)[0];\n            if(country.length==0) return false;\n            var val = ((country[1].percent_change)*100).toFixed(1);\n            var str = '';\n            if(val>=0){\n                str = '% increase';\n            } else {\n                str = '% decrease';\n            }\n            mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);\n        }\n\n        if(options.map_toggle=='percent-fully-vaccinated'){\n            var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n            if((!country)||(country.length==0)) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1)+'% fully vaccinated');\n        }\n\n        if(options.map_toggle=='percent-vaccine-acceptance'){\n            var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n            if((!country)||(country.length==0)) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].vaccince_acceptance_percent).toFixed(1)+'% vaccine acceptance');\n        }\n\n\n        d3.select('#map_tooltip_bg').attr('width', 0)\n\n        var bbox = mapTooltip.node().getBBox();\n        d3.select('#map_tooltip_bg').attr('width', (parseFloat(bbox.width)+2))\n        var scale = window.innerWidth/1329;\n        mapTooltip\n        .attr('display', 'inline')\n        .attr('transform', 'translate('+project(([d.lng, d.lat])).x+','+project(([d.lng, d.lat])).y+')scale('+scale+')');\n\n        var heightOffset = mapTooltip.node().getBBox();\n        mapTooltip.attr('transform', 'translate('+(project(([d.lng, d.lat])).x+3)+','+(project(([d.lng, d.lat])).y+2-heightOffset.height/2)+')scale('+scale+')');\n\n    }).on('mouseout', function(event){\n        if(event.toElement=='tspan') return false;\n        mapTooltip.attr('display', 'none');\n    })\n\n}\n\nfunction project(d) {\n    return map.project(new mapboxgl.LngLat(d[0], d[1]));\n}\n\n\nexport default createMap;\n"]},"metadata":{},"sourceType":"module"}