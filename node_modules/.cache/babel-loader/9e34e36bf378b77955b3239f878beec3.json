{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{nFormatter}from'./HelperFunctions';var yScaleCases;var yScaleDeaths;var yScaleVaccines;var yAxisCases;var yAxisDeaths;var yAxisVaccines;var yScaleCasesAxis;var yScaleDeathsAxis;var yScaleVaccinesAxis;var xScale;var xAxis;var xScaleAxis;var regions=['AF','ME','AP','EU','AM','OTH'];export function drawTimechart(data,options){var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});var vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\ndata.vaccines_data=data.vaccines_data_daily;data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\ndata.vaccines_data=[];if(options.timeline_frequency==='day'){data.vaccines_data=data.vaccines_data_cumulative;}if(options.timeline_frequency==='week'){data.vaccines_data_cumulative.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||d.date==options.maxDate){data.vaccines_data.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(options.maxDate).startOf('day').unix();data.vaccines_data_cumulative.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||options.maxDate!=endOfMonthDate&&date==maxDateUnix){data.vaccines_data.push(d);}});}data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});// define date range\n// const minDate = groupedData[0].date;\n// const maxDate = groupedData[numIntervals].date;\nvar minDate=groupedData[0].date;var maxDate=options.maxDate;var md=moment(maxDate);if(options.timeline_frequency==='month')md=md.add(1,'months');if(options.timeline_frequency==='week')md=md.add(1,'weeks');if(options.timeline_frequency==='day')md=md.add(1,'days');var svg=d3.select('#timechart_svg');svg.selectAll('g').remove();d3.selectAll('#layout .yAxis').remove();d3.selectAll('#yAxis').remove();d3.selectAll('#layout .xAxis').remove();var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\nxScale=d3.scaleTime().range([0,width]).domain([minDate,md]);xScaleAxis=d3.scaleTime().range([0,596]).domain([minDate,md]);// xScaleAxis = d3.scaleTime()\n// .range([35,596])\n// .domain([minDate,maxDate]);\nyScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nxAxis=d3.axisBottom().scale(xScaleAxis).tickSize(2).tickPadding(3);// if(options.timeline_frequency=='month')\n// xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n// if(options.timeline_frequency=='week')\n// xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisGroup=d3.select('#layout').append(\"g\").attr('id','yAxis').attr('clip-path','url(#mask)');var yAxisCasesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"casesAxis\").attr('transform','translate(620,363)').call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"deathsAxis\").attr('transform','translate(620,534)').call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"VaccinesAxis\").attr('transform','translate(620,707.5)').call(yAxisVaccines);// x-axis cases\nvar xAxisCases=yAxisGroup.append('g').attr(\"id\",\"casesXAxis\").attr('class','xAxis').attr('transform','translate(24,504)').call(xAxis);var xAxisDeaths=yAxisGroup.append('g').attr(\"id\",\"deathsXAxis\").attr('class','xAxis').attr('transform','translate(24,674)').call(xAxis);var xAxisVaccines=yAxisGroup.append('g').attr(\"id\",\"vaccinesXAxis\").attr('class','xAxis').attr('transform','translate(24,848)').call(xAxis);var xAxisTimeline=yAxisGroup.append('g').attr(\"id\",\"timelineXAxis\").attr('class','xAxis').attr('transform','translate(24,908)').call(xAxis);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).enter().append('g').attr('class','bar_group').attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar cases_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar deaths_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).enter().append('g').attr('class','vbar_group').attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class','timeBar vaccines_bar').attr('class',function(d,i){return'timeBar vaccines_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});if(options.timeline_frequency==='month'){vbarGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}}export function updateTimechart(data,options){var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});var vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\ndata.vaccines_data=data.vaccines_data_daily;data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\ndata.vaccines_data=[];if(options.timeline_frequency==='day'){data.vaccines_data=data.vaccines_data_cumulative;}if(options.timeline_frequency==='week'){data.vaccines_data_cumulative.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||d.date==options.maxDate){data.vaccines_data.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(options.maxDate).startOf('day').unix();data.vaccines_data_cumulative.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||options.maxDate!=endOfMonthDate&&date==maxDateUnix){data.vaccines_data.push(d);}});}data.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});// define date range\n// const minDate = groupedData[0].date;\n// const maxDate = groupedData[numIntervals].date;\nvar minDate;if(groupedData.length>0){minDate=groupedData[0].date;}else{minDate=options.minDate;}var maxDate=options.maxDate;var md=moment(maxDate);if(options.timeline_frequency==='month')md=md.add(1,'months');if(options.timeline_frequency==='week')md=md.add(1,'weeks');if(options.timeline_frequency==='day')md=md.add(1,'days');var svg=d3.select('#timechart_svg');var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\nxScale=d3.scaleTime().range([0,width]).domain([minDate,md]);xScaleAxis=d3.scaleTime().range([23,596]).domain([minDate,md]);yScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisCasesText=d3.select('#casesAxis').transition().duration(500).call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=d3.select('#deathsAxis').transition().duration(500).call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=d3.select('#VaccinesAxis').transition().duration(500).call(yAxisVaccines);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];return'blue';});// // DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(groupedData.length==0){d3.selectAll('.cases_bar').transition().duration(500).attr('y',140).attr('height',0);d3.selectAll('.deaths_bar').transition().duration(500).attr('y',140+170).attr('height',0);}// // VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).attr('data-date',function(d){return d.date;}).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(vgroupedData.length==0){d3.selectAll('.vaccines_bar').transition().duration(500).attr('y',140).attr('height',0);}// // bar size tweak for spacing\n// if(options.timeline_frequency==='month'){\n//     barGroups.selectAll(\".timeBar\")\n//     .attr(\"width\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(1-barSpacing);\n//       })\n//     .attr(\"x\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(barSpacing/2);\n//       })\n//     }\n}export default drawTimechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Timechart.js"],"names":["d3","moment","colors","nFormatter","yScaleCases","yScaleDeaths","yScaleVaccines","yAxisCases","yAxisDeaths","yAxisVaccines","yScaleCasesAxis","yScaleDeathsAxis","yScaleVaccinesAxis","xScale","xAxis","xScaleAxis","regions","drawTimechart","data","options","groupedData","who_data","forEach","d","i","timeline_frequency","date","week_start","month_start","ifrc_region","new_cases","new_deaths","cumulative_cases","cumulative_deaths","dd","ii","hasOwnProperty","total_new_cases","AF","AP","AM","EU","ME","OTH","total_cumulative_cases","total_new_deaths","total_cumulative_deaths","region","push","vgroupedData","timeline_type","vaccines_data","vaccines_data_daily","new_vaccines","daily_vaccinations","cumulative_vaccines","total_new_vaccines","vaccines_data_cumulative","endOfWeekDate","endOf","startOf","unix","maxDate","maxDateUnix","endOfMonthDate","total_vaccinations","total_cumulative_vaccines","filter","el","numIntervals","max","maxCases","maxDeaths","maxVaccines","minDate","md","add","svg","select","selectAll","remove","width","barWidth","barSpacing","scaleTime","range","domain","scaleLinear","axisBottom","scale","tickSize","tickPadding","axisRight","ticks","tickFormat","yAxisGroup","append","attr","yAxisCasesText","call","yAxisDeathsText","yAxisVaccinesText","xAxisCases","xAxisDeaths","xAxisVaccines","xAxisTimeline","barGroups","enter","totalNewCases","parentNode","datum","dp","y","totalNewDeaths","next","timeMonth","offset","vbarGroups","totalNewVaccines","updateTimechart","toDate","length","transition","duration"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {nFormatter} from './HelperFunctions';\n\nlet yScaleCases;\nlet yScaleDeaths;\nlet yScaleVaccines;\nlet yAxisCases;\nlet yAxisDeaths;\nlet yAxisVaccines;\nlet yScaleCasesAxis;\nlet yScaleDeathsAxis;\nlet yScaleVaccinesAxis;\nlet xScale;\nlet xAxis; \nlet xScaleAxis;\n\nconst regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n\nexport function drawTimechart(data, options) {\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    let vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        data.vaccines_data = [];\n        if(options.timeline_frequency==='day') {\n            data.vaccines_data = data.vaccines_data_cumulative;\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(d.date==options.maxDate)){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(options.maxDate).startOf('day').unix();\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((options.maxDate!=endOfMonthDate)&&(date==maxDateUnix))){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n    const minDate = groupedData[0].date;\n    const maxDate = options.maxDate;\n    let md = moment(maxDate);\n\n    if(options.timeline_frequency==='month') md = md.add(1, 'months');\n    if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\n    if(options.timeline_frequency==='day') md = md.add(1, 'days');\n\n    const svg = d3.select('#timechart_svg');\n    svg.selectAll('g').remove();\n    d3.selectAll('#layout .yAxis').remove();\n    d3.selectAll('#yAxis').remove();\n    d3.selectAll('#layout .xAxis').remove();\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    xScale = d3.scaleTime()\n    .range([0,width])\n    .domain([minDate,md]);\n\n    xScaleAxis = d3.scaleTime()\n    .range([0,596])\n    .domain([minDate,md]);\n\n    // xScaleAxis = d3.scaleTime()\n    // .range([35,596])\n    // .domain([minDate,maxDate]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    \n    xAxis = d3.axisBottom()\n    .scale(xScaleAxis)\n    .tickSize(2)\n    .tickPadding(3);\n\n    // if(options.timeline_frequency=='month')\n    // xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n\n    // if(options.timeline_frequency=='week')\n    // xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\n\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisGroup = d3.select('#layout').append(\"g\").attr('id', 'yAxis').attr('clip-path', 'url(#mask)');\n\n    var yAxisCasesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"casesAxis\")\n    .attr('transform', 'translate(620,363)')\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"deathsAxis\")\n    .attr('transform', 'translate(620,534)')\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"VaccinesAxis\")\n    .attr('transform', 'translate(620,707.5)')\n    .call(yAxisVaccines);\n\n    // x-axis cases\n    var xAxisCases = yAxisGroup.append('g')\n    .attr(\"id\", \"casesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,504)')\n    .call(xAxis);\n\n    var xAxisDeaths = yAxisGroup.append('g')\n    .attr(\"id\", \"deathsXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,674)')\n    .call(xAxis);\n\n    var xAxisVaccines = yAxisGroup.append('g')\n    .attr(\"id\", \"vaccinesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,848)')\n    .call(xAxis);\n\n    var xAxisTimeline = yAxisGroup.append('g')\n    .attr(\"id\", \"timelineXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,908)')\n    .call(xAxis);\n\n\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'bar_group')\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar cases_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    })\n\n    // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar deaths_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n            })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n            })\n        }\n\n    // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'vbar_group')\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n   \n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', 'timeBar vaccines_bar')\n    .attr('class', function(d,i) { return 'timeBar vaccines_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    if(options.timeline_frequency==='month'){\n    vbarGroups.selectAll(\".timeBar\")\n    .attr(\"width\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(1-barSpacing);\n        })\n    .attr(\"x\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(barSpacing/2);\n        })\n    }\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n          })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n          })\n        }\n\n}\n\nexport function updateTimechart(data, options) {\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    let vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        data.vaccines_data = [];\n        if(options.timeline_frequency==='day') {\n            data.vaccines_data = data.vaccines_data_cumulative;\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(d.date==options.maxDate)){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(options.maxDate).startOf('day').unix();\n            data.vaccines_data_cumulative.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((options.maxDate!=endOfMonthDate)&&(date==maxDateUnix))){\n                    data.vaccines_data.push(d);\n                }\n            })\n        }\n\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n    let minDate;\n    if(groupedData.length>0){\n        minDate = groupedData[0].date;\n    } else {\n        minDate = options.minDate;\n    }\n\n    const maxDate = options.maxDate;\n    let md = moment(maxDate);\n\n    if(options.timeline_frequency==='month') md = md.add(1, 'months');\n    if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\n    if(options.timeline_frequency==='day') md = md.add(1, 'days');\n\n    const svg = d3.select('#timechart_svg');\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    xScale = d3.scaleTime()\n    .range([0,width])\n    .domain([minDate,md]);\n\n    xScaleAxis = d3.scaleTime()\n    .range([23,596])\n    .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    \n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisCasesText = d3.select('#casesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = d3.select('#deathsAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = d3.select('#VaccinesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisVaccines);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n        return 'blue'\n    })\n\n    // // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n\n    if(groupedData.length==0){\n        d3.selectAll('.cases_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n\n        d3.selectAll('.deaths_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140+170)\n        .attr('height', 0)\n        \n    }\n    // // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .attr('data-date', function(d){ return d.date})\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n\n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    });\n\n    if(vgroupedData.length==0){\n        d3.selectAll('.vaccines_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n    }\n   \n    // // bar size tweak for spacing\n    // if(options.timeline_frequency==='month'){\n    //     barGroups.selectAll(\".timeBar\")\n    //     .attr(\"width\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(1-barSpacing);\n    //       })\n    //     .attr(\"x\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(barSpacing/2);\n    //       })\n    //     }\n\n}\n\nexport default drawTimechart;\n"]},"metadata":{},"sourceType":"module"}