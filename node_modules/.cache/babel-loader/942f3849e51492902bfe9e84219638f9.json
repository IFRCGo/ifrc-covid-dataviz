{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{addCommas}from'./HelperFunctions';import{filter}from'./App';var maxCases;var maxDeaths;var maxVaccinations;var xScaleCases;var xScaleDeaths;var xScaleVaccines;var labelWidth;var margin={left:20,top:0,right:58};var rcSize;var groupedData=[];export function drawRegionchart(data,options,filter){var barSpacing=0.1;// reset region values to zero\ndata.regions.forEach(function(d,i){d.population=0;d.cumulative_deaths=0;d.cumulative_cases=0;d.cumulative_vaccines=0;});// loop through countries and calculate region totals\ndata.country.forEach(function(d,i){data.regions.forEach(function(dd,ii){if(dd.code==d.ifrc_region){if(d.population>0&&d.who_daily_latest){if(d.who_daily_latest.cumulative_cases>0)dd.cumulative_cases+=d.who_daily_latest.cumulative_cases;if(d.who_daily_latest.cumulative_deaths>0)dd.cumulative_deaths+=d.who_daily_latest.cumulative_deaths||0;dd.population+=d.population;}if(d.population>0&&d.vaccine_daily_latest){dd.cumulative_vaccines+=d.vaccine_daily_latest.total_vaccinations||0;}}});});// calculate regions per 100k values using total population for each region\ndata.regions.forEach(function(d,i){d.cumulative_cases_per_100k=d.cumulative_cases/(d.population/100000);d.cumulative_deaths_per_100k=d.cumulative_deaths/(d.population/100000);d.cumulative_vaccines_per_100k=d.cumulative_vaccines/(d.population/100000);if(!isFinite(d.cumulative_cases_per_100k))d.cumulative_cases_per_100k=0;if(!isFinite(d.cumulative_deaths_per_100k))d.cumulative_deaths_per_100k=0;if(!isFinite(d.cumulative_vaccines_per_100k))d.cumulative_vaccines_per_100k=0;});// get maximum values for each series\nif(options.region_switch=='per100'){// get maximum values for each series\nmaxVaccinations=d3.max(data.regions,function(d,i){return d.cumulative_vaccines_per_100k;});maxCases=d3.max(data.regions,function(d,i){return d.cumulative_cases_per_100k;});maxDeaths=d3.max(data.regions,function(d,i){return d.cumulative_deaths_per_100k;});}else{// get maximum values for each series\nmaxVaccinations=d3.max(data.regions,function(d,i){return d.cumulative_vaccines;});maxCases=d3.max(data.regions,function(d,i){return d.cumulative_cases;});maxDeaths=d3.max(data.regions,function(d,i){return d.cumulative_deaths;});}// append region chart container\nvar regionChartContainer=d3.select('#layout #region_chart_container').attr('opacity',0);// get dimensions\nrcSize={x:regionChartContainer.attr('x'),y:regionChartContainer.attr('y'),width:regionChartContainer.attr('width'),height:regionChartContainer.attr('height')};// create svg container\nvar svg=d3.select('#layout').append('g').attr('transform','translate('+rcSize.x+', '+rcSize.y+')').attr('id','region_chart');// calculate chart row height\nvar rowHeight=rcSize.height/(data.regions.length-1);// remove OTH\n// create rows\nvar rows=svg.selectAll('.bar-row').data(data.regions.filter(function(d){return d.code!=='OTH';})).enter().append('g').attr('class','bar-row').attr('transform',function(d,i){return'translate(0,'+(i*rowHeight+margin.top)+')';});// create region labels\nvar label=rows.append('text').attr('y',rowHeight/2).attr('x',margin.left-5).attr('class',function(d,i){return'bar-labels bar-label-'+d.code;}).style('alignment-baseline','middle').style('font-size','11px').attr('opacity',1).attr('fill','#000').text(function(d,i){if(d.code==='AM')return'Americas';if(d.code==='EU')return'Europe';if(d.code==='AF')return'Africa';if(d.code==='ME')return'Middle East and North Africa';if(d.code==='AP')return'Asia-Pacific';}).style('text-anchor','end');// get label node width for use in scale\nlabelWidth=rows.node().getBBox().width+margin.left;label.attr('x',labelWidth+89);labelWidth=labelWidth+94;d3.selectAll('.timeBar').attr('opacity',1);// create fading background click area\nvar rowBg=rows.append('rect').attr('y',0).attr('x',0).attr('width',labelWidth).attr('height',rowHeight-2).style('opacity',0).attr('fill','grey').style('cursor','pointer').attr('class',function(d,i){return'bar-bg-'+d.code;}).attr('data-id',function(d,i){return d.code;}).on('mouseover',function(d){d3.select(this).style('opacity',0.1);}).on('mouseout',function(){d3.select(this).style('opacity',0);}).on('click',function(d,i){var t=d3.select(this).attr('data-id');filter([t],'regionchart');});// define scales\nxScaleCases=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxCases]);xScaleDeaths=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxDeaths]);xScaleVaccines=d3.scaleLinear().range([labelWidth,rcSize.width-margin.right-labelWidth]).domain([0,maxVaccinations]);var bars=rows.append('rect').attr('id',function(d,i){return'bar-'+d.code;}).attr('data-id',function(d,i){return d.code;}).attr('class','region-bar').attr('width',function(d,i){var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases_per_100k);if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths_per_100k);if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines_per_100k);}else{if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases);if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths);if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines);}if(!isNaN(val)){return parseFloat(val);}else{return 0;}}).attr('x',labelWidth).style('outline','none').style('cursor','pointer').attr('y',rowHeight*barSpacing-1).attr('height',rowHeight-rowHeight*barSpacing*2).style('fill',function(d){return colors.regions[d.code];}).attr('opacity',1).on('click',function(d,i){var t=d3.select(this).attr('data-id');filter([t],'regionchart');}).on('mouseover',function(d){var dat=d3.select(this.parentNode).datum();// d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n// d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n}).on('mouseout',function(){// d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n});// create data value labels\nvar dataLabel=rows.append('text').text(function(d){var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=Math.round(d.cumulative_cases_per_100k);if(options.region_chart_toggle=='deaths')val=Math.round(d.cumulative_deaths_per_100k);if(options.region_chart_toggle=='vaccines')val=Math.round(d.cumulative_vaccines_per_100k);}else{if(options.region_chart_toggle=='cases')val=Math.round(d.cumulative_cases);if(options.region_chart_toggle=='deaths')val=Math.round(d.cumulative_deaths);if(options.region_chart_toggle=='vaccines')val=Math.round(d.cumulative_vaccines);}return addCommas(val);}).attr('id',function(d,i){return'data-label'+d.code;}).attr('data-id',function(d,i){return d.code;}).attr('class','data-label').attr('y',rowHeight/2).style('alignment-baseline','middle').style('text-anchor','start').attr('x',function(d,i){var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;}else{if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases)+labelWidth+5;if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths)+labelWidth+5;if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;}return val;}).attr('opacity',function(d,i){var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=d.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')val=d.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')val=d.cumulative_vaccines_per_100k;}else{if(options.region_chart_toggle=='cases')val=d.cumulative_cases;if(options.region_chart_toggle=='deaths')val=d.cumulative_deaths;if(options.region_chart_toggle=='vaccines')val=d.cumulative_vaccines;}if(val>0){return 1;}else{return 0;}}).style('fill','#696969').style('font-weight','normal').style('font-size','10px');}export function updateRegionchart(options,data){// reset region values to zero\ndata.regions.forEach(function(d,i){d.population=0;d.cumulative_deaths=0;d.cumulative_cases=0;d.cumulative_vaccines=0;});// loop through countries and calculate region totals\ndata.country.forEach(function(d,i){data.regions.forEach(function(dd,ii){if(dd.code==d.ifrc_region){if(d.population>0&&d.who_daily_latest){if(d.who_daily_latest.cumulative_cases>0)dd.cumulative_cases+=d.who_daily_latest.cumulative_cases;if(d.who_daily_latest.cumulative_deaths>0)dd.cumulative_deaths+=d.who_daily_latest.cumulative_deaths||0;dd.population+=d.population;}if(d.population>0&&d.vaccine_daily_latest){dd.cumulative_vaccines+=d.vaccine_daily_latest.total_vaccinations||0;}}});});// calculate regions per 100k values using total population for each region\ndata.regions.forEach(function(d,i){d.cumulative_cases_per_100k=d.cumulative_cases/(d.population/100000);d.cumulative_deaths_per_100k=d.cumulative_deaths/(d.population/100000);d.cumulative_vaccines_per_100k=d.cumulative_vaccines/(d.population/100000);if(!isFinite(d.cumulative_cases_per_100k))d.cumulative_cases_per_100k=0;if(!isFinite(d.cumulative_deaths_per_100k))d.cumulative_deaths_per_100k=0;if(!isFinite(d.cumulative_vaccines_per_100k))d.cumulative_vaccines_per_100k=0;});if(options.region_switch=='per100'){// get maximum values for each series\nmaxVaccinations=d3.max(data.regions,function(d,i){return d.cumulative_vaccines_per_100k;});maxCases=d3.max(data.regions,function(d,i){return d.cumulative_cases_per_100k;});maxDeaths=d3.max(data.regions,function(d,i){return d.cumulative_deaths_per_100k;});}else{// get maximum values for each series\nmaxVaccinations=d3.max(data.regions,function(d,i){return d.cumulative_vaccines;});maxCases=d3.max(data.regions,function(d,i){return d.cumulative_cases;});maxDeaths=d3.max(data.regions,function(d,i){return d.cumulative_deaths;});}// redefine scales using new extent\nxScaleCases=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxCases]);xScaleDeaths=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxDeaths]);xScaleVaccines=d3.scaleLinear().range([0,rcSize.width-margin.right-labelWidth]).domain([0,maxVaccinations]);// update bars\nif(maxVaccinations==0&&maxCases==0&&maxDeaths==0){d3.selectAll('.region-bar').transition().duration(500).attr('width',0);d3.selectAll('.data-label').transition().duration(500).attr('x',labelWidth).attr('opacity',0);}else{d3.selectAll('.region-bar').transition().duration(500).style('fill',function(d){return colors.regions[d.code];if(options.region_chart_toggle=='vaccines'){return colors.regions_blue[d.code];}else{return colors.regions[d.code];}}).attr('width',function(d,i){var id=d3.select(this).attr('data-id');var d;groupedData.forEach(function(dd,ii){if(dd.code==id){d=dd;}});var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases_per_100k);if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths_per_100k);if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines_per_100k);}else{if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases);if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths);if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines);}if(!isNaN(val)){return parseFloat(val);}else{return 0;}});d3.selectAll('.data-label').transition().duration(500).tween(\"text\",function(d,i){var val=0;var id=d3.select(this).attr('data-id');var d;groupedData.forEach(function(dd,ii){if(dd.code==id){d=dd;}});if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=Math.round(d.cumulative_cases_per_100k);if(options.region_chart_toggle=='deaths')val=Math.round(d.cumulative_deaths_per_100k);if(options.region_chart_toggle=='vaccines')val=Math.round(d.cumulative_vaccines_per_100k);}else{if(options.region_chart_toggle=='cases')val=Math.round(d.cumulative_cases);if(options.region_chart_toggle=='deaths')val=Math.round(d.cumulative_deaths);if(options.region_chart_toggle=='vaccines')val=Math.round(d.cumulative_vaccines);}var i=d3.interpolate(Math.floor(Math.random()*2346+9345),val);return function(t){d3.select(this).text(addCommas(Math.round(i(t))));};}).attr('x',function(d,i){var id=d3.select(this).attr('data-id');var d;groupedData.forEach(function(dd,ii){if(dd.code==id){d=dd;}});var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;}else{if(options.region_chart_toggle=='cases')val=xScaleCases(d.cumulative_cases)+labelWidth+5;if(options.region_chart_toggle=='deaths')val=xScaleDeaths(d.cumulative_deaths)+labelWidth+5;if(options.region_chart_toggle=='vaccines')val=xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;}return val;}).attr('opacity',function(d,i){var d;var id=d3.select(this).attr('data-id');groupedData.forEach(function(dd,ii){if(dd.code==id){d=dd;}});var val=0;if(options.region_switch=='per100'){if(options.region_chart_toggle=='cases')val=d.cumulative_cases_per_100k;if(options.region_chart_toggle=='deaths')val=d.cumulative_deaths_per_100k;if(options.region_chart_toggle=='vaccines')val=d.cumulative_vaccines_per_100k;}else{if(options.region_chart_toggle=='cases')val=d.cumulative_cases;if(options.region_chart_toggle=='deaths')val=d.cumulative_deaths;if(options.region_chart_toggle=='vaccines')val=d.cumulative_vaccines;}if(val>0){return 1;}else{return 0;}});}}export default drawRegionchart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Regionchart.js"],"names":["d3","moment","colors","addCommas","filter","maxCases","maxDeaths","maxVaccinations","xScaleCases","xScaleDeaths","xScaleVaccines","labelWidth","margin","left","top","right","rcSize","groupedData","drawRegionchart","data","options","barSpacing","regions","forEach","d","i","population","cumulative_deaths","cumulative_cases","cumulative_vaccines","country","dd","ii","code","ifrc_region","who_daily_latest","vaccine_daily_latest","total_vaccinations","cumulative_cases_per_100k","cumulative_deaths_per_100k","cumulative_vaccines_per_100k","isFinite","region_switch","max","regionChartContainer","select","attr","x","y","width","height","svg","append","rowHeight","length","rows","selectAll","enter","label","style","text","node","getBBox","rowBg","on","t","scaleLinear","range","domain","bars","val","region_chart_toggle","isNaN","parseFloat","dat","parentNode","datum","dataLabel","Math","round","updateRegionchart","transition","duration","regions_blue","id","tween","interpolate","floor","random"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {addCommas} from './HelperFunctions';\nimport {filter} from './App';\n\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases; \nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth; \nconst margin = { left: 20, top: 0, right: 58 };\nlet rcSize; \nlet groupedData = [];\n\nexport function drawRegionchart(data, options, filter) {\n\n    const barSpacing = 0.1;\n\n    // reset region values to zero\n    data.regions.forEach(function(d,i){\n        d.population = 0;\n        d.cumulative_deaths = 0;\n        d.cumulative_cases = 0;\n        d.cumulative_vaccines = 0;\n    })\n\n    // loop through countries and calculate region totals\n    data.country.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ \n                if((d.population>0)&&(d.who_daily_latest)){\n                    if(d.who_daily_latest.cumulative_cases>0)\n                    dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n                    if(d.who_daily_latest.cumulative_deaths>0)\n                    dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths||0;\n                    dd.population += d.population;\n                }\n                if((d.population>0)&&(d.vaccine_daily_latest)){\n                    dd.cumulative_vaccines += (d.vaccine_daily_latest.total_vaccinations)||0;\n                }\n            }\n        });\n    });\n\n    // calculate regions per 100k values using total population for each region\n    data.regions.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    // get maximum values for each series\n    if(options.region_switch=='per100'){\n        // get maximum values for each series\n        maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines_per_100k;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases_per_100k;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths_per_100k;\n        });\n    } else {\n         // get maximum values for each series\n         maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths;\n        });\n    }\n\n    // append region chart container\n    const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n\n    // get dimensions\n    rcSize = {\n        x: regionChartContainer.attr('x'), y: regionChartContainer.attr('y'), width: regionChartContainer.attr('width'), height: regionChartContainer.attr('height')\n    }\n\n    // create svg container\n    const svg = d3.select('#layout').append('g').attr('transform', 'translate('+rcSize.x+', '+rcSize.y+')')\n    .attr('id', 'region_chart');\n\n    // calculate chart row height\n\tvar rowHeight = rcSize.height/(data.regions.length-1); // remove OTH\n\n    // create rows\n    var rows = svg.selectAll('.bar-row')\n\t.data(data.regions.filter(d=>d.code!=='OTH'))\n\t.enter()\n\t.append('g')\n\t.attr('class', 'bar-row')\n\t.attr('transform', function(d,i){\n\t\treturn 'translate(0,' + ((i*rowHeight) + margin.top) + ')';\n\t});\n\n    // create region labels\n    var label = rows.append('text')\n\t.attr('y', rowHeight/2 )\n    .attr('x', margin.left-5)\n\t.attr('class', function(d,i){ return 'bar-labels bar-label-'+d.code })\n\t.style('alignment-baseline', 'middle')\n\t.style('font-size', '11px')\n    .attr('opacity', 1)\n\t.attr('fill', '#000')\n\t.text(function(d,i){\n\t\tif(d.code==='AM') return 'Americas';\n\t\tif(d.code==='EU') return 'Europe';\n\t\tif(d.code==='AF') return 'Africa';\n\t\tif(d.code==='ME') return 'Middle East and North Africa';\n\t\tif(d.code==='AP') return 'Asia-Pacific';\n\t}).style('text-anchor', 'end');\n\n    // get label node width for use in scale\n    labelWidth = rows.node().getBBox().width + margin.left;\n\tlabel.attr('x', labelWidth+89);\n\tlabelWidth = labelWidth + 94;\n    d3.selectAll('.timeBar').attr('opacity',1);\n    \n    // create fading background click area\n    var rowBg = rows.append('rect')\n\t.attr('y', 0)\n\t.attr('x', 0)\n\t.attr('width', labelWidth)\n\t.attr('height', rowHeight-2)\n\t.style('opacity', 0)\n    .attr('fill', 'grey')\n\t.style('cursor', 'pointer')\n\t.attr('class', function(d,i){ return 'bar-bg-'+d.code })\n\t.attr('data-id', function(d,i){ return d.code })\n\t.on('mouseover', function(d){\n\t\td3.select(this).style('opacity', 0.1);\n\t})\n\t.on('mouseout', function(){\n\t\td3.select(this).style('opacity', 0);\n\t})\n\t.on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    });\n\n    // define scales\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([labelWidth, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    var bars = rows.append('rect')\n    .attr('id', function(d,i){\n        return 'bar-'+d.code;\n    })\n\t.attr('data-id', function(d,i){ return d.code })\n    .attr('class', 'region-bar')\n    .attr('width', function(d,i){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n        } else {\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);                \n        }\n        if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n    })\n    .attr('x', labelWidth)\n    .style('outline', 'none')\n    .style('cursor', 'pointer')\n    .attr('y', rowHeight*barSpacing - 1)\n    .attr('height', rowHeight-((rowHeight*barSpacing)*2))\n    .style('fill', function(d){\n        return colors.regions[d.code]\n    })\n    .attr('opacity',1)\n    .on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    })\n    .on('mouseover', function(d){\n        var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\n    // create data value labels\n    var dataLabel = rows.append('text')\n\t.text(function(d){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases_per_100k));\n            if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths_per_100k));\n            if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines_per_100k));\n        } else {\n            if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases));\n            if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths));\n            if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines));             \n        }\n        return addCommas(val);\n    })\n\t.attr('id', function(d,i){\n\t\treturn 'data-label'+d.code;\n\t})\n    .attr('data-id', function(d,i){ return d.code })\n\t.attr('class', 'data-label')\n\t.attr('y', rowHeight/2)\n\t.style('alignment-baseline', 'middle')\n\t.style('text-anchor', 'start')\n\t.attr('x', function(d,i){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n        } else {\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases)+labelWidth+5;\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths)+labelWidth+5;\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;               \n        }\n        return val;\n    })\n    .attr('opacity', function(d,i){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n            if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n        } else {\n            if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths);\n            if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines);\n        }\n        if(val>0){ return 1 } else { return 0}\n    })\n\t.style('fill', '#696969')\n\t.style('font-weight', 'normal')\n\t.style('font-size', '10px');\n\n}\n\nexport function updateRegionchart(options,data) {\n    \n    // reset region values to zero\n    data.regions.forEach(function(d,i){\n        d.population = 0;\n        d.cumulative_deaths = 0;\n        d.cumulative_cases = 0;\n        d.cumulative_vaccines = 0;\n    })\n\n    // loop through countries and calculate region totals\n    data.country.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ \n                if((d.population>0)&&(d.who_daily_latest)){\n                    if(d.who_daily_latest.cumulative_cases>0)\n                    dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n                    if(d.who_daily_latest.cumulative_deaths>0)\n                    dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths||0;\n                    dd.population += d.population;\n                }\n                if((d.population>0)&&(d.vaccine_daily_latest)){\n                    dd.cumulative_vaccines += (d.vaccine_daily_latest.total_vaccinations)||0;\n                }\n            }\n        });\n    });\n\n    // calculate regions per 100k values using total population for each region\n    data.regions.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    if(options.region_switch=='per100'){\n        // get maximum values for each series\n        maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines_per_100k;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases_per_100k;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths_per_100k;\n        });\n    } else {\n         // get maximum values for each series\n         maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths;\n        });\n    }\n\n    // redefine scales using new extent\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    // update bars\n    if((maxVaccinations==0)&&(maxCases==0)&&(maxDeaths==0)){\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .attr('width', 0);\n\n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500) \n          .attr('x', labelWidth)\n          .attr('opacity', 0);\n    } else {\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .style('fill', function(d){\n            return colors.regions[d.code];\n            if(options.region_chart_toggle=='vaccines'){\n                return colors.regions_blue[d.code]\n            } else {\n                return colors.regions[d.code]\n            }\n        })\n        .attr('width', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n            } else {\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);                \n            }\n            if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n        })   \n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500)\n          .tween(\"text\", function(d,i) {\n            var val = 0;\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases_per_100k));\n                if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths_per_100k));\n                if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines_per_100k));\n            } else {\n                if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases));\n                if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths));\n                if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines));             \n            }\n            var i = d3.interpolate(Math.floor((Math.random() * 2346) + 9345), val);\n            return function(t) {\n              d3.select(this).text(addCommas(Math.round(i(t))));\n            };\n          })\n        .attr('x', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n            } else {\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases)+labelWidth+5;\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths)+labelWidth+5;\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;               \n            }\n            return val;\n        })\n        .attr('opacity', function(d,i){\n            var d;\n            var id = d3.select(this).attr('data-id');\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n                if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n                if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n            } else {\n                if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases);\n                if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths);\n                if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines);\n            }\n            if(val>0){ return 1 } else { return 0}\n        })\n\n    }\n\n}\n\nexport default drawRegionchart;\n"]},"metadata":{},"sourceType":"module"}