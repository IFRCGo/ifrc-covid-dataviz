{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{nFormatter}from'./HelperFunctions';import{selection,textwrap}from'd3-textwrap';import clone from'just-clone';var yScaleCases;var yScaleDeaths;var yScaleVaccines;var yAxisCases;var yAxisDeaths;var yAxisVaccines;var yScaleCasesAxis;var yScaleDeathsAxis;var yScaleVaccinesAxis;var xScale;var xAxis;var xScaleAxis;var xScaleEvents;var maxDate;var minDate;var md;var vgroupedData;var regions=['AF','AP','ME','EU','AM','OTH'];export function drawTimechart(data,options){minDate=new Date(data.min_date);maxDate=new Date(data.max_date);var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});vgroupedData=[];if(options.timeline_type!='cumulative'){// cumulative and stacked\n// data.vaccines_data = data.vaccines_data_daily;\n// data.vaccines_data_daily = clone(data.vaccines_data);\ndata.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){var newVaccines=0;if(d[dd].new_vaccines>0){newVaccines+=d[dd].new_vaccines;}d.region.push({'region':dd,'new_vaccines':newVaccines});});});}else{// cumulative only\nvar vData=[];if(options.timeline_frequency==='day'){vData=clone(data.vaccines_data);}if(options.timeline_frequency==='week'){data.vaccines_data.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||date==moment(data.max_date).startOf('day').unix()){vData.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(data.max_date).startOf('day').unix();data.vaccines_data.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||moment(data.max_date).startOf('day').unix()!=endOfMonthDate&&date==maxDateUnix){vData.push(d);}});}vData.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});// define date range\n// const minDate = groupedData[0].date;\n// const maxDate = groupedData[numIntervals].date;\n// const minDate = groupedData[0].date;\n// if(options.timeline_frequency==='month') md = md.add(1, 'months');\n// if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\nif(options.timeline_frequency==='month')minDate=moment(minDate).startOf('month').startOf('day').toDate();if(options.timeline_frequency==='month')maxDate=moment(maxDate).endOf('month').startOf('day').toDate();if(options.timeline_frequency==='week')maxDate=moment(maxDate).endOf('isoWeek').startOf('day').toDate();md=moment(maxDate);if(options.timeline_frequency==='day')md=new Date(moment(maxDate).add(1,'days').toDate());var svg=d3.select('#timechart_svg');svg.selectAll('g').remove();d3.selectAll('#layout .yAxis').remove();d3.selectAll('#yAxis').remove();d3.selectAll('#layout .xAxis').remove();//bg\nsvg.append('g').append('rect').attr('width',2000).attr('height','100%').attr('x',0).attr('y',0).attr('fill','#FFF').attr('opacity',0);var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0.02;// define scales\nxScale=d3.scaleTime().range([0,width]).domain([minDate,md]);xScaleAxis=d3.scaleTime().range([0,596]).domain([minDate,md]);yScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nxAxis=d3.axisBottom().scale(xScaleAxis).tickSize(2).tickPadding(3);// if(options.timeline_frequency=='month')\n// xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n// if(options.timeline_frequency=='week')\n// xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisGroup=d3.select('#layout').append(\"g\").attr('id','yAxis').attr('clip-path','url(#mask)');var yAxisCasesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"casesAxis\").attr('transform','translate(620,363)').call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"deathsAxis\").attr('transform','translate(620,534)').call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=yAxisGroup.append(\"g\").attr(\"class\",\"yAxis axis\").attr(\"id\",\"VaccinesAxis\").attr('transform','translate(620,707.5)').call(yAxisVaccines);// x-axis cases\nvar xAxisCases=yAxisGroup.append('g').attr(\"id\",\"casesXAxis\").attr('class','xAxis').attr('transform','translate(24,504)').call(xAxis);var xAxisDeaths=yAxisGroup.append('g').attr(\"id\",\"deathsXAxis\").attr('class','xAxis').attr('transform','translate(24,674)').call(xAxis);var xAxisVaccines=yAxisGroup.append('g').attr(\"id\",\"vaccinesXAxis\").attr('class','xAxis').attr('transform','translate(24,848)').call(xAxis);var xAxisTimeline=yAxisGroup.append('g').attr(\"id\",\"timelineXAxis\").attr('class','xAxis').attr('transform','translate(24,908)').call(xAxis);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).enter().append('g').attr('class','bar_group').attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar cases_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class',function(d,i){return'timeBar deaths_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];});// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).enter().append('g').attr('class','vbar_group').attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).enter().append('rect').attr('class','timeBar vaccines_bar').attr('class',function(d,i){return'timeBar vaccines_bar time_'+d.region;}).attr('x',barWidth*barSpacing).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('width',barWidth-barWidth*barSpacing*2).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions_blue[d.region];});if(options.timeline_frequency==='month'){vbarGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// bar size tweak for spacing\nif(options.timeline_frequency==='month'){barGroups.selectAll(\".timeBar\").attr(\"width\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(1-barSpacing);}).attr(\"x\",function(d){var date=d3.select(this.parentNode).datum().date;var next=d3.timeMonth.offset(date,1);return(xScale(next)-xScale(date))*(barSpacing/2);});}// tooltips\n// events calendar timeline\nvar tData=data.timeline_data;xScaleEvents=d3.scaleTime().range([25,619]).domain([minDate,md]);// bring to front\ndocument.getElementById(\"svg\").appendChild(d3.select('#timeline_tooltip').node());document.getElementById(\"svg\").appendChild(d3.select('#event_tooltip').node());var timelineTooltip=d3.select('#timeline_tooltip').attr('opacity',0);var eventTooltip=d3.select('#event_tooltip').attr('opacity',0);// hover bar\nvar hoverBar=svg.append('rect').attr('id','timechart_hover').attr('width',barWidth).attr('x',0).attr('y',0).attr('opacity',0).attr('height','100%').attr('fill','rgb(221 221 221 / 40%)');d3.select('#timechart_svg').on('mouseover',function(event){var coords=d3.pointer(event);hoverBar.attr('opacity',1);var xDate=xScale.invert(coords[0]);if(options.timeline_frequency=='week'){xDate=moment(xDate).startOf('isoWeek');}if(options.timeline_frequency=='day'){xDate=moment(xDate).startOf('day');}if(options.timeline_frequency=='month'){xDate=moment(xDate).startOf('month');}if(coords[1]<470){timelineTooltip.attr('opacity',1).attr('display','inline');hoverBar.attr('height','100%');}else if(coords[1]>510){eventTooltip.attr('opacity',1);hoverBar.attr('height','90%');}else{eventTooltip.attr('opacity',0);timelineTooltip.attr('opacity',0);hoverBar.attr('height','100%');}if(xDate.toDate().getTime()<minDate.getTime()){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);}d3.select('#svg_container').style('z-index',10);}).on('mouseout',function(event){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0).attr('display','none');// timelineTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\nd3.select('#svg_container').style('z-index',1);eventTooltip.attr('opacity',0).attr('transform','translate(0,0)');d3.selectAll('.event_marker circle').style('stroke',colors.black);}).on('mousemove',function(event){var coords=d3.pointer(event);var xDate=xScale.invert(coords[0]);var tooltipStr='';if(options.timeline_frequency=='week'){xDate=moment(xDate).startOf('isoWeek');tooltipStr=xDate.format('ll');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}if(options.timeline_frequency=='day'){xDate=moment(xDate).startOf('day');tooltipStr=xDate.format('ll');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}if(options.timeline_frequency=='month'){xDate=moment(xDate).startOf('month');tooltipStr=xDate.format('MMMM YYYY');d3.select('#timeline_tooltip_date tspan').text(tooltipStr);}hoverBar.attr('x',xScale(xDate.toDate()));var groupedDataFiltered=groupedData.filter(function(d,i){return moment(d.date).startOf('day').unix()==xDate.startOf('day').unix();});var vgroupedDataFiltered=vgroupedData.filter(function(d,i){return moment(d.date).startOf('day').unix()==xDate.startOf('day').unix();});var deaths='-';var cases='-';var vaccines='-';if(options.timeline_type=='cumulative'){// cumulative\nif(groupedDataFiltered[0])cases=nFormatter(groupedDataFiltered[0].total_cumulative_cases,2);if(groupedDataFiltered[0])deaths=nFormatter(groupedDataFiltered[0].total_cumulative_deaths,2);if(vgroupedDataFiltered[0])vaccines=nFormatter(vgroupedDataFiltered[0].total_cumulative_vaccines,2);}else{// non-cumulative/stacked\nif(groupedDataFiltered[0])cases=nFormatter(groupedDataFiltered[0].total_new_cases,2);if(groupedDataFiltered[0])deaths=nFormatter(groupedDataFiltered[0].total_new_deaths,2);if(vgroupedDataFiltered[0])vaccines=nFormatter(vgroupedDataFiltered[0].total_new_vaccines,2);}d3.select('#tooltip_cases tspan').text(cases).attr(\"text-anchor\",\"end\").attr('dx',32);d3.select('#tooltip_deaths tspan').text(deaths).attr(\"text-anchor\",\"end\").attr('dx',32);d3.select('#tooltip_vaccines tspan').text(vaccines).attr(\"text-anchor\",\"end\").attr('dx',32);// if((xDate.toDate().getTime()>options.maxDate.getTime())){\n//     hoverBar.attr('opacity', 0);\n// // } else \nif(xDate.toDate().getTime()<minDate.getTime()&&options.timeline_frequency=='day'){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);}if(options.timeline_frequency=='month'){hoverBar.attr('width',function(){return xScale(moment(xDate).endOf('month'))-xScale(moment(xDate).startOf('month'));});}timelineTooltip.attr('transform',function(){var bw=barWidth;var ratio=(options.brushR-options.brushL)/600;var offset=0;if(ratio<0.5)offset=3;if(ratio<0.3)offset=12;if(ratio<0.2)offset=20;if(ratio<0.15)offset=21;if(options.timeline_frequency=='month'){if(ratio<0.6)offset=20;if(ratio<0.5)offset=30;if(ratio<0.3)offset=50;if(ratio<0.2)offset=60;if(ratio<0.1)offset=70;return'translate('+(xScaleEvents(xDate.toDate())+barWidth/3+offset)+','+(coords[1]+353)+')';}return'translate('+(xScaleEvents(xDate.toDate())+18+offset)+','+(coords[1]+353)+')';});if(coords[1]<470){timelineTooltip.attr('opacity',1);hoverBar.attr('opacity',1);hoverBar.attr('height','100%');}else if(coords[1]>510){eventTooltip.attr('opacity',1);hoverBar.attr('height','90%');var x=moment(xScale.invert(coords[0])).startOf('day');var xx=xScale.invert(coords[0]);eventTooltip.attr('transform',function(){return'translate('+(xScaleEvents(x.toDate())+-3)+','+817+')';});var events=tData.filter(function(d,i){return moment(d.date).startOf('day').unix()==x.unix();});// select nearest neighbor for ux purposes \nif(events.length==0){events=tData.filter(function(d,i){return moment(d.date).startOf('day').unix()<=moment(x).add(1,'days').unix()&&moment(d.date).startOf('day').unix()>=moment(x).subtract(1,'days').unix();});}if(events.length>0){d3.select('#event-'+moment(events[0].date).startOf('day').unix()).select('path').style('stroke','#000').attr('opacity',1);tooltipStr=moment(events[0].date).startOf('day').format('ll');d3.select('#event_tooltip_date tspan').text(tooltipStr);var wrap=textwrap().bounds({height:200,width:230}).method('tspans');var event=d3.select('#event_tooltip_text').text(events[0].description).attr('y',18).attr('x',6);d3.select('#event_tooltip_text').call(wrap);d3.selectAll('#event_tooltip_text tspan').attr('dy','1.3em');var bbox=d3.select('#event_tooltip_text').node().getBBox();d3.select('#event_tooltip_rect').attr('width',bbox.width+17).attr('height',bbox.height+26);var h=d3.select('#event_tooltip_rect').attr('height');var ys=0;if(bbox.height<20){ys=19;}else if(bbox.height<30){ys=9;}else if(bbox.height<40){ys=0;}else if(bbox.height<50){ys=-20;}else if(bbox.height<60){ys=-20;}var y=d3.select('#event_tooltip_rect').attr('y');d3.select('#event_tooltip_rect').attr('y',ys);d3.selectAll('#event_tooltip_text').attr('y',function(d,i){return parseInt(d3.select(this).attr('y'))+ys;});d3.selectAll('#event_tooltip_date tspan').attr('dy',function(d,i){return ys;});eventTooltip.attr('opacity',1);}else{d3.selectAll('.event_marker circle').style('stroke',colors.black);eventTooltip.attr('opacity',0);}}else{eventTooltip.attr('opacity',0);timelineTooltip.attr('opacity',0);hoverBar.attr('opacity',0);hoverBar.attr('height','100%');}if(options.timeline_frequency=='day'&&xDate.toDate().getTime()<minDate.getTime()){hoverBar.attr('opacity',0);timelineTooltip.attr('opacity',0);return false;}});tData=tData.filter(function(d){return d.date.length>0;});// event lin\nyAxisGroup.append('line').attr('id','event-line').attr('x1',0).attr('x2',620).attr('y1',893).attr('y2',893).attr('stroke-width',2.5).attr('stroke',colors.black);var circles=yAxisGroup.append('g').selectAll('.event_marker').data(tData).enter().append('g').attr('class','event_marker').attr('id',function(d,i){return'event-'+moment(d.date).startOf('day').unix();}).attr('transform',function(d){var x=xScaleEvents(new Date(d.date));return'translate('+x+', 893)';}).style('cursor','pointer');// .append('path')\n// .attr('d', \"M0,-6L4,0 0,6 -4,0Z\")\ncircles.append(\"circle\").style('stroke',colors.black).attr('opacity',1).attr('r',6.5).attr('cx',0).attr('cy',0).style('stroke-width',2.2).style('fill','white');circles.append(\"circle\").attr('r',2).attr('cx',0).attr('cy',0).attr('fill',colors.black).style('stroke',colors.black);// create brush zoom\n// reset\n// options.brushL = 0;\n// options.brushR = 600;\nvar brush=d3.brushX().extent([[0,0],[600,20]]).on(\"start brush end\",brushed);d3.select('.brush').remove();;var gBrush=d3.select('#zoombar').append(\"g\").attr(\"class\",\"brush\").attr('opacity',0.1).call(brush);d3.selectAll('.handle rect').attr('fill-opacity','1').style('visibility','visible').attr('width',2).attr('fill','#000').style('stroke-opacity',0);var brushScale=d3.scaleLinear().domain([-3,597]).range([0,2000]);gBrush.call(brush.move,[options.brushL,options.brushR]);function brushed(){var x=parseFloat(d3.select('.handle--w').attr('x'));var x2=parseFloat(d3.select('.handle--e').attr('x'));if(x2-x<40)return false;var w=d3.select('.selection').attr('width');d3.select('#zoomL').attr('transform','translate('+x+',0)');d3.select('#zoomR').attr('transform','translate('+x2+',0)');d3.select('#zoomOverlay').attr('width',x2-x);d3.select('#zoomOverlay').attr('x',x);d3.select('#zoomOverlay').attr('transform','translate(3,0)');var viewBoxW=Math.round(brushScale(x2)-brushScale(x));var viewBoxX=Math.round(brushScale(x));options.brushL=x+3;options.brushR=x2+3;xScaleAxis=d3.scaleTime().range([0,596]).domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);xScaleEvents=d3.scaleTime().range([25,619])// .domain([minDate,md]);\n.domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);d3.selectAll('.event_marker').attr('transform',function(d){var x=xScaleEvents(new Date(d.date));return'translate('+x+', 893)';});xAxis=d3.axisBottom().ticks(5).scale(xScaleAxis);xAxisCases.call(xAxis);xAxisDeaths.call(xAxis);xAxisVaccines.call(xAxis);xAxisTimeline.call(xAxis);d3.select('#timechart_svg').attr('viewBox',viewBoxX+' 0 '+viewBoxW+' 553');}}export function updateTimechart(data,options){var groupedData=[];data.who_data.forEach(function(d,i){if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')groupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')groupedData[d[options.timeline_frequency+'Total']].date=d.week_start;if(options.timeline_frequency==='month')groupedData[d[options.timeline_frequency+'Total']].date=d.month_start;if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases+=d.new_cases;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths+=d.new_deaths;groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases=0;});// totals by date\ngroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d.hasOwnProperty(dd)){d[dd]={new_cases:0,new_deaths:0,cumulative_cases:0,cumulative_deaths:0};}// if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\nif(i>0){d[dd].cumulative_cases=groupedData[i][dd].new_cases+groupedData[i-1][dd].cumulative_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths+groupedData[i-1][dd].cumulative_deaths;}else{d[dd].cumulative_cases=groupedData[i][dd].new_cases;d[dd].cumulative_deaths=groupedData[i][dd].new_deaths;}});d.total_new_cases=d.AF.new_cases+d.AP.new_cases+d.AM.new_cases+d.EU.new_cases+d.ME.new_cases+d.OTH.new_cases;d.total_cumulative_cases=d.AF.cumulative_cases+d.AP.cumulative_cases+d.AM.cumulative_cases+d.EU.cumulative_cases+d.ME.cumulative_cases+d.OTH.cumulative_cases;d.total_new_deaths=d.AF.new_deaths+d.AP.new_deaths+d.AM.new_deaths+d.EU.new_deaths+d.ME.new_deaths+d.OTH.new_deaths;d.total_cumulative_deaths=d.AF.cumulative_deaths+d.AP.cumulative_deaths+d.AM.cumulative_deaths+d.EU.cumulative_deaths+d.ME.cumulative_deaths+d.OTH.cumulative_deaths;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_cases':d[dd].new_cases,'new_deaths':d[dd].new_deaths,'cumulative_cases':d[dd].cumulative_cases,'cumulative_deaths':d[dd].cumulative_deaths});});});vgroupedData=[];if(options.timeline_type!='cumulative'){// non-cumulative and stacked\n// data.vaccines_data = data.vaccines_data_daily;\ndata.vaccines_data.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={new_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines+=d.daily_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={new_vaccines:0,cumulative_vaccines:0};}});d.total_new_vaccines=d.AF.new_vaccines+d.AP.new_vaccines+d.AM.new_vaccines+d.EU.new_vaccines+d.ME.new_vaccines+d.OTH.new_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'new_vaccines':d[dd].new_vaccines});});});}else{// cumulative only\nvar vData=[];if(options.timeline_frequency==='day'){vData=clone(data.vaccines_data);}if(options.timeline_frequency==='week'){data.vaccines_data.forEach(function(d,i){var endOfWeekDate=moment(d.date).endOf('isoWeek').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfWeekDate||date==moment(data.max_date).startOf('day').unix()){vData.push(d);}});}if(options.timeline_frequency==='month'){var maxDateUnix=moment(data.max_date).startOf('day').unix();data.vaccines_data.forEach(function(d,i){var endOfMonthDate=moment(d.date).endOf('month').startOf('day').unix();var date=moment(d.date).startOf('day').unix();if(date==endOfMonthDate||moment(data.max_date).startOf('day').unix()!=endOfMonthDate&&date==maxDateUnix){vData.push(d);}});}vData.forEach(function(d,i){if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']]={};if(options.timeline_frequency==='day')vgroupedData[d[options.timeline_frequency+'Total']].date=d.date;if(options.timeline_frequency==='week')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('isoWeek').toDate();if(options.timeline_frequency==='month')vgroupedData[d[options.timeline_frequency+'Total']].date=moment(d.date).startOf('month').toDate();if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region])vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]={cumulative_vaccines:0};vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines+=d.total_vaccinations;});// totals by date\nvgroupedData.forEach(function(d,i){regions.forEach(function(dd,ii){if(!d[dd]){d[dd]={cumulative_vaccines:0};}});d.total_cumulative_vaccines=d.AF.cumulative_vaccines+d.AP.cumulative_vaccines+d.AM.cumulative_vaccines+d.EU.cumulative_vaccines+d.ME.cumulative_vaccines+d.OTH.cumulative_vaccines;d.region=[];regions.forEach(function(dd,ii){d.region.push({'region':dd,'cumulative_vaccines':d[dd].cumulative_vaccines});});});}vgroupedData=vgroupedData.filter(function(el){return el;});var numIntervals=d3.max(data.who_data,function(d,i){return d[options.timeline_frequency+'Total'];});var maxCases=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_cases;if(options.timeline_type==='cumulative')return d.total_cumulative_cases;if(options.timeline_type==='stacked')return 100;});var maxDeaths=d3.max(groupedData,function(d,i){if(options.timeline_type==='non-cumulative')return d.total_new_deaths;if(options.timeline_type==='cumulative')return d.total_cumulative_deaths;if(options.timeline_type==='stacked')return 100;});var maxVaccines=d3.max(vgroupedData,function(d,i){if(d){if(options.timeline_type==='non-cumulative')return d.total_new_vaccines;if(options.timeline_type==='cumulative')return d.total_cumulative_vaccines;if(options.timeline_type==='stacked')return 100;}});var svg=d3.select('#timechart_svg');var width=2000;var barWidth=width/numIntervals;var barSpacing=0.04;if(options.timeline_frequency==='month')barSpacing=0.03;if(options.timeline_frequency==='day')barSpacing=0;// define scales\n// xScale = d3.scaleTime()\n// .range([0,width])\n// .domain([minDate,md]);\n// xScaleAxis = d3.scaleTime()\n// .range([23,596])\n// .domain([minDate,md]);\nyScaleCases=d3.scaleLinear().range([0,140]).domain([0,maxCases]);yScaleCasesAxis=d3.scaleLinear().range([140,0]).domain([0,maxCases]);yScaleDeaths=d3.scaleLinear().range([0,140]).domain([0,maxDeaths]);yScaleDeathsAxis=d3.scaleLinear().range([140,0]).domain([0,maxDeaths]);yScaleVaccines=d3.scaleLinear().range([0,140]).domain([0,maxVaccines]);yScaleVaccinesAxis=d3.scaleLinear().range([140,0]).domain([0,maxVaccines]);// define axi\nyAxisCases=d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisDeaths=d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});yAxisVaccines=d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function(d){if(options.timeline_type=='stacked')return nFormatter(d)+'%';return nFormatter(d);});// y-axis cases\nvar yAxisCasesText=d3.select('#casesAxis').transition().duration(500).call(yAxisCases);// y-axis deaths\nvar yAxisDeathsText=d3.select('#deathsAxis').transition().duration(500).call(yAxisDeaths);// y-axis vaccines\nvar yAxisVaccinesText=d3.select('#VaccinesAxis').transition().duration(500).call(yAxisVaccines);// CASES\n// loop through groupedData and draw bars\nvar barGroups=svg.selectAll('.bar_group').data(groupedData).attr('transform',function(d,i){return'translate('+xScale(d.date)+')';});// CASES\nbarGroups.selectAll('.cases_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_cases;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleCases(d.cumulative_cases)-yScaleCases(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleCases(d.new_cases)-yScaleCases(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_cases/totalNewCases)-140*(dp/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewCases=d3.select(this.parentNode).datum().total_new_cases-d3.select(this.parentNode).datum().OTH.new_cases;var y=0;if(options.timeline_type==='cumulative')y=yScaleCases(d.cumulative_cases);if(options.timeline_type==='non-cumulative')y=yScaleCases(d.new_cases);if(options.timeline_type==='stacked')y=140*(d.new_cases/totalNewCases);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('fill',function(d,i){return colors.regions[d.region];return'blue';});// // DEATHS\nbarGroups.selectAll('.deaths_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_deaths;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleDeaths(d.cumulative_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='non-cumulative')y=140-yScaleDeaths(d.new_deaths)-yScaleDeaths(dp)+170;if(options.timeline_type==='stacked')y=140-140*(d.new_deaths/totalNewDeaths)-140*(dp/totalNewDeaths)+170;// if(options.timeline_type==='non-cumulative') if(y>310) return 0;\nif(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewDeaths=d3.select(this.parentNode).datum().total_new_deaths-d3.select(this.parentNode).datum().OTH.new_deaths;var y=0;if(options.timeline_type==='cumulative')y=yScaleDeaths(d.cumulative_deaths);if(options.timeline_type==='non-cumulative')y=yScaleDeaths(d.new_deaths);if(options.timeline_type==='stacked')y=140*(d.new_deaths/totalNewDeaths);if(options.timeline_type==='non-cumulative')if(y<0)return 0;if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(groupedData.length==0){d3.selectAll('.cases_bar').transition().duration(500).attr('y',140).attr('height',0);d3.selectAll('.deaths_bar').transition().duration(500).attr('y',140+170).attr('height',0);}// // VACCINES\nvar vbarGroups=svg.selectAll('.vbar_group').data(vgroupedData).attr('transform',function(d,i){return'translate('+xScale(d.date)+', 344)';});vbarGroups.selectAll('.vaccines_bar').data(function(d,i){return d.region.filter(function(dd,ii){return dd.region!=='OTH';});}).transition().duration(500).attr('y',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var dp=0;if(i>0){for(var ii=1;ii<=i;ii++){if(options.timeline_type==='cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;if(options.timeline_type==='non-cumulative')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;if(options.timeline_type==='stacked')dp+=d3.select(this.parentNode).datum().region[ii-1].new_vaccines;}}var y=0;if(options.timeline_type==='cumulative')y=140-yScaleVaccines(d.cumulative_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='non-cumulative')y=140-yScaleVaccines(d.new_vaccines)-yScaleVaccines(dp);if(options.timeline_type==='stacked')y=140-140*(d.new_vaccines/totalNewVaccines)-140*(dp/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};}).attr('height',function(d,i){var totalNewVaccines=d3.select(this.parentNode).datum().total_new_vaccines-d3.select(this.parentNode).datum().OTH.new_vaccines;var y=0;if(options.timeline_type==='cumulative')y=yScaleVaccines(d.cumulative_vaccines);if(options.timeline_type==='non-cumulative')y=yScaleVaccines(d.new_vaccines);if(options.timeline_type==='stacked')y=140*(d.new_vaccines/totalNewVaccines);if(y){if(y>0){return y;}else{return 0;};}else{return 0;};});if(vgroupedData.length==0){d3.selectAll('.vaccines_bar').transition().duration(500).attr('y',140).attr('height',0);}// // bar size tweak for spacing\n// if(options.timeline_frequency==='month'){\n//     barGroups.selectAll(\".timeBar\")\n//     .attr(\"width\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(1-barSpacing);\n//       })\n//     .attr(\"x\", function(d) {\n//         var date = d3.select(this.parentNode).datum().date;\n//         var next = d3.timeMonth.offset(date, 1);\n//         return (xScale(next)- xScale(date))*(barSpacing/2);\n//       })\n//     }\n}export default drawTimechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Timechart.js"],"names":["d3","moment","colors","nFormatter","selection","textwrap","clone","yScaleCases","yScaleDeaths","yScaleVaccines","yAxisCases","yAxisDeaths","yAxisVaccines","yScaleCasesAxis","yScaleDeathsAxis","yScaleVaccinesAxis","xScale","xAxis","xScaleAxis","xScaleEvents","maxDate","minDate","md","vgroupedData","regions","drawTimechart","data","options","Date","min_date","max_date","groupedData","who_data","forEach","d","i","timeline_frequency","date","week_start","month_start","ifrc_region","new_cases","new_deaths","cumulative_cases","cumulative_deaths","dd","ii","hasOwnProperty","total_new_cases","AF","AP","AM","EU","ME","OTH","total_cumulative_cases","total_new_deaths","total_cumulative_deaths","region","push","timeline_type","vaccines_data","new_vaccines","daily_vaccinations","cumulative_vaccines","total_new_vaccines","newVaccines","vData","endOfWeekDate","endOf","startOf","unix","maxDateUnix","endOfMonthDate","total_vaccinations","total_cumulative_vaccines","filter","el","numIntervals","max","maxCases","maxDeaths","maxVaccines","toDate","add","svg","select","selectAll","remove","append","attr","width","barWidth","barSpacing","scaleTime","range","domain","scaleLinear","axisBottom","scale","tickSize","tickPadding","axisRight","ticks","tickFormat","yAxisGroup","yAxisCasesText","call","yAxisDeathsText","yAxisVaccinesText","xAxisCases","xAxisDeaths","xAxisVaccines","xAxisTimeline","barGroups","enter","totalNewCases","parentNode","datum","dp","y","totalNewDeaths","next","timeMonth","offset","vbarGroups","totalNewVaccines","regions_blue","tData","timeline_data","document","getElementById","appendChild","node","timelineTooltip","eventTooltip","hoverBar","on","event","coords","pointer","xDate","invert","getTime","style","black","tooltipStr","format","text","groupedDataFiltered","vgroupedDataFiltered","deaths","cases","vaccines","bw","ratio","brushR","brushL","x","xx","events","length","subtract","wrap","bounds","height","method","description","bbox","getBBox","h","ys","parseInt","circles","brush","brushX","extent","brushed","gBrush","brushScale","move","parseFloat","x2","w","viewBoxW","Math","round","viewBoxX","updateTimechart","transition","duration"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {nFormatter} from './HelperFunctions';\nimport { selection, textwrap } from 'd3-textwrap';\nimport clone from 'just-clone';\n\nlet yScaleCases;\nlet yScaleDeaths;\nlet yScaleVaccines;\nlet yAxisCases;\nlet yAxisDeaths;\nlet yAxisVaccines;\nlet yScaleCasesAxis;\nlet yScaleDeathsAxis;\nlet yScaleVaccinesAxis;\nlet xScale;\nlet xAxis; \nlet xScaleAxis;\nlet xScaleEvents;\nlet maxDate; \nlet minDate;\nlet md; \nlet vgroupedData;\n\nconst regions = ['AF', 'AP', 'ME', 'EU', 'AM', 'OTH'];\n\nexport function drawTimechart(data, options) {\n\n    minDate = new Date(data.min_date);\n    maxDate = new Date(data.max_date);\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // cumulative and stacked\n        // data.vaccines_data = data.vaccines_data_daily;\n        // data.vaccines_data_daily = clone(data.vaccines_data);\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n\n            regions.forEach(function(dd,ii){\n                var newVaccines = 0;\n                if(d[dd].new_vaccines>0){\n                    newVaccines += d[dd].new_vaccines\n                }\n                d.region.push({'region': dd, 'new_vaccines': newVaccines });\n            })\n        });\n\n    } else{ // cumulative only\n        var vData = [];\n        if(options.timeline_frequency==='day') {\n            vData = clone(data.vaccines_data);\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(date==moment(data.max_date).startOf('day').unix())){\n                    vData.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(data.max_date).startOf('day').unix();\n            data.vaccines_data.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((moment(data.max_date).startOf('day').unix()!=endOfMonthDate)&&(date==maxDateUnix))){\n                    vData.push(d);\n                }\n            })\n        }\n\n        vData.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n    // const minDate = groupedData[0].date;\n\n    // if(options.timeline_frequency==='month') md = md.add(1, 'months');\n    // if(options.timeline_frequency==='week') md = md.add(1, 'weeks');\n    if(options.timeline_frequency==='month') minDate = moment(minDate).startOf('month').startOf('day').toDate();\n    if(options.timeline_frequency==='month') maxDate = moment(maxDate).endOf('month').startOf('day').toDate();\n    if(options.timeline_frequency==='week') maxDate = moment(maxDate).endOf('isoWeek').startOf('day').toDate();\n\n    md = moment(maxDate);\n    if(options.timeline_frequency==='day') md = new Date(moment(maxDate).add(1, 'days').toDate());\n\n    const svg = d3.select('#timechart_svg');\n    svg.selectAll('g').remove();\n    d3.selectAll('#layout .yAxis').remove();\n    d3.selectAll('#yAxis').remove();\n    d3.selectAll('#layout .xAxis').remove();\n\n    //bg\n    svg.append('g').append('rect')\n    .attr('width', 2000)\n    .attr('height', '100%')\n    .attr('x', 0)\n    .attr('y', 0)\n    .attr('fill', '#FFF')\n    .attr('opacity', 0);\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0.02;\n\n    // define scales\n\n    xScale = d3.scaleTime()\n    .range([0,width])\n    .domain([minDate,md]);\n\n    xScaleAxis = d3.scaleTime()\n    .range([0,596])\n    .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    \n    xAxis = d3.axisBottom()\n    .scale(xScaleAxis)\n    .tickSize(2)\n    .tickPadding(3);\n\n    // if(options.timeline_frequency=='month')\n    // xAxis.ticks(d3.timeMonth.every(3)).tickFormat(d3.timeFormat(\"%b %Y\"));\n\n    // if(options.timeline_frequency=='week')\n    // xAxis.ticks(d3.timeWeek.every(10)).tickFormat(d3.timeFormat(\"%d %b %Y\"));\n\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisGroup = d3.select('#layout').append(\"g\").attr('id', 'yAxis').attr('clip-path', 'url(#mask)');\n\n    var yAxisCasesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"casesAxis\")\n    .attr('transform', 'translate(620,363)')\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"deathsAxis\")\n    .attr('transform', 'translate(620,534)')\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = yAxisGroup.append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"VaccinesAxis\")\n    .attr('transform', 'translate(620,707.5)')\n    .call(yAxisVaccines);\n\n    // x-axis cases\n    var xAxisCases = yAxisGroup.append('g')\n    .attr(\"id\", \"casesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,504)')\n    .call(xAxis);\n\n    var xAxisDeaths = yAxisGroup.append('g')\n    .attr(\"id\", \"deathsXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,674)')\n    .call(xAxis);\n\n    var xAxisVaccines = yAxisGroup.append('g')\n    .attr(\"id\", \"vaccinesXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,848)')\n    .call(xAxis);\n\n    var xAxisTimeline = yAxisGroup.append('g')\n    .attr(\"id\", \"timelineXAxis\")\n    .attr('class', 'xAxis')\n    .attr('transform', 'translate(24,908)')\n    .call(xAxis);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'bar_group')\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar cases_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    })\n\n    // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', function(d,i) { return 'timeBar deaths_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n            })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n            })\n        }\n\n    // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'vbar_group')\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n  \n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', 'timeBar vaccines_bar')\n    .attr('class', function(d,i) { return 'timeBar vaccines_bar time_'+d.region })\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions_blue[d.region];\n    });\n\n    if(options.timeline_frequency==='month'){\n    vbarGroups.selectAll(\".timeBar\")\n    .attr(\"width\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(1-barSpacing);\n        })\n    .attr(\"x\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(barSpacing/2);\n        })\n    }\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n          })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n          })\n        }\n\n        // tooltips\n\n        // events calendar timeline\n        var tData = data.timeline_data;\n\n        xScaleEvents = d3.scaleTime()\n        .range([25,619])\n        .domain([minDate,md]);\n        \n        // bring to front\n       document.getElementById(\"svg\").appendChild(d3.select('#timeline_tooltip').node());\n       document.getElementById(\"svg\").appendChild(d3.select('#event_tooltip').node());\n       var timelineTooltip = d3.select('#timeline_tooltip').attr('opacity', 0);\n       var eventTooltip = d3.select('#event_tooltip').attr('opacity', 0);\n\n        // hover bar\n        var hoverBar = svg.append('rect')\n        .attr('id','timechart_hover')\n        .attr('width', barWidth)\n        .attr('x', 0)\n        .attr('y', 0)\n        .attr('opacity', 0)\n        .attr('height', '100%')\n        .attr('fill', 'rgb(221 221 221 / 40%)')\n\n        d3.select('#timechart_svg').on('mouseover',  (event) => {\n\n            var coords = d3.pointer( event );\n            hoverBar.attr('opacity', 1)\n\n            var xDate = xScale.invert(coords[0]);\n\n            if(options.timeline_frequency=='week') {\n                xDate = moment(xDate).startOf('isoWeek');\n            }\n            if(options.timeline_frequency=='day') {\n                xDate = moment(xDate).startOf('day');\n            }\n            if(options.timeline_frequency=='month') {\n                xDate = moment(xDate).startOf('month');\n            }\n\n            if(coords[1]<470){\n                timelineTooltip.attr('opacity', 1).attr('display', 'inline');\n                hoverBar.attr('height', '100%');\n            } else if(coords[1]>510){\n                eventTooltip.attr('opacity', 1);\n                hoverBar.attr('height', '90%');\n            } else {\n                eventTooltip.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                hoverBar.attr('height', '100%');\n            }\n\n            if((xDate.toDate().getTime()<minDate.getTime())){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n            }\n\n            d3.select('#svg_container').style('z-index', 10);\n\n        }).on('mouseout',  (event) => {\n            hoverBar.attr('opacity', 0)\n            timelineTooltip.attr('opacity', 0).attr('display', 'none');\n            // timelineTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\n            d3.select('#svg_container').style('z-index', 1);\n            eventTooltip.attr('opacity', 0).attr('transform', 'translate(0,0)');\n            d3.selectAll('.event_marker circle').style('stroke', colors.black);\n        })\n        .on('mousemove', (event) => {\n            var coords = d3.pointer( event );\n\n            var xDate = xScale.invert(coords[0]);\n\n            var tooltipStr = '';\n            if(options.timeline_frequency=='week') {\n                xDate = moment(xDate).startOf('isoWeek');\n                tooltipStr = xDate.format('ll');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            if(options.timeline_frequency=='day') {\n                xDate = moment(xDate).startOf('day');\n                tooltipStr = xDate.format('ll');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            if(options.timeline_frequency=='month') {\n                xDate = moment(xDate).startOf('month');\n                tooltipStr = xDate.format('MMMM YYYY');\n                d3.select('#timeline_tooltip_date tspan').text(tooltipStr);\n            }\n            hoverBar.attr('x', xScale(xDate.toDate()));\n\n            var groupedDataFiltered = groupedData.filter(function(d,i){\n                return moment(d.date).startOf('day').unix() == xDate.startOf('day').unix();\n            });\n            var vgroupedDataFiltered = vgroupedData.filter(function(d,i){\n                return moment(d.date).startOf('day').unix() == xDate.startOf('day').unix();\n            });\n\n            var deaths = '-';\n            var cases = '-';\n            var vaccines = '-';\n            if(options.timeline_type=='cumulative'){ \n                // cumulative\n                if(groupedDataFiltered[0]) cases = nFormatter(groupedDataFiltered[0].total_cumulative_cases, 2);\n                if(groupedDataFiltered[0]) deaths = nFormatter(groupedDataFiltered[0].total_cumulative_deaths, 2);\n                if(vgroupedDataFiltered[0]) vaccines = nFormatter(vgroupedDataFiltered[0].total_cumulative_vaccines, 2);\n            } else {\n                // non-cumulative/stacked\n                if(groupedDataFiltered[0]) cases = nFormatter(groupedDataFiltered[0].total_new_cases, 2);\n                if(groupedDataFiltered[0]) deaths = nFormatter(groupedDataFiltered[0].total_new_deaths, 2);\n                if(vgroupedDataFiltered[0]) vaccines = nFormatter(vgroupedDataFiltered[0].total_new_vaccines, 2);\n            }\n\n            d3.select('#tooltip_cases tspan').text((cases)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n            d3.select('#tooltip_deaths tspan').text((deaths)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n            d3.select('#tooltip_vaccines tspan').text((vaccines)).attr(\"text-anchor\", \"end\").attr('dx', 32)\n\n            // if((xDate.toDate().getTime()>options.maxDate.getTime())){\n            //     hoverBar.attr('opacity', 0);\n            // // } else \n            if(((xDate.toDate().getTime()<minDate.getTime()))&&(options.timeline_frequency=='day')){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n            }\n\n            if(options.timeline_frequency=='month'){\n                hoverBar.attr('width', function(){\n                   return xScale(moment(xDate).endOf('month')) - xScale(moment(xDate).startOf('month'));\n                })\n            }\n            timelineTooltip.attr('transform', function(){\n                var bw = barWidth;\n                var ratio = (options.brushR - options.brushL)/600;\n                var offset = 0;\n                if(ratio<0.5) offset = 3;\n                if(ratio<0.3) offset = 12;\n                if(ratio<0.2) offset = 20;\n                if(ratio<0.15) offset = 21;\n                if(options.timeline_frequency=='month') { \n                    if(ratio<0.6) offset = 20;\n                    if(ratio<0.5) offset = 30;\n                    if(ratio<0.3) offset = 50;\n                    if(ratio<0.2) offset = 60;\n                    if(ratio<0.1) offset = 70;\n                    return 'translate('+(((xScaleEvents(xDate.toDate()))+(barWidth/3))+offset)+','+(coords[1]+353)+')';\n                }\n                return 'translate('+((xScaleEvents(xDate.toDate())+(18))+offset)+','+(coords[1]+353)+')';\n            })\n\n            if(coords[1]<470){\n                timelineTooltip.attr('opacity', 1);\n                hoverBar.attr('opacity', 1);\n                hoverBar.attr('height', '100%');\n            } else if(coords[1]>510){\n                eventTooltip.attr('opacity', 1);\n                hoverBar.attr('height', '90%');\n                var x = moment(xScale.invert(coords[0])).startOf('day');\n                var xx = (xScale.invert(coords[0]))\n                eventTooltip.attr('transform', function(){\n                    return 'translate('+(xScaleEvents(x.toDate())+(-3))+','+(817)+')';\n                });\n\n                var events = tData.filter(function(d,i){\n                    return moment(d.date).startOf('day').unix() == x.unix()\n                });\n\n                // select nearest neighbor for ux purposes \n                if(events.length==0){\n                    events = tData.filter(function(d,i){\n                        return ((moment(d.date).startOf('day').unix() <= moment(x).add(1, 'days').unix())&&(moment(d.date).startOf('day').unix() >= moment(x).subtract(1, 'days').unix()))\n                    });\n                }\n                \n                if(events.length>0){\n\n                    d3.select('#event-'+moment(events[0].date).startOf('day').unix()).select('path').style('stroke', '#000').attr('opacity', 1);\n                    tooltipStr = moment(events[0].date).startOf('day').format('ll');\n                    d3.select('#event_tooltip_date tspan').text(tooltipStr);\n\n                    var wrap = textwrap().bounds({height: 200, width: 230}).method('tspans');\n                    var event = d3.select('#event_tooltip_text').text(events[0].description)\n                    .attr('y', 18)\n                    .attr('x', 6)\n                    d3.select('#event_tooltip_text').call(wrap);\n\n                    d3.selectAll('#event_tooltip_text tspan').attr('dy', '1.3em');\n                    var bbox = d3.select('#event_tooltip_text').node().getBBox();\n                    d3.select('#event_tooltip_rect').attr('width', bbox.width+17)\n                    .attr('height', bbox.height +26 );\n\n                    var h = d3.select('#event_tooltip_rect').attr('height');\n                    var ys = 0;\n\n                    if(bbox.height<20){\n                        ys = 19;\n                    } else if(bbox.height<30){\n                        ys = 9;\n                    } else if(bbox.height<40){\n                        ys = 0;\n                    } else if(bbox.height<50){\n                        ys = -20;\n                    } else if(bbox.height<60){\n                        ys = -20;\n                    }\n\n                    var y = d3.select('#event_tooltip_rect').attr('y');\n\n                    d3.select('#event_tooltip_rect').attr('y', ys);\n                    \n                    d3.selectAll('#event_tooltip_text').attr('y', function(d,i){\n                        return parseInt(d3.select(this).attr('y')) + ys;\n                    });\n\n                    d3.selectAll('#event_tooltip_date tspan').attr('dy', function(d,i){\n                        return ys;\n                    });\n\n                    eventTooltip.attr('opacity', 1);\n\n                } else {\n                    d3.selectAll('.event_marker circle').style('stroke', colors.black)\n                    eventTooltip.attr('opacity', 0);\n                }\n            } else {\n                eventTooltip.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                hoverBar.attr('opacity', 0);\n                hoverBar.attr('height', '100%');\n            }\n\n            if((options.timeline_frequency=='day')&&((xDate.toDate().getTime()<minDate.getTime()))){\n                hoverBar.attr('opacity', 0);\n                timelineTooltip.attr('opacity', 0);\n                return false;\n            }\n        });\n\n        tData = tData.filter(d => d.date.length > 0);\n\n        // event lin\n\n        yAxisGroup.append('line')\n        .attr('id', 'event-line')\n        .attr('x1', 0)\n        .attr('x2', 620)\n        .attr('y1', 893)\n        .attr('y2', 893)\n        .attr('stroke-width', 2.5)\n        .attr('stroke', colors.black);\n\n        var circles = yAxisGroup.append('g').selectAll('.event_marker')\n        .data(tData)\n        .enter()\n        .append('g')\n        .attr('class', 'event_marker')\n        .attr('id', function(d,i){\n            return 'event-'+moment(d.date).startOf('day').unix();\n        })\n        .attr('transform', function(d){\n            var x = xScaleEvents(new Date(d.date));\n            return 'translate('+(x)+', 893)';\n        })\n        .style('cursor', 'pointer');\n        // .append('path')\n        // .attr('d', \"M0,-6L4,0 0,6 -4,0Z\")\n        \n        circles.append(\"circle\")\n        .style('stroke', colors.black)\n        .attr('opacity', 1)\n        .attr('r', 6.5)\n        .attr('cx', 0)\n        .attr('cy', 0)\n        .style('stroke-width',2.2)\n        .style('fill', 'white');\n        circles\n        .append(\"circle\")\n        .attr('r', 2)\n        .attr('cx', 0)\n        .attr('cy', 0)\n        .attr('fill', colors.black)\n        .style('stroke', colors.black);\n\n\n        // create brush zoom\n        // reset\n        // options.brushL = 0;\n        // options.brushR = 600;\n        const brush = d3.brushX()\n        .extent([[0,0],[600,20]])\n        .on(\"start brush end\", brushed);\n\n        d3.select('.brush').remove();\n;\n        var gBrush = d3.select('#zoombar').append(\"g\")\n        .attr(\"class\", \"brush\")\n        .attr('opacity', 0.1)\n        .call(brush);\n\n\t\td3.selectAll('.handle rect').attr('fill-opacity', '1').style('visibility', 'visible').attr('width', 2).attr('fill', '#000').style('stroke-opacity', 0);\n\n        var brushScale = d3.scaleLinear()\n        .domain([-3, 597])\n        .range([0,2000]);\n\n        gBrush.call(brush.move, [options.brushL,options.brushR]);\n\n        function brushed(){\n            var x = parseFloat(d3.select('.handle--w').attr('x'));\n            var x2 = parseFloat(d3.select('.handle--e').attr('x'));\n            if((x2-x)<40) return false;\n            var w = d3.select('.selection').attr('width');\n            d3.select('#zoomL').attr('transform', 'translate('+x+',0)');\n            d3.select('#zoomR').attr('transform', 'translate('+(x2)+',0)');\n            d3.select('#zoomOverlay').attr('width', (x2-x));\n            d3.select('#zoomOverlay').attr('x', (x));\n            d3.select('#zoomOverlay').attr('transform', 'translate(3,0)');\n            var viewBoxW = Math.round(brushScale(x2)-brushScale(x));\n            var viewBoxX = Math.round(brushScale(x));\n            options.brushL = x+3;\n            options.brushR = x2+3;\n\n            xScaleAxis = d3.scaleTime()\n            .range([0,596])\n            .domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);\n\n            xScaleEvents = d3.scaleTime()\n            .range([25,619])\n            // .domain([minDate,md]);\n            .domain([new Date(xScale.invert(brushScale(x))),new Date(xScale.invert(brushScale(x2)))]);\n\n            d3.selectAll('.event_marker')\n            .attr('transform', function(d){\n                var x = xScaleEvents(new Date(d.date));\n                return 'translate('+(x)+', 893)';\n            });\n\n            xAxis = d3.axisBottom()\n            .ticks(5)\n            .scale(xScaleAxis);\n\n            xAxisCases.call(xAxis);\n            xAxisDeaths.call(xAxis);\n            xAxisVaccines.call(xAxis);\n            xAxisTimeline.call(xAxis);\n            \n            d3.select('#timechart_svg').attr('viewBox', viewBoxX + ' 0 '+ viewBoxW + ' 553')\n        }\n\n}\n\nexport function updateTimechart(data, options) {\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = d.week_start;\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = d.month_start;\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            if(!d.hasOwnProperty(dd)){\n               d[dd] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n            }\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n    });\n\n    vgroupedData = [];\n\n    if(options.timeline_type!='cumulative'){ // non-cumulative and stacked\n        // data.vaccines_data = data.vaccines_data_daily;\n        data.vaccines_data.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.daily_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n                }\n            });\n            d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines});\n            })\n        });\n\n    } else{ // cumulative only\n        var vData = [];\n        if(options.timeline_frequency==='day') {\n            vData = clone(data.vaccines_data);\n        }\n        if(options.timeline_frequency==='week') {\n            data.vaccines_data.forEach(function(d,i){\n                var endOfWeekDate = moment(d.date).endOf('isoWeek').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfWeekDate)||(date==moment(data.max_date).startOf('day').unix())){\n                    vData.push(d);\n                }\n            })\n        }\n        if(options.timeline_frequency==='month') {\n            var maxDateUnix = moment(data.max_date).startOf('day').unix();\n            data.vaccines_data.forEach(function(d,i){\n                var endOfMonthDate = moment(d.date).endOf('month').startOf('day').unix();\n                var date = moment(d.date).startOf('day').unix();\n                if((date==endOfMonthDate)||((moment(data.max_date).startOf('day').unix()!=endOfMonthDate)&&(date==maxDateUnix))){\n                    vData.push(d);\n                }\n            })\n        }\n\n        vData.forEach(function(d,i){\n            if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n            if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n            if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n            if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n            if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {cumulative_vaccines: 0};\n            vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.total_vaccinations;\n        });\n        // totals by date\n        vgroupedData.forEach(function(d,i){\n            regions.forEach(function(dd,ii){\n                if(!d[dd]){\n                    d[dd] = {cumulative_vaccines: 0}\n                }\n            });\n            d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n            d.region = [];\n            regions.forEach(function(dd,ii){\n                d.region.push({'region': dd, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n            })\n        });\n    }\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    const svg = d3.select('#timechart_svg');\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    // xScale = d3.scaleTime()\n    // .range([0,width])\n    // .domain([minDate,md]);\n\n    // xScaleAxis = d3.scaleTime()\n    // .range([23,596])\n    // .domain([minDate,md]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisCasesText = d3.select('#casesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = d3.select('#deathsAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisDeaths);\n\n    // y-axis vaccines\n    var yAxisVaccinesText = d3.select('#VaccinesAxis')\n    .transition()\n    .duration(500)\n    .call(yAxisVaccines);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n        return 'blue'\n    })\n\n    // // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        // if(options.timeline_type==='non-cumulative') if(y>310) return 0;\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(options.timeline_type==='non-cumulative') if(y<0) return 0;\n\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n\n    if(groupedData.length==0){\n        d3.selectAll('.cases_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n\n        d3.selectAll('.deaths_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140+170)\n        .attr('height', 0)\n        \n    }\n    // // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 344)'\n    })\n\n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .transition()\n    .duration(500)\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    })\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ if(y>0) { return y} else { return 0}; } else { return 0};\n    });\n\n    if(vgroupedData.length==0){\n        d3.selectAll('.vaccines_bar')\n        .transition()\n        .duration(500)\n        .attr('y', 140)\n        .attr('height', 0)\n    }\n   \n    // // bar size tweak for spacing\n    // if(options.timeline_frequency==='month'){\n    //     barGroups.selectAll(\".timeBar\")\n    //     .attr(\"width\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(1-barSpacing);\n    //       })\n    //     .attr(\"x\", function(d) {\n    //         var date = d3.select(this.parentNode).datum().date;\n    //         var next = d3.timeMonth.offset(date, 1);\n    //         return (xScale(next)- xScale(date))*(barSpacing/2);\n    //       })\n    //     }\n\n}\n\nexport default drawTimechart;\n"]},"metadata":{},"sourceType":"module"}