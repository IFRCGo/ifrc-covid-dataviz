{"ast":null,"code":"import*as d3 from\"d3\";import moment from'moment';import colors from'./colors';import{filter}from'./App';import mapboxgl from'!mapbox-gl';// eslint-disable-line import/no-webpack-loader-syntax\nimport'mapbox-gl/dist/mapbox-gl.css';import{addCommas}from'./HelperFunctions';mapboxgl.accessToken='pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';var map;var dots;var maxSize=15;export function createMap(data,options,filter){d3.select('#map-refresh').attr('display','none').style('cursor','pointer').on('click',function(d,i){map.setCenter([8,22]);map.setZoom(-0.01);d3.select('#map-refresh').attr('display','none');});map=new mapboxgl.Map({container:'map_div',// container ID\nstyle:'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww',// style URL\ncenter:[8,22],// starting position [lng, lat]\nzoom:-0.01// starting zoom\n});map.setRenderWorldCopies(false);map.addControl(new mapboxgl.NavigationControl());map.on('zoom',function(){d3.select('#map-refresh').attr('display','inline');});map.on('touchmove',function(){d3.select('#map-refresh').attr('display','inline');});map.on('wheel',function(){d3.select('#map-refresh').attr('display','inline');});map.on('drag',function(){d3.select('#map-refresh').attr('display','inline');});var container=map.getCanvasContainer();var svg=d3.select(container).append(\"svg\").attr('id','mapoverlay').attr(\"width\",\"100%\").attr(\"height\",\"24vw\").style(\"position\",\"absolute\").style(\"z-index\",2);dots=svg.selectAll(\".country-map\").data(data.world).enter().append(\"circle\").attr('class','country-map').attr('id',function(d,i){return'country-map-'+d.iso2;}).attr(\"r\",0);var maxValue=d3.max(data.country,function(d,i){return d[1].cumulative_cases;});var rScale=d3.scalePow().exponent(0.5).domain([0,maxValue]).range([0,15]);data.country.forEach(function(d,i){d3.select('#country-'+d[0]).attr('r',rScale(d[1].cumulative_cases)).attr('data-name',d[1].country);});document.getElementById(\"mapoverlay\").appendChild(d3.select('#map_tooltip').node());function render(){dots.attr(\"cx\",function(d){return project([d.lng,d.lat]).x;}).attr(\"cy\",function(d){return project([d.lng,d.lat]).y;});}map.on(\"viewreset\",render);map.on(\"move\",render);map.on(\"moveend\",render);render();// Call once to render\n// map.on('mousemove', function (e) {\n//     var features = map.queryRenderedFeatures(e.point);\n//     var displayProperties = [\n//     'type',\n//     'properties',\n//     'id',\n//     'layer',\n//     'source',\n//     'sourceLayer',\n//     'state'\n//     ];\n//     var displayFeatures = features.map(function (feat) {\n//     var displayFeat = {};\n//     displayProperties.forEach(function (prop) {\n//     displayFeat[prop] = feat[prop];\n//     });\n//     return displayFeat;\n//     });\n//     console.log(JSON.stringify(\n//     displayFeatures,\n//     null,\n//     2\n//     ))\n//     })\nupdateMap(data,options);}export function updateMap(data,options){var duration=800;var delay=10;if(options.map_toggle=='bi-weekly-change'){var maxValue=d3.max(data.country,function(d,i){return d[1].percent_change;});var rScale=d3.scalePow().exponent(0.5).domain([-1,0,1]).range([maxSize,0,maxSize]).clamp(true);d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);data.country.forEach(function(d,i){d3.select('#country-map-'+d[0]).transition('c').duration(duration).delay(delay).attr('r',rScale(d[1].percent_change)).style('stroke',function(){// if(d[1].percent_change>1){ return '#E02225'} else { return '#1F558C'}\nreturn'#FFF';}).style('fill',function(){if(d[1].percent_change>0){return colors.red;}else{return colors.blue;}});});}if(options.map_toggle=='cases'){var maxValue=d3.max(data.country,function(d,i){return d[1].cumulative_cases;});var rScale=d3.scalePow().exponent(0.5).domain([0,maxValue]).range([0,maxSize]);d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);data.country.forEach(function(d,i){d3.select('#country-map-'+d[0]).transition('c').duration(duration).delay(delay).attr('r',rScale(d[1].cumulative_cases)).style('fill',colors.red).style('stroke','#FFF');});}if(options.map_toggle=='deaths'){var maxValue=d3.max(data.country,function(d,i){return d[1].cumulative_deaths;});var rScale=d3.scalePow().exponent(0.5).domain([0,maxValue]).range([0,maxSize]);d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);data.country.forEach(function(d,i){d3.select('#country-map-'+d[0]).transition('c').duration(duration).delay(delay).attr('r',rScale(d[1].cumulative_deaths)).style('fill',colors.red).style('stroke','#FFF');});}if(options.map_toggle=='percent-fully-vaccinated'){var maxValue=d3.max(data.vGroup,function(d,i){return parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;});var rScale=d3.scalePow().exponent(0.55).domain([0,1]).range([1,maxSize]).clamp(true);d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);data.vGroup.forEach(function(d,i){var peoplevaccinated=parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;if(isNaN(peoplevaccinated))peoplevaccinated=0;d3.select('#country-map-'+d[1][0].country_code).transition('c').duration(duration).delay(delay).attr('r',rScale(peoplevaccinated)).style('stroke','#FFF').style('fill',function(){return colors.blue;});});}if(options.map_toggle=='percent-vaccine-acceptance'){var maxValue=d3.max(data.vGroup,function(d,i){return parseFloat(d[1][0].vaccince_acceptance_percent)/100;});var rScale=d3.scalePow().exponent(1).domain([0,1]).range([1,maxSize*.7]);// .clamp(true);\nd3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);data.vGroup.forEach(function(d,i){var vaccince_acceptance_percent=parseFloat(d[1][0].vaccince_acceptance_percent/100);if(isNaN(vaccince_acceptance_percent))vaccince_acceptance_percent=0;d3.select('#country-map-'+d[1][0].country_code).transition('c').duration(duration).delay(delay).attr('r',rScale(vaccince_acceptance_percent)).style('stroke','#FFF').style('fill',function(){return colors.blue;});});}function render(){dots.attr(\"cx\",function(d){return project([d.lng,d.lat]).x;}).attr(\"cy\",function(d){return project([d.lng,d.lat]).y;});}map.on(\"viewreset\",render);map.on(\"move\",render);map.on(\"moveend\",render);render();// Call once to render\n// tooltips\nvar mapTooltip=d3.select('#map_tooltip').attr('opacity',1).attr('transform','translate(0,0)').attr('display','none');d3.selectAll('.country-map').on('mousemove',function(event,d){var id=d3.select(this).attr('id').substr(12,2);var countryfiltered=data.equity_data.filter(function(d){return d.country_iso2==id;});var countryName;if(countryfiltered[0])countryName=countryfiltered[0].country_name;mapTooltip.select('#map_tooltip_name tspan').text(countryName);if(options.map_toggle=='cases'){var country=data.country.filter(function(d){return d[1].country_code==id;})[0];if(country.length==0)return false;mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_cases)+' cases');}if(options.map_toggle=='deaths'){var country=data.country.filter(function(d){return d[1].country_code==id;})[0];if(country.length==0)return false;mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_deaths)+' deaths');}if(options.map_toggle=='bi-weekly-change'){var country=data.country.filter(function(d){return d[1].country_code==id;})[0];if(country.length==0)return false;var val=(country[1].percent_change*100).toFixed(1);var str='';if(val>=0){str='% increase';}else{str='% decrease';}mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);}if(options.map_toggle=='percent-fully-vaccinated'){var country=data.vGroup.filter(function(d){return d[1][0].country_code==id;})[0][1];if(!country||country.length==0)return false;mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1)+'% fully vaccinated');}if(options.map_toggle=='percent-vaccine-acceptance'){var country=data.vGroup.filter(function(d){return d[1][0].country_code==id;})[0][1];if(!country||country.length==0)return false;mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].vaccince_acceptance_percent).toFixed(1)+'% vaccine acceptance');}d3.select('#map_tooltip_bg').attr('width',0);var bbox=mapTooltip.node().getBBox();d3.select('#map_tooltip_bg').attr('width',parseFloat(bbox.width)+2);var scale=window.innerWidth/1329;mapTooltip.attr('display','inline').attr('transform','translate('+project([d.lng,d.lat]).x+','+project([d.lng,d.lat]).y+')scale('+scale+')');var heightOffset=mapTooltip.node().getBBox();mapTooltip.attr('transform','translate('+(project([d.lng,d.lat]).x+3)+','+(project([d.lng,d.lat]).y+2-heightOffset.height/2)+')scale('+scale+')');}).on('mouseout',function(event){if(event.toElement=='tspan')return false;mapTooltip.attr('display','none');});}function project(d){return map.project(new mapboxgl.LngLat(d[0],d[1]));}export default createMap;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Map.js"],"names":["d3","moment","colors","filter","mapboxgl","addCommas","accessToken","map","dots","maxSize","createMap","data","options","select","attr","style","on","d","i","setCenter","setZoom","Map","container","center","zoom","setRenderWorldCopies","addControl","NavigationControl","getCanvasContainer","svg","append","selectAll","world","enter","iso2","maxValue","max","country","cumulative_cases","rScale","scalePow","exponent","domain","range","forEach","document","getElementById","appendChild","node","render","project","lng","lat","x","y","updateMap","duration","delay","map_toggle","percent_change","clamp","transition","red","blue","cumulative_deaths","vGroup","parseFloat","people_fully_vaccinated_per_hundred","peoplevaccinated","isNaN","country_code","vaccince_acceptance_percent","mapTooltip","event","id","substr","countryfiltered","equity_data","country_iso2","countryName","country_name","text","length","val","toFixed","str","Math","abs","bbox","getBBox","width","scale","window","innerWidth","heightOffset","height","toElement","LngLat"],"mappings":"AAAA,MAAO,GAAKA,CAAAA,EAAZ,KAAoB,IAApB,CACA,MAAOC,CAAAA,MAAP,KAAmB,QAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,OAAQC,MAAR,KAAqB,OAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CAAmC;AACnC,MAAO,8BAAP,CACA,OAAQC,SAAR,KAAwB,mBAAxB,CAEAD,QAAQ,CAACE,WAAT,CAAuB,2FAAvB,CAEA,GAAIC,CAAAA,GAAJ,CACA,GAAIC,CAAAA,IAAJ,CACA,GAAIC,CAAAA,OAAO,CAAG,EAAd,CAEA,MAAO,SAASC,CAAAA,SAAT,CAAmBC,IAAnB,CAAyBC,OAAzB,CAAkCT,MAAlC,CAA0C,CAE7CH,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,MAA1C,EAAkDC,KAAlD,CAAwD,QAAxD,CAAkE,SAAlE,EACCC,EADD,CACI,OADJ,CACa,SAASC,CAAT,CAAWC,CAAX,CAAa,CACtBX,GAAG,CAACY,SAAJ,CAAc,CAAC,CAAD,CAAI,EAAJ,CAAd,EACAZ,GAAG,CAACa,OAAJ,CAAY,CAAC,IAAb,EACApB,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,MAA1C,EACH,CALD,EAOAP,GAAG,CAAG,GAAIH,CAAAA,QAAQ,CAACiB,GAAb,CAAiB,CACnBC,SAAS,CAAE,SADQ,CACG;AACtBP,KAAK,CAAE,mDAFY,CAEyC;AAC5DQ,MAAM,CAAE,CAAC,CAAD,CAAI,EAAJ,CAHW,CAGF;AACjBC,IAAI,CAAE,CAAC,IAAK;AAJO,CAAjB,CAAN,CAOAjB,GAAG,CAACkB,oBAAJ,CAAyB,KAAzB,EACAlB,GAAG,CAACmB,UAAJ,CAAe,GAAItB,CAAAA,QAAQ,CAACuB,iBAAb,EAAf,EAEApB,GAAG,CAACS,EAAJ,CAAO,MAAP,CAAe,UAAW,CACtBhB,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,QAA1C,EACH,CAFD,EAIAP,GAAG,CAACS,EAAJ,CAAO,WAAP,CAAoB,UAAW,CAC3BhB,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,QAA1C,EACH,CAFD,EAIAP,GAAG,CAACS,EAAJ,CAAO,OAAP,CAAgB,UAAW,CACvBhB,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,QAA1C,EACH,CAFD,EAIAP,GAAG,CAACS,EAAJ,CAAO,MAAP,CAAe,UAAW,CACtBhB,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,QAA1C,EACH,CAFD,EAMA,GAAIQ,CAAAA,SAAS,CAAGf,GAAG,CAACqB,kBAAJ,EAAhB,CAEA,GAAIC,CAAAA,GAAG,CAAG7B,EAAE,CACXa,MADS,CACFS,SADE,EAETQ,MAFS,CAEF,KAFE,EAGThB,IAHS,CAGJ,IAHI,CAGE,YAHF,EAITA,IAJS,CAIJ,OAJI,CAIK,MAJL,EAKTA,IALS,CAKJ,QALI,CAKM,MALN,EAMTC,KANS,CAMH,UANG,CAMS,UANT,EAOTA,KAPS,CAOH,SAPG,CAOQ,CAPR,CAAV,CASAP,IAAI,CAAGqB,GAAG,CACTE,SADM,CACI,cADJ,EAENpB,IAFM,CAEDA,IAAI,CAACqB,KAFJ,EAGNC,KAHM,GAINH,MAJM,CAIC,QAJD,EAKNhB,IALM,CAKD,OALC,CAKQ,aALR,EAMNA,IANM,CAMD,IANC,CAMK,SAASG,CAAT,CAAWC,CAAX,CAAa,CAAE,MAAO,eAAeD,CAAC,CAACiB,IAAxB,CAA8B,CANlD,EAONpB,IAPM,CAOD,GAPC,CAOI,CAPJ,CAAP,CAUA,GAAIqB,CAAAA,QAAQ,CAAGnC,EAAE,CAACoC,GAAH,CAAOzB,IAAI,CAAC0B,OAAZ,CAAqB,SAASpB,CAAT,CAAWC,CAAX,CAAa,CAC7C,MAAOD,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAKqB,gBAAZ,CACH,CAFc,CAAf,CAIA,GAAIC,CAAAA,MAAM,CAAGvC,EAAE,CAACwC,QAAH,GAAcC,QAAd,CAAuB,GAAvB,EACVC,MADU,CACH,CAAC,CAAD,CAAIP,QAAJ,CADG,EAEVQ,KAFU,CAEJ,CAAC,CAAD,CAAI,EAAJ,CAFI,CAAb,CAIAhC,IAAI,CAAC0B,OAAL,CAAaO,OAAb,CAAqB,SAAS3B,CAAT,CAAWC,CAAX,CAAa,CAC9BlB,EAAE,CAACa,MAAH,CAAU,YAAYI,CAAC,CAAC,CAAD,CAAvB,EAA4BH,IAA5B,CAAiC,GAAjC,CAAsCyB,MAAM,CAACtB,CAAC,CAAC,CAAD,CAAD,CAAKqB,gBAAN,CAA5C,EACCxB,IADD,CACM,WADN,CACmBG,CAAC,CAAC,CAAD,CAAD,CAAKoB,OADxB,EAEH,CAHD,EAKAQ,QAAQ,CAACC,cAAT,CAAwB,YAAxB,EAAsCC,WAAtC,CAAkD/C,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BmC,IAA1B,EAAlD,EAGA,QAASC,CAAAA,MAAT,EAAkB,CACdzC,IAAI,CACDM,IADH,CACQ,IADR,CACc,SAASG,CAAT,CAAY,CACtB,MAAOiC,CAAAA,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BC,CAAjC,CACD,CAHH,EAIGvC,IAJH,CAIQ,IAJR,CAIc,SAASG,CAAT,CAAY,CACtB,MAAOiC,CAAAA,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BE,CAAjC,CACD,CANH,EAOD,CAEH/C,GAAG,CAACS,EAAJ,CAAO,WAAP,CAAoBiC,MAApB,EACA1C,GAAG,CAACS,EAAJ,CAAO,MAAP,CAAeiC,MAAf,EACA1C,GAAG,CAACS,EAAJ,CAAO,SAAP,CAAkBiC,MAAlB,EACAA,MAAM,GAAI;AAEV;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACAM,SAAS,CAAC5C,IAAD,CAAOC,OAAP,CAAT,CACH,CAED,MAAO,SAAS2C,CAAAA,SAAT,CAAmB5C,IAAnB,CAAyBC,OAAzB,CAAkC,CAErC,GAAI4C,CAAAA,QAAQ,CAAG,GAAf,CACA,GAAIC,CAAAA,KAAK,CAAG,EAAZ,CAGA,GAAG7C,OAAO,CAAC8C,UAAR,EAAsB,kBAAzB,CAA4C,CAExC,GAAIvB,CAAAA,QAAQ,CAAGnC,EAAE,CAACoC,GAAH,CAAOzB,IAAI,CAAC0B,OAAZ,CAAqB,SAASpB,CAAT,CAAWC,CAAX,CAAa,CAC7C,MAAOD,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAK0C,cAAZ,CACH,CAFc,CAAf,CAIA,GAAIpB,CAAAA,MAAM,CAAGvC,EAAE,CAACwC,QAAH,GAAcC,QAAd,CAAuB,GAAvB,EACZC,MADY,CACL,CAAC,CAAC,CAAF,CAAK,CAAL,CAAQ,CAAR,CADK,EAEZC,KAFY,CAEN,CAAClC,OAAD,CAAU,CAAV,CAAaA,OAAb,CAFM,EAGZmD,KAHY,CAGN,IAHM,CAAb,CAKA5D,EAAE,CAAC+B,SAAH,CAAa,cAAb,EAA6B8B,UAA7B,CAAwC,GAAxC,EAA6CL,QAA7C,CAAsDA,QAAQ,CAAC,GAA/D,EAAoE1C,IAApE,CAAyE,GAAzE,CAA6E,CAA7E,EAEAH,IAAI,CAAC0B,OAAL,CAAaO,OAAb,CAAqB,SAAS3B,CAAT,CAAWC,CAAX,CAAa,CAC9BlB,EAAE,CAACa,MAAH,CAAU,gBAAgBI,CAAC,CAAC,CAAD,CAA3B,EACC4C,UADD,CACY,GADZ,EACiBL,QADjB,CAC0BA,QAD1B,EACoCC,KADpC,CAC0CA,KAD1C,EAEC3C,IAFD,CAEM,GAFN,CAEWyB,MAAM,CAACtB,CAAC,CAAC,CAAD,CAAD,CAAK0C,cAAN,CAFjB,EAGC5C,KAHD,CAGO,QAHP,CAGiB,UAAU,CACvB;AACA,MAAO,MAAP,CACH,CAND,EAMGA,KANH,CAMS,MANT,CAMiB,UAAU,CACvB,GAAGE,CAAC,CAAC,CAAD,CAAD,CAAK0C,cAAL,CAAoB,CAAvB,CAAyB,CAAE,MAAOzD,CAAAA,MAAM,CAAC4D,GAAd,CAAmB,CAA9C,IAAoD,CAAE,MAAO5D,CAAAA,MAAM,CAAC6D,IAAd,CAAmB,CAC5E,CARD,EASH,CAVD,EAYH,CAED,GAAGnD,OAAO,CAAC8C,UAAR,EAAsB,OAAzB,CAAiC,CAC7B,GAAIvB,CAAAA,QAAQ,CAAGnC,EAAE,CAACoC,GAAH,CAAOzB,IAAI,CAAC0B,OAAZ,CAAqB,SAASpB,CAAT,CAAWC,CAAX,CAAa,CAC7C,MAAOD,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAKqB,gBAAZ,CACH,CAFc,CAAf,CAIA,GAAIC,CAAAA,MAAM,CAAGvC,EAAE,CAACwC,QAAH,GAAcC,QAAd,CAAuB,GAAvB,EACZC,MADY,CACL,CAAC,CAAD,CAAIP,QAAJ,CADK,EAEZQ,KAFY,CAEN,CAAC,CAAD,CAAIlC,OAAJ,CAFM,CAAb,CAIAT,EAAE,CAAC+B,SAAH,CAAa,cAAb,EAA6B8B,UAA7B,CAAwC,GAAxC,EAA6CL,QAA7C,CAAsDA,QAAQ,CAAC,GAA/D,EAAoE1C,IAApE,CAAyE,GAAzE,CAA6E,CAA7E,EAEAH,IAAI,CAAC0B,OAAL,CAAaO,OAAb,CAAqB,SAAS3B,CAAT,CAAWC,CAAX,CAAa,CAC9BlB,EAAE,CAACa,MAAH,CAAU,gBAAgBI,CAAC,CAAC,CAAD,CAA3B,EACC4C,UADD,CACY,GADZ,EACiBL,QADjB,CAC0BA,QAD1B,EACoCC,KADpC,CAC0CA,KAD1C,EAEC3C,IAFD,CAEM,GAFN,CAEWyB,MAAM,CAACtB,CAAC,CAAC,CAAD,CAAD,CAAKqB,gBAAN,CAFjB,EAGCvB,KAHD,CAGO,MAHP,CAGeb,MAAM,CAAC4D,GAHtB,EAIC/C,KAJD,CAIO,QAJP,CAIiB,MAJjB,EAKH,CAND,EAQH,CAED,GAAGH,OAAO,CAAC8C,UAAR,EAAsB,QAAzB,CAAkC,CAC9B,GAAIvB,CAAAA,QAAQ,CAAGnC,EAAE,CAACoC,GAAH,CAAOzB,IAAI,CAAC0B,OAAZ,CAAqB,SAASpB,CAAT,CAAWC,CAAX,CAAa,CAC7C,MAAOD,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAK+C,iBAAZ,CACH,CAFc,CAAf,CAIA,GAAIzB,CAAAA,MAAM,CAAGvC,EAAE,CAACwC,QAAH,GAAcC,QAAd,CAAuB,GAAvB,EACZC,MADY,CACL,CAAC,CAAD,CAAIP,QAAJ,CADK,EAEZQ,KAFY,CAEN,CAAC,CAAD,CAAIlC,OAAJ,CAFM,CAAb,CAIAT,EAAE,CAAC+B,SAAH,CAAa,cAAb,EAA6B8B,UAA7B,CAAwC,GAAxC,EAA6CL,QAA7C,CAAsDA,QAAQ,CAAC,GAA/D,EAAoE1C,IAApE,CAAyE,GAAzE,CAA6E,CAA7E,EAEAH,IAAI,CAAC0B,OAAL,CAAaO,OAAb,CAAqB,SAAS3B,CAAT,CAAWC,CAAX,CAAa,CAC9BlB,EAAE,CAACa,MAAH,CAAU,gBAAgBI,CAAC,CAAC,CAAD,CAA3B,EACC4C,UADD,CACY,GADZ,EACiBL,QADjB,CAC0BA,QAD1B,EACoCC,KADpC,CAC0CA,KAD1C,EAEC3C,IAFD,CAEM,GAFN,CAEWyB,MAAM,CAACtB,CAAC,CAAC,CAAD,CAAD,CAAK+C,iBAAN,CAFjB,EAGCjD,KAHD,CAGO,MAHP,CAGeb,MAAM,CAAC4D,GAHtB,EAIC/C,KAJD,CAIO,QAJP,CAIiB,MAJjB,EAKH,CAND,EAQH,CAED,GAAGH,OAAO,CAAC8C,UAAR,EAAsB,0BAAzB,CAAoD,CAChD,GAAIvB,CAAAA,QAAQ,CAAGnC,EAAE,CAACoC,GAAH,CAAOzB,IAAI,CAACsD,MAAZ,CAAoB,SAAShD,CAAT,CAAWC,CAAX,CAAa,CAC5C,MAAOgD,CAAAA,UAAU,CAACjD,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQkD,mCAAT,CAAV,CAAwD,GAA/D,CACH,CAFc,CAAf,CAIA,GAAI5B,CAAAA,MAAM,CAAGvC,EAAE,CAACwC,QAAH,GAAcC,QAAd,CAAuB,IAAvB,EACZC,MADY,CACL,CAAC,CAAD,CAAI,CAAJ,CADK,EAEZC,KAFY,CAEN,CAAC,CAAD,CAAIlC,OAAJ,CAFM,EAGZmD,KAHY,CAGN,IAHM,CAAb,CAKA5D,EAAE,CAAC+B,SAAH,CAAa,cAAb,EAA6B8B,UAA7B,CAAwC,GAAxC,EAA6CL,QAA7C,CAAsDA,QAAQ,CAAC,GAA/D,EAAoE1C,IAApE,CAAyE,GAAzE,CAA6E,CAA7E,EAEAH,IAAI,CAACsD,MAAL,CAAYrB,OAAZ,CAAoB,SAAS3B,CAAT,CAAWC,CAAX,CAAa,CAC7B,GAAIkD,CAAAA,gBAAgB,CAAGF,UAAU,CAACjD,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQkD,mCAAT,CAAV,CAAwD,GAA/E,CACA,GAAGE,KAAK,CAACD,gBAAD,CAAR,CAA4BA,gBAAgB,CAAG,CAAnB,CAC5BpE,EAAE,CAACa,MAAH,CAAU,gBAAgBI,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQqD,YAAlC,EACCT,UADD,CACY,GADZ,EACiBL,QADjB,CAC0BA,QAD1B,EACoCC,KADpC,CAC0CA,KAD1C,EAEC3C,IAFD,CAEM,GAFN,CAEWyB,MAAM,CAAC6B,gBAAD,CAFjB,EAGCrD,KAHD,CAGO,QAHP,CAGiB,MAHjB,EAICA,KAJD,CAIO,MAJP,CAIe,UAAU,CACrB,MAAOb,CAAAA,MAAM,CAAC6D,IAAd,CACH,CAND,EAOH,CAVD,EAaH,CAED,GAAGnD,OAAO,CAAC8C,UAAR,EAAsB,4BAAzB,CAAsD,CAClD,GAAIvB,CAAAA,QAAQ,CAAGnC,EAAE,CAACoC,GAAH,CAAOzB,IAAI,CAACsD,MAAZ,CAAoB,SAAShD,CAAT,CAAWC,CAAX,CAAa,CAC5C,MAAOgD,CAAAA,UAAU,CAACjD,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQsD,2BAAT,CAAV,CAAgD,GAAvD,CACH,CAFc,CAAf,CAKA,GAAIhC,CAAAA,MAAM,CAAGvC,EAAE,CAACwC,QAAH,GAAcC,QAAd,CAAuB,CAAvB,EACZC,MADY,CACL,CAAC,CAAD,CAAI,CAAJ,CADK,EAEZC,KAFY,CAEN,CAAC,CAAD,CAAIlC,OAAO,CAAC,EAAZ,CAFM,CAAb,CAGA;AAEAT,EAAE,CAAC+B,SAAH,CAAa,cAAb,EAA6B8B,UAA7B,CAAwC,GAAxC,EAA6CL,QAA7C,CAAsDA,QAAQ,CAAC,GAA/D,EAAoE1C,IAApE,CAAyE,GAAzE,CAA6E,CAA7E,EAEAH,IAAI,CAACsD,MAAL,CAAYrB,OAAZ,CAAoB,SAAS3B,CAAT,CAAWC,CAAX,CAAa,CAC7B,GAAIqD,CAAAA,2BAA2B,CAAGL,UAAU,CAACjD,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQsD,2BAAR,CAAoC,GAArC,CAA5C,CAEA,GAAGF,KAAK,CAACE,2BAAD,CAAR,CAAuCA,2BAA2B,CAAG,CAA9B,CAEvCvE,EAAE,CAACa,MAAH,CAAU,gBAAgBI,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQqD,YAAlC,EACCT,UADD,CACY,GADZ,EACiBL,QADjB,CAC0BA,QAD1B,EACoCC,KADpC,CAC0CA,KAD1C,EAEC3C,IAFD,CAEM,GAFN,CAEWyB,MAAM,CAACgC,2BAAD,CAFjB,EAGCxD,KAHD,CAGO,QAHP,CAGiB,MAHjB,EAICA,KAJD,CAIO,MAJP,CAIe,UAAU,CACrB,MAAOb,CAAAA,MAAM,CAAC6D,IAAd,CACH,CAND,EAOH,CAZD,EAcH,CAED,QAASd,CAAAA,MAAT,EAAkB,CACdzC,IAAI,CACDM,IADH,CACQ,IADR,CACc,SAASG,CAAT,CAAY,CACtB,MAAOiC,CAAAA,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BC,CAAjC,CACD,CAHH,EAIGvC,IAJH,CAIQ,IAJR,CAIc,SAASG,CAAT,CAAY,CACtB,MAAOiC,CAAAA,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BE,CAAjC,CACD,CANH,EAOD,CAEH/C,GAAG,CAACS,EAAJ,CAAO,WAAP,CAAoBiC,MAApB,EACA1C,GAAG,CAACS,EAAJ,CAAO,MAAP,CAAeiC,MAAf,EACA1C,GAAG,CAACS,EAAJ,CAAO,SAAP,CAAkBiC,MAAlB,EACAA,MAAM,GAAI;AAEV;AAEA,GAAIuB,CAAAA,UAAU,CAAGxE,EAAE,CAACa,MAAH,CAAU,cAAV,EAA0BC,IAA1B,CAA+B,SAA/B,CAA0C,CAA1C,EAA6CA,IAA7C,CAAkD,WAAlD,CAA+D,gBAA/D,EAAiFA,IAAjF,CAAsF,SAAtF,CAAiG,MAAjG,CAAjB,CAEAd,EAAE,CAAC+B,SAAH,CAAa,cAAb,EAA6Bf,EAA7B,CAAgC,WAAhC,CAA6C,SAASyD,KAAT,CAAgBxD,CAAhB,CAAkB,CAE3D,GAAIyD,CAAAA,EAAE,CAAG1E,EAAE,CAACa,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB,IAArB,EAA2B6D,MAA3B,CAAkC,EAAlC,CAAqC,CAArC,CAAT,CACA,GAAIC,CAAAA,eAAe,CAAGjE,IAAI,CAACkE,WAAL,CAAiB1E,MAAjB,CAAwB,SAAAc,CAAC,QAAEA,CAAAA,CAAC,CAAC6D,YAAF,EAAkBJ,EAApB,EAAzB,CAAtB,CACA,GAAIK,CAAAA,WAAJ,CACA,GAAGH,eAAe,CAAC,CAAD,CAAlB,CAAuBG,WAAW,CAAGH,eAAe,CAAC,CAAD,CAAf,CAAmBI,YAAjC,CAEvBR,UAAU,CAAC3D,MAAX,CAAkB,yBAAlB,EAA6CoE,IAA7C,CAAkDF,WAAlD,EAEA,GAAGnE,OAAO,CAAC8C,UAAR,EAAoB,OAAvB,CAA+B,CAC3B,GAAIrB,CAAAA,OAAO,CAAG1B,IAAI,CAAC0B,OAAL,CAAalC,MAAb,CAAoB,SAAAc,CAAC,QAAEA,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAKqD,YAAL,EAAqBI,EAAvB,EAArB,EAAgD,CAAhD,CAAd,CACA,GAAGrC,OAAO,CAAC6C,MAAR,EAAgB,CAAnB,CAAsB,MAAO,MAAP,CACtBV,UAAU,CAAC3D,MAAX,CAAkB,wBAAlB,EAA4CoE,IAA5C,CAAiD5E,SAAS,CAACgC,OAAO,CAAC,CAAD,CAAP,CAAWC,gBAAZ,CAAT,CAAuC,QAAxF,EACH,CAED,GAAG1B,OAAO,CAAC8C,UAAR,EAAoB,QAAvB,CAAgC,CAC5B,GAAIrB,CAAAA,OAAO,CAAG1B,IAAI,CAAC0B,OAAL,CAAalC,MAAb,CAAoB,SAAAc,CAAC,QAAEA,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAKqD,YAAL,EAAqBI,EAAvB,EAArB,EAAgD,CAAhD,CAAd,CACA,GAAGrC,OAAO,CAAC6C,MAAR,EAAgB,CAAnB,CAAsB,MAAO,MAAP,CACtBV,UAAU,CAAC3D,MAAX,CAAkB,wBAAlB,EAA4CoE,IAA5C,CAAiD5E,SAAS,CAACgC,OAAO,CAAC,CAAD,CAAP,CAAW2B,iBAAZ,CAAT,CAAwC,SAAzF,EACH,CAED,GAAGpD,OAAO,CAAC8C,UAAR,EAAoB,kBAAvB,CAA0C,CACtC,GAAIrB,CAAAA,OAAO,CAAG1B,IAAI,CAAC0B,OAAL,CAAalC,MAAb,CAAoB,SAAAc,CAAC,QAAEA,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAKqD,YAAL,EAAqBI,EAAvB,EAArB,EAAgD,CAAhD,CAAd,CACA,GAAGrC,OAAO,CAAC6C,MAAR,EAAgB,CAAnB,CAAsB,MAAO,MAAP,CACtB,GAAIC,CAAAA,GAAG,CAAG,CAAE9C,OAAO,CAAC,CAAD,CAAP,CAAWsB,cAAZ,CAA4B,GAA7B,EAAkCyB,OAAlC,CAA0C,CAA1C,CAAV,CACA,GAAIC,CAAAA,GAAG,CAAG,EAAV,CACA,GAAGF,GAAG,EAAE,CAAR,CAAU,CACNE,GAAG,CAAG,YAAN,CACH,CAFD,IAEO,CACHA,GAAG,CAAG,YAAN,CACH,CACDb,UAAU,CAAC3D,MAAX,CAAkB,wBAAlB,EAA4CoE,IAA5C,CAAiDK,IAAI,CAACC,GAAL,CAASJ,GAAT,EAAcE,GAA/D,EACH,CAED,GAAGzE,OAAO,CAAC8C,UAAR,EAAoB,0BAAvB,CAAkD,CAC9C,GAAIrB,CAAAA,OAAO,CAAG1B,IAAI,CAACsD,MAAL,CAAY9D,MAAZ,CAAmB,SAAAc,CAAC,QAAEA,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQqD,YAAR,EAAwBI,EAA1B,EAApB,EAAkD,CAAlD,EAAqD,CAArD,CAAd,CACA,GAAI,CAACrC,OAAF,EAAaA,OAAO,CAAC6C,MAAR,EAAgB,CAAhC,CAAoC,MAAO,MAAP,CACpCV,UAAU,CAAC3D,MAAX,CAAkB,wBAAlB,EAA4CoE,IAA5C,CAAiDf,UAAU,CAAC7B,OAAO,CAAC,CAAD,CAAP,CAAW8B,mCAAZ,CAAV,CAA2DiB,OAA3D,CAAmE,CAAnE,EAAsE,oBAAvH,EACH,CAED,GAAGxE,OAAO,CAAC8C,UAAR,EAAoB,4BAAvB,CAAoD,CAChD,GAAIrB,CAAAA,OAAO,CAAG1B,IAAI,CAACsD,MAAL,CAAY9D,MAAZ,CAAmB,SAAAc,CAAC,QAAEA,CAAAA,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,EAAQqD,YAAR,EAAwBI,EAA1B,EAApB,EAAkD,CAAlD,EAAqD,CAArD,CAAd,CACA,GAAI,CAACrC,OAAF,EAAaA,OAAO,CAAC6C,MAAR,EAAgB,CAAhC,CAAoC,MAAO,MAAP,CACpCV,UAAU,CAAC3D,MAAX,CAAkB,wBAAlB,EAA4CoE,IAA5C,CAAiDf,UAAU,CAAC7B,OAAO,CAAC,CAAD,CAAP,CAAWkC,2BAAZ,CAAV,CAAmDa,OAAnD,CAA2D,CAA3D,EAA8D,sBAA/G,EACH,CAGDpF,EAAE,CAACa,MAAH,CAAU,iBAAV,EAA6BC,IAA7B,CAAkC,OAAlC,CAA2C,CAA3C,EAEA,GAAI0E,CAAAA,IAAI,CAAGhB,UAAU,CAACxB,IAAX,GAAkByC,OAAlB,EAAX,CACAzF,EAAE,CAACa,MAAH,CAAU,iBAAV,EAA6BC,IAA7B,CAAkC,OAAlC,CAA4CoD,UAAU,CAACsB,IAAI,CAACE,KAAN,CAAV,CAAuB,CAAnE,EACA,GAAIC,CAAAA,KAAK,CAAGC,MAAM,CAACC,UAAP,CAAkB,IAA9B,CACArB,UAAU,CACT1D,IADD,CACM,SADN,CACiB,QADjB,EAECA,IAFD,CAEM,WAFN,CAEmB,aAAaoC,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BC,CAAvC,CAAyC,GAAzC,CAA6CH,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BE,CAAvE,CAAyE,SAAzE,CAAmFqC,KAAnF,CAAyF,GAF5G,EAIA,GAAIG,CAAAA,YAAY,CAAGtB,UAAU,CAACxB,IAAX,GAAkByC,OAAlB,EAAnB,CACAjB,UAAU,CAAC1D,IAAX,CAAgB,WAAhB,CAA6B,cAAcoC,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BC,CAA1B,CAA4B,CAA1C,EAA6C,GAA7C,EAAkDH,OAAO,CAAE,CAACjC,CAAC,CAACkC,GAAH,CAAQlC,CAAC,CAACmC,GAAV,CAAF,CAAP,CAA0BE,CAA1B,CAA4B,CAA5B,CAA8BwC,YAAY,CAACC,MAAb,CAAoB,CAApG,EAAuG,SAAvG,CAAiHJ,KAAjH,CAAuH,GAApJ,EAEH,CA3DD,EA2DG3E,EA3DH,CA2DM,UA3DN,CA2DkB,SAASyD,KAAT,CAAe,CAC7B,GAAGA,KAAK,CAACuB,SAAN,EAAiB,OAApB,CAA6B,MAAO,MAAP,CAC7BxB,UAAU,CAAC1D,IAAX,CAAgB,SAAhB,CAA2B,MAA3B,EACH,CA9DD,EAgEH,CAED,QAASoC,CAAAA,OAAT,CAAiBjC,CAAjB,CAAoB,CAChB,MAAOV,CAAAA,GAAG,CAAC2C,OAAJ,CAAY,GAAI9C,CAAAA,QAAQ,CAAC6F,MAAb,CAAoBhF,CAAC,CAAC,CAAD,CAArB,CAA0BA,CAAC,CAAC,CAAD,CAA3B,CAAZ,CAAP,CACH,CAGD,cAAeP,CAAAA,SAAf","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {filter} from './App';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport {addCommas} from './HelperFunctions';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';\n\nlet map;\nlet dots; \nlet maxSize = 15; \n\nexport function createMap(data, options, filter) {\n\n    d3.select('#map-refresh').attr('display', 'none').style('cursor', 'pointer')\n    .on('click', function(d,i){\n        map.setCenter([8, 22]);\n        map.setZoom(-0.01);\n        d3.select('#map-refresh').attr('display', 'none');\n    })\n    \n    map = new mapboxgl.Map({\n        container: 'map_div', // container ID\n        style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww', // style URL\n        center: [8, 22], // starting position [lng, lat]\n        zoom: -0.01 // starting zoom\n    });\n\n    map.setRenderWorldCopies(false);\n    map.addControl(new mapboxgl.NavigationControl());\n    \n    map.on('zoom', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('touchmove', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('wheel', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n    map.on('drag', function() {\n        d3.select('#map-refresh').attr('display', 'inline');\n    });\n\n\n\n    var container = map.getCanvasContainer();\n\n    var svg = d3\n    .select(container)\n    .append(\"svg\")\n    .attr('id', 'mapoverlay')\n    .attr(\"width\", \"100%\")\n    .attr(\"height\", \"24vw\")\n    .style(\"position\", \"absolute\")\n    .style(\"z-index\", 2);\n\n    dots = svg\n    .selectAll(\".country-map\")\n    .data(data.world)\n    .enter()\n    .append(\"circle\")\n    .attr('class', 'country-map')\n    .attr('id', function(d,i){ return 'country-map-'+d.iso2 })\n    .attr(\"r\", 0)\n    \n\n    var maxValue = d3.max(data.country, function(d,i){\n        return d[1].cumulative_cases;\n    })\n\n    var rScale = d3.scalePow().exponent(0.5)\n      .domain([0, maxValue])\n      .range([0, 15]);\n\n    data.country.forEach(function(d,i){\n        d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases))\n        .attr('data-name', d[1].country)\n    })\n    \n    document.getElementById(\"mapoverlay\").appendChild(d3.select('#map_tooltip').node());\n\n\n    function render() {\n        dots\n          .attr(\"cx\", function(d) {\n            return project(([d.lng, d.lat])).x;\n          })\n          .attr(\"cy\", function(d) {\n            return project(([d.lng, d.lat])).y;\n          });\n      }\n\n    map.on(\"viewreset\", render);\n    map.on(\"move\", render);\n    map.on(\"moveend\", render);\n    render(); // Call once to render\n\n    // map.on('mousemove', function (e) {\n    //     var features = map.queryRenderedFeatures(e.point);\n         \n    //     var displayProperties = [\n    //     'type',\n    //     'properties',\n    //     'id',\n    //     'layer',\n    //     'source',\n    //     'sourceLayer',\n    //     'state'\n    //     ];\n         \n    //     var displayFeatures = features.map(function (feat) {\n    //     var displayFeat = {};\n    //     displayProperties.forEach(function (prop) {\n    //     displayFeat[prop] = feat[prop];\n    //     });\n    //     return displayFeat;\n    //     });\n         \n    //     console.log(JSON.stringify(\n    //     displayFeatures,\n    //     null,\n    //     2\n    //     ))\n    //     })\n    updateMap(data, options) ;\n}\n\nexport function updateMap(data, options) {\n   \n    var duration = 800;\n    var delay = 10;\n\n\n    if(options.map_toggle == 'bi-weekly-change'){\n        \n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].percent_change;\n        })\n\n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([-1, 0, 1])\n        .range([maxSize, 0, maxSize])\n        .clamp(true);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-map-'+d[0])\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(d[1].percent_change))\n            .style('stroke', function(){\n                // if(d[1].percent_change>1){ return '#E02225'} else { return '#1F558C'}\n                return '#FFF'\n            }).style('fill', function(){\n                if(d[1].percent_change>0){ return colors.red } else { return colors.blue}\n            })\n        })\n\n    }\n\n    if(options.map_toggle == 'cases'){\n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].cumulative_cases;\n        })\n\n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([0, maxValue])\n        .range([0, maxSize]);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-map-'+d[0])\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(d[1].cumulative_cases))\n            .style('fill', colors.red)\n            .style('stroke', '#FFF');\n        })\n\n    }\n    \n    if(options.map_toggle == 'deaths'){\n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].cumulative_deaths;\n        })\n\n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([0, maxValue])\n        .range([0, maxSize]);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-map-'+d[0])\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(d[1].cumulative_deaths))\n            .style('fill', colors.red)\n            .style('stroke', '#FFF');\n        })\n\n    }\n\n    if(options.map_toggle == 'percent-fully-vaccinated'){\n        var maxValue = d3.max(data.vGroup, function(d,i){\n            return parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n        })\n\n        var rScale = d3.scalePow().exponent(0.55)\n        .domain([0, 1])\n        .range([1, maxSize])\n        .clamp(true);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.vGroup.forEach(function(d,i){\n            var peoplevaccinated = parseFloat(d[1][0].people_fully_vaccinated_per_hundred)/100;\n            if(isNaN(peoplevaccinated)) peoplevaccinated = 0;\n            d3.select('#country-map-'+d[1][0].country_code)\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(peoplevaccinated))\n            .style('stroke', '#FFF')\n            .style('fill', function(){\n                return colors.blue;\n            })\n        })\n\n        \n    }\n\n    if(options.map_toggle == 'percent-vaccine-acceptance'){\n        var maxValue = d3.max(data.vGroup, function(d,i){\n            return parseFloat(d[1][0].vaccince_acceptance_percent)/100;\n        })\n\n        \n        var rScale = d3.scalePow().exponent(1)\n        .domain([0, 1])\n        .range([1, maxSize*.7])\n        // .clamp(true);\n\n        d3.selectAll('.country-map').transition('c').duration(duration/1.7).attr('r',0);\n\n        data.vGroup.forEach(function(d,i){\n            var vaccince_acceptance_percent = parseFloat(d[1][0].vaccince_acceptance_percent/100);\n            \n            if(isNaN(vaccince_acceptance_percent)) vaccince_acceptance_percent = 0;\n\n            d3.select('#country-map-'+d[1][0].country_code)\n            .transition('c').duration(duration).delay(delay)\n            .attr('r', rScale(vaccince_acceptance_percent))\n            .style('stroke', '#FFF')\n            .style('fill', function(){\n                return colors.blue;\n            })\n        })\n\n    }\n\n    function render() {\n        dots\n          .attr(\"cx\", function(d) {\n            return project(([d.lng, d.lat])).x;\n          })\n          .attr(\"cy\", function(d) {\n            return project(([d.lng, d.lat])).y;\n          });\n      }\n\n    map.on(\"viewreset\", render);\n    map.on(\"move\", render);\n    map.on(\"moveend\", render);\n    render(); // Call once to render\n\n    // tooltips\n\n    var mapTooltip = d3.select('#map_tooltip').attr('opacity', 1).attr('transform', 'translate(0,0)').attr('display', 'none');\n\n    d3.selectAll('.country-map').on('mousemove', function(event, d){\n\n        var id = d3.select(this).attr('id').substr(12,2);\n        var countryfiltered = data.equity_data.filter(d=>d.country_iso2 == id);\n        var countryName;\n        if(countryfiltered[0]) countryName = countryfiltered[0].country_name;\n\n        mapTooltip.select('#map_tooltip_name tspan').text(countryName);\n\n        if(options.map_toggle=='cases'){\n            var country = data.country.filter(d=>d[1].country_code == id)[0];\n            if(country.length==0) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_cases)+' cases');\n        }\n\n        if(options.map_toggle=='deaths'){\n            var country = data.country.filter(d=>d[1].country_code == id)[0];\n            if(country.length==0) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(addCommas(country[1].cumulative_deaths)+' deaths');\n        }\n\n        if(options.map_toggle=='bi-weekly-change'){\n            var country = data.country.filter(d=>d[1].country_code == id)[0];\n            if(country.length==0) return false;\n            var val = ((country[1].percent_change)*100).toFixed(1);\n            var str = '';\n            if(val>=0){\n                str = '% increase';\n            } else {\n                str = '% decrease';\n            }\n            mapTooltip.select('#map_tooltip_val tspan').text(Math.abs(val)+str);\n        }\n\n        if(options.map_toggle=='percent-fully-vaccinated'){\n            var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n            if((!country)||(country.length==0)) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].people_fully_vaccinated_per_hundred).toFixed(1)+'% fully vaccinated');\n        }\n\n        if(options.map_toggle=='percent-vaccine-acceptance'){\n            var country = data.vGroup.filter(d=>d[1][0].country_code == id)[0][1];\n            if((!country)||(country.length==0)) return false;\n            mapTooltip.select('#map_tooltip_val tspan').text(parseFloat(country[0].vaccince_acceptance_percent).toFixed(1)+'% vaccine acceptance');\n        }\n\n\n        d3.select('#map_tooltip_bg').attr('width', 0)\n\n        var bbox = mapTooltip.node().getBBox();\n        d3.select('#map_tooltip_bg').attr('width', (parseFloat(bbox.width)+2))\n        var scale = window.innerWidth/1329;\n        mapTooltip\n        .attr('display', 'inline')\n        .attr('transform', 'translate('+project(([d.lng, d.lat])).x+','+project(([d.lng, d.lat])).y+')scale('+scale+')');\n\n        var heightOffset = mapTooltip.node().getBBox();\n        mapTooltip.attr('transform', 'translate('+(project(([d.lng, d.lat])).x+3)+','+(project(([d.lng, d.lat])).y+2-heightOffset.height/2)+')scale('+scale+')');\n\n    }).on('mouseout', function(event){\n        if(event.toElement=='tspan') return false;\n        mapTooltip.attr('display', 'none');\n    })\n\n}\n\nfunction project(d) {\n    return map.project(new mapboxgl.LngLat(d[0], d[1]));\n}\n\n\nexport default createMap;\n"]},"metadata":{},"sourceType":"module"}