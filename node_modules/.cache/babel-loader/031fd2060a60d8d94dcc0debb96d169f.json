{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { filter } from './App';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\n\nimport 'mapbox-gl/dist/mapbox-gl.css';\nmapboxgl.accessToken = 'pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';\nlet map;\nexport function createMap(data, options, filter) {\n  console.log('createMap');\n  map = new mapboxgl.Map({\n    container: 'map_div',\n    // container ID\n    style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww',\n    // style URL\n    center: [8, 22],\n    // starting position [lng, lat]\n    zoom: -0.01 // starting zoom\n\n  });\n  map.setRenderWorldCopies(false);\n  map.addControl(new mapboxgl.NavigationControl());\n  console.log(data);\n  var container = map.getCanvasContainer();\n  var svg = d3.select(container).append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"24vw\").style(\"position\", \"absolute\").style(\"z-index\", 2);\n\n  function project(d) {\n    return map.project(new mapboxgl.LngLat(d[0], d[1]));\n  }\n\n  var dots = svg.selectAll(\".country\").data(data.world).enter().append(\"circle\").attr('class', 'country').attr('id', function (d, i) {\n    return 'country-' + d.iso2;\n  }).attr(\"r\", 0);\n  var maxValue = d3.max(data.country, function (d, i) {\n    return d[1].cumulative_cases;\n  });\n  var rScale = d3.scalePow().exponent(0.5).domain([0, maxValue]).range([0, 15]);\n  data.country.forEach(function (d, i) {\n    // console.log(d);\n    d3.select('#country-' + d[0]).attr('r', rScale(d[1].cumulative_cases));\n  });\n\n  function render() {\n    dots.attr(\"cx\", function (d) {\n      return project([d.lng, d.lat]).x;\n    }).attr(\"cy\", function (d) {\n      return project([d.lng, d.lat]).y;\n    });\n  }\n\n  map.on(\"viewreset\", render);\n  map.on(\"move\", render);\n  map.on(\"moveend\", render);\n  render(); // Call once to render\n  // map.on('mousemove', function (e) {\n  //     var features = map.queryRenderedFeatures(e.point);\n  //     var displayProperties = [\n  //     'type',\n  //     'properties',\n  //     'id',\n  //     'layer',\n  //     'source',\n  //     'sourceLayer',\n  //     'state'\n  //     ];\n  //     var displayFeatures = features.map(function (feat) {\n  //     var displayFeat = {};\n  //     displayProperties.forEach(function (prop) {\n  //     displayFeat[prop] = feat[prop];\n  //     });\n  //     return displayFeat;\n  //     });\n  //     console.log(JSON.stringify(\n  //     displayFeatures,\n  //     null,\n  //     2\n  //     ))\n  //     })\n}\nexport function updateMap(data, options) {\n  if (options.map_toggle == 'bi-weekly-change') {\n    var maxValue = d3.max(data.country, function (d, i) {\n      return d[1].percent_change;\n    });\n    console.log(maxValue); // console.log(data.country);\n\n    var rScale = d3.scalePow().exponent(0.5).domain([0, 1, maxValue]).range([15, 0, 15]);\n    d3.selectAll('.country').attr('r', 0);\n    data.country.forEach(function (d, i) {\n      d3.select('#country-' + d[0]).attr('r', rScale(d[1].percent_change)).attr('stroke', function () {\n        if (d[1].percent_change > 1) {\n          return 'red';\n        }\n      });\n    });\n  } // if(options.map_toggle == 'cases'){\n  //     var maxValue = d3.max(data.country, function(d,i){\n  //         return d[1].cumulative_cases;\n  //     })\n  //     var rScale = d3.scalePow().exponent(0.5)\n  //     .domain([0, maxValue])\n  //     .range([0, 15]);\n  //     d3.selectAll('.country').attr('r',0);\n  //     data.country.forEach(function(d,i){\n  //         console.log(d);\n  //         d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases));\n  //     })\n  // }\n\n}\nexport default createMap;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Map.js"],"names":["d3","moment","colors","filter","mapboxgl","accessToken","map","createMap","data","options","console","log","Map","container","style","center","zoom","setRenderWorldCopies","addControl","NavigationControl","getCanvasContainer","svg","select","append","attr","project","d","LngLat","dots","selectAll","world","enter","i","iso2","maxValue","max","country","cumulative_cases","rScale","scalePow","exponent","domain","range","forEach","render","lng","lat","x","y","on","updateMap","map_toggle","percent_change"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {filter} from './App';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiZ28taWZyYyIsImEiOiJjams3b2ZhZWswMGFvM3hxeHp2ZHFhOTRrIn0._pqO9OQ2iNeDGrpopJNjpg';\n\nlet map;\nexport function createMap(data, options, filter) {\n    console.log('createMap');\n\n    map = new mapboxgl.Map({\n        container: 'map_div', // container ID\n        style: 'mapbox://styles/go-ifrc/ck9tz6f150ub11ip8j97wrsww', // style URL\n        center: [8, 22], // starting position [lng, lat]\n        zoom: -0.01 // starting zoom\n    });\n\n    map.setRenderWorldCopies(false);\n    map.addControl(new mapboxgl.NavigationControl());\n    \n    console.log(data);\n\n    var container = map.getCanvasContainer();\n\n    var svg = d3\n    .select(container)\n    .append(\"svg\")\n    .attr(\"width\", \"100%\")\n    .attr(\"height\", \"24vw\")\n    .style(\"position\", \"absolute\")\n    .style(\"z-index\", 2);\n\n    function project(d) {\n        return map.project(new mapboxgl.LngLat(d[0], d[1]));\n    }\n\n    var dots = svg\n    .selectAll(\".country\")\n    .data(data.world)\n    .enter()\n    .append(\"circle\")\n    .attr('class', 'country')\n    .attr('id', function(d,i){ return 'country-'+d.iso2 })\n    .attr(\"r\", 0);\n\n    var maxValue = d3.max(data.country, function(d,i){\n        return d[1].cumulative_cases;\n    })\n\n    var rScale = d3.scalePow().exponent(0.5)\n      .domain([0, maxValue])\n      .range([0, 15]);\n\n    data.country.forEach(function(d,i){\n        // console.log(d);\n        d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases));\n    })\n    \n    function render() {\n        dots\n          .attr(\"cx\", function(d) {\n            return project(([d.lng, d.lat])).x;\n          })\n          .attr(\"cy\", function(d) {\n            return project(([d.lng, d.lat])).y;\n          });\n      }\n\n    map.on(\"viewreset\", render);\n    map.on(\"move\", render);\n    map.on(\"moveend\", render);\n    render(); // Call once to render\n\n    // map.on('mousemove', function (e) {\n    //     var features = map.queryRenderedFeatures(e.point);\n         \n    //     var displayProperties = [\n    //     'type',\n    //     'properties',\n    //     'id',\n    //     'layer',\n    //     'source',\n    //     'sourceLayer',\n    //     'state'\n    //     ];\n         \n    //     var displayFeatures = features.map(function (feat) {\n    //     var displayFeat = {};\n    //     displayProperties.forEach(function (prop) {\n    //     displayFeat[prop] = feat[prop];\n    //     });\n    //     return displayFeat;\n    //     });\n         \n    //     console.log(JSON.stringify(\n    //     displayFeatures,\n    //     null,\n    //     2\n    //     ))\n    //     })\n\n}\n\nexport function updateMap(data, options) {\n\n    if(options.map_toggle == 'bi-weekly-change'){\n        \n        var maxValue = d3.max(data.country, function(d,i){\n            return d[1].percent_change;\n        })\n\n        console.log(maxValue);\n        // console.log(data.country);\n        \n        var rScale = d3.scalePow().exponent(0.5)\n        .domain([0, 1, maxValue])\n        .range([15, 0, 15]);\n\n        d3.selectAll('.country').attr('r',0);\n\n        data.country.forEach(function(d,i){\n            d3.select('#country-'+d[0]).attr('r', rScale(d[1].percent_change))\n            .attr('stroke', function(){\n                if(d[1].percent_change>1){ return 'red'} \n            })\n        })\n\n    }\n\n\n    // if(options.map_toggle == 'cases'){\n    //     var maxValue = d3.max(data.country, function(d,i){\n    //         return d[1].cumulative_cases;\n    //     })\n\n    //     var rScale = d3.scalePow().exponent(0.5)\n    //     .domain([0, maxValue])\n    //     .range([0, 15]);\n\n    //     d3.selectAll('.country').attr('r',0);\n\n    //     data.country.forEach(function(d,i){\n    //         console.log(d);\n    //         d3.select('#country-'+d[0]).attr('r', rScale(d[1].cumulative_cases));\n    //     })\n\n    // }\n    \n\n}\n\n\n\nexport default createMap;\n"]},"metadata":{},"sourceType":"module"}