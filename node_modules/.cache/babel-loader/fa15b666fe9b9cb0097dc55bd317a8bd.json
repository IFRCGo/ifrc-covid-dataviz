{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nexport function drawTimechart(data, options) {\n  const regions = ['AP']; // console.log('draw timechart');\n  // console.log(data);\n  // console.log(options);\n  // const groupedData = d3.group(data.who_data, d => d[options.timeline_frequency+'Total'], d => d.ifrc_region)\n\n  const groupedData = [];\n  data.who_data.forEach(function (d, i) {\n    groupedData[d[options.timeline_frequency + 'Total']] = groupedData[d[options.timeline_frequency + 'Total']] || {};\n    if (options.timeline_frequency == 'day') groupedData[d[options.timeline_frequency + 'Total']].date = d.date;\n    if (options.timeline_frequency == 'week') groupedData[d[options.timeline_frequency + 'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n    if (options.timeline_frequency == 'month') groupedData[d[options.timeline_frequency + 'Total']].date = moment(d.date).startOf('month').toDate();\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region] = groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region] || {\n      new_cases: 0,\n      new_deaths: 0,\n      cumulative_cases: 0,\n      cumulative_deaths: 0\n    };\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].new_cases += d.new_cases;\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].new_cases += d.new_cases;\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].cumulative_cases += d.cumulative_cases;\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].cumulative_deaths += d.cumulative_deaths;\n  }); // totals by date\n\n  groupedData.forEach(function (d, i) {\n    d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.undefined.new_cases;\n    d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.undefined.cumulative_cases;\n    d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.undefined.new_deaths;\n    d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.undefined.cumulative_deaths;\n    d.region = [{\n      'region': 'AP',\n      'new_cases': d.AP.new_cases,\n      'new_deaths': d.AP.new_deaths\n    }];\n  });\n  console.log(groupedData);\n  const numIntervals = d3.max(data.who_data, function (d, i) {\n    return d[options.timeline_frequency + 'Total'];\n  });\n  const maxCases = d3.max(groupedData, function (d, i) {\n    if (options.timeline_type == 'non-cumulative') return d.total_new_cases;\n    if (options.timeline_type == 'cumulative') return d.total_cumulative_cases;\n    if (options.timeline_type == 'stacked') return 100;\n  }); // define date range\n\n  const minDate = groupedData[0].date;\n  const maxDate = groupedData[numIntervals].date;\n  const svg = d3.select('#timechart_svg').attr('fill', 'blue');\n  const width = parseInt(svg.attr('width'));\n  const barWidth = width / numIntervals;\n  const barSpacing = 0.2;\n  const xScale = d3.scaleLinear().range([0, width]).domain([minDate, maxDate]);\n  const yScaleCases = d3.scaleLinear().range([140, 0]).domain([0, maxCases]);\n  console.log('minDate');\n  console.log(minDate);\n  console.log('maxDate');\n  console.log(maxDate); // CASES\n  // loop through groupedData and draw bars\n\n  const casesBarGroups = svg.selectAll('.cases_bar_group').data(groupedData).enter().append('g').attr('transform', function (d, i) {\n    return 'translate(' + xScale(d.date) + ')';\n  });\n  casesBarGroups.append('rect').attr('x', barWidth * barSpacing).attr('y', 0).attr('width', barWidth - barWidth * barSpacing * 2).attr('height', function (d, i) {\n    console.log(d);\n  }); // 10\n  // 0.1\n  // 1 - 8 - 1\n  // draw x-axis\n  // draw y-axis\n}\nexport function updateTimechart(data) {\n  console.log('update timechart');\n}\nexport default drawTimechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Timechart.js"],"names":["d3","moment","drawTimechart","data","options","regions","groupedData","who_data","forEach","d","i","timeline_frequency","date","startOf","toDate","ifrc_region","new_cases","new_deaths","cumulative_cases","cumulative_deaths","total_new_cases","AF","AP","AM","EU","ME","undefined","total_cumulative_cases","total_new_deaths","total_cumulative_deaths","region","console","log","numIntervals","max","maxCases","timeline_type","minDate","maxDate","svg","select","attr","width","parseInt","barWidth","barSpacing","xScale","scaleLinear","range","domain","yScaleCases","casesBarGroups","selectAll","enter","append","updateTimechart"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\n\nexport function drawTimechart(data, options) {\n\n    const regions = ['AP', ]\n    // console.log('draw timechart');\n    // console.log(data);\n    // console.log(options);\n    // const groupedData = d3.group(data.who_data, d => d[options.timeline_frequency+'Total'], d => d.ifrc_region)\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        groupedData[d[options.timeline_frequency+'Total']] = groupedData[d[options.timeline_frequency+'Total']] || {};\n        if(options.timeline_frequency=='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency=='week') groupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n        if(options.timeline_frequency=='month') groupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] || {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases += d.cumulative_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_deaths += d.cumulative_deaths;\n    });\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.undefined.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.undefined.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.undefined.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.undefined.cumulative_deaths; \n        d.region = [{'region': 'AP', 'new_cases': d.AP.new_cases, 'new_deaths': d.AP.new_deaths}]\n    })\n\n    console.log(groupedData);\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type=='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type=='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type=='stacked') return 100;\n    })\n\n    // define date range\n    const minDate = groupedData[0].date;\n    const maxDate = groupedData[numIntervals].date;\n\n    const svg = d3.select('#timechart_svg').attr('fill', 'blue');\n    const width = parseInt(svg.attr('width'));\n    const barWidth = width/numIntervals;\n    const barSpacing = 0.2;\n\n    const xScale = d3.scaleLinear()\n    .range([0,width])\n    .domain([minDate,maxDate]);\n\n    const yScaleCases = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    console.log('minDate');\n    console.log(minDate);\n    console.log('maxDate');\n    console.log(maxDate);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const casesBarGroups = svg.selectAll('.cases_bar_group')\n    .data(groupedData)\n    .enter()\n    .append('g')\n    .attr('transform', function(d,i){ return 'translate('+xScale(d.date)+')'})\n\n    casesBarGroups.append('rect')\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', 0)\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        console.log(d);\n    });\n\n    // 10\n\n    // 0.1\n\n    // 1 - 8 - 1\n    \n    // draw x-axis\n\n\n    // draw y-axis\n\n}\n\nexport function updateTimechart(data) {\n\n    console.log('update timechart');\n\n}\n\nexport default drawTimechart;\n"]},"metadata":{},"sourceType":"module"}