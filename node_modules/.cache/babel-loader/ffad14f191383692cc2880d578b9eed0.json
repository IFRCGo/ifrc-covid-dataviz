{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { nFormatter } from './HelperFunctions';\nlet yScaleCases;\nlet yScaleDeaths;\nlet yScaleVaccines;\nlet yAxisCases;\nlet yAxisDeaths;\nlet yAxisVaccines;\nlet yScaleCasesAxis;\nlet yScaleDeathsAxis;\nlet yScaleVaccinesAxis;\nexport function drawTimechart(data, options) {\n  const regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n  const groupedData = [];\n  data.who_data.forEach(function (d, i) {\n    if (i < 3) console.log(d);\n    if (!groupedData[d[options.timeline_frequency + 'Total']]) groupedData[d[options.timeline_frequency + 'Total']] = {};\n    if (options.timeline_frequency === 'day') groupedData[d[options.timeline_frequency + 'Total']].date = d.date;\n    if (options.timeline_frequency === 'week') groupedData[d[options.timeline_frequency + 'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n    if (options.timeline_frequency === 'month') groupedData[d[options.timeline_frequency + 'Total']].date = moment(d.date).startOf('month').toDate();\n    if (!groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region] = {\n      new_cases: 0,\n      new_deaths: 0,\n      cumulative_cases: 0,\n      cumulative_deaths: 0\n    };\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].new_cases += d.new_cases;\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n    groupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].cumulative_cases = 0;\n  });\n  console.log(groupedData); // totals by date\n\n  groupedData.forEach(function (d, i) {\n    regions.forEach(function (dd, ii) {\n      // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n      if (i > 0) {\n        d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i - 1][dd].cumulative_cases;\n        d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i - 1][dd].cumulative_deaths;\n      } else {\n        d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n        d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n      }\n    });\n    d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases;\n    d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases;\n    d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths;\n    d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths;\n    d.region = [];\n    regions.forEach(function (dd, ii) {\n      d.region.push({\n        'region': dd,\n        'new_cases': d[dd].new_cases,\n        'new_deaths': d[dd].new_deaths,\n        'cumulative_cases': d[dd].cumulative_cases,\n        'cumulative_deaths': d[dd].cumulative_deaths\n      });\n    });\n  });\n  let vgroupedData = [];\n  data.vaccines_data.forEach(function (d, i) {\n    if (i < 3) console.log(d);\n    if (!vgroupedData[d[options.timeline_frequency + 'Total']]) vgroupedData[d[options.timeline_frequency + 'Total']] = {};\n    if (options.timeline_frequency === 'day') vgroupedData[d[options.timeline_frequency + 'Total']].date = d.date;\n    if (options.timeline_frequency === 'week') vgroupedData[d[options.timeline_frequency + 'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n    if (options.timeline_frequency === 'month') vgroupedData[d[options.timeline_frequency + 'Total']].date = moment(d.date).startOf('month').toDate();\n    if (!vgroupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region] = {\n      new_vaccines: 0,\n      cumulative_vaccines: 0\n    };\n    vgroupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].new_vaccines += d.new_vaccines;\n    vgroupedData[d[options.timeline_frequency + 'Total']][d.ifrc_region].cumulative_vaccines += d.cumulative_vaccines;\n  });\n  vgroupedData = vgroupedData.filter(function (el) {\n    return el;\n  }); // totals by date\n\n  vgroupedData.forEach(function (d, i) {\n    console.log(d);\n    if (i < 3) console.log(d);\n    regions.forEach(function (dd, ii) {\n      if (!d[dd]) {\n        d[dd] = {\n          new_vaccines: 0,\n          cumulative_vaccines: 0\n        };\n      }\n    });\n    d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines;\n    d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines;\n    d.region = [];\n    regions.forEach(function (dd, ii) {\n      d.region.push({\n        'region': dd,\n        'new_vaccines': d[dd].new_vaccines,\n        'cumulative_vaccines': d[dd].cumulative_vaccines\n      });\n    });\n  });\n  const numIntervals = d3.max(data.who_data, function (d, i) {\n    return d[options.timeline_frequency + 'Total'];\n  });\n  const maxCases = d3.max(groupedData, function (d, i) {\n    if (options.timeline_type === 'non-cumulative') return d.total_new_cases;\n    if (options.timeline_type === 'cumulative') return d.total_cumulative_cases;\n    if (options.timeline_type === 'stacked') return 100;\n  });\n  const maxDeaths = d3.max(groupedData, function (d, i) {\n    if (options.timeline_type === 'non-cumulative') return d.total_new_deaths;\n    if (options.timeline_type === 'cumulative') return d.total_cumulative_deaths;\n    if (options.timeline_type === 'stacked') return 100;\n  });\n  const maxVaccines = d3.max(vgroupedData, function (d, i) {\n    if (d) {\n      if (options.timeline_type === 'non-cumulative') return d.total_new_vaccines;\n      if (options.timeline_type === 'cumulative') return d.total_cumulative_vaccines;\n      if (options.timeline_type === 'stacked') return 100;\n    }\n  }); // define date range\n  // const minDate = groupedData[0].date;\n  // const maxDate = groupedData[numIntervals].date;\n\n  const minDate = groupedData[0].date;\n  const maxDate = options.maxDate;\n  const svg = d3.select('#timechart_svg');\n  svg.selectAll('g').remove();\n  d3.selectAll('#layout .yAxis').remove();\n  const width = 2000;\n  const barWidth = width / numIntervals;\n  let barSpacing = 0.04;\n  if (options.timeline_frequency === 'month') barSpacing = 0.03;\n  if (options.timeline_frequency === 'day') barSpacing = 0; // define scales\n\n  const xScale = d3.scaleTime().range([0, width]).domain([minDate, maxDate]);\n  yScaleCases = d3.scaleLinear().range([0, 140]).domain([0, maxCases]);\n  yScaleCasesAxis = d3.scaleLinear().range([140, 0]).domain([0, maxCases]);\n  yScaleDeaths = d3.scaleLinear().range([0, 140]).domain([0, maxDeaths]);\n  yScaleDeathsAxis = d3.scaleLinear().range([140, 0]).domain([0, maxDeaths]);\n  yScaleVaccines = d3.scaleLinear().range([0, 140]).domain([0, maxVaccines]);\n  yScaleVaccinesAxis = d3.scaleLinear().range([140, 0]).domain([0, maxVaccines]); // define axi\n\n  yAxisCases = d3.axisRight().scale(yScaleCasesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function (d) {\n    if (options.timeline_type == 'stacked') return nFormatter(d) + '%';\n    return nFormatter(d);\n  });\n  yAxisDeaths = d3.axisRight().scale(yScaleDeathsAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function (d) {\n    if (options.timeline_type == 'stacked') return nFormatter(d) + '%';\n    return nFormatter(d);\n  });\n  yAxisVaccines = d3.axisRight().scale(yScaleVaccinesAxis).ticks(3).tickSize(3).tickPadding(3).tickFormat(function (d) {\n    if (options.timeline_type == 'stacked') return nFormatter(d) + '%';\n    return nFormatter(d);\n  }); // y-axis cases\n\n  var yAxisCasesText = d3.select('#layout').append(\"g\").attr(\"class\", \"yAxis axis\").attr(\"id\", \"casesAxis\").attr('transform', 'translate(620,363)').call(yAxisCases); // y-axis deaths\n\n  var yAxisDeathsText = d3.select('#layout').append(\"g\").attr(\"class\", \"yAxis axis\").attr(\"id\", \"deathsAxis\").attr('transform', 'translate(620,534)').call(yAxisDeaths); // y-axis deaths\n\n  var yAxisVaccinesText = d3.select('#layout').append(\"g\").attr(\"class\", \"yAxis axis\").attr(\"id\", \"VaccinesAxis\").attr('transform', 'translate(620,734)').call(yAxisVaccines); // CASES\n  // loop through groupedData and draw bars\n\n  const barGroups = svg.selectAll('.bar_group').data(groupedData).enter().append('g').attr('transform', function (d, i) {\n    return 'translate(' + xScale(d.date) + ')';\n  }); // CASES\n\n  barGroups.selectAll('.cases_bar').data(function (d, i) {\n    return d.region.filter(function (dd, ii) {\n      return dd.region !== 'OTH';\n    });\n  }).enter().append('rect').attr('class', 'timeBar cases_bar').attr('x', barWidth * barSpacing).attr('y', function (d, i) {\n    const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n    let dp = 0;\n\n    if (i > 0) {\n      for (let ii = 1; ii <= i; ii++) {\n        if (options.timeline_type === 'cumulative') dp += d3.select(this.parentNode).datum().region[ii - 1].cumulative_cases;\n        if (options.timeline_type === 'non-cumulative') dp += d3.select(this.parentNode).datum().region[ii - 1].new_cases;\n        if (options.timeline_type === 'stacked') dp += d3.select(this.parentNode).datum().region[ii - 1].new_cases;\n      }\n    }\n\n    let y = 0;\n    if (options.timeline_type === 'cumulative') y = 140 - yScaleCases(d.cumulative_cases) - yScaleCases(dp);\n    if (options.timeline_type === 'non-cumulative') y = 140 - yScaleCases(d.new_cases) - yScaleCases(dp);\n    if (options.timeline_type === 'stacked') y = 140 - 140 * (d.new_cases / totalNewCases) - 140 * (dp / totalNewCases);\n\n    if (y) {\n      return y;\n    } else {\n      return 0;\n    }\n\n    ;\n  }).attr('width', barWidth - barWidth * barSpacing * 2).attr('height', function (d, i) {\n    const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n    let y = 0;\n    if (options.timeline_type === 'cumulative') y = yScaleCases(d.cumulative_cases);\n    if (options.timeline_type === 'non-cumulative') y = yScaleCases(d.new_cases);\n    if (options.timeline_type === 'stacked') y = 140 * (d.new_cases / totalNewCases);\n\n    if (y) {\n      return y;\n    } else {\n      return 0;\n    }\n\n    ;\n  }).attr('fill', function (d, i) {\n    return colors.regions[d.region];\n  }); // DEATHS\n\n  barGroups.selectAll('.deaths_bar').data(function (d, i) {\n    return d.region.filter(function (dd, ii) {\n      return dd.region !== 'OTH';\n    });\n  }).enter().append('rect').attr('class', 'timeBar deaths_bar').attr('x', barWidth * barSpacing).attr('y', function (d, i) {\n    const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n    let dp = 0;\n\n    if (i > 0) {\n      for (let ii = 1; ii <= i; ii++) {\n        if (options.timeline_type === 'cumulative') dp += d3.select(this.parentNode).datum().region[ii - 1].cumulative_deaths;\n        if (options.timeline_type === 'non-cumulative') dp += d3.select(this.parentNode).datum().region[ii - 1].new_deaths;\n        if (options.timeline_type === 'stacked') dp += d3.select(this.parentNode).datum().region[ii - 1].new_deaths;\n      }\n    }\n\n    let y = 0;\n    if (options.timeline_type === 'cumulative') y = 140 - yScaleDeaths(d.cumulative_deaths) - yScaleDeaths(dp) + 170;\n    if (options.timeline_type === 'non-cumulative') y = 140 - yScaleDeaths(d.new_deaths) - yScaleDeaths(dp) + 170;\n    if (options.timeline_type === 'stacked') y = 140 - 140 * (d.new_deaths / totalNewDeaths) - 140 * (dp / totalNewDeaths) + 170;\n\n    if (y) {\n      return y;\n    } else {\n      return 0;\n    }\n\n    ;\n  }).attr('width', barWidth - barWidth * barSpacing * 2).attr('height', function (d, i) {\n    const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n    let y = 0;\n    if (options.timeline_type === 'cumulative') y = yScaleDeaths(d.cumulative_deaths);\n    if (options.timeline_type === 'non-cumulative') y = yScaleDeaths(d.new_deaths);\n    if (options.timeline_type === 'stacked') y = 140 * (d.new_deaths / totalNewDeaths);\n\n    if (y) {\n      return y;\n    } else {\n      return 0;\n    }\n\n    ;\n  }).attr('fill', function (d, i) {\n    return colors.regions[d.region];\n  }); // VACCINES\n\n  const vbarGroups = svg.selectAll('.vbar_group').data(vgroupedData).enter().append('g').attr('class', 'vbar_group').attr('transform', function (d, i) {\n    return 'translate(' + xScale(d.date) + ', 300)';\n  });\n  vbarGroups.selectAll('.vaccines_bar').data(function (d, i) {\n    return d.region.filter(function (dd, ii) {\n      return dd.region !== 'OTH';\n    });\n  }).enter().append('g').append('rect').attr('class', 'timeBar vaccines_bar').attr('x', barWidth * barSpacing).attr('y', function (d, i) {\n    const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n    let dp = 0;\n\n    if (i > 0) {\n      for (let ii = 1; ii <= i; ii++) {\n        if (options.timeline_type === 'cumulative') dp += d3.select(this.parentNode).datum().region[ii - 1].cumulative_vaccines;\n        if (options.timeline_type === 'non-cumulative') dp += d3.select(this.parentNode).datum().region[ii - 1].new_vaccines;\n        if (options.timeline_type === 'stacked') dp += d3.select(this.parentNode).datum().region[ii - 1].new_vaccines;\n      }\n    }\n\n    let y = 0;\n    if (options.timeline_type === 'cumulative') y = 140 - yScaleVaccines(d.cumulative_vaccines) - yScaleVaccines(dp);\n    if (options.timeline_type === 'non-cumulative') y = 140 - yScaleVaccines(d.new_vaccines) - yScaleVaccines(dp);\n    if (options.timeline_type === 'stacked') y = 140 - 140 * (d.new_vaccines / totalNewVaccines) - 140 * (dp / totalNewVaccines);\n\n    if (y) {\n      return y;\n    } else {\n      return 0;\n    }\n\n    ;\n  }).attr('width', barWidth - barWidth * barSpacing * 2).attr('height', function (d, i) {\n    const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n    let y = 0;\n    if (options.timeline_type === 'cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n    if (options.timeline_type === 'non-cumulative') y = yScaleVaccines(d.new_vaccines);\n    if (options.timeline_type === 'stacked') y = 140 * (d.new_vaccines / totalNewVaccines);\n\n    if (y) {\n      return y;\n    } else {\n      return 0;\n    }\n\n    ;\n  }).attr('fill', function (d, i) {\n    return colors.regions[d.region];\n  });\n\n  if (options.timeline_frequency === 'month') {\n    barGroups.selectAll(\".timeBar\").attr(\"width\", function (d) {\n      var date = d3.select(this.parentNode).datum().date;\n      var next = d3.timeMonth.offset(date, 1);\n      return (xScale(next) - xScale(date)) * (1 - barSpacing);\n    }).attr(\"x\", function (d) {\n      var date = d3.select(this.parentNode).datum().date;\n      var next = d3.timeMonth.offset(date, 1);\n      return (xScale(next) - xScale(date)) * (barSpacing / 2);\n    });\n  } // bar size tweak for spacing\n\n\n  if (options.timeline_frequency === 'month') {\n    barGroups.selectAll(\".timeBar\").attr(\"width\", function (d) {\n      var date = d3.select(this.parentNode).datum().date;\n      var next = d3.timeMonth.offset(date, 1);\n      return (xScale(next) - xScale(date)) * (1 - barSpacing);\n    }).attr(\"x\", function (d) {\n      var date = d3.select(this.parentNode).datum().date;\n      var next = d3.timeMonth.offset(date, 1);\n      return (xScale(next) - xScale(date)) * (barSpacing / 2);\n    });\n  } // 10\n  // 0.1\n  // 1 - 8 - 1\n  // draw x-axis\n  // draw y-axis\n\n}\nexport function updateTimechart(data) {\n  console.log('update timechart');\n}\nexport default drawTimechart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Timechart.js"],"names":["d3","moment","colors","nFormatter","yScaleCases","yScaleDeaths","yScaleVaccines","yAxisCases","yAxisDeaths","yAxisVaccines","yScaleCasesAxis","yScaleDeathsAxis","yScaleVaccinesAxis","drawTimechart","data","options","regions","groupedData","who_data","forEach","d","i","console","log","timeline_frequency","date","startOf","toDate","ifrc_region","new_cases","new_deaths","cumulative_cases","cumulative_deaths","dd","ii","total_new_cases","AF","AP","AM","EU","ME","OTH","total_cumulative_cases","total_new_deaths","total_cumulative_deaths","region","push","vgroupedData","vaccines_data","new_vaccines","cumulative_vaccines","filter","el","total_new_vaccines","total_cumulative_vaccines","numIntervals","max","maxCases","timeline_type","maxDeaths","maxVaccines","minDate","maxDate","svg","select","selectAll","remove","width","barWidth","barSpacing","xScale","scaleTime","range","domain","scaleLinear","axisRight","scale","ticks","tickSize","tickPadding","tickFormat","yAxisCasesText","append","attr","call","yAxisDeathsText","yAxisVaccinesText","barGroups","enter","totalNewCases","parentNode","datum","dp","y","totalNewDeaths","vbarGroups","totalNewVaccines","next","timeMonth","offset","updateTimechart"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {nFormatter} from './HelperFunctions';\n\nlet yScaleCases;\nlet yScaleDeaths;\nlet yScaleVaccines;\nlet yAxisCases;\nlet yAxisDeaths;\nlet yAxisVaccines;\nlet yScaleCasesAxis;\nlet yScaleDeathsAxis;\nlet yScaleVaccinesAxis;\n\nexport function drawTimechart(data, options) {\n\n    const regions = ['AF', 'ME', 'AP', 'EU', 'AM', 'OTH'];\n\n    const groupedData = [];\n\n    data.who_data.forEach(function(d,i){\n        if(i<3) console.log(d);\n        if(!groupedData[d[options.timeline_frequency+'Total']])groupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') groupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') groupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n        if(options.timeline_frequency==='month') groupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n        if(!groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_cases: 0, new_deaths: 0, cumulative_cases: 0, cumulative_deaths: 0};\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_cases += d.new_cases;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_deaths += d.new_deaths;\n        groupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_cases = 0;\n    });\n\n    console.log(groupedData);\n\n    // totals by date\n    groupedData.forEach(function(d,i){\n        regions.forEach(function(dd,ii){\n            // if(dd!=='OTH') d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n            if(i>0){\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases + groupedData[i-1][dd].cumulative_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths + groupedData[i-1][dd].cumulative_deaths;\n            } else {\n                d[dd].cumulative_cases = groupedData[i][dd].new_cases;\n                d[dd].cumulative_deaths = groupedData[i][dd].new_deaths;\n            }\n        })\n\n        d.total_new_cases = d.AF.new_cases + d.AP.new_cases + d.AM.new_cases + d.EU.new_cases + d.ME.new_cases + d.OTH.new_cases; \n        d.total_cumulative_cases = d.AF.cumulative_cases + d.AP.cumulative_cases + d.AM.cumulative_cases + d.EU.cumulative_cases + d.ME.cumulative_cases + d.OTH.cumulative_cases; \n        d.total_new_deaths = d.AF.new_deaths + d.AP.new_deaths + d.AM.new_deaths + d.EU.new_deaths + d.ME.new_deaths + d.OTH.new_deaths; \n        d.total_cumulative_deaths = d.AF.cumulative_deaths + d.AP.cumulative_deaths + d.AM.cumulative_deaths + d.EU.cumulative_deaths + d.ME.cumulative_deaths + d.OTH.cumulative_deaths; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_cases': d[dd].new_cases, 'new_deaths': d[dd].new_deaths, 'cumulative_cases': d[dd].cumulative_cases, 'cumulative_deaths': d[dd].cumulative_deaths});\n        })\n\n    });\n\n    let vgroupedData = [];\n\n    data.vaccines_data.forEach(function(d,i){\n        if(i<3) console.log(d);\n        if(!vgroupedData[d[options.timeline_frequency+'Total']])vgroupedData[d[options.timeline_frequency+'Total']] = {};\n        if(options.timeline_frequency==='day') vgroupedData[d[options.timeline_frequency+'Total']].date = d.date;\n        if(options.timeline_frequency==='week') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('isoWeek').toDate();\n        if(options.timeline_frequency==='month') vgroupedData[d[options.timeline_frequency+'Total']].date = moment(d.date).startOf('month').toDate();\n        if(!vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region]) vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region] = {new_vaccines: 0, cumulative_vaccines: 0};\n        vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].new_vaccines += d.new_vaccines;\n        vgroupedData[d[options.timeline_frequency+'Total']][d.ifrc_region].cumulative_vaccines += d.cumulative_vaccines;\n    });\n\n    vgroupedData = vgroupedData.filter(function(el) { return el; });\n\n    // totals by date\n    vgroupedData.forEach(function(d,i){\n        console.log(d);\n        if(i<3) console.log(d);\n\n        regions.forEach(function(dd,ii){\n            if(!d[dd]){\n                d[dd] = {new_vaccines: 0, cumulative_vaccines: 0}\n            }\n        });\n        d.total_new_vaccines = d.AF.new_vaccines + d.AP.new_vaccines + d.AM.new_vaccines + d.EU.new_vaccines + d.ME.new_vaccines + d.OTH.new_vaccines; \n        d.total_cumulative_vaccines = d.AF.cumulative_vaccines + d.AP.cumulative_vaccines + d.AM.cumulative_vaccines + d.EU.cumulative_vaccines + d.ME.cumulative_vaccines + d.OTH.cumulative_vaccines; \n        d.region = [];\n\n        regions.forEach(function(dd,ii){\n            d.region.push({'region': dd, 'new_vaccines': d[dd].new_vaccines, 'cumulative_vaccines': d[dd].cumulative_vaccines});\n        })\n\n    });\n\n    const numIntervals = d3.max(data.who_data, function(d,i){\n        return d[options.timeline_frequency+'Total'];\n    });\n\n    const maxCases = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_cases;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_cases;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxDeaths = d3.max(groupedData, function(d,i){\n        if(options.timeline_type==='non-cumulative') return d.total_new_deaths;\n        if(options.timeline_type==='cumulative') return d.total_cumulative_deaths;\n        if(options.timeline_type==='stacked') return 100;\n    })\n\n    const maxVaccines = d3.max(vgroupedData, function(d,i){\n        if(d){\n            if(options.timeline_type==='non-cumulative') return d.total_new_vaccines;\n            if(options.timeline_type==='cumulative') return d.total_cumulative_vaccines;\n            if(options.timeline_type==='stacked') return 100;\n        }\n    })\n\n    // define date range\n    // const minDate = groupedData[0].date;\n    // const maxDate = groupedData[numIntervals].date;\n    const minDate = groupedData[0].date;\n    const maxDate = options.maxDate;\n\n    const svg = d3.select('#timechart_svg');\n    svg.selectAll('g').remove();\n    d3.selectAll('#layout .yAxis').remove();\n\n    const width = 2000;\n    const barWidth = width/numIntervals;\n\n    let barSpacing = 0.04; \n    if(options.timeline_frequency==='month') barSpacing = 0.03;\n    if(options.timeline_frequency==='day') barSpacing = 0;\n\n    // define scales\n\n    const xScale = d3.scaleTime()\n    .range([0,width])\n    .domain([minDate,maxDate]);\n\n    yScaleCases = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxCases]);\n\n    yScaleCasesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxCases]);\n\n    yScaleDeaths = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxDeaths]);\n\n    yScaleDeathsAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxDeaths]);\n\n    yScaleVaccines = d3.scaleLinear()\n    .range([0,140])\n    .domain([0,maxVaccines]);\n\n    yScaleVaccinesAxis = d3.scaleLinear()\n    .range([140,0])\n    .domain([0,maxVaccines]);\n\n    // define axi\n    \n    yAxisCases = d3.axisRight()\n    .scale(yScaleCasesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisDeaths = d3.axisRight()\n    .scale(yScaleDeathsAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    yAxisVaccines = d3.axisRight()\n    .scale(yScaleVaccinesAxis)\n    .ticks(3)\n    .tickSize(3)\n    .tickPadding(3)\n    .tickFormat(function(d){\n        if(options.timeline_type=='stacked') return nFormatter(d)+'%';\n        return nFormatter(d);\n    })\n\n    // y-axis cases\n    var yAxisCasesText = d3.select('#layout').append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"casesAxis\")\n    .attr('transform', 'translate(620,363)')\n    .call(yAxisCases);\n\n    // y-axis deaths\n    var yAxisDeathsText = d3.select('#layout').append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"deathsAxis\")\n    .attr('transform', 'translate(620,534)')\n    .call(yAxisDeaths);\n\n    // y-axis deaths\n    var yAxisVaccinesText = d3.select('#layout').append(\"g\")\n    .attr(\"class\", \"yAxis axis\")\n    .attr(\"id\", \"VaccinesAxis\")\n    .attr('transform', 'translate(620,734)')\n    .call(yAxisVaccines);\n\n    // CASES\n    // loop through groupedData and draw bars\n    const barGroups = svg.selectAll('.bar_group')\n    .data(groupedData)\n    .enter()\n    .append('g')\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+')'\n    })\n\n    // CASES\n    barGroups.selectAll('.cases_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', 'timeBar cases_bar')\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_cases;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_cases;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleCases(d.cumulative_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleCases(d.new_cases)-(yScaleCases(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_cases/totalNewCases))-((140*(dp/totalNewCases))))\n        if(y){ return y; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewCases = d3.select(this.parentNode).datum().total_new_cases - d3.select(this.parentNode).datum().OTH.new_cases;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleCases(d.cumulative_cases);\n        if(options.timeline_type==='non-cumulative') y = yScaleCases(d.new_cases);\n        if(options.timeline_type==='stacked') y = (140*(d.new_cases/totalNewCases));\n        if(y){ return y; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    })\n\n    // DEATHS\n    barGroups.selectAll('.deaths_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('rect')\n    .attr('class', 'timeBar deaths_bar')\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_deaths;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_deaths;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleDeaths(d.cumulative_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleDeaths(d.new_deaths)-(yScaleDeaths(dp))+170)\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_deaths/totalNewDeaths))-((140*(dp/totalNewDeaths)))+170)\n        if(y){ return y; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewDeaths = d3.select(this.parentNode).datum().total_new_deaths - d3.select(this.parentNode).datum().OTH.new_deaths;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleDeaths(d.cumulative_deaths);\n        if(options.timeline_type==='non-cumulative') y = yScaleDeaths(d.new_deaths);\n        if(options.timeline_type==='stacked') y = (140*(d.new_deaths/totalNewDeaths));\n        if(y){ return y; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    // VACCINES\n\n    const vbarGroups = svg.selectAll('.vbar_group')\n    .data(vgroupedData)\n    .enter()\n    .append('g')\n    .attr('class', 'vbar_group')\n    .attr('transform', function(d,i){ \n        return 'translate('+xScale(d.date)+', 300)'\n    })\n\n    vbarGroups.selectAll('.vaccines_bar')\n    .data(function(d,i){ return d.region.filter(function(dd,ii){\n        return dd.region!=='OTH';\n    })})\n    .enter()\n    .append('g')\n    .append('rect')\n    .attr('class', 'timeBar vaccines_bar')\n    .attr('x', (barWidth*barSpacing))\n    .attr('y', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let dp = 0;\n        if(i>0){\n            for(let ii=1;ii<=i;ii++){\n                if(options.timeline_type==='cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].cumulative_vaccines;\n                if(options.timeline_type==='non-cumulative') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n                if(options.timeline_type==='stacked') dp += d3.select(this.parentNode).datum().region[ii-1].new_vaccines;\n            }\n        }\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = (140-yScaleVaccines(d.cumulative_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='non-cumulative') y = (140-yScaleVaccines(d.new_vaccines)-(yScaleVaccines(dp)))\n        if(options.timeline_type==='stacked') y = (140-(140*(d.new_vaccines/totalNewVaccines))-((140*(dp/totalNewVaccines))))\n        if(y){ return y; } else { return 0};\n    })\n    .attr('width', barWidth-(barWidth*barSpacing*2))\n    .attr('height', function(d,i){\n        const totalNewVaccines = d3.select(this.parentNode).datum().total_new_vaccines - d3.select(this.parentNode).datum().OTH.new_vaccines;\n        let y = 0;\n        if(options.timeline_type==='cumulative') y = yScaleVaccines(d.cumulative_vaccines);\n        if(options.timeline_type==='non-cumulative') y = yScaleVaccines(d.new_vaccines);\n        if(options.timeline_type==='stacked') y = (140*(d.new_vaccines/totalNewVaccines));\n        if(y){ return y; } else { return 0};\n    })\n    .attr('fill', function(d,i){\n        return colors.regions[d.region];\n    });\n\n    if(options.timeline_frequency==='month'){\n    barGroups.selectAll(\".timeBar\")\n    .attr(\"width\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(1-barSpacing);\n        })\n    .attr(\"x\", function(d) {\n        var date = d3.select(this.parentNode).datum().date;\n        var next = d3.timeMonth.offset(date, 1);\n        return (xScale(next)- xScale(date))*(barSpacing/2);\n        })\n    }\n\n    // bar size tweak for spacing\n    if(options.timeline_frequency==='month'){\n        barGroups.selectAll(\".timeBar\")\n        .attr(\"width\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(1-barSpacing);\n          })\n        .attr(\"x\", function(d) {\n            var date = d3.select(this.parentNode).datum().date;\n            var next = d3.timeMonth.offset(date, 1);\n            return (xScale(next)- xScale(date))*(barSpacing/2);\n          })\n        }\n\n    // 10\n\n    // 0.1\n\n    // 1 - 8 - 1\n    \n    // draw x-axis\n\n\n    // draw y-axis\n\n}\n\nexport function updateTimechart(data) {\n\n    console.log('update timechart');\n\n}\n\nexport default drawTimechart;\n"]},"metadata":{},"sourceType":"module"}