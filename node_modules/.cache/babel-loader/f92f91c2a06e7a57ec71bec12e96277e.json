{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { addCommas } from './HelperFunctions';\nimport { filter } from './App';\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases;\nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth;\nconst margin = {\n  left: 20,\n  top: 0,\n  right: 58\n};\nlet rcSize;\nlet groupedData = [];\nexport function drawRegionchart(data, options, filter) {\n  const barSpacing = 0.1;\n  data.regions.forEach(function (d, i) {\n    d = {\n      region: d.code,\n      cumulative_cases: 0,\n      cumulative_deaths: 0,\n      cumulative_vaccines: 0,\n      population: 0\n    };\n  });\n  data.country.forEach(function (d, i) {\n    data.regions.forEach(function (dd, ii) {\n      if (dd.code == d.ifrc_region) {\n        // remove OTH\n        if (d.population > 0 && d.who_daily_latest) {\n          dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n          dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths;\n          dd.population += d.population;\n        }\n\n        if (d.population > 0 && d.vaccine_daily_latest) {\n          dd.cumulative_vaccines += d.vaccine_daily_latest.total_vaccinations || 0;\n        }\n      }\n    });\n  });\n  data.regions.forEach(function (d, i) {\n    d.cumulative_cases_per_100k = d.cumulative_cases / (d.population / 100000);\n    d.cumulative_deaths_per_100k = d.cumulative_deaths / (d.population / 100000);\n    d.cumulative_vaccines_per_100k = d.cumulative_vaccines / (d.population / 100000);\n    if (!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n    if (!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n    if (!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n  });\n  data.regions.sort(function (a, b) {\n    return b.cumulative_cases_per_100k - a.cumulative_cases_per_100k;\n  });\n  maxVaccinations = d3.max(data.regions, function (d, i) {\n    return d.cumulative_vaccines_per_100k;\n  });\n  maxCases = d3.max(data.regions, function (d, i) {\n    return d.cumulative_cases_per_100k;\n  });\n  maxDeaths = d3.max(data.regions, function (d, i) {\n    return d.cumulative_deaths_per_100k;\n  }); // append region chart containerg\n\n  const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n  rcSize = {\n    x: regionChartContainer.attr('x'),\n    y: regionChartContainer.attr('y'),\n    width: regionChartContainer.attr('width'),\n    height: regionChartContainer.attr('height')\n  };\n  const svg = d3.select('#layout').append('g').attr('transform', 'translate(' + rcSize.x + ', ' + rcSize.y + ')').attr('id', 'region_chart');\n  var rowHeight = rcSize.height / (data.regions.length - 1); // remove OTH\n\n  var rows = svg.selectAll('.bar-row').data(data.regions.filter(d => d.code !== 'OTH')).enter().append('g').attr('class', 'bar-row').attr('transform', function (d, i) {\n    return 'translate(0,' + (i * rowHeight + margin.top) + ')';\n  });\n  data.cumulative_totals = data.regions;\n  var label = rows.append('text').attr('y', rowHeight / 2).attr('x', margin.left - 5).attr('class', function (d, i) {\n    return 'bar-labels bar-label-' + d.code;\n  }).style('alignment-baseline', 'middle').style('font-size', '11px').attr('opacity', 1).attr('fill', '#000').text(function (d, i) {\n    if (d.code === 'AM') return 'Americas';\n    if (d.code === 'EU') return 'Europe';\n    if (d.code === 'AF') return 'Africa';\n    if (d.code === 'ME') return 'Middle East and North Africa';\n    if (d.code === 'AP') return 'Asia-Pacific';\n  }).style('text-anchor', 'end');\n  labelWidth = rows.node().getBBox().width + margin.left;\n  label.attr('x', labelWidth + 89);\n  labelWidth = labelWidth + 94;\n  d3.selectAll('.timeBar').attr('opacity', 1);\n  var rowBg = rows.append('rect').attr('y', 0).attr('x', 0).attr('width', labelWidth).attr('height', rowHeight - 2).style('opacity', 0).attr('fill', 'grey').style('cursor', 'pointer').attr('class', function (d, i) {\n    return 'bar-bg-' + d.code;\n  }).attr('data-id', function (d, i) {\n    return d.code;\n  }).on('mouseover', function (d) {\n    d3.select(this).style('opacity', 0.1); // var dat = d3.select(this.parentNode).datum();\n    // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n    // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n  }).on('mouseout', function () {\n    d3.select(this).style('opacity', 0); // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n  }).on('click', function (d, i) {\n    var t = d3.select(this).attr('data-id');\n    filter([t], 'regionchart');\n  });\n  xScaleCases = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxCases]);\n  xScaleDeaths = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxDeaths]);\n  xScaleVaccines = d3.scaleLinear().range([labelWidth, rcSize.width - margin.right - labelWidth]).domain([0, maxVaccinations]);\n  var bars = rows.append('rect').attr('id', function (d, i) {\n    return 'bar-' + d.code;\n  }).attr('data-id', function (d, i) {\n    return d.code;\n  }).attr('class', 'region-bar').attr('width', function (d, i) {\n    if (options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k);\n    if (options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k);\n    if (options.region_chart_toggle == 'vaccines') return xScaleDeaths(d.cumulative_vaccines_per_100k);\n  }).attr('x', labelWidth).style('outline', 'none').style('cursor', 'pointer').attr('y', rowHeight * barSpacing - 1).attr('height', rowHeight - rowHeight * barSpacing * 2).style('fill', function (d) {\n    return colors.regions[d.code];\n  }).attr('opacity', 1).on('click', function (d, i) {\n    var t = d3.select(this).attr('data-id');\n    filter([t], 'regionchart');\n  }).on('mouseover', function (d) {\n    var dat = d3.select(this.parentNode).datum(); // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n    // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n  }).on('mouseout', function () {// d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n  });\n  var dataLabel = rows.append('text').text(function (d) {\n    if (options.region_chart_toggle == 'cases') return addCommas(Math.round(d.cumulative_cases_per_100k));\n    if (options.region_chart_toggle == 'deaths') return addCommas(Math.round(d.cumulative_deaths_per_100k));\n    if (options.region_chart_toggle == 'vaccines') return addCommas(Math.round(d.cumulative_vaccines_per_100k));\n  }).attr('id', function (d, i) {\n    return 'data-label' + d.code;\n  }).attr('data-id', function (d, i) {\n    return d.code;\n  }).attr('class', 'data-label').attr('y', rowHeight / 2).style('alignment-baseline', 'middle').style('text-anchor', 'start').attr('x', function (d, i) {\n    if (options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k) + labelWidth + 5;\n    if (options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k) + labelWidth + 5;\n    if (options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines_per_100k) + labelWidth + 5;\n  }).attr('opacity', function (d, i) {\n    var val = 0;\n    if (options.region_chart_toggle == 'cases') val = d.cumulative_cases_per_100k;\n    if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths_per_100k;\n    if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines_per_100k;\n\n    if (val > 0) {\n      return 1;\n    } else {\n      return 0;\n    }\n  }).style('fill', '#696969').style('font-weight', 'normal').style('font-size', '10px');\n}\nexport function updateRegionchart(options, data) {// groupedData = [];\n  // data.regions.forEach(function(d,i){\n  //     groupedData.push({ region: d.code, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0, population: d.population});\n  // })\n  // data.who_data.forEach(function(d,i){\n  //     data.regions.forEach(function(dd,ii){\n  //         if((dd.code==d.ifrc_region)){ // remove OTH\n  //             groupedData[ii].cumulative_cases += d.new_cases;\n  //             groupedData[ii].cumulative_deaths += d.new_deaths;\n  //         }\n  //     });\n  // });\n  // // vaccinations max date records\n  // var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n  // var vacGrouped = vGroup[vGroup.length-1];\n  // var vData = [];\n  // vacGrouped[1].forEach(function(d,i){\n  //     regions.forEach(function(dd,ii){\n  //         if((dd==d.ifrc_region)&&(dd!='OTH')){ // remove OTH\n  //             groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n  //         }\n  //     })\n  // });\n  // groupedData.forEach(function(d,i){\n  //     d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n  //     d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n  //     d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n  //     if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n  //     if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n  //     if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n  // })\n  // groupedData.sort(function(a,b){\n  //     if(options.region_chart_toggle == 'cases') return (b.cumulative_cases_per_100k) - (a.cumulative_cases_per_100k);\n  //     if(options.region_chart_toggle == 'deaths') return (b.cumulative_deaths_per_100k) - (a.cumulative_deaths_per_100k);\n  //     if(options.region_chart_toggle == 'vaccines') return (b.cumulative_vaccines_per_100k) - (a.cumulative_vaccines_per_100k); \n  // });\n  // maxVaccinations = d3.max(groupedData, function(d,i){\n  //     return d.cumulative_vaccines_per_100k;\n  // })\n  // maxCases = d3.max(groupedData, function(d,i){\n  //     return d.cumulative_cases_per_100k;\n  // })\n  // maxDeaths = d3.max(groupedData, function(d,i){\n  //     return d.cumulative_deaths_per_100k;\n  // });\n  // xScaleCases = d3.scaleLinear()\n  // .range([0, rcSize.width - margin.right - labelWidth])\n  // .domain([0, maxCases]);\n  // xScaleDeaths = d3.scaleLinear()\n  // .range([0, rcSize.width - margin.right - labelWidth])\n  // .domain([0, maxDeaths]);\n  // xScaleVaccines = d3.scaleLinear()\n  // .range([0, rcSize.width - margin.right - labelWidth])\n  // .domain([0, maxVaccinations]);\n  // if((maxVaccinations==0)&&(maxCases==0)&&(maxDeaths==0)){\n  //     d3.selectAll('.region-bar')\n  //     .transition().duration(500)\n  //     .attr('width', 0);\n  //     d3.selectAll('.data-label')\n  //     .transition()\n  //       .duration(500) \n  //       .attr('x', labelWidth)\n  //       .attr('opacity', 0);\n  // } else {\n  //     d3.selectAll('.region-bar')\n  //     .transition().duration(500)\n  //     .attr('width', function(d,i){\n  //         var id = d3.select(this).attr('data-id');\n  //         var d;\n  //         groupedData.forEach(function(dd,ii){\n  //             if(dd.code == id){\n  //                 d = dd;\n  //             }\n  //         })\n  //         var val = 0;\n  //         if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n  //         if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n  //         if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n  //         if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n  //     })   \n  //     d3.selectAll('.data-label')\n  //     .transition()\n  //       .duration(500)\n  //       .tween(\"text\", function(d,i) {\n  //         var end = 0;\n  //         var id = d3.select(this).attr('data-id');\n  //         var d;\n  //         groupedData.forEach(function(dd,ii){\n  //             if(dd.code == id){\n  //                 d = dd;\n  //             }\n  //         })\n  //         if(options.region_chart_toggle == 'cases') end = (d.cumulative_cases_per_100k);\n  //         if(options.region_chart_toggle == 'deaths') end = (d.cumulative_deaths_per_100k);  \n  //         if(options.region_chart_toggle == 'vaccines') end = (d.cumulative_vaccines_per_100k);  \n  //         var i = d3.interpolate(Math.floor((Math.random() * 2346) + 9345), end);\n  //         return function(t) {\n  //           d3.select(this).text(addCommas(Math.round(i(t))));\n  //         };\n  //       })\n  //     .attr('x', function(d,i){\n  //         var id = d3.select(this).attr('data-id');\n  //         var d;\n  //         groupedData.forEach(function(dd,ii){\n  //             if(dd.code == id){\n  //                 d = dd;\n  //             }\n  //         })\n  //         if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n  //         if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n  //         if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n  //     })\n  //     .attr('opacity', function(d,i){\n  //         var d;\n  //         var id = d3.select(this).attr('data-id');\n  //         groupedData.forEach(function(dd,ii){\n  //             if(dd.code == id){\n  //                 d = dd;\n  //             }\n  //         })\n  //         var val = 0;\n  //         if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n  //         if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n  //         if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n  //         if(val>0){ return 1 } else { return 0}\n  //     })\n  // }\n}\nexport default drawRegionchart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Regionchart.js"],"names":["d3","moment","colors","addCommas","filter","maxCases","maxDeaths","maxVaccinations","xScaleCases","xScaleDeaths","xScaleVaccines","labelWidth","margin","left","top","right","rcSize","groupedData","drawRegionchart","data","options","barSpacing","regions","forEach","d","i","region","code","cumulative_cases","cumulative_deaths","cumulative_vaccines","population","country","dd","ii","ifrc_region","who_daily_latest","vaccine_daily_latest","total_vaccinations","cumulative_cases_per_100k","cumulative_deaths_per_100k","cumulative_vaccines_per_100k","isFinite","sort","a","b","max","regionChartContainer","select","attr","x","y","width","height","svg","append","rowHeight","length","rows","selectAll","enter","cumulative_totals","label","style","text","node","getBBox","rowBg","on","t","scaleLinear","range","domain","bars","region_chart_toggle","dat","parentNode","datum","dataLabel","Math","round","val","updateRegionchart"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {addCommas} from './HelperFunctions';\nimport {filter} from './App';\n\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases; \nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth; \nconst margin = { left: 20, top: 0, right: 58 };\nlet rcSize; \nlet groupedData = [];\n\nexport function drawRegionchart(data, options, filter) {\n\n    const barSpacing = 0.1;\n\n    data.regions.forEach(function(d,i){\n        d = { region: d.code, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0, population: 0};\n    })\n\n    data.country.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ // remove OTH\n                if((d.population>0)&&(d.who_daily_latest)){\n                    dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n                    dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths;\n                    dd.population += d.population;\n                }\n                if((d.population>0)&&(d.vaccine_daily_latest)){\n                    dd.cumulative_vaccines += (d.vaccine_daily_latest.total_vaccinations)||0;\n                }\n            }\n        });\n    });\n\n    data.regions.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    data.regions.sort(function(a,b){\n        return (b.cumulative_cases_per_100k) - (a.cumulative_cases_per_100k);\n    });\n\n    maxVaccinations = d3.max(data.regions, function(d,i){\n        return d.cumulative_vaccines_per_100k;\n    })\n\n    maxCases = d3.max(data.regions, function(d,i){\n        return d.cumulative_cases_per_100k;\n    })\n\n    maxDeaths = d3.max(data.regions, function(d,i){\n        return d.cumulative_deaths_per_100k;\n    });\n\n    // append region chart containerg\n    const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n    rcSize = {\n        x: regionChartContainer.attr('x'), y: regionChartContainer.attr('y'), width: regionChartContainer.attr('width'), height: regionChartContainer.attr('height')\n    }\n\n    const svg = d3.select('#layout').append('g').attr('transform', 'translate('+rcSize.x+', '+rcSize.y+')')\n    .attr('id', 'region_chart');\n\n\tvar rowHeight = rcSize.height/(data.regions.length-1); // remove OTH\n\n    var rows = svg.selectAll('.bar-row')\n\t.data(data.regions.filter(d=>d.code!=='OTH'))\n\t.enter()\n\t.append('g')\n\t.attr('class', 'bar-row')\n\t.attr('transform', function(d,i){\n\t\treturn 'translate(0,' + ((i*rowHeight) + margin.top) + ')';\n\t});\n\n    data.cumulative_totals = data.regions;\n    \n    var label = rows.append('text')\n\t.attr('y', rowHeight/2 )\n    .attr('x', margin.left-5)\n\t.attr('class', function(d,i){ return 'bar-labels bar-label-'+d.code })\n\t.style('alignment-baseline', 'middle')\n\t.style('font-size', '11px')\n    .attr('opacity', 1)\n\t.attr('fill', '#000')\n\t.text(function(d,i){\n\t\tif(d.code==='AM') return 'Americas';\n\t\tif(d.code==='EU') return 'Europe';\n\t\tif(d.code==='AF') return 'Africa';\n\t\tif(d.code==='ME') return 'Middle East and North Africa';\n\t\tif(d.code==='AP') return 'Asia-Pacific';\n\t}).style('text-anchor', 'end');\n\n    labelWidth = rows.node().getBBox().width + margin.left;\n\tlabel.attr('x', labelWidth+89);\n\tlabelWidth = labelWidth + 94;\n    d3.selectAll('.timeBar').attr('opacity',1);\n    \n    var rowBg = rows.append('rect')\n\t.attr('y', 0)\n\t.attr('x', 0)\n\t.attr('width', labelWidth)\n\t.attr('height', rowHeight-2)\n\t.style('opacity', 0)\n    .attr('fill', 'grey')\n\t.style('cursor', 'pointer')\n\t.attr('class', function(d,i){ return 'bar-bg-'+d.code })\n\t.attr('data-id', function(d,i){ return d.code })\n\t.on('mouseover', function(d){\n\t\td3.select(this).style('opacity', 0.1);\n        // var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n\t\td3.select(this).style('opacity', 0);\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\t.on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    });\n\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([labelWidth, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    var bars = rows.append('rect')\n    .attr('id', function(d,i){\n        return 'bar-'+d.code;\n    })\n\t.attr('data-id', function(d,i){ return d.code })\n    .attr('class', 'region-bar')\n    .attr('width', function(d,i){\n        if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k);\n        if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k);\n        if(options.region_chart_toggle == 'vaccines') return xScaleDeaths(d.cumulative_vaccines_per_100k);\n    })\n    .attr('x', labelWidth)\n    .style('outline', 'none')\n    .style('cursor', 'pointer')\n    .attr('y', rowHeight*barSpacing - 1)\n    .attr('height', rowHeight-((rowHeight*barSpacing)*2))\n    .style('fill', function(d){\n        return colors.regions[d.code]\n    })\n    .attr('opacity',1)\n    .on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    })\n    .on('mouseover', function(d){\n        var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\n    var dataLabel = rows.append('text')\n\t.text(function(d){\n        if(options.region_chart_toggle == 'cases') return addCommas(Math.round(d.cumulative_cases_per_100k));\n        if(options.region_chart_toggle == 'deaths') return addCommas(Math.round(d.cumulative_deaths_per_100k));\n        if(options.region_chart_toggle == 'vaccines') return addCommas(Math.round(d.cumulative_vaccines_per_100k));\n    })\n\t.attr('id', function(d,i){\n\t\treturn 'data-label'+d.code;\n\t})\n    .attr('data-id', function(d,i){ return d.code })\n\t.attr('class', 'data-label')\n\t.attr('y', rowHeight/2)\n\t.style('alignment-baseline', 'middle')\n\t.style('text-anchor', 'start')\n\t.attr('x', function(d,i){\n        if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n        if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n        if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n    })\n    .attr('opacity', function(d,i){\n        var val = 0;\n        if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n        if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n        if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n        if(val>0){ return 1 } else { return 0}\n    })\n\t.style('fill', '#696969')\n\t.style('font-weight', 'normal')\n\t.style('font-size', '10px');\n\n}\n\nexport function updateRegionchart(options,data) {\n    \n    // groupedData = [];\n\n    // data.regions.forEach(function(d,i){\n    //     groupedData.push({ region: d.code, cumulative_cases: 0, cumulative_deaths: 0, cumulative_vaccines: 0, population: d.population});\n    // })\n\n    // data.who_data.forEach(function(d,i){\n    //     data.regions.forEach(function(dd,ii){\n    //         if((dd.code==d.ifrc_region)){ // remove OTH\n    //             groupedData[ii].cumulative_cases += d.new_cases;\n    //             groupedData[ii].cumulative_deaths += d.new_deaths;\n    //         }\n    //     });\n    // });\n\n    // // vaccinations max date records\n    // var vGroup = d3.flatGroup(data.vaccines_data_cumulative, d => d.date);\n\n    // var vacGrouped = vGroup[vGroup.length-1];\n\n    // var vData = [];\n    // vacGrouped[1].forEach(function(d,i){\n    //     regions.forEach(function(dd,ii){\n    //         if((dd==d.ifrc_region)&&(dd!='OTH')){ // remove OTH\n    //             groupedData[ii].cumulative_vaccines += d.total_vaccinations;\n    //         }\n    //     })\n    // });\n\n    // groupedData.forEach(function(d,i){\n    //     d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n    //     d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n    //     d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n    //     if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n    //     if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n    //     if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    // })\n\n    // groupedData.sort(function(a,b){\n    //     if(options.region_chart_toggle == 'cases') return (b.cumulative_cases_per_100k) - (a.cumulative_cases_per_100k);\n    //     if(options.region_chart_toggle == 'deaths') return (b.cumulative_deaths_per_100k) - (a.cumulative_deaths_per_100k);\n    //     if(options.region_chart_toggle == 'vaccines') return (b.cumulative_vaccines_per_100k) - (a.cumulative_vaccines_per_100k); \n    // });\n\n    // maxVaccinations = d3.max(groupedData, function(d,i){\n    //     return d.cumulative_vaccines_per_100k;\n    // })\n\n    // maxCases = d3.max(groupedData, function(d,i){\n    //     return d.cumulative_cases_per_100k;\n    // })\n\n    // maxDeaths = d3.max(groupedData, function(d,i){\n    //     return d.cumulative_deaths_per_100k;\n    // });\n\n    // xScaleCases = d3.scaleLinear()\n\t// .range([0, rcSize.width - margin.right - labelWidth])\n\t// .domain([0, maxCases]);\n\n    // xScaleDeaths = d3.scaleLinear()\n\t// .range([0, rcSize.width - margin.right - labelWidth])\n\t// .domain([0, maxDeaths]);\n\n    // xScaleVaccines = d3.scaleLinear()\n\t// .range([0, rcSize.width - margin.right - labelWidth])\n\t// .domain([0, maxVaccinations]);\n\n    // if((maxVaccinations==0)&&(maxCases==0)&&(maxDeaths==0)){\n    //     d3.selectAll('.region-bar')\n    //     .transition().duration(500)\n    //     .attr('width', 0);\n\n    //     d3.selectAll('.data-label')\n    //     .transition()\n    //       .duration(500) \n    //       .attr('x', labelWidth)\n    //       .attr('opacity', 0);\n    // } else {\n    //     d3.selectAll('.region-bar')\n    //     .transition().duration(500)\n    //     .attr('width', function(d,i){\n    //         var id = d3.select(this).attr('data-id');\n    //         var d;\n    //         groupedData.forEach(function(dd,ii){\n    //             if(dd.code == id){\n    //                 d = dd;\n    //             }\n    //         })\n    //         var val = 0;\n    //         if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n    //         if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n    //         if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n    //         if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n    //     })   \n    //     d3.selectAll('.data-label')\n    //     .transition()\n    //       .duration(500)\n    //       .tween(\"text\", function(d,i) {\n    //         var end = 0;\n    //         var id = d3.select(this).attr('data-id');\n    //         var d;\n    //         groupedData.forEach(function(dd,ii){\n    //             if(dd.code == id){\n    //                 d = dd;\n    //             }\n    //         })\n    //         if(options.region_chart_toggle == 'cases') end = (d.cumulative_cases_per_100k);\n    //         if(options.region_chart_toggle == 'deaths') end = (d.cumulative_deaths_per_100k);  \n    //         if(options.region_chart_toggle == 'vaccines') end = (d.cumulative_vaccines_per_100k);  \n    //         var i = d3.interpolate(Math.floor((Math.random() * 2346) + 9345), end);\n    //         return function(t) {\n    //           d3.select(this).text(addCommas(Math.round(i(t))));\n    //         };\n    //       })\n    //     .attr('x', function(d,i){\n    //         var id = d3.select(this).attr('data-id');\n    //         var d;\n    //         groupedData.forEach(function(dd,ii){\n    //             if(dd.code == id){\n    //                 d = dd;\n    //             }\n    //         })\n    //         if(options.region_chart_toggle == 'cases') return xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n    //         if(options.region_chart_toggle == 'deaths') return xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n    //         if(options.region_chart_toggle == 'vaccines') return xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n    //     })\n    //     .attr('opacity', function(d,i){\n    //         var d;\n    //         var id = d3.select(this).attr('data-id');\n    //         groupedData.forEach(function(dd,ii){\n    //             if(dd.code == id){\n    //                 d = dd;\n    //             }\n    //         })\n    //         var val = 0;\n    //         if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n    //         if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n    //         if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n    //         if(val>0){ return 1 } else { return 0}\n    //     })\n\n    // }\n\n   \n\n}\n\nexport default drawRegionchart;\n"]},"metadata":{},"sourceType":"module"}