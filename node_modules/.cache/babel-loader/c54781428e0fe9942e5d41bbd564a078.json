{"ast":null,"code":"import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport { addCommas } from './HelperFunctions';\nimport { filter } from './App';\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases;\nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth;\nconst margin = {\n  left: 20,\n  top: 0,\n  right: 58\n};\nlet rcSize;\nlet groupedData = [];\nexport function drawRegionchart(data, options, filter) {\n  const barSpacing = 0.1; // reset region values to zero\n\n  data.regions.forEach(function (d, i) {\n    d.population = 0;\n    d.cumulative_deaths = 0;\n    d.cumulative_cases = 0;\n    d.cumulative_vaccines = 0;\n  }); // loop through countries and calculate region totals\n\n  data.country.forEach(function (d, i) {\n    data.regions.forEach(function (dd, ii) {\n      if (dd.code == d.ifrc_region) {\n        if (d.population > 0 && d.who_daily_latest) {\n          if (d.who_daily_latest.cumulative_cases > 0) dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n          if (d.who_daily_latest.cumulative_deaths > 0) dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths || 0;\n          dd.population += d.population;\n        }\n\n        if (d.population > 0 && d.vaccine_daily_latest) {\n          dd.cumulative_vaccines += d.vaccine_daily_latest.total_vaccinations || 0;\n        }\n      }\n    });\n  }); // calculate regions per 100k values using total population for each region\n\n  data.regions.forEach(function (d, i) {\n    d.cumulative_cases_per_100k = d.cumulative_cases / (d.population / 100000);\n    d.cumulative_deaths_per_100k = d.cumulative_deaths / (d.population / 100000);\n    d.cumulative_vaccines_per_100k = d.cumulative_vaccines / (d.population / 100000);\n    if (!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n    if (!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n    if (!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n  }); // get maximum values for each series\n\n  if (options.region_switch == 'per100') {\n    // get maximum values for each series\n    maxVaccinations = d3.max(data.regions, function (d, i) {\n      return d.cumulative_vaccines_per_100k;\n    });\n    maxCases = d3.max(data.regions, function (d, i) {\n      return d.cumulative_cases_per_100k;\n    });\n    maxDeaths = d3.max(data.regions, function (d, i) {\n      return d.cumulative_deaths_per_100k;\n    });\n  } else {\n    // get maximum values for each series\n    maxVaccinations = d3.max(data.regions, function (d, i) {\n      return d.cumulative_vaccines;\n    });\n    maxCases = d3.max(data.regions, function (d, i) {\n      return d.cumulative_cases;\n    });\n    maxDeaths = d3.max(data.regions, function (d, i) {\n      return d.cumulative_deaths;\n    });\n  } // append region chart container\n\n\n  const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0); // get dimensions\n\n  rcSize = {\n    x: regionChartContainer.attr('x'),\n    y: regionChartContainer.attr('y'),\n    width: regionChartContainer.attr('width'),\n    height: regionChartContainer.attr('height')\n  }; // create svg container\n\n  const svg = d3.select('#layout').append('g').attr('transform', 'translate(' + rcSize.x + ', ' + rcSize.y + ')').attr('id', 'region_chart'); // calculate chart row height\n\n  var rowHeight = rcSize.height / (data.regions.length - 1); // remove OTH\n  // create rows\n\n  var rows = svg.selectAll('.bar-row').data(data.regions.filter(d => d.code !== 'OTH')).enter().append('g').attr('class', 'bar-row').attr('transform', function (d, i) {\n    return 'translate(0,' + (i * rowHeight + margin.top) + ')';\n  }); // create region labels\n\n  var label = rows.append('text').attr('y', rowHeight / 2).attr('x', margin.left - 5).attr('class', function (d, i) {\n    return 'bar-labels bar-label-' + d.code;\n  }).style('alignment-baseline', 'middle').style('font-size', '11px').attr('opacity', 1).attr('fill', '#000').text(function (d, i) {\n    if (d.code === 'AM') return 'Americas';\n    if (d.code === 'EU') return 'Europe';\n    if (d.code === 'AF') return 'Africa';\n    if (d.code === 'ME') return 'Middle East and North Africa';\n    if (d.code === 'AP') return 'Asia-Pacific';\n  }).style('text-anchor', 'end'); // get label node width for use in scale\n\n  labelWidth = rows.node().getBBox().width + margin.left;\n  label.attr('x', labelWidth + 89);\n  labelWidth = labelWidth + 94;\n  d3.selectAll('.timeBar').attr('opacity', 1); // create fading background click area\n\n  var rowBg = rows.append('rect').attr('y', 0).attr('x', 0).attr('width', labelWidth).attr('height', rowHeight - 2).style('opacity', 0).attr('fill', 'grey').style('cursor', 'pointer').attr('class', function (d, i) {\n    return 'bar-bg-' + d.code;\n  }).attr('data-id', function (d, i) {\n    return d.code;\n  }).on('mouseover', function (d) {\n    d3.select(this).style('opacity', 0.1);\n  }).on('mouseout', function () {\n    d3.select(this).style('opacity', 0);\n  }).on('click', function (d, i) {\n    var t = d3.select(this).attr('data-id');\n    filter([t], 'regionchart');\n  }); // define scales\n\n  xScaleCases = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxCases]);\n  xScaleDeaths = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxDeaths]);\n  xScaleVaccines = d3.scaleLinear().range([labelWidth, rcSize.width - margin.right - labelWidth]).domain([0, maxVaccinations]);\n  var bars = rows.append('rect').attr('id', function (d, i) {\n    return 'bar-' + d.code;\n  }).attr('data-id', function (d, i) {\n    return d.code;\n  }).attr('class', 'region-bar').attr('width', function (d, i) {\n    var val = 0;\n\n    if (options.region_switch == 'per100') {\n      if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n      if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n      if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n    } else {\n      if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n      if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n      if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);\n    }\n\n    if (!isNaN(val)) {\n      return parseFloat(val);\n    } else {\n      return 0;\n    }\n  }).attr('x', labelWidth).style('outline', 'none').style('cursor', 'pointer').attr('y', rowHeight * barSpacing - 1).attr('height', rowHeight - rowHeight * barSpacing * 2).style('fill', function (d) {\n    return colors.regions[d.code];\n  }).attr('opacity', 1).on('click', function (d, i) {\n    var t = d3.select(this).attr('data-id');\n    filter([t], 'regionchart');\n  }).on('mouseover', function (d) {\n    var dat = d3.select(this.parentNode).datum(); // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n    // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n  }).on('mouseout', function () {// d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n  }); // create data value labels\n\n  var dataLabel = rows.append('text').text(function (d) {\n    var val = 0;\n\n    if (options.region_switch == 'per100') {\n      if (options.region_chart_toggle == 'cases') val = Math.round(d.cumulative_cases_per_100k);\n      if (options.region_chart_toggle == 'deaths') val = Math.round(d.cumulative_deaths_per_100k);\n      if (options.region_chart_toggle == 'vaccines') val = Math.round(d.cumulative_vaccines_per_100k);\n    } else {\n      if (options.region_chart_toggle == 'cases') val = Math.round(d.cumulative_cases);\n      if (options.region_chart_toggle == 'deaths') val = Math.round(d.cumulative_deaths);\n      if (options.region_chart_toggle == 'vaccines') val = Math.round(d.cumulative_vaccines);\n    }\n\n    return val;\n  }).attr('id', function (d, i) {\n    return 'data-label' + d.code;\n  }).attr('data-id', function (d, i) {\n    return d.code;\n  }).attr('class', 'data-label').attr('y', rowHeight / 2).style('alignment-baseline', 'middle').style('text-anchor', 'start').attr('x', function (d, i) {\n    var val = 0;\n\n    if (options.region_switch == 'per100') {\n      if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k) + labelWidth + 5;\n      if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k) + labelWidth + 5;\n      if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k) + labelWidth + 5;\n    } else {\n      if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases) + labelWidth + 5;\n      if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths) + labelWidth + 5;\n      if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines) + labelWidth + 5;\n    }\n\n    return val;\n  }).attr('opacity', function (d, i) {\n    var val = 0;\n\n    if (options.region_switch == 'per100') {\n      if (options.region_chart_toggle == 'cases') val = d.cumulative_cases_per_100k;\n      if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths_per_100k;\n      if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines_per_100k;\n    } else {\n      if (options.region_chart_toggle == 'cases') val = d.cumulative_cases;\n      if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths;\n      if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines;\n    }\n\n    if (val > 0) {\n      return 1;\n    } else {\n      return 0;\n    }\n  }).style('fill', '#696969').style('font-weight', 'normal').style('font-size', '10px');\n}\nexport function updateRegionchart(options, data) {\n  // reset region values to zero\n  data.regions.forEach(function (d, i) {\n    d.population = 0;\n    d.cumulative_deaths = 0;\n    d.cumulative_cases = 0;\n    d.cumulative_vaccines = 0;\n  }); // loop through countries and calculate region totals\n\n  data.country.forEach(function (d, i) {\n    data.regions.forEach(function (dd, ii) {\n      if (dd.code == d.ifrc_region) {\n        if (d.population > 0 && d.who_daily_latest) {\n          if (d.who_daily_latest.cumulative_cases > 0) dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n          if (d.who_daily_latest.cumulative_deaths > 0) dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths || 0;\n          dd.population += d.population;\n        }\n\n        if (d.population > 0 && d.vaccine_daily_latest) {\n          dd.cumulative_vaccines += d.vaccine_daily_latest.total_vaccinations || 0;\n        }\n      }\n    });\n  }); // calculate regions per 100k values using total population for each region\n\n  data.regions.forEach(function (d, i) {\n    d.cumulative_cases_per_100k = d.cumulative_cases / (d.population / 100000);\n    d.cumulative_deaths_per_100k = d.cumulative_deaths / (d.population / 100000);\n    d.cumulative_vaccines_per_100k = d.cumulative_vaccines / (d.population / 100000);\n    if (!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n    if (!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n    if (!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n  });\n  console.log(options);\n  console.log(data);\n\n  if (options.region_switch == 'per100') {\n    // get maximum values for each series\n    maxVaccinations = d3.max(data.regions, function (d, i) {\n      return d.cumulative_vaccines_per_100k;\n    });\n    maxCases = d3.max(data.regions, function (d, i) {\n      return d.cumulative_cases_per_100k;\n    });\n    maxDeaths = d3.max(data.regions, function (d, i) {\n      return d.cumulative_deaths_per_100k;\n    });\n  } else {\n    // get maximum values for each series\n    maxVaccinations = d3.max(data.regions, function (d, i) {\n      return d.cumulative_vaccines;\n    });\n    maxCases = d3.max(data.regions, function (d, i) {\n      return d.cumulative_cases;\n    });\n    maxDeaths = d3.max(data.regions, function (d, i) {\n      return d.cumulative_deaths;\n    });\n  } // redefine scales using new extent\n\n\n  xScaleCases = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxCases]);\n  xScaleDeaths = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxDeaths]);\n  xScaleVaccines = d3.scaleLinear().range([0, rcSize.width - margin.right - labelWidth]).domain([0, maxVaccinations]); // update bars\n\n  if (maxVaccinations == 0 && maxCases == 0 && maxDeaths == 0) {\n    d3.selectAll('.region-bar').transition().duration(500).attr('width', 0);\n    d3.selectAll('.data-label').transition().duration(500).attr('x', labelWidth).attr('opacity', 0);\n  } else {\n    d3.selectAll('.region-bar').transition().duration(500).style('fill', function (d) {\n      if (options.region_chart_toggle == 'vaccines') {\n        return colors.regions_blue[d.code];\n      } else {\n        return colors.regions[d.code];\n      }\n    }).attr('width', function (d, i) {\n      var id = d3.select(this).attr('data-id');\n      var d;\n      groupedData.forEach(function (dd, ii) {\n        if (dd.code == id) {\n          d = dd;\n        }\n      });\n      var val = 0;\n\n      if (options.region_switch == 'per100') {\n        if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n        if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n        if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n      } else {\n        if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n        if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n        if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);\n      }\n\n      if (!isNaN(val)) {\n        return parseFloat(val);\n      } else {\n        return 0;\n      }\n    });\n    d3.selectAll('.data-label').transition().duration(500).tween(\"text\", function (d, i) {\n      var val = 0;\n      var id = d3.select(this).attr('data-id');\n      var d;\n      groupedData.forEach(function (dd, ii) {\n        if (dd.code == id) {\n          d = dd;\n        }\n      });\n\n      if (options.region_switch == 'per100') {\n        if (options.region_chart_toggle == 'cases') val = Math.round(d.cumulative_cases_per_100k);\n        if (options.region_chart_toggle == 'deaths') val = Math.round(d.cumulative_deaths_per_100k);\n        if (options.region_chart_toggle == 'vaccines') val = Math.round(d.cumulative_vaccines_per_100k);\n      } else {\n        if (options.region_chart_toggle == 'cases') val = Math.round(d.cumulative_cases);\n        if (options.region_chart_toggle == 'deaths') val = Math.round(d.cumulative_deaths);\n        if (options.region_chart_toggle == 'vaccines') val = Math.round(d.cumulative_vaccines);\n      }\n\n      var i = d3.interpolate(Math.floor(Math.random() * 2346 + 9345), val);\n      return function (t) {\n        d3.select(this).text(addCommas(Math.round(i(t))));\n      };\n    }).attr('x', function (d, i) {\n      var id = d3.select(this).attr('data-id');\n      var d;\n      groupedData.forEach(function (dd, ii) {\n        if (dd.code == id) {\n          d = dd;\n        }\n      });\n      var val = 0;\n\n      if (options.region_switch == 'per100') {\n        if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k) + labelWidth + 5;\n        if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k) + labelWidth + 5;\n        if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k) + labelWidth + 5;\n      } else {\n        if (options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases) + labelWidth + 5;\n        if (options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths) + labelWidth + 5;\n        if (options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines) + labelWidth + 5;\n      }\n\n      return val;\n    }).attr('opacity', function (d, i) {\n      var d;\n      var id = d3.select(this).attr('data-id');\n      groupedData.forEach(function (dd, ii) {\n        if (dd.code == id) {\n          d = dd;\n        }\n      });\n      var val = 0;\n\n      if (options.region_switch == 'per100') {\n        if (options.region_chart_toggle == 'cases') val = d.cumulative_cases_per_100k;\n        if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths_per_100k;\n        if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines_per_100k;\n      } else {\n        if (options.region_chart_toggle == 'cases') val = d.cumulative_cases;\n        if (options.region_chart_toggle == 'deaths') val = d.cumulative_deaths;\n        if (options.region_chart_toggle == 'vaccines') val = d.cumulative_vaccines;\n      }\n\n      if (val > 0) {\n        return 1;\n      } else {\n        return 0;\n      }\n    });\n  }\n}\nexport default drawRegionchart;","map":{"version":3,"sources":["/Users/matthewsmawfield/www/ifrc-covid-dataviz/src/Regionchart.js"],"names":["d3","moment","colors","addCommas","filter","maxCases","maxDeaths","maxVaccinations","xScaleCases","xScaleDeaths","xScaleVaccines","labelWidth","margin","left","top","right","rcSize","groupedData","drawRegionchart","data","options","barSpacing","regions","forEach","d","i","population","cumulative_deaths","cumulative_cases","cumulative_vaccines","country","dd","ii","code","ifrc_region","who_daily_latest","vaccine_daily_latest","total_vaccinations","cumulative_cases_per_100k","cumulative_deaths_per_100k","cumulative_vaccines_per_100k","isFinite","region_switch","max","regionChartContainer","select","attr","x","y","width","height","svg","append","rowHeight","length","rows","selectAll","enter","label","style","text","node","getBBox","rowBg","on","t","scaleLinear","range","domain","bars","val","region_chart_toggle","isNaN","parseFloat","dat","parentNode","datum","dataLabel","Math","round","updateRegionchart","console","log","transition","duration","regions_blue","id","tween","interpolate","floor","random"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport moment from 'moment';\nimport colors from './colors';\nimport {addCommas} from './HelperFunctions';\nimport {filter} from './App';\n\nlet maxCases;\nlet maxDeaths;\nlet maxVaccinations;\nlet xScaleCases; \nlet xScaleDeaths;\nlet xScaleVaccines;\nlet labelWidth; \nconst margin = { left: 20, top: 0, right: 58 };\nlet rcSize; \nlet groupedData = [];\n\nexport function drawRegionchart(data, options, filter) {\n\n    const barSpacing = 0.1;\n\n    // reset region values to zero\n    data.regions.forEach(function(d,i){\n        d.population = 0;\n        d.cumulative_deaths = 0;\n        d.cumulative_cases = 0;\n        d.cumulative_vaccines = 0;\n    })\n\n    // loop through countries and calculate region totals\n    data.country.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ \n                if((d.population>0)&&(d.who_daily_latest)){\n                    if(d.who_daily_latest.cumulative_cases>0)\n                    dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n                    if(d.who_daily_latest.cumulative_deaths>0)\n                    dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths||0;\n                    dd.population += d.population;\n                }\n                if((d.population>0)&&(d.vaccine_daily_latest)){\n                    dd.cumulative_vaccines += (d.vaccine_daily_latest.total_vaccinations)||0;\n                }\n            }\n        });\n    });\n\n    // calculate regions per 100k values using total population for each region\n    data.regions.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    // get maximum values for each series\n    if(options.region_switch=='per100'){\n        // get maximum values for each series\n        maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines_per_100k;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases_per_100k;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths_per_100k;\n        });\n    } else {\n         // get maximum values for each series\n         maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths;\n        });\n    }\n\n    // append region chart container\n    const regionChartContainer = d3.select('#layout #region_chart_container').attr('opacity', 0);\n\n    // get dimensions\n    rcSize = {\n        x: regionChartContainer.attr('x'), y: regionChartContainer.attr('y'), width: regionChartContainer.attr('width'), height: regionChartContainer.attr('height')\n    }\n\n    // create svg container\n    const svg = d3.select('#layout').append('g').attr('transform', 'translate('+rcSize.x+', '+rcSize.y+')')\n    .attr('id', 'region_chart');\n\n    // calculate chart row height\n\tvar rowHeight = rcSize.height/(data.regions.length-1); // remove OTH\n\n    // create rows\n    var rows = svg.selectAll('.bar-row')\n\t.data(data.regions.filter(d=>d.code!=='OTH'))\n\t.enter()\n\t.append('g')\n\t.attr('class', 'bar-row')\n\t.attr('transform', function(d,i){\n\t\treturn 'translate(0,' + ((i*rowHeight) + margin.top) + ')';\n\t});\n\n    // create region labels\n    var label = rows.append('text')\n\t.attr('y', rowHeight/2 )\n    .attr('x', margin.left-5)\n\t.attr('class', function(d,i){ return 'bar-labels bar-label-'+d.code })\n\t.style('alignment-baseline', 'middle')\n\t.style('font-size', '11px')\n    .attr('opacity', 1)\n\t.attr('fill', '#000')\n\t.text(function(d,i){\n\t\tif(d.code==='AM') return 'Americas';\n\t\tif(d.code==='EU') return 'Europe';\n\t\tif(d.code==='AF') return 'Africa';\n\t\tif(d.code==='ME') return 'Middle East and North Africa';\n\t\tif(d.code==='AP') return 'Asia-Pacific';\n\t}).style('text-anchor', 'end');\n\n    // get label node width for use in scale\n    labelWidth = rows.node().getBBox().width + margin.left;\n\tlabel.attr('x', labelWidth+89);\n\tlabelWidth = labelWidth + 94;\n    d3.selectAll('.timeBar').attr('opacity',1);\n    \n    // create fading background click area\n    var rowBg = rows.append('rect')\n\t.attr('y', 0)\n\t.attr('x', 0)\n\t.attr('width', labelWidth)\n\t.attr('height', rowHeight-2)\n\t.style('opacity', 0)\n    .attr('fill', 'grey')\n\t.style('cursor', 'pointer')\n\t.attr('class', function(d,i){ return 'bar-bg-'+d.code })\n\t.attr('data-id', function(d,i){ return d.code })\n\t.on('mouseover', function(d){\n\t\td3.select(this).style('opacity', 0.1);\n\t})\n\t.on('mouseout', function(){\n\t\td3.select(this).style('opacity', 0);\n\t})\n\t.on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    });\n\n    // define scales\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([labelWidth, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    var bars = rows.append('rect')\n    .attr('id', function(d,i){\n        return 'bar-'+d.code;\n    })\n\t.attr('data-id', function(d,i){ return d.code })\n    .attr('class', 'region-bar')\n    .attr('width', function(d,i){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n        } else {\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);                \n        }\n        if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n    })\n    .attr('x', labelWidth)\n    .style('outline', 'none')\n    .style('cursor', 'pointer')\n    .attr('y', rowHeight*barSpacing - 1)\n    .attr('height', rowHeight-((rowHeight*barSpacing)*2))\n    .style('fill', function(d){\n        return colors.regions[d.code]\n    })\n    .attr('opacity',1)\n    .on('click', function(d,i){\n        var t = d3.select(this).attr('data-id');\n        filter([t],'regionchart');\n    })\n    .on('mouseover', function(d){\n        var dat = d3.select(this.parentNode).datum();\n        // d3.selectAll('.timeBar:not(.time_'+dat.region).transition().duration(500).attr('opacity', 0.3);\n        // d3.selectAll('.time_'+dat.region).attr('opacity', 1);\n\t})\n\t.on('mouseout', function(){\n        // d3.selectAll('.timeBar').transition().duration(500).attr('opacity', 1);\n\t})\n\n    // create data value labels\n    var dataLabel = rows.append('text')\n\t.text(function(d){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases_per_100k));\n            if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths_per_100k));\n            if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines_per_100k));\n        } else {\n            if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases));\n            if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths));\n            if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines));             \n        }\n        return val;\n    })\n\t.attr('id', function(d,i){\n\t\treturn 'data-label'+d.code;\n\t})\n    .attr('data-id', function(d,i){ return d.code })\n\t.attr('class', 'data-label')\n\t.attr('y', rowHeight/2)\n\t.style('alignment-baseline', 'middle')\n\t.style('text-anchor', 'start')\n\t.attr('x', function(d,i){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n        } else {\n            if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases)+labelWidth+5;\n            if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths)+labelWidth+5;\n            if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;               \n        }\n        return val;\n    })\n    .attr('opacity', function(d,i){\n        var val = 0;\n        if(options.region_switch=='per100'){\n            if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n            if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n            if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n        } else {\n            if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases);\n            if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths);\n            if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines);\n        }\n        if(val>0){ return 1 } else { return 0}\n    })\n\t.style('fill', '#696969')\n\t.style('font-weight', 'normal')\n\t.style('font-size', '10px');\n\n}\n\nexport function updateRegionchart(options,data) {\n    \n    // reset region values to zero\n    data.regions.forEach(function(d,i){\n        d.population = 0;\n        d.cumulative_deaths = 0;\n        d.cumulative_cases = 0;\n        d.cumulative_vaccines = 0;\n    })\n\n    // loop through countries and calculate region totals\n    data.country.forEach(function(d,i){\n        data.regions.forEach(function(dd,ii){\n            if((dd.code==d.ifrc_region)){ \n                if((d.population>0)&&(d.who_daily_latest)){\n                    if(d.who_daily_latest.cumulative_cases>0)\n                    dd.cumulative_cases += d.who_daily_latest.cumulative_cases;\n                    if(d.who_daily_latest.cumulative_deaths>0)\n                    dd.cumulative_deaths += d.who_daily_latest.cumulative_deaths||0;\n                    dd.population += d.population;\n                }\n                if((d.population>0)&&(d.vaccine_daily_latest)){\n                    dd.cumulative_vaccines += (d.vaccine_daily_latest.total_vaccinations)||0;\n                }\n            }\n        });\n    });\n\n    // calculate regions per 100k values using total population for each region\n    data.regions.forEach(function(d,i){\n        d.cumulative_cases_per_100k = d.cumulative_cases/(d.population/100000)\n        d.cumulative_deaths_per_100k = d.cumulative_deaths/(d.population/100000);\n        d.cumulative_vaccines_per_100k = d.cumulative_vaccines/(d.population/100000);\n        if(!isFinite(d.cumulative_cases_per_100k)) d.cumulative_cases_per_100k = 0;\n        if(!isFinite(d.cumulative_deaths_per_100k)) d.cumulative_deaths_per_100k = 0;\n        if(!isFinite(d.cumulative_vaccines_per_100k)) d.cumulative_vaccines_per_100k = 0;\n    })\n\n    console.log(options);\n    console.log(data);\n\n    if(options.region_switch=='per100'){\n        // get maximum values for each series\n        maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines_per_100k;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases_per_100k;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths_per_100k;\n        });\n    } else {\n         // get maximum values for each series\n         maxVaccinations = d3.max(data.regions, function(d,i){\n            return d.cumulative_vaccines;\n        })\n\n        maxCases = d3.max(data.regions, function(d,i){\n            return d.cumulative_cases;\n        })\n\n        maxDeaths = d3.max(data.regions, function(d,i){\n            return d.cumulative_deaths;\n        });\n    }\n\n    // redefine scales using new extent\n    xScaleCases = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxCases]);\n\n    xScaleDeaths = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxDeaths]);\n\n    xScaleVaccines = d3.scaleLinear()\n\t.range([0, rcSize.width - margin.right - labelWidth])\n\t.domain([0, maxVaccinations]);\n\n    // update bars\n    if((maxVaccinations==0)&&(maxCases==0)&&(maxDeaths==0)){\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .attr('width', 0);\n\n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500) \n          .attr('x', labelWidth)\n          .attr('opacity', 0);\n    } else {\n        d3.selectAll('.region-bar')\n        .transition().duration(500)\n        .style('fill', function(d){\n            if(options.region_chart_toggle=='vaccines'){\n                return colors.regions_blue[d.code]\n            } else {\n                return colors.regions[d.code]\n            }\n        })\n        .attr('width', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k);\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k);\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k);\n            } else {\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases);\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths);\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines);                \n            }\n            if(!isNaN(val)) { return parseFloat(val) } else { return 0}\n        })   \n        d3.selectAll('.data-label')\n        .transition()\n          .duration(500)\n          .tween(\"text\", function(d,i) {\n            var val = 0;\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases_per_100k));\n                if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths_per_100k));\n                if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines_per_100k));\n            } else {\n                if(options.region_chart_toggle == 'cases') val = (Math.round(d.cumulative_cases));\n                if(options.region_chart_toggle == 'deaths') val = (Math.round(d.cumulative_deaths));\n                if(options.region_chart_toggle == 'vaccines') val = (Math.round(d.cumulative_vaccines));             \n            }\n            var i = d3.interpolate(Math.floor((Math.random() * 2346) + 9345), val);\n            return function(t) {\n              d3.select(this).text(addCommas(Math.round(i(t))));\n            };\n          })\n        .attr('x', function(d,i){\n            var id = d3.select(this).attr('data-id');\n            var d;\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases_per_100k)+labelWidth+5;\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths_per_100k)+labelWidth+5;\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines_per_100k)+labelWidth+5;\n            } else {\n                if(options.region_chart_toggle == 'cases') val = xScaleCases(d.cumulative_cases)+labelWidth+5;\n                if(options.region_chart_toggle == 'deaths') val = xScaleDeaths(d.cumulative_deaths)+labelWidth+5;\n                if(options.region_chart_toggle == 'vaccines') val = xScaleVaccines(d.cumulative_vaccines)+labelWidth+5;               \n            }\n            return val;\n        })\n        .attr('opacity', function(d,i){\n            var d;\n            var id = d3.select(this).attr('data-id');\n            groupedData.forEach(function(dd,ii){\n                if(dd.code == id){\n                    d = dd;\n                }\n            })\n            var val = 0;\n            if(options.region_switch=='per100'){\n                if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases_per_100k);\n                if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths_per_100k);\n                if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines_per_100k);\n            } else {\n                if(options.region_chart_toggle == 'cases') val = (d.cumulative_cases);\n                if(options.region_chart_toggle == 'deaths') val = (d.cumulative_deaths);\n                if(options.region_chart_toggle == 'vaccines') val = (d.cumulative_vaccines);\n            }\n            if(val>0){ return 1 } else { return 0}\n        })\n\n    }\n\n}\n\nexport default drawRegionchart;\n"]},"metadata":{},"sourceType":"module"}